(window.webpackJsonp=window.webpackJsonp||[]).push([[14],Array(179).concat([function(e,t,n){"use strict";var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a=n(213);function o(){return"undefined"!==typeof navigator&&navigator.userAgent?navigator.userAgent:"Unknown"}function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function c(e,t,n,i){if(!(i in t)&&!i.match(/^on[a-z]+$/)){var a=void 0;try{a=r(e[i])}catch(o){}"function"===a&&(t[i]=function(){var e;return(e=this[n])[i].apply(e,arguments)})}}var u=void 0;t.constants=a,t.asLocalTrack=function(e,t){if(e instanceof t.LocalAudioTrack||e instanceof t.LocalVideoTrack||e instanceof t.LocalDataTrack)return e;if(e instanceof t.MediaStreamTrack)return"audio"===e.kind?new t.LocalAudioTrack(e,t):new t.LocalVideoTrack(e,t);throw a.typeErrors.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")},t.asLocalTrackPublication=function(e,t,n,r){return new(0,{audio:r.LocalAudioTrackPublication,video:r.LocalVideoTrackPublication,data:r.LocalDataTrackPublication}[e.kind])(t,e,n,r)},t.capitalize=function(e){return e[0].toUpperCase()+e.slice(1)},t.deprecateEvents=function(e,t,n,r){var i=new Set;t.on("newListener",function a(o){n.has(o)&&!i.has(o)&&(r.deprecated(e+"#"+o+" has been deprecated and scheduled for removal in twilio-video.js@2.0.0."+(n.get(o)?" Use "+e+"#"+n.get(o)+" instead.":"")),i.add(o)),i.size>=n.size&&t.removeListener("newListener",a)})},t.difference=function(e,t){e=Array.isArray(e)?new Set(e):new Set(e.values()),t=Array.isArray(t)?new Set(t):new Set(t.values());var n=new Set;return e.forEach(function(e){t.has(e)||n.add(e)}),n},t.filterObject=function(e,t){return Object.keys(e).reduce(function(n,r){return e[r]!==t&&(n[r]=e[r]),n},{})},t.flatMap=function(e,t){var n=e instanceof Map||e instanceof Set?Array.from(e.values()):e;return t=t||function(e){return e},n.reduce(function(e,n){var r=t(n);return e.concat(r)},[])},t.getUserAgent=o,t.guessBrowser=function(){return"undefined"!==typeof webkitRTCPeerConnection?"chrome":"undefined"!==typeof mozRTCPeerConnection?"firefox":"undefined"!==typeof RTCPeerConnection&&o().match(/AppleWebKit\/(\d+)\./)?"safari":null},t.makeClientSIPURI=function(){return s()+"@"+a.REGISTRAR_SERVER},t.makeServerSIPURI=function(){return"orchestrator@"+a.REGISTRAR_SERVER},t.makeUUID=s,t.oncePerTick=function(e){var t=null;function n(){t=null,e()}return function(){t&&clearTimeout(t),t=setTimeout(n)}},t.promiseFromEvents=function(e,t,n,r){return new Promise(function(a,o){function s(){var e=[].slice.call(arguments);r&&t.removeListener(r,c),a.apply(void 0,i(e))}function c(){var e=[].slice.call(arguments);t.removeListener(n,s),o.apply(void 0,i(e))}t.once(n,s),r&&t.once(r,c),e()})},t.getOrNull=function(e,t){return t.split(".").reduce(function(e,t){return e?e[t]:null},e)},t.defer=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},t.delegateMethods=function(e,t,n){for(var r in e)c(e,t,n,r)},t.proxyProperties=function(e,t,n){Object.getOwnPropertyNames(e).forEach(function(e){!function(e,t,n,r){if(!(r in t))r.match(/^on[a-z]+$/)?(Object.defineProperty(t,r,{value:null,writable:!0}),n.addEventListener(r.slice(2),function(){t.dispatchEvent.apply(t,arguments)})):Object.defineProperty(t,r,{enumerable:!0,get:function(){return n[r]}})}(0,t,n,e)})},t.legacyPromise=function(e,t,n){return t?e.then(function(e){t(e)},function(e){n(e)}):e},t.buildLogLevels=function(e){return"string"===typeof e?{default:e,media:e,signaling:e,webrtc:e}:e},t.trackClass=function(e,t){return(t=t?"Local":"")+(e.kind||"").replace(/\w{1}/,function(e){return e.toUpperCase()})+"Track"},t.trackPublicationClass=function(e,t){return(t=t?"Local":"")+(e.kind||"").replace(/\w{1}/,function(e){return e.toUpperCase()})+"TrackPublication"},t.validateLocalTrack=function(e,t){if(!(e instanceof t.LocalAudioTrack||e instanceof t.LocalDataTrack||e instanceof t.LocalVideoTrack||e instanceof t.MediaStreamTrack))throw a.typeErrors.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")},t.getSdpFormat=function(e){return"undefined"!==typeof mozRTCPeerConnection||"unified-plan"===e&&function(){if("boolean"===typeof u)return u;if("undefined"===typeof RTCPeerConnection)return u=!1;try{return new RTCPeerConnection({sdpSemantics:"bogus"}),u=!1}catch(e){return u=!0}}()?"unified":"planb"}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";e.exports.DEFAULT_ENVIRONMENT="prod",e.exports.DEFAULT_REALM="us1",e.exports.DEFAULT_LOG_LEVEL="warn",e.exports.REGISTRAR_SERVER="endpoint.twilio.com",e.exports.WS_SERVER=function(e,t){switch(e){case"prod":switch(t){case"us1":return"wss://endpoint.twilio.com";default:return"wss://endpoint."+t+".twilio.com"}default:return"wss://endpoint."+e+"-"+t+".twilio.com"}},e.exports.ECS_SERVER=function(e,t){switch(e){case"prod":return"https://ecs."+t+".twilio.com";default:return"https://ecs."+e+"-"+t+".twilio.com"}},e.exports.ECS_TIMEOUT=60,e.exports.PUBLISH_MAX_ATTEMPTS=5,e.exports.PUBLISH_BACKOFF_JITTER=10,e.exports.PUBLISH_BACKOFF_MS=20,e.exports.ICE_SERVERS_TIMEOUT_MS=3e3,e.exports.ICE_SERVERS_DEFAULT_TTL=3600,e.exports.DEFAULT_ICE_SERVERS=function(e){switch(e){case"prod":return[{urls:"stun:global.stun.twilio.com:3478?transport=udp"}];default:return[{urls:"stun:global.stun."+e+".twilio.com:3478?transport=udp"}]}},e.exports.headers={X_TWILIO_ACCESSTOKEN:"X-Twilio-AccessToken"},e.exports.typeErrors={INVALID_TYPE:function(e,t){return new TypeError(e+" must be "+(["a","e","i","o","u"].includes(t.toLowerCase()[0])?"an":"a")+" "+t)},INVALID_VALUE:function(e,t){return new RangeError(e+" must be one of ",t.join(", "))},REQUIRED_ARGUMENT:function(e){return new TypeError(e+" must be specified")}}},,,,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=n(1548),s={};t.createTwilioError=function(e,t){return t="string"===typeof t&&t?t:"Unknown error",s[e="number"===typeof e?e:0]?new s[e]:new o(e,t)};var c=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20101,"Invalid Access Token"))}return a(t,o),t}();t.AccessTokenInvalidError=c,Object.defineProperty(s,20101,{value:c});var u=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20102,"Invalid Access Token header"))}return a(t,o),t}();t.AccessTokenHeaderInvalidError=u,Object.defineProperty(s,20102,{value:u});var l=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20103,"Invalid Access Token issuer/subject"))}return a(t,o),t}();t.AccessTokenIssuerInvalidError=l,Object.defineProperty(s,20103,{value:l});var d=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20104,"Access Token expired or expiration date invalid"))}return a(t,o),t}();t.AccessTokenExpiredError=d,Object.defineProperty(s,20104,{value:d});var f=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20105,"Access Token not yet valid"))}return a(t,o),t}();t.AccessTokenNotYetValidError=f,Object.defineProperty(s,20105,{value:f});var h=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20106,"Invalid Access Token grants"))}return a(t,o),t}();t.AccessTokenGrantsInvalidError=h,Object.defineProperty(s,20106,{value:h});var p=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20107,"Invalid Access Token signature"))}return a(t,o),t}();t.AccessTokenSignatureInvalidError=p,Object.defineProperty(s,20107,{value:p});var v=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53e3,"Signaling connection error"))}return a(t,o),t}();t.SignalingConnectionError=v,Object.defineProperty(s,53e3,{value:v});var m=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53001,"Signaling connection disconnected"))}return a(t,o),t}();t.SignalingConnectionDisconnectedError=m,Object.defineProperty(s,53001,{value:m});var g=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53002,"Signaling connection timed out"))}return a(t,o),t}();t.SignalingConnectionTimeoutError=g,Object.defineProperty(s,53002,{value:g});var y=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53003,"Client received an invalid signaling message"))}return a(t,o),t}();t.SignalingIncomingMessageInvalidError=y,Object.defineProperty(s,53003,{value:y});var b=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53004,"Client sent an invalid signaling message"))}return a(t,o),t}();t.SignalingOutgoingMessageInvalidError=b,Object.defineProperty(s,53004,{value:b});var _=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53100,"Room name is invalid"))}return a(t,o),t}();t.RoomNameInvalidError=_,Object.defineProperty(s,53100,{value:_});var k=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53101,"Room name is too long"))}return a(t,o),t}();t.RoomNameTooLongError=k,Object.defineProperty(s,53101,{value:k});var w=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53102,"Room name contains invalid characters"))}return a(t,o),t}();t.RoomNameCharsInvalidError=w,Object.defineProperty(s,53102,{value:w});var T=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53103,"Unable to create Room"))}return a(t,o),t}();t.RoomCreateFailedError=T,Object.defineProperty(s,53103,{value:T});var S=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53104,"Unable to connect to Room"))}return a(t,o),t}();t.RoomConnectFailedError=S,Object.defineProperty(s,53104,{value:S});var C=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53105,"Room contains too many Participants"))}return a(t,o),t}();t.RoomMaxParticipantsExceededError=C,Object.defineProperty(s,53105,{value:C});var E=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53106,"Room not found"))}return a(t,o),t}();t.RoomNotFoundError=E,Object.defineProperty(s,53106,{value:E});var R=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53107,"MaxParticipants is out of range"))}return a(t,o),t}();t.RoomMaxParticipantsOutOfRangeError=R,Object.defineProperty(s,53107,{value:R});var O=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53108,"RoomType is not valid"))}return a(t,o),t}();t.RoomTypeInvalidError=O,Object.defineProperty(s,53108,{value:O});var x=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53109,"Timeout is out of range"))}return a(t,o),t}();t.RoomTimeoutOutOfRangeError=x,Object.defineProperty(s,53109,{value:x});var P=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53110,"StatusCallbackMethod is invalid"))}return a(t,o),t}();t.RoomStatusCallbackMethodInvalidError=P,Object.defineProperty(s,53110,{value:P});var I=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53111,"StatusCallback is invalid"))}return a(t,o),t}();t.RoomStatusCallbackInvalidError=I,Object.defineProperty(s,53111,{value:I});var A=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53112,"Status is invalid"))}return a(t,o),t}();t.RoomStatusInvalidError=A,Object.defineProperty(s,53112,{value:A});var j=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53113,"Room exists"))}return a(t,o),t}();t.RoomRoomExistsError=j,Object.defineProperty(s,53113,{value:j});var M=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53114,"Room creation parameter(s) incompatible with the Room type"))}return a(t,o),t}();t.RoomInvalidParametersError=M,Object.defineProperty(s,53114,{value:M});var D=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53115,"MediaRegion is invalid"))}return a(t,o),t}();t.RoomMediaRegionInvalidError=D,Object.defineProperty(s,53115,{value:D});var N=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53116,"There are no media servers available in the MediaRegion"))}return a(t,o),t}();t.RoomMediaRegionUnavailableError=N,Object.defineProperty(s,53116,{value:N});var U=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53117,"The subscription operation requested is not supported for the Room type"))}return a(t,o),t}();t.RoomSubscriptionOperationNotSupportedError=U,Object.defineProperty(s,53117,{value:U});var L=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53118,"Room completed"))}return a(t,o),t}();t.RoomCompletedError=L,Object.defineProperty(s,53118,{value:L});var $=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53200,"Participant identity is invalid"))}return a(t,o),t}();t.ParticipantIdentityInvalidError=$,Object.defineProperty(s,53200,{value:$});var X=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53201,"Participant identity is too long"))}return a(t,o),t}();t.ParticipantIdentityTooLongError=X,Object.defineProperty(s,53201,{value:X});var q=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53202,"Participant identity contains invalid characters"))}return a(t,o),t}();t.ParticipantIdentityCharsInvalidError=q,Object.defineProperty(s,53202,{value:q});var F=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53203,"Participant has too many Tracks"))}return a(t,o),t}();t.ParticipantMaxTracksExceededError=F,Object.defineProperty(s,53203,{value:F});var H=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53204,"Participant not found"))}return a(t,o),t}();t.ParticipantNotFoundError=H,Object.defineProperty(s,53204,{value:H});var B=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53205,"Participant disconnected because of duplicate identity"))}return a(t,o),t}();t.ParticipantDuplicateIdentityError=B,Object.defineProperty(s,53205,{value:B});var V=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53300,"Track is invalid"))}return a(t,o),t}();t.TrackInvalidError=V,Object.defineProperty(s,53300,{value:V});var W=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53301,"Track name is invalid"))}return a(t,o),t}();t.TrackNameInvalidError=W,Object.defineProperty(s,53301,{value:W});var G=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53302,"Track name is too long"))}return a(t,o),t}();t.TrackNameTooLongError=G,Object.defineProperty(s,53302,{value:G});var z=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53303,"Track name contains invalid characters"))}return a(t,o),t}();t.TrackNameCharsInvalidError=z,Object.defineProperty(s,53303,{value:z});var K=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53304,"Track name is duplicated"))}return a(t,o),t}();t.TrackNameIsDuplicatedError=K,Object.defineProperty(s,53304,{value:K});var J=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53305,"The server has reached capacity and cannot fulfill this request."))}return a(t,o),t}();t.TrackServerTrackCapacityReachedError=J,Object.defineProperty(s,53305,{value:J});var Y=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53400,"Client is unable to create or apply a local media description"))}return a(t,o),t}();t.MediaClientLocalDescFailedError=Y,Object.defineProperty(s,53400,{value:Y});var Q=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53401,"Server is unable to create or apply a local media description"))}return a(t,o),t}();t.MediaServerLocalDescFailedError=Q,Object.defineProperty(s,53401,{value:Q});var Z=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53402,"Client is unable to apply a remote media description"))}return a(t,o),t}();t.MediaClientRemoteDescFailedError=Z,Object.defineProperty(s,53402,{value:Z});var ee=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53403,"Server is unable to apply a remote media description"))}return a(t,o),t}();t.MediaServerRemoteDescFailedError=ee,Object.defineProperty(s,53403,{value:ee});var te=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53404,"No supported codec"))}return a(t,o),t}();t.MediaNoSupportedCodecError=te,Object.defineProperty(s,53404,{value:te});var ne=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53405,"Media connection failed"))}return a(t,o),t}();t.MediaConnectionError=ne,Object.defineProperty(s,53405,{value:ne});var re=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53500,"Unable to acquire configuration"))}return a(t,o),t}();t.ConfigurationAcquireFailedError=re,Object.defineProperty(s,53500,{value:re});var ie=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53501,"Unable to acquire TURN credentials"))}return a(t,o),t}();t.ConfigurationAcquireTurnFailedError=ie,Object.defineProperty(s,53501,{value:ie})},,,,,,,,,,,,function(e,t,n){"use strict";var r=o(n(152)),i=o(n(161)),a=o(n(457));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(348);function c(e,t){return[(new Date).toISOString()+" Chat "+e+":"].concat((0,a.default)(t))}var u=function(){function e(t){(0,r.default)(this,e),this.prefix="",this.prefix=null!==t&&void 0!==t&&t.length>0?t+" ":""}return(0,i.default)(e,[{key:"setLevel",value:function(e){s.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.trace.apply(null,c(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.debug.apply(null,c(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.info.apply(null,c(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.warn.apply(null,c(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.error.apply(null,c(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){s.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.trace.apply(null,c("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.debug.apply(null,c("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.info.apply(null,c("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.warn.apply(null,c("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s.error.apply(null,c("E",t))}}]),e}();t.Logger=u},,,,,,,function(e,t,n){e.exports={default:n(1643),__esModule:!0}},,,,,,,,,,,function(e,t,n){"use strict";var r=o(n(152)),i=o(n(161)),a=o(n(311));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1647);t.isDeepEqual=function(e,t){return 0===s.createPatch(e,t).length},t.deepClone=function(e){return JSON.parse((0,a.default)(e))},t.parseToNumber=function(e){return"undefined"===typeof e||isNaN(Number(e))?null:Number(e)};var c=function(){function e(t){(0,r.default)(this,e),this.base=t.replace(/\/$/,""),this.args=[],this.paths=[]}return(0,i.default)(e,[{key:"arg",value:function(e,t){return"undefined"!==typeof t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"path",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();t.UriBuilder=c},,,,,,,,,,,,function(e,t,n){"use strict";function r(e,t,n,r){if(!(r in t)&&!r.match(/^on[a-z]+$/)){var i;try{i=typeof e[r]}catch(a){}"function"===i&&(t[r]=function(){return this[n][r].apply(this[n],arguments)})}}t.defer=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},t.delegateMethods=function(e,t,n){for(var i in e)r(e,t,n,i)},t.difference=function(e,t){e=Array.isArray(e)?new Set(e):new Set(e.values()),t=Array.isArray(t)?new Set(t):new Set(t.values());var n=new Set;return e.forEach(function(e){t.has(e)||n.add(e)}),n},t.flatMap=function(e,t){return(e instanceof Map||e instanceof Set?Array.from(e.values()):e).reduce(function(e,n){var r=t(n);return e.concat(r)},[])},t.guessBrowser=function(){return"undefined"!==typeof webkitRTCPeerConnection?"chrome":"undefined"!==typeof mozRTCPeerConnection?"firefox":"undefined"!==typeof RTCPeerConnection&&"undefined"!==typeof navigator&&navigator.userAgent.match(/AppleWebKit\/(\d+)\./)?"safari":null},t.interceptEvent=function(e,t){var n=null;Object.defineProperty(e,"on"+t,{get:function(){return n},set:function(e){n&&this.removeEventListener(t,n),"function"===typeof e?(n=e,this.addEventListener(t,n)):n=null}})},t.legacyPromise=function(e,t,n){return t?e.then(function(e){t(e)},function(e){n(e)}):e},t.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},t.proxyProperties=function(e,t,n){Object.getOwnPropertyNames(e).forEach(function(e){!function(e,t,n,r){if(!(r in t))r.match(/^on[a-z]+$/)?(Object.defineProperty(t,r,{value:null,writable:!0}),n.addEventListener(r.slice(2),function(){t.dispatchEvent.apply(t,arguments)})):Object.defineProperty(t,r,{enumerable:!0,get:function(){return n[r]}})}(0,t,n,e)})}},function(e,t,n){"use strict";var r=n(179).difference,i=n(179).flatMap,a=n(1563),o={0:"PCMU",8:"PCMA"},s=16e3;function c(e,t){return t?"\r\nb="+e+":"+("AS"===e?Math.round((t+s)/950):t):null}function u(e){return Array.from(l(e)).reduce(function(e,t){var n=t[0],r=t[1],i=e.get(r)||[];return e.set(r,i.concat(n))},new Map)}function l(e){return f(e).reduce(function(t,n){var r=new RegExp("a=rtpmap:"+n+" ([^/]+)"),i=e.match(r),a=i?i[1].toLowerCase():o[n]?o[n].toLowerCase():"";return t.set(n,a)},new Map)}function d(e,t,n){return e.replace(/\r\n\r\n$/,"\r\n").split("\r\nm=").slice(1).map(function(e){return"m="+e}).filter(function(e){var r=new RegExp("m="+(t||".*"),"gm"),i=new RegExp("a="+(n||".*"),"gm");return r.test(e)&&i.test(e)})}function f(e){var t=e.split("\r\n")[0].match(/([0-9]+)/g);return t?t.slice(1).map(function(e){return parseInt(e,10)}):[]}t.createCodecMapForMediaSection=u,t.createPtToCodecName=l,t.getMediaSections=d,t.setBitrateParameters=function(e,t,n,r){var i=d(e);return[e.split("\r\nm=")[0]].concat(i.map(function(e){if(!/^m=(audio|video)/.test(e)||!/a=(recvonly|sendrecv)/.test(e))return e;var i=e.match(/^m=(audio|video)/)[1];return function(e,t,n){var r=c(e,t)||"",i=/\r\nb=(AS|TIAS):([0-9]+)/,a=n.match(i);if(!a)return n.replace(/(\r\n)?$/,r+"$1");var o=parseInt(a[2],10);return t=t||1/0,r=c(e,Math.min(o,t)),n.replace(i,r)}(t,"audio"===i?n:r,e)})).join("\r\n")},t.setCodecPreferences=function(e,t,n){var a=d(e);return[e.split("\r\nm=")[0]].concat(a.map(function(e){if(!/^m=(audio|video)/.test(e))return e;var a=e.match(/^m=(audio|video)/)[1],o=u(e),s=function(e,t){t=t.map(function(e){return e.toLowerCase()});var n=i(t,function(t){return e.get(t)||[]}),a=r(Array.from(e.keys()),t),o=i(a,function(t){return e.get(t)});return n.concat(o)}(o,"audio"===a?t:n.map(function(e){return e.codec})),c=function(e,t){var n=t.split("\r\n"),r=n[0],i=n.slice(1);return[r=r.replace(/([0-9]+\s?)+$/,e.join(" "))].concat(i).join("\r\n")}(s,e),l=o.get("pcma")||[],d=o.get("pcmu")||[];return("audio"===a?new Set(l.concat(d)):new Set).has(s[0])?c.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):c})).join("\r\n")},t.setSimulcast=function(e,t){var n=d(e);return[e.split("\r\nm=")[0]].concat(n.map(function(e){if(e=e.replace(/\r\n$/,""),!/^m=video/.test(e))return e;var n=u(e),r=f(e),i=new Set(n.get("vp8")||[]);return r.some(function(e){return i.has(e)})?a(e,t):e})).concat("").join("\r\n")}},function(e,t,n){e.exports={default:n(1651),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1667);t.TwilsockClient=r.TwilsockClient,t.Twilsock=r.TwilsockClient;var i=n(285);t.TwilsockError=i.TwilsockError;var a=n(1692);t.TransportUnavailableError=a.TransportUnavailableError},,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r={};Object.defineProperties(r,{getStats:{enumerable:!0,value:n(1519)},getUserMedia:{enumerable:!0,value:n(1520)},MediaStream:{enumerable:!0,value:n(791)},MediaStreamTrack:{enumerable:!0,value:n(1521)},RTCIceCandidate:{enumerable:!0,value:n(1522)},RTCPeerConnection:{enumerable:!0,value:n(1523)},RTCSessionDescription:{enumerable:!0,value:n(1527)},version:{enumerable:!0,value:n(1528).version}}),e.exports=r},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=n(348);function o(e,t){return["".concat((new Date).toISOString()," Twilsock ").concat(e,":")].concat(Array.from(t))}var s=function(){function e(t){r(this,e),this.prefix="",this.prefix=null!==t&&void 0!==t&&t.length>0?" "+t+":":""}return i(e,[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.debug.apply(null,o("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.debug.apply(null,o("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.info.apply(null,o("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.warn.apply(null,o("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.error.apply(null,o("E",t))}}],[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.trace.apply(null,o("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.debug.apply(null,o("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.info.apply(null,o("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.warn.apply(null,o("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.error.apply(null,o("E",t))}}]),e}();t.Logger=s;var c=new s("");t.log=c},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173),s=n(404);Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(e){return r(this,t),i(this,a(t).call(this,e))}return o(t,e),t}(s(Error));t.TwilsockError=c},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173),s=n(404);Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r(this,t),(n=i(this,a(t).call(this))).name=n.constructor.name,n.message="".concat(e," (status: ").concat(o,", code: ").concat(s,")"),n.status=o,n.code=s,n}return o(t,e),t}(s(Error));t.SyncError=c,t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(348);function i(e,t){return["".concat((new Date).toISOString()," Sync ").concat(e,":")].concat(Array.from(t))}t.default={setLevel:function(e){r.setLevel(e)},trace:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.trace.apply(null,i("T",t))},debug:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.debug.apply(null,i("D",t))},info:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.info.apply(null,i("I",t))},warn:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.warn.apply(null,i("W",t))},error:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r.error.apply(null,i("E",t))}}},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=n(213).DEFAULT_LOG_LEVEL,o=n(213).typeErrors,s=void 0;var c=function(){function e(t,n,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!==typeof t)throw o.INVALID_TYPE("moduleName","string");if(!n)throw o.REQUIRED_ARGUMENT("component");"object"!==("undefined"===typeof i?"undefined":r(i))&&(i={}),h(i),Object.defineProperties(this,{_component:{value:n},_logLevels:{value:i},_warnings:{value:new Set},logLevel:{get:function(){return e.getLevelByName(i[t]||a)}},name:{get:n.toString.bind(n)}})}return i(e,[{key:"createLog",value:function(t,n){return new e(t,n,this._logLevels)}},{key:"setLevels",value:function(e){return h(e),Object.assign(this._logLevels,e),this}},{key:"log",value:function(t,n){var r=e._levels[t];if(!r)throw o.INVALID_VALUE("logLevel",l);if(this.logLevel<=t){var i=r.name,a=(new Date).toISOString().split("T").concat(["|",i,"in",this.name+":"]);r.logFn.apply(console,a.concat(n))}return this}},{key:"debug",value:function(){return this.log(e.DEBUG,[].slice.call(arguments))}},{key:"deprecated",value:function(e){var t=function(e){if((s=s||new Map).has(e))return s.get(e);var t=new Set;return s.set(e,t),t}(this._component.constructor);return t.has(e)?this:(t.add(e),this.warn(e))}},{key:"info",value:function(){return this.log(e.INFO,[].slice.call(arguments))}},{key:"warn",value:function(){return this.log(e.WARN,[].slice.call(arguments))}},{key:"warnOnce",value:function(e){return this._warnings.has(e)?this:(this._warnings.add(e),this.warn(e))}},{key:"error",value:function(){return this.log(e.ERROR,[].slice.call(arguments))}},{key:"throw",value:function(t,n){throw t.clone&&(t=t.clone(n)),this.log(e.ERROR,t),t}}],[{key:"getLevelByName",value:function(t){return isNaN(t)?(f(t=t.toUpperCase()),e[t]):parseInt(t,10)}}]),e}();Object.defineProperties(c,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:[{name:"DEBUG",logFn:console.log},{name:"INFO",logFn:console.info},{name:"WARN",logFn:console.warn},{name:"ERROR",logFn:console.error},{name:"OFF",logFn:function(){}}]}});var u={},l=[],d=c._levels.map(function(e,t){return u[e.name]=!0,l.push(t),e.name});function f(e){if(!(e in u))throw o.INVALID_VALUE("level",d)}function h(e){Object.keys(e).forEach(function(t){f(e[t].toUpperCase())})}e.exports=c},function(e,t,n){e.exports={default:n(1646),__esModule:!0}},function(e,t,n){"use strict";var r=n(159);Object.defineProperty(t,"__esModule",{value:!0});var i=n(313);t.AbstractMessage=function e(t){r(this,e),this.id=t||"TM".concat(i.v4())}},function(e,t,n){var r=n(1674),i=n(1675),a=i;a.v1=r,a.v4=i,e.exports=a},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=n(286);function o(e){return!isNaN(parseInt(e))&&isFinite(e)}function s(e){return o(e)&&e>=0}t.deepClone=function(e){return JSON.parse(JSON.stringify(e))},t.validateOptionalTtl=function(e){if(void 0!==e&&!s(e))throw new a.default("Invalid TTL value, expected a positive integer, was '".concat(e,"'"),400,54011)},t.validateMandatoryTtl=function(e){if(!s(e))throw new a.default("Invalid TTL value, expected a positive integer, was '".concat(e,"'"),400,54011)},t.validatePageSize=function(e){var t;if(!(void 0===e||o(t=e)&&t>0))throw new a.default("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,54455)};var c=function(){function e(t){r(this,e),this.base=t,this.args=new Array,this.paths=new Array}return i(e,[{key:"pathSegment",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"queryParam",value:function(e,t){return"undefined"!==typeof t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();t.UriBuilder=c},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=n(169).EventEmitter,o=n(179),s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r,i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=null,o=e;return n=function(e){var t=new Map;for(var n in e)t.set(n,new Set(e[n]));return t}(n),Object.defineProperties(i,{_lock:{get:function(){return a},set:function(e){a=e}},_reachableStates:{value:(r=n,Array.from(r.keys()).reduce(function(e,t){return e.set(t,function e(t,n,r){r=r||new Set;t.get(n).forEach(function(n){r.has(n)||(r.add(n),e(t,n,r).forEach(r.add,r))});return r}(r,t))},new Map))},_state:{get:function(){return o},set:function(e){o=e}},_states:{value:n},_whenDeferreds:{value:new Set},isLocked:{enumerable:!0,get:function(){return null!==a}},state:{enumerable:!0,get:function(){return o}}}),i.on("stateChanged",function(e){i._whenDeferreds.forEach(function(t){t.when(e,t.resolve,t.reject)})}),i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),i(t,[{key:"_whenPromise",value:function(e){var t=this;if("function"!==typeof e)return Promise.reject(new Error("when() executor must be a function"));var n=o.defer();return n.when=e,this._whenDeferreds.add(n),n.promise.then(function(e){return t._whenDeferreds.delete(n),e},function(e){throw t._whenDeferreds.delete(n),e})}},{key:"bracket",value:function(e,t){var n=void 0,r=this;function i(e){if(r.hasLock(n)&&r.releaseLockCompletely(n),e)throw e}return this.takeLock(e).then(function(e){return t(n=e)}).then(function(e){return i(),e},i)}},{key:"hasLock",value:function(e){return this._lock===e}},{key:"preempt",value:function(e,t,n){if(!c(this._states,this.state,e))throw new Error('Cannot transition from "'+this.state+'" to "'+e+'"');var r=void 0;this.isLocked&&(r=this._lock,this._lock=null);var i=null;t&&(i=this.takeLockSync(t));var a=i?null:this.takeLockSync("preemption");return this.transition(e,i||a,n),r&&r.resolve(),a&&this.releaseLock(a),i}},{key:"releaseLock",value:function(e){if(!this.isLocked)throw new Error("Could not release the lock for "+e.name+" because the StateMachine is not locked");if(!this.hasLock(e))throw new Error("Could not release the lock for "+e.name+" because "+this._lock.name+" has the lock");0===e.depth?(this._lock=null,e.resolve()):e.depth--}},{key:"releaseLockCompletely",value:function(e){if(!this.isLocked)throw new Error("Could not release the lock for "+e.name+" because the StateMachine is not locked");if(!this.hasLock(e))throw new Error("Could not release the lock for "+e.name+" because "+this._lock.name+" has the lock");e.depth=0,this._lock=null,e.resolve()}},{key:"takeLock",value:function(e){var t=this;if("object"===("undefined"===typeof e?"undefined":r(e))){var n=e;return new Promise(function(e){e(t.takeLockSync(n))})}var i=e;if(this.isLocked){var a=this.takeLock.bind(this,i);return this._lock.promise.then(a)}return Promise.resolve(this.takeLockSync(i))}},{key:"takeLockSync",value:function(e){var t="string"===typeof e?null:e,n=t?t.name:e;if(t&&!this.hasLock(t)||!t&&this.isLocked)throw new Error("Could not take the lock for "+n+" because the lock for "+this._lock.name+" was not released");if(t)return t.depth++,t;var r=function(e){var t=o.defer();return t.name=e,t.depth=0,t}(n);return this._lock=r,r}},{key:"transition",value:function(e,t,n){if(n=n||[],this.isLocked){if(!t)throw new Error("You must provide the key in order to transition");if(!this.hasLock(t))throw new Error("Could not transition using the key for "+t.name+" because "+this._lock.name+" has the lock")}else if(t)throw new Error("Key provided for "+t.name+", but the StateMachine was not locked (possibly due to preemption)");if(!c(this._states,this.state,e))throw new Error('Cannot transition from "'+this.state+'" to "'+e+'"');this._state=e,this.emit.apply(this,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(["stateChanged",e].concat(n)))}},{key:"tryTransition",value:function(e,t,n){try{this.transition(e,t,n)}catch(r){return!1}return!0}},{key:"when",value:function(e){var t=this;return this.state===e?Promise.resolve(this):c(this._reachableStates,this.state,e)?this._whenPromise(function(n,r,i){n===e?r(t):c(t._reachableStates,n,e)||i(u(n,e))}):Promise.reject(u(this.state,e))}}]),t}();function c(e,t,n){return e.get(t).has(n)}function u(e,t){return new Error('"'+t+'" cannot be reached from "'+e+'"')}e.exports=s},function(e,t,n){var r,i;!function(a,o){"use strict";void 0===(i="function"===typeof(r=function(){var e=function(){},t="undefined",n=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"===typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(t,r){for(var i=0;i<n.length;i++){var a=n[i];this[a]=i<t?e:this.methodFactory(a,t,r)}this.log=this.debug}function a(n,a,o){return function(n){"debug"===n&&(n="log");return typeof console!==t&&(void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}(n)||function(e,n,r){return function(){typeof console!==t&&(i.call(this,n,r),this[e].apply(this,arguments))}}.apply(this,arguments)}function o(e,r,o){var s,c=this,u="loglevel";function l(){var e;if(typeof window!==t){try{e=window.localStorage[u]}catch(i){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(u)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(i){}return void 0===c.levels[e]&&(e=void 0),e}}e&&(u+=":"+e),c.name=e,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=o||a,c.getLevel=function(){return s},c.setLevel=function(r,a){if("string"===typeof r&&void 0!==c.levels[r.toUpperCase()]&&(r=c.levels[r.toUpperCase()]),!("number"===typeof r&&r>=0&&r<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(s=r,!1!==a&&function(e){var r=(n[e]||"silent").toUpperCase();if(typeof window===t)return;try{return void(window.localStorage[u]=r)}catch(i){}try{window.document.cookie=encodeURIComponent(u)+"="+r+";"}catch(i){}}(r),i.call(c,r,e),typeof console===t&&r<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(e){l()||c.setLevel(e,!1)},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var d=l();null==d&&(d=null==r?"WARN":r),c.setLevel(d,!1)}var s=new o,c={};s.getLogger=function(e){if("string"!==typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=c[e];return t||(t=c[e]=new o(e,s.getLevel(),s.methodFactory)),t};var u=typeof window!==t?window.log:void 0;return s.noConflict=function(){return typeof window!==t&&window.log===s&&(window.log=u),s},s.getLoggers=function(){return c},s})?r.call(t,n,t,e):r)||(e.exports=i)}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(197).inherits,i=n(1529);function a(e,t){var n=new i(e,t);return Object.setPrototypeOf(n,a.prototype),n}r(a,i),e.exports=a},function(e,t,n){"use strict";var r=n(197).inherits,i=n(1530);function a(e){var t=new i(e);return Object.setPrototypeOf(t,a.prototype),t}r(a,i),e.exports=a},function(e,t,n){"use strict";var r=n(197).inherits,i=n(1532);function a(e,t){var n=new i(e,t);return Object.setPrototypeOf(n,a.prototype),n}r(a,i),e.exports=a},function(e,t,n){"use strict";var r=o(n(189)),i=o(n(152)),a=o(n(161));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(t,n,r,a){(0,i.default)(this,e),this.state={prevToken:r,nextToken:a,source:n,items:t}}return(0,a.default)(e,[{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):r.default.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):r.default.reject(new Error("No previous page"))}},{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}}]),e}();t.RestPaginator=s},function(e,t,n){"use strict";var r=n(159),i=n(165),a=n(172),o=n(170),s=n(173);Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(e){var n;return r(this,t),(n=a(this,o(t).call(this))).minDelay=e.min,n.maxDelay=e.max,n.initialDelay=e.initial||0,n.maxAttemptsCount=e.maxAttemptsCount||0,n.maxAttemptsTime=e.maxAttemptsTime||0,n.randomness=e.randomness||0,n.inProgress=!1,n.attemptNum=0,n.prevDelay=0,n.currDelay=0,n}return s(t,e),i(t,[{key:"attempt",value:function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"===typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;var t=this.currDelay+this.prevDelay;return this.prevDelay=this.currDelay,this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var n=this.nextDelay(e);n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n&&(this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),this.reject(new Error("Maximum attempt time limit reached"))),this.timeout=setTimeout(function(){return t.attempt()},n)}},{key:"cleanup",value:function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise(function(t,n){e.resolve=t,e.reject=n,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)})}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}},{key:"succeeded",value:function(e){this.emit("succeeded",e),this.resolve(e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}},{key:"run",value:function(e){var t=this;return this.on("attempt",function(){e().then(function(e){return t.succeeded(e)}).catch(function(e){return t.failed(e)})}),this.start()}}]),t}(n(169).EventEmitter);t.Retrier=c,t.default=c},function(e,t,n){"use strict";var r=n(159),i=n(165),a=n(172),o=n(170),s=n(173);Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(e,n){var i;return r(this,t),(i=a(this,o(t).call(this))).services=e,i.removalHandler=n,i.subscriptionState="none",i}return s(t,e),i(t,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.emit("failure",e)}},{key:"_subscribe",value:function(){return this.services.router.subscribe(this.sid,this),this}},{key:"_unsubscribe",value:function(){return this.services.router.unsubscribe(this.sid,this),this}},{key:"_setSubscriptionState",value:function(e){this.subscriptionState=e,this.emit("_subscriptionStateChanged",e)}},{key:"close",value:function(){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName)}}]),t}(n(169).EventEmitter);t.SyncEntity=c,t.default=c},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e){e.exports={_args:[["twilio-video@1.14.1","/Users/yraj/lts-code/remotepatientmonitoring/client"]],_from:"twilio-video@1.14.1",_id:"twilio-video@1.14.1",_inBundle:!1,_integrity:"sha512-DkVvv6fMTQnkf16KRJjlBPpgg2H3psKr1gT6yNHFIbe+r1vVAbo50FS74LQzVgMvnkgbmhuMebmGPXlpsm35FQ==",_location:"/twilio-video",_phantomChildren:{"async-limiter":"1.0.0","safe-buffer":"5.1.2",ultron:"1.1.1"},_requested:{type:"version",registry:!0,raw:"twilio-video@1.14.1",name:"twilio-video",escapedName:"twilio-video",rawSpec:"1.14.1",saveSpec:null,fetchSpec:"1.14.1"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/twilio-video/-/twilio-video-1.14.1.tgz",_spec:"1.14.1",_where:"/Users/yraj/lts-code/remotepatientmonitoring/client",author:{name:"Mark Andrus Roberts",email:"mroberts@twilio.com"},browser:{ws:"./src/ws.js",xmlhttprequest:"./src/xmlhttprequest.js"},bugs:{url:"https://github.com/twilio/twilio-video.js/issues"},contributors:[{name:"Ryan Rowland",email:"rrowland@twilio.com"},{name:"Manjesh Malavalli",email:"mmalavalli@twilio.com"}],dependencies:{"@twilio/sip.js":"^0.7.7","@twilio/webrtc":"^2.1.3",ws:"^3.3.1",xmlhttprequest:"^1.8.0"},description:"Twilio Video JavaScript library",devDependencies:{"@types/express":"^4.11.0","@types/node":"^8.5.1","@types/selenium-webdriver":"^3.0.8","@types/ws":"^3.2.1","babel-cli":"^6.26.0","babel-preset-es2015":"^6.24.1",browserify:"^14.3.0",cheerio:"^0.22.0",chromedriver:"2.28.0",envify:"^4.0.0",eslint:"^4.9.0",express:"^4.16.2",geckodriver:"1.4.0","ink-docstrap":"^1.3.2",istanbul:"^0.4.5",jsdoc:"^3.5.5",karma:"^1.6.0","karma-browserify":"^5.1.1","karma-chrome-launcher":"^2.0.0","karma-firefox-launcher":"^1.0.1","karma-mocha":"^1.3.0","karma-safaritechpreview-launcher":"0.0.6","karma-spec-reporter":"^0.0.31",mocha:"^3.2.0","npm-run-all":"^4.0.2",phantom:"^4.0.2","release-tool":"^0.2.2",requirejs:"^2.3.3",rimraf:"^2.6.1","selenium-webdriver":"3.3.0",sinon:"^4.0.1","travis-multirunner":"^4.0.0","ts-node":"4.0.1",tslint:"5.8.0",twilio:"^2.11.1",typescript:"2.6.2","uglify-js":"^2.8.22","vinyl-fs":"^2.4.4","vinyl-source-stream":"^1.1.0","webrtc-adapter":"^4.1.1"},engines:{node:">=0.12"},homepage:"https://twilio.com",keywords:["twilio","webrtc","library","javascript","video","rooms"],license:"BSD-3-Clause",main:"./es5/index.js",name:"twilio-video",repository:{type:"git",url:"git+https://github.com/twilio/twilio-video.js.git"},scripts:{build:"npm-run-all clean lint docs cover test:integration build:es5 build:js build:min.js test:umd","build:es5":"rimraf ./es5 && babel lib -d es5","build:js":"node ./scripts/build.js ./src/twilio-video.js ./LICENSE.md ./dist/twilio-video.js","build:min.js":'uglifyjs ./dist/twilio-video.js -o ./dist/twilio-video.min.js --comments "/^! twilio-video.js/" -b beautify=false,ascii_only=true',"build:quick":"npm-run-all clean lint docs build:es5 build:js build:min.js","build:travis":"npm-run-all clean lint docs cover test:integration:travis build:es5 build:js build:min.js test:umd test:framework",clean:"rimraf ./coverage ./es5 ./dist",cover:"istanbul cover node_modules/mocha/bin/_mocha -- ./test/unit/index.js",docs:"node ./scripts/docs.js ./dist/docs",lint:"eslint ./lib ./test/*.js ./test/framework/*.js ./test/lib/*.js ./test/integration/** ./test/unit/**",test:"npm-run-all test:unit test:integration","test:crossbrowser":"npm-run-all test:crossbrowser:*","test:crossbrowser:build":"npm-run-all test:crossbrowser:build:*","test:crossbrowser:build:browser":"cd ./test/crossbrowser && browserify lib/crossbrowser/src/browser/index.js > src/browser/index.js","test:crossbrowser:build:clean":"rimraf ./test/crossbrowser/lib ./test/crossbrowser/src/browser/index.js","test:crossbrowser:build:lint":"cd ./test/crossbrowser && tslint --project tsconfig.json","test:crossbrowser:build:tsc":"cd ./test/crossbrowser && tsc","test:crossbrowser:test":"cd ./test/crossbrowser && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:framework":"npm-run-all test:framework:angular test:framework:no-framework test:framework:react","test:framework:angular":"npm-run-all test:framework:angular:*","test:framework:angular:install":"cd ./test/framework/twilio-video-angular && rimraf ./node_modules && npm install","test:framework:angular:run":"mocha ./test/framework/twilio-video-angular.js","test:framework:no-framework":"npm-run-all test:framework:no-framework:*","test:framework:no-framework:run":"mocha ./test/framework/twilio-video-no-framework.js","test:framework:react":"npm-run-all test:framework:react:*","test:framework:react:build":"cd ./test/framework/twilio-video-react && npm run build","test:framework:react:install":"cd ./test/framework/twilio-video-react && rimraf ./node_modules && npm install","test:framework:react:run":"mocha ./test/framework/twilio-video-react.js","test:framework:react:test":"node ./scripts/framework.js twilio-video-react","test:integration":"node ./scripts/karma.js karma/integration.conf.js","test:integration:adapter":"node ./scripts/karma.js karma/integration.adapter.conf.js","test:integration:travis":"node ./scripts/integration.js","test:sdkdriver":"npm-run-all test:sdkdriver:*","test:sdkdriver:build":"npm-run-all test:sdkdriver:build:*","test:sdkdriver:build:clean":"rimraf ./test/lib/sdkdriver/lib ./test/lib/sdkdriver/test/integration/browser/index.js","test:sdkdriver:build:lint":"cd ./test/lib/sdkdriver && tslint --project tsconfig.json","test:sdkdriver:build:tsc":"cd ./test/lib/sdkdriver && tsc --rootDir src","test:sdkdriver:test":"npm-run-all test:sdkdriver:test:*","test:sdkdriver:test:integration":"npm-run-all test:sdkdriver:test:integration:*","test:sdkdriver:test:integration:browser":"cd ./test/lib/sdkdriver/test/integration && browserify browser/browser.js > browser/index.js","test:sdkdriver:test:integration:run":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:sdkdriver:test:unit":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/unit/spec/**/*.ts","test:umd":"mocha ./test/umd/index.js","test:unit":"mocha ./test/unit/index.js"},title:"Twilio Video",version:"1.14.1"}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_isCancelable:{writable:!0,value:!0},_isCanceled:{writable:!0,value:!1},_onCancel:{value:n}}),Object.defineProperty(this,"_promise",{value:new Promise(function(e,n){t(function(t){r._isCancelable=!1,e(t)},function(e){r._isCancelable=!1,n(e)},function(){return r._isCanceled})})})}return r(e,[{key:"cancel",value:function(){return this._isCancelable&&(this._isCanceled=!0,this._onCancel()),this}},{key:"catch",value:function(){var t=[].slice.call(arguments),n=this._promise;return new e(function(e,r){n.catch.apply(n,i(t)).then(e,r)},this._onCancel)}},{key:"then",value:function(){var t=[].slice.call(arguments),n=this._promise;return new e(function(e,r){n.then.apply(n,i(t)).then(e,r)},this._onCancel)}}],[{key:"reject",value:function(t){return new e(function(e,n){n(t)},function(){})}},{key:"resolve",value:function(t){return new e(function(e){e(t)},function(){})}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(179).asLocalTrack,i=n(179).buildLogLevels,a=n(283).getUserMedia,o=n(421),s=n(422),c=n(423),u=n(283).MediaStreamTrack,l=n(310),d=n(213).DEFAULT_LOG_LEVEL,f=n(1533),h=0;e.exports=function(e){var t=!(e&&("audio"in e||"video"in e));e=Object.assign({audio:t,getUserMedia:a,logLevel:d,LocalAudioTrack:o,LocalDataTrack:s,LocalVideoTrack:c,MediaStreamTrack:u,Log:l,video:t},e);var n="[createLocalTracks #"+ ++h+"]",p=i(e.logLevel),v=new e.Log("default",n,p),m=Object.assign({log:v},e);if(delete m.name,!1===e.audio&&!1===e.video)return v.info("Neither audio nor video requested, so returning empty LocalTracks"),Promise.resolve([]);if(e.tracks)return v.info("Adding user-provided LocalTracks"),v.debug("LocalTracks:",e.tracks),Promise.resolve(e.tracks);var g={audio:e.audio&&e.audio.name?{name:e.audio.name}:{},video:e.video&&e.video.name?{name:e.video.name}:{}};e.audio&&delete e.audio.name,e.video&&delete e.video.name;var y={audio:e.audio,video:e.video};return(e.audio&&e.audio.workaroundWebKitBug180748?f(v,e.getUserMedia,y):e.getUserMedia(y)).then(function(e){var t=e.getAudioTracks().concat(e.getVideoTracks());return v.info("Call to getUserMedia successful; got MediaStreamTracks:",t),t.map(function(e){return r(e,Object.assign(g[e.kind],m))})},function(e){throw v.warn("Call to getUserMedia failed:",e),e})}},function(e,t,n){"use strict";var r=n(169).EventEmitter;function i(){Object.defineProperties(this,{_eventEmitter:{value:new r}})}i.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},i.prototype.addEventListener=function(){return this._eventEmitter.addListener.apply(this._eventEmitter,arguments)},i.prototype.removeEventListener=function(){return this._eventEmitter.removeListener.apply(this._eventEmitter,arguments)},e.exports=i},function(e,t,n){"use strict";e.exports=function(e){Object.defineProperties(this,{track:{enumerable:!0,value:e,writable:!0}})}},function(e,t,n){"use strict";var r,i=n(259).flatMap;function a(e,t){return(t.match(new RegExp(e,"gm"))||[]).reduce(function(t,n){var r=n.match(new RegExp(e));return r?t.add(r[1]):t},new Set)}function o(e,t){return a(e,t)}function s(e){return o("^a=ssrc:[0-9]+ +msid:.+ +(.+) *$",e)}function c(e){return o("^a=msid:.+ +(.+) *$",e)}function u(e,t){return a("^a=ssrc:([0-9]+) +msid:[^ ]+ +"+t+" *$",e)}function l(e,t,n){return t=t||".*",n=n||".*",e.split("\r\nm=").slice(1).map(function(e){return"m="+e}).filter(function(e){var r=new RegExp("m="+t,"gm"),i=new RegExp("a="+n,"gm");return r.test(e)&&i.test(e)})}function d(e){return Array.from(a("^a=ssrc:([0-9]+) +.*$",e))}function f(e,t){var n=l(e),r=new RegExp("^a=msid:[^ ]+ +"+t+" *$","gm"),a=n.filter(function(e){return e.match(r)});return new Set(i(a,d))}function h(e,t,n){return new Map(Array.from(e(n)).map(function(e){return[e,t(n,e)]}))}function p(e){return h(s,u,e)}function v(e){return h(c,f,e)}function m(e,t,n){var r=e(n),i=new Map;r.forEach(function(e,r){if(t.has(r)){var a=Array.from(t.get(r)),o=Array.from(e);a.forEach(function(e,t){var r=o[t];i.set(r,e);var a="^a=ssrc:"+r+" (.*)$",s="a=ssrc:"+e+" $1";n=n.replace(new RegExp(a,"gm"),s)})}else t.set(r,e)});var a="^(a=ssrc-group:[^ ]+ +)(.*)$";return(n.match(new RegExp(a,"gm"))||[]).forEach(function(e){var t=e.match(new RegExp(a));if(t){var r=t[1],o=t[2].split(" ").map(function(e){var t=i.get(e);return t||e}).join(" ");n=n.replace(t[0],r+o)}}),n}t.checkIfSdpSemanticsIsSupported=function(){if("boolean"===typeof r)return r;if("undefined"===typeof RTCPeerConnection)return r=!1;try{return new RTCPeerConnection({sdpSemantics:"bogus"}),r=!1}catch(e){return r=!0}},t.getMediaSections=l,t.getPlanBTrackIds=s,t.getUnifiedPlanTrackIds=c,t.getPlanBSSRCs=u,t.getUnifiedPlanSSRCs=f,t.updatePlanBTrackIdsToSSRCs=function(e,t){return m(p,e,t)},t.updateUnifiedPlanTrackIdsToSSRCs=function(e,t){return m(v,e,t)}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(169).EventEmitter,a=n(179).buildLogLevels,o=n(213).DEFAULT_LOG_LEVEL,s=n(310),c=0,u=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Object.assign({name:e,log:null,logLevel:o},r);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),u=String(r.name),l=a(r.logLevel),d=r.log?r.log.createLog("media",i):new s("media",i,l);return Object.defineProperties(i,{_id:{value:e},_instanceId:{value:++c},_log:{value:d},kind:{enumerable:!0,value:n},name:{enumerable:!0,value:u}}),i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"id",get:function(){return this._id}}]),t}();e.exports=u},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(806),a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.name,e.sid,n));return Object.defineProperties(r,{_signaling:{value:e},_track:{value:null,writable:!0},kind:{enumerable:!0,value:e.kind}}),e.on("updated",function(){e.error?r.emit("subscriptionFailed",e.error):(r.track&&r.track._setEnabled(e.isEnabled),r.emit(e.isEnabled?"trackEnabled":"trackDisabled"))}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toString",value:function(){return"[RemoteTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}},{key:"_subscribed",value:function(e){!this._track&&e&&(this._track=e,this.emit("subscribed",e))}},{key:"_unsubscribe",value:function(){if(this._track){var e=this._track;this._track=null,e._unsubscribe(),this.emit("unsubscribed",e)}}},{key:"isSubscribed",get:function(){return!!this._track}},{key:"isTrackEnabled",get:function(){return this._signaling.isEnabled}},{key:"track",get:function(){return this._track}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(806),a=function(e){function t(e,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n.name,e,i));return Object.defineProperties(a,{_reemitTrackEvent:{value:function(){return a.emit(a.isTrackEnabled?"trackEnabled":"trackDisabled")}},_unpublish:{value:r},kind:{enumerable:!0,value:n.kind},track:{enumerable:!0,value:n}}),n.on("disabled",a._reemitTrackEvent),n.on("enabled",a._reemitTrackEvent),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toString",value:function(){return"[LocalTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}},{key:"unpublish",value:function(){return this.track.removeListener("disabled",this._reemitTrackEvent),this.track.removeListener("enabled",this._reemitTrackEvent),this._unpublish(this),this}},{key:"isTrackEnabled",get:function(){return"data"===this.track.kind||this.track.isEnabled}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(347),a={connecting:["connected"],connected:["disconnected"],disconnected:[]},o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"connecting",a));return Object.defineProperties(e,{_identity:{writable:!0,value:null},_networkQualityLevel:{value:null,writable:!0},_networkQualityLevels:{value:null,writable:!0},_sid:{writable:!0,value:null},identity:{enumerable:!0,get:function(){return this._identity}},sid:{enumerable:!0,get:function(){return this._sid}},tracks:{enumerable:!0,value:new Map}}),e}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"addTrack",value:function(e){return this.tracks.set(e.id,e),this.emit("trackAdded",e),this}},{key:"disconnect",value:function(){return"disconnected"!==this.state&&(this.preempt("disconnected"),!0)}},{key:"removeTrack",value:function(e){var t=this.tracks.delete(e.id);return t&&this.emit("trackRemoved",e),t}},{key:"setNetworkQualityLevel",value:function(e,t){t&&(this._networkQualityLevels=t),this._networkQualityLevel!==e&&(this._networkQualityLevel=e,this.emit("networkQualityLevelChanged"))}},{key:"connect",value:function(e,t){return"connecting"===this.state&&(this._sid=e,this._identity=t,this.preempt("connected"),!0)}},{key:"networkQualityLevel",get:function(){return this._networkQualityLevel}},{key:"networkQualityLevels",get:function(){return this._networkQualityLevels}}]),t}();e.exports=o},function(e,t,n){"use strict";(function(t){var r=t.window||t,i=n(1593),a=r.WebSocket?r.WebSocket:n(820),o=r.addEventListener?r.addEventListener.bind(r):null;e.exports=n(1594)({addEventListener:o,console:r.console,Promise:r.Promise,WebSocket:a,timers:r,Transport:i})}).call(this,n(48))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1673);t.Init=r.Init;var i=n(1676);t.InitReply=i.InitReply;var a=n(1677);t.Update=a.Update;var o=n(1678);t.Message=o.Message;var s=n(1679);t.Reply=s.Reply;var c=n(1680);t.Close=c.Close},function(e,t,n){(function(e,r){var i;(function(){"use strict";var a={function:!0,object:!0},o=a[typeof window]&&window||this,s=a[typeof t]&&t,c=a[typeof e]&&e&&!e.nodeType&&e,u=s&&c&&"object"==typeof r&&r;!u||u.global!==u&&u.window!==u&&u.self!==u||(o=u);var l=Math.pow(2,53)-1,d=/\bOpera/,f=Object.prototype,h=f.hasOwnProperty,p=f.toString;function v(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function m(e){return e=k(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:v(e)}function g(e,t){for(var n in e)h.call(e,n)&&t(e[n],n,e)}function y(e){return null==e?v(e):p.call(e).slice(8,-1)}function b(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function _(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=l)for(;++n<r;)t(e[n],n,e);else g(e,t)}(e,function(r,i){n=t(n,r,i,e)}),n}function k(e){return String(e).replace(/^ +| +$/g,"")}var w=function e(t){var n=o,r=t&&"object"==typeof t&&"String"!=y(t);r&&(n=t,t=null);var i=n.navigator||{},a=i.userAgent||"";t||(t=a);var s,c,u=r?!!i.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(p.toString()),l=r?"Object":"ScriptBridgingProxyObject",f=r?"Object":"Environment",h=r&&n.java?"JavaPackage":y(n.java),v=r?"Object":"RuntimeObject",w=/\bJava/.test(h)&&n.java,T=w&&y(n.environment)==f,S=w?"a":"\u03b1",C=w?"b":"\u03b2",E=n.document||{},R=n.operamini||n.opera,O=d.test(O=r&&R?R["[[Class]]"]:y(R))?O:R=null,x=t,P=[],I=null,A=t==a,j=A&&R&&"function"==typeof R.version&&R.version(),M=_([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(e,n){return e||RegExp("\\b"+(n.pattern||b(n))+"\\b","i").exec(t)&&(n.label||n)}),D=function(e){return _(e,function(e,n){return e||RegExp("\\b"+(n.pattern||b(n))+"\\b","i").exec(t)&&(n.label||n)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),N=$([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),U=function(e){return _(e,function(e,n,r){return e||(n[N]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(N)]||RegExp("\\b"+b(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),L=function(e){return _(e,function(e,n){var r=n.pattern||b(n);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=m(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,n.label||n)),e})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function $(e){return _(e,function(e,n){var r=n.pattern||b(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=m(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e})}if(M&&(M=[M]),U&&!N&&(N=$([U])),(s=/\bGoogle TV\b/.exec(N))&&(N=s[0]),/\bSimulator\b/i.test(t)&&(N=(N?N+" ":"")+"Simulator"),"Opera Mini"==D&&/\bOPiOS\b/.test(t)&&P.push("running in Turbo/Uncompressed mode"),"IE"==D&&/\blike iPhone OS\b/.test(t)?(U=(s=e(t.replace(/like iPhone OS/,""))).manufacturer,N=s.product):/^iP/.test(N)?(D||(D="Safari"),L="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"!=D||/buntu/i.test(L)?U&&"Google"!=U&&(/Chrome/.test(D)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(N))||/\bAndroid\b/.test(L)&&/^Chrome/.test(D)&&/\bVersion\//i.test(t)?(D="Android Browser",L=/\bAndroid\b/.test(L)?L:"Android"):"Silk"==D?(/\bMobi/i.test(t)||(L="Android",P.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&P.unshift("accelerated")):"PaleMoon"==D&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?P.push("identifying as Firefox "+s[1]):"Firefox"==D&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(L||(L="Firefox OS"),N||(N=s[1])):!D||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(D))?(D&&!N&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(D=null),(s=N||U||L)&&(N||U||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(L))&&(D=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(L)?L:s)+" Browser")):"Electron"==D&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&P.push("Chromium "+s):L="Kubuntu",j||(j=_(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",b(D),"(?:Firefox|Minefield|NetFront)"],function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null})),(s=("iCab"==M&&parseFloat(j)>3?"WebKit":/\bOpera\b/.test(D)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(M)&&"WebKit"||!M&&/\bMSIE\b/i.test(t)&&("Mac OS"==L?"Tasman":"Trident")||"WebKit"==M&&/\bPlayStation\b(?! Vita\b)/i.test(D)&&"NetFront")&&(M=[s]),"IE"==D&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(D+=" Mobile",L="Windows Phone "+(/\+$/.test(s)?s:s+".x"),P.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(D="IE Mobile",L="Windows Phone 8.x",P.unshift("desktop mode"),j||(j=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=D&&"Trident"==M&&(s=/\brv:([\d.]+)/.exec(t))&&(D&&P.push("identifying as "+D+(j?" "+j:"")),D="IE",j=s[1]),A){if(function(e,t){var n=null!=e?typeof e[t]:"number";return!/^(?:boolean|number|string|undefined)$/.test(n)&&("object"!=n||!!e[t])}(n,"global"))if(w&&(x=(s=w.lang.System).getProperty("os.arch"),L=L||s.getProperty("os.name")+" "+s.getProperty("os.version")),T){try{j=n.require("ringo/engine").version.join("."),D="RingoJS"}catch(q){(s=n.system)&&s.global.system==n.system&&(D="Narwhal",L||(L=s[0].os||null))}D||(D="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(s=n.process)&&("object"==typeof s.versions&&("string"==typeof s.versions.electron?(P.push("Node "+s.versions.node),D="Electron",j=s.versions.electron):"string"==typeof s.versions.nw&&(P.push("Chromium "+j,"Node "+s.versions.node),D="NW.js",j=s.versions.nw)),D||(D="Node.js",x=s.arch,L=s.platform,j=(j=/[\d.]+/.exec(s.version))?j[0]:null));else y(s=n.runtime)==l?(D="Adobe AIR",L=s.flash.system.Capabilities.os):y(s=n.phantom)==v?(D="PhantomJS",j=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof E.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(j=[j,E.documentMode],(s=+s[1]+4)!=j[1]&&(P.push("IE "+j[1]+" mode"),M&&(M[1]=""),j[1]=s),j="IE"==D?String(j[1].toFixed(1)):j[0]):"number"==typeof E.documentMode&&/^(?:Chrome|Firefox)\b/.test(D)&&(P.push("masking as "+D+" "+j),D="IE",j="11.0",M=["Trident"],L="Windows");L=L&&m(L)}if(j&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(j)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(A&&i.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(I=/b/i.test(s)?"beta":"alpha",j=j.replace(RegExp(s+"\\+?$"),"")+("beta"==I?C:S)+(/\d+\+?/.exec(s)||"")),"Fennec"==D||"Firefox"==D&&/\b(?:Android|Firefox OS)\b/.test(L))D="Firefox Mobile";else if("Maxthon"==D&&j)j=j.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(N))"Xbox 360"==N&&(L=null),"Xbox 360"==N&&/\bIEMobile\b/.test(t)&&P.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(D)&&(!D||N||/Browser|Mobi/.test(D))||"Windows CE"!=L&&!/Mobi/i.test(t))if("IE"==D&&A)try{null===n.external&&P.unshift("platform preview")}catch(q){P.unshift("embedded")}else(/\bBlackBerry\b/.test(N)||/\bBB10\b/.test(t))&&(s=(RegExp(N.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||j)?(L=((s=[s,/BB10/.test(t)])[1]?(N=null,U="BlackBerry"):"Device Software")+" "+s[0],j=null):this!=g&&"Wii"!=N&&(A&&R||/Opera/.test(D)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==D&&/\bOS X (?:\d+\.){2,}/.test(L)||"IE"==D&&(L&&!/^Win/.test(L)&&j>5.5||/\bWindows XP\b/.test(L)&&j>8||8==j&&!/\bTrident\b/.test(t)))&&!d.test(s=e.call(g,t.replace(d,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),d.test(D)?(/\bIE\b/.test(s)&&"Mac OS"==L&&(L=null),s="identify"+s):(s="mask"+s,D=O?m(O.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(L=null),A||(j=null)),M=["Presto"],P.push(s));else D+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==D&&"+"==s[1].slice(-1)?(D="WebKit Nightly",I="alpha",j=s[1].slice(0,-1)):j!=s[1]&&j!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(j=null),s[1]=(/\bChrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==M&&(M=["Blink"]),A&&(u||s[1])?(M&&(M[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=M?"27":"28")):(M&&(M[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:"8"),M&&(M[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==D&&(!j||parseInt(j)>45)&&(j=s)),"Opera"==D&&(s=/\bzbov|zvav$/.exec(L))?(D+=" ",P.unshift("desktop mode"),"zvav"==s?(D+="Mini",j=null):D+="Mobile",L=L.replace(RegExp(" *"+s+"$"),"")):"Safari"==D&&/\bChrome\b/.exec(M&&M[1])&&(P.unshift("desktop mode"),D="Chrome Mobile",j=null,/\bOS X\b/.test(L)?(U="Apple",L="iOS 4.3+"):L=null),j&&0==j.indexOf(s=/[\d.]+$/.exec(L))&&t.indexOf("/"+s+"-")>-1&&(L=k(L.replace(s,""))),M&&!/\b(?:Avant|Nook)\b/.test(D)&&(/Browser|Lunascape|Maxthon/.test(D)||"Safari"!=D&&/^iOS/.test(L)&&/\bSafari\b/.test(M[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(D)&&M[1])&&(s=M[M.length-1])&&P.push(s),P.length&&(P=["("+P.join("; ")+")"]),U&&N&&N.indexOf(U)<0&&P.push("on "+U),N&&P.push((/^on /.test(P[P.length-1])?"":"on ")+N),L&&(s=/ ([\d.+]+)$/.exec(L),c=s&&"/"==L.charAt(L.length-s[0].length-1),L={architecture:32,family:s&&!c?L.replace(s[0],""):L,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(x))&&!/\bi686\b/i.test(x)?(L&&(L.architecture=64,L.family=L.family.replace(RegExp(" *"+s),"")),D&&(/\bWOW64\b/i.test(t)||A&&/\w(?:86|32)$/.test(i.cpuClass||i.platform)&&!/\bWin64; x64\b/i.test(t))&&P.unshift("32-bit")):L&&/^OS X/.test(L.family)&&"Chrome"==D&&parseFloat(j)>=39&&(L.architecture=64),t||(t=null);var X={};return X.description=t,X.layout=M&&M[0],X.manufacturer=U,X.name=D,X.prerelease=I,X.product=N,X.ua=t,X.version=D&&j,X.os=L||{architecture:null,family:null,version:null,toString:function(){return"null"}},X.parse=e,X.toString=function(){return this.description||""},X.version&&P.unshift(j),X.name&&P.unshift(D),L&&D&&(L!=String(L).split(" ")[0]||L!=D.split(" ")[0]&&!N)&&P.push(N?"("+L+")":"on "+L),P.length&&(X.description=P.join(" ")),X}();o.platform=w,void 0===(i=function(){return w}.call(t,n,t,e))||(e.exports=i)}).call(this)}).call(this,n(97)(e),n(48))},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=n(348);function o(e,t){return["".concat((new Date).toISOString()," Notifications ").concat(e,":")].concat(Array.from(t))}var s=function(){function e(){r(this,e),this.prefix=""}return i(e,[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.debug.apply(null,o("T"+this.prefix,t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.debug.apply(null,o("D"+this.prefix,t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.info.apply(null,o("I"+this.prefix,t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.warn.apply(null,o("W"+this.prefix,t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.error.apply(null,o("E"+this.prefix,t))}}],[{key:"scope",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new e}}]),e}();t.Logger=s;var c=s.scope();t.log=c},function(e,t,n){e.exports=n(1703)},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165);Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(t){a(this,e),this.queuedRequests=[],this.isRequestInFlight=!1,this.inputMergingFunction=t}return o(e,[{key:"add",value:function(e,t){var n=this,r=new Promise(function(r,i){return n.queuedRequests.push({input:e,requestFunction:t,resolve:r,reject:i})});return this.wakeupQueue(),r}},{key:"squashAndAdd",value:function(e,t){var n,r=this.queuedRequests;this.queuedRequests=[],r.length>0?(n=r.map(function(e){return e.input}).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;var i=this.add(n,t);return r.forEach(function(e){return i.then(e.resolve,e.reject)}),i}},{key:"isEmpty",value:function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var e=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then(function(t){e.isRequestInFlight=!1,e.wakeupQueue()})}}}]),e}();t.MergingQueue=s;var c=function(){function e(t){a(this,e),this.queueByNamespaceKey=new Map,this.inputReducer=t}return o(e,[{key:"add",value:function(){var e=i(r.mark(function e(t,n,i){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,function(e){return e.add(n,i)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"squashAndAdd",value:function(){var e=i(r.mark(function e(t,n,i){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,function(e){return e.squashAndAdd(n,i)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"invokeQueueMethod",value:function(){var e=i(r.mark(function e(t,n){var i,a;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.queueByNamespaceKey.has(t)||this.queueByNamespaceKey.set(t,new s(this.inputReducer)),i=this.queueByNamespaceKey.get(t),a=n(i),this.queueByNamespaceKey.get(t).isEmpty()&&this.queueByNamespaceKey.delete(t),e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.NamespacedMergingQueue=c},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";"undefined"!==typeof webkitMediaStream?e.exports=webkitMediaStream:"undefined"!==typeof MediaStream?e.exports=MediaStream:e.exports=function(){throw new Error("WebRTC is not supported in this browser")}},function(e,t,n){"use strict";e.exports=function e(t){if(!(this instanceof e))return new e(t);var n=t&&"rollback"===t.type?null:new RTCSessionDescription(t);Object.defineProperties(this,{_description:{get:function(){return n}},sdp:{enumerable:!0,value:n?n.sdp:t.sdp},type:{enumerable:!0,value:n?n.type:t.type}})}},function(e,t,n){"use strict";var r=n(259).defer,i={high:new Set(["low"]),low:new Set(["high"])};function a(e){if(!(this instanceof a))return new a(e);var t=e||"low";Object.defineProperties(this,{_state:{set:function(e){if(t!==e){t=e;var n=this._whenDeferreds.get(t);n.forEach(function(e){e.resolve(this)},this),n.clear()}},get:function(){return t}},_whenDeferreds:{value:new Map([["high",new Set],["low",new Set]])},state:{enumerable:!0,get:function(){return this._state}}})}function o(e,t){return new Error('Cannot transition from "'+e+'" to "'+t+'"')}a.prototype.lower=function(){return this.transition("low")},a.prototype.raise=function(){return this.transition("high")},a.prototype.transition=function(e){if(!i[this.state].has(e))throw o(this.state,e);return this._state=e,this},a.prototype.when=function(e){if(this.state===e)return Promise.resolve(this);if(!i[this.state].has(e))return Promise.reject(o(this.state,e));var t=r();return this._whenDeferreds.get(e).add(t),t.promise},e.exports=a},function(e,t,n){"use strict";e.exports="undefined"!==typeof RTCSessionDescription?RTCSessionDescription:mozRTCSessionDescription},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0};var a=n(796),o=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"_start",value:function(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_start",this).call(this),this._dummyEl&&this._detachElement(this._dummyEl)}},{key:"attach",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attach",this).apply(this,arguments)}},{key:"detach",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"detach",this).apply(this,arguments)}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(283).MediaStream,a=n(545),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.id,e.kind,n)),a=!1;return n=Object.assign({MediaStream:i},n),Object.defineProperties(r,{_attachments:{value:new Set},_isStarted:{get:function(){return a},set:function(e){a=e}},_MediaStream:{value:n.MediaStream},isStarted:{get:function(){return a}},mediaStreamTrack:{enumerable:!0,value:e.track}}),r._initialize(),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"_start",value:function(){this._log.debug("Started"),this._isStarted=!0,this._dummyEl&&(this._dummyEl.oncanplay=null),this.emit("started",this)}},{key:"_initialize",value:function(){var e=this;this._log.debug("Initializing"),this._dummyEl=this._createElement(),this.mediaStreamTrack.addEventListener("ended",function t(){e._end(),e.mediaStreamTrack.removeEventListener("ended",t)}),this._dummyEl&&(this._dummyEl.muted=!0,this._dummyEl.oncanplay=this._start.bind(this,this._dummyEl),this._attach(this._dummyEl),this._attachments.delete(this._dummyEl))}},{key:"_end",value:function(){this._log.debug("Ended"),this._dummyEl&&(this._detachElement(this._dummyEl),this._dummyEl.oncanplay=null)}},{key:"attach",value:function(e){return"string"===typeof e?e=this._selectElement(e):e||(e=this._createElement()),this._log.debug("Attempting to attach to element:",e),e=this._attach(e)}},{key:"_attach",value:function(e){var t=e.srcObject;t instanceof this._MediaStream||(t=new this._MediaStream);var n="audio"===this.mediaStreamTrack.kind?"getAudioTracks":"getVideoTracks";return t[n]().forEach(function(e){t.removeTrack(e)}),t.addTrack(this.mediaStreamTrack),e.srcObject=t,e.autoplay=!0,e.playsInline=!0,this._attachments.has(e)||this._attachments.add(e),e}},{key:"_selectElement",value:function(e){var t=document.querySelector(e);if(!t)throw new Error("Selector matched no element: "+e);return t}},{key:"_createElement",value:function(){return"undefined"!==typeof document?document.createElement(this.kind):null}},{key:"detach",value:function(e){var t=void 0;return t="string"===typeof e?[this._selectElement(e)]:e?[e]:this._getAllAttachedElements(),this._log.debug("Attempting to detach from elements:",t),this._detachElements(t),e?t[0]:t}},{key:"_detachElements",value:function(e){return e.map(this._detachElement.bind(this))}},{key:"_detachElement",value:function(e){if(!this._attachments.has(e))return e;var t=e.srcObject;return t instanceof this._MediaStream&&(t.removeTrack(this.mediaStreamTrack),e.srcObject=t),this._attachments.delete(e),e}},{key:"_getAllAttachedElements",value:function(){var e=[];return this._attachments.forEach(function(t){e.push(t)}),e}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0};var a=n(798);e.exports=function(e){return function(t){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t=Object.assign({},t);var r=new a(e),i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,r,t));return Object.defineProperties(i,{_didCallEnd:{value:!1,writable:!0},_trackSender:{value:r},isEnabled:{enumerable:!0,get:function(){return this.mediaStreamTrack.enabled}},isStopped:{get:function(){return"ended"===this.mediaStreamTrack.readyState}}}),i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,e),r(n,[{key:"_end",value:function(){this._didCallEnd||(i(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_end",this).call(this),this._didCallEnd=!0,this.emit("stopped",this))}},{key:"enable",value:function(e){return(e="boolean"!==typeof e||e)!==this.mediaStreamTrack.enabled&&(this._log.info((e?"En":"Dis")+"abling"),this.mediaStreamTrack.enabled=e,this.emit(e?"enabled":"disabled",this)),this}},{key:"disable",value:function(){return this.enable(!1)}},{key:"stop",value:function(){return this._log.info("Stopping"),this.mediaStreamTrack.stop(),this._end(),this}}]),n}()}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(799),a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.id,e));return Object.defineProperties(n,{_senders:{value:new Set}}),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"addSender",value:function(e){return this._senders.add(e),this}},{key:"removeSender",value:function(e){return this._senders.delete(e),this}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=n(800),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.kind));return Object.defineProperties(r,{readyState:{enumerable:!0,get:function(){return n.readyState}},track:{enumerable:!0,value:n}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";var r=n(169).EventEmitter,i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(r,{id:{enumerable:!0,value:e},kind:{enumerable:!0,value:n}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";var r=n(800),i=function(e){function t(e,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"data"));return Object.defineProperties(a,{maxPacketLifeTime:{enumerable:!0,value:n},maxRetransmits:{enumerable:!0,value:r},ordered:{enumerable:!0,value:i}}),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0};function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var o=n(796),s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Object.defineProperties(r,{dimensions:{enumerable:!0,value:{width:null,height:null}}}),a(r,r)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"_initialize",value:function(){var e=this;i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initialize",this).call(this),this._dummyEl&&(this._dummyEl.onloadedmetadata=function(){c(e,e._dummyEl)&&(e.dimensions.width=e._dummyEl.videoWidth,e.dimensions.height=e._dummyEl.videoHeight)},this._dummyEl.onresize=function(){c(e,e._dummyEl)&&(e.dimensions.width=e._dummyEl.videoWidth,e.dimensions.height=e._dummyEl.videoHeight,e.isStarted&&(e._log.debug("Dimensions changed:",e.dimensions),e.emit(t.DIMENSIONS_CHANGED,e)))})}},{key:"_start",value:function(e){return this.dimensions.width=e.videoWidth,this.dimensions.height=e.videoHeight,this._log.debug("Dimensions:",this.dimensions),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_start",this).call(this,e)}},{key:"attach",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attach",this).apply(this,arguments)}},{key:"detach",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"detach",this).apply(this,arguments)}}]),t}();function c(e,t){return e.dimensions.width!==t.videoWidth||e.dimensions.height!==t.videoHeight}s.DIMENSIONS_CHANGED="dimensionsChanged",e.exports=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i="undefined"!==typeof AudioContext?AudioContext:"undefined"!==typeof webkitAudioContext?webkitAudioContext:null,a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Object.assign({AudioContext:i},t),Object.defineProperties(this,{_AudioContext:{value:t.AudioContext},_audioContext:{value:null,writable:!0},_holders:{value:new Set},AudioContextFactory:{enumerable:!0,value:e}})}return r(e,[{key:"getOrCreate",value:function(e){if(!this._holders.has(e)&&(this._holders.add(e),this._AudioContext&&!this._audioContext))try{this._audioContext=new this._AudioContext}catch(t){}return this._audioContext}},{key:"release",value:function(e){this._holders.has(e)&&(this._holders.delete(e),!this._holders.size&&this._audioContext&&(this._audioContext.close(),this._audioContext=null))}}]),e}();e.exports=new a},function(e,t,n){"use strict";var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=n(1538),o=n(1539),s=n(1540),c=n(1541),u=n(1542),l=n(1543),d=n(169).EventEmitter,f=n(179),h=0,p=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=function(e){var t=e.map(function(e){return[e._id,e]}),n=t.filter(function(e){return"audio"===e[1].kind}),r=t.filter(function(e){return"video"===e[1].kind}),i=t.filter(function(e){return"data"===e[1].kind});return{audioTracks:n,dataTracks:i,tracks:t,videoTracks:r}}((n=Object.assign({RemoteAudioTrack:a,RemoteAudioTrackPublication:o,RemoteDataTrack:s,RemoteDataTrackPublication:c,RemoteVideoTrack:u,RemoteVideoTrackPublication:l,tracks:[]},n)).tracks),d=n.log.createLog("default",r),f=new Map(i.audioTracks),p=new Map(i.dataTracks),m=new Map(i.tracks),g=new Map(i.videoTracks);return Object.defineProperties(r,{_RemoteAudioTrack:{value:n.RemoteAudioTrack},_RemoteAudioTrackPublication:{value:n.RemoteAudioTrackPublication},_RemoteDataTrack:{value:n.RemoteDataTrack},_RemoteDataTrackPublication:{value:n.RemoteDataTrackPublication},_RemoteVideoTrack:{value:n.RemoteVideoTrack},_RemoteVideoTrackPublication:{value:n.RemoteVideoTrackPublication},_instanceId:{value:++h},_log:{value:d},_signaling:{value:e},_trackEventReemitters:{value:new Map},_trackPublicationEventReemitters:{value:new Map},_trackSignalingUpdatedEventCallbacks:{value:new Map},audioTracks:{enumerable:!0,value:f},audioTrackPublications:{enumerable:!0,value:new Map},dataTracks:{enumerable:!0,value:p},dataTrackPublications:{enumerable:!0,value:new Map},identity:{enumerable:!0,get:function(){return e.identity}},sid:{enumerable:!0,get:function(){return e.sid}},state:{enumerable:!0,get:function(){return e.state}},tracks:{enumerable:!0,value:m},trackPublications:{enumerable:!0,value:new Map},videoTracks:{enumerable:!0,value:g},videoTrackPublications:{enumerable:!0,value:new Map}}),r.tracks.forEach(v.bind(null,r)),e.on("networkQualityLevelChanged",function(){return r.emit("networkQualityLevelChanged",r.networkQualityLevel)}),function(e,t){var n=e._log;if("disconnected"===e.state)return;t.on("stateChanged",function r(i){n.debug("Transitioned to state:",i),e.emit(i,e),"disconnected"===i&&(n.debug("Removing Track event reemitters"),t.removeListener("stateChanged",r),e.tracks.forEach(function(t){e._trackEventReemitters.get(t._id).forEach(function(e,n){t.removeListener(n,e)})}),e._trackEventReemitters.clear(),e.trackPublications.forEach(function(t){e._trackPublicationEventReemitters.get(t.trackSid).forEach(function(e,n){t.removeListener(n,e)})}),e._trackPublicationEventReemitters.clear())})}(r,e),d.info("Created a new Participant"+(r.identity?": "+r.identity:"")),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d),i(t,[{key:"_getTrackEvents",value:function(){return[["dimensionsChanged","trackDimensionsChanged"],["disabled","trackDisabled"],["enabled","trackEnabled"],["message","trackMessage"],["started","trackStarted"]]}},{key:"_getTrackPublicationEvents",value:function(){return[]}},{key:"toString",value:function(){return"[Participant #"+this._instanceId+": "+this.sid+"]"}},{key:"_addTrack",value:function(e){var t=this._log;return this.tracks.has(e._id)?null:(this.tracks.set(e._id,e),{audio:this.audioTracks,video:this.videoTracks,data:this.dataTracks}[e.kind].set(e._id,e),v(this,e),t.info("Added a new "+f.trackClass(e)+":",e._id),t.debug(f.trackClass(e)+":",e),this.emit("trackAdded",e),e)}},{key:"_addTrackPublication",value:function(e){var t=this._log;return this.trackPublications.has(e.trackSid)?null:(this.trackPublications.set(e.trackSid,e),{audio:this.audioTrackPublications,data:this.dataTrackPublications,video:this.videoTrackPublications}[e.kind].set(e.trackSid,e),function(e,t){var n=new Map;if("disconnected"===e.state)return;e._getTrackPublicationEvents().forEach(function(i){var a=r(i,2),o=a[0],s=a[1];n.set(o,function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];e.emit.apply(e,[s].concat(r,[t]))}),t.on(o,n.get(o))}),e._trackPublicationEventReemitters.set(t.trackSid,n)}(this,e),t.info("Added a new "+f.trackPublicationClass(e)+":",e.trackSid),t.debug(f.trackPublicationClass(e)+":",e),e)}},{key:"_handleTrackSignalingEvents",value:function(){var e=this._log,t=this;if("disconnected"!==this.state){var n=this._RemoteAudioTrack,r=this._RemoteAudioTrackPublication,i=this._RemoteVideoTrack,a=this._RemoteVideoTrackPublication,o=this._RemoteDataTrack,s=this._RemoteDataTrackPublication,c=this._signaling;c.on("trackAdded",u),c.on("trackRemoved",l),c.tracks.forEach(u),c.on("stateChanged",function t(n){"disconnected"===n&&(e.debug("Removing event listeners"),c.removeListener("stateChanged",t),c.removeListener("trackAdded",u),c.removeListener("trackRemoved",l))})}function u(n){var i=new(0,{audio:r,data:s,video:a}[n.kind])(n,{log:e});t._addTrackPublication(i);var o=n.isSubscribed;o&&d(n),t._trackSignalingUpdatedEventCallbacks.set(n.sid,function(){if(o!==n.isSubscribed){if(o=n.isSubscribed)return void d(n);!function(e){var n=t.tracks.get(e.id),r=t.trackPublications.get(e.sid);n&&t._removeTrack(n,r)}(n)}}),n.on("updated",t._trackSignalingUpdatedEventCallbacks.get(n.sid))}function l(e){e.isSubscribed&&e.setTrackTransceiver(null);var n=t._trackSignalingUpdatedEventCallbacks.get(e.sid);n&&(e.removeListener("updated",n),t._trackSignalingUpdatedEventCallbacks.delete(e.id));var r=t.trackPublications.get(e.sid);r&&t._removeTrackPublication(r)}function d(r){var a={audio:n,video:i,data:o}[r.kind],s=t.trackPublications.get(r.sid),c=r.trackTransceiver;if(a&&r.kind===c.kind){var u="data"===r.kind?new a(c,{log:e,name:r.name}):new a(c,r.isEnabled,{log:e,name:r.name});t._addTrack(u,s)}}}},{key:"_deleteTrack",value:function(e){this.tracks.delete(e._id),{audio:this.audioTracks,video:this.videoTracks,data:this.dataTracks}[e.kind].delete(e._id),(this._trackEventReemitters.get(e._id)||new Map).forEach(function(t,n){e.removeListener(n,t)});var t=this._log;t.info("Removed a "+f.trackClass(e)+":",e._id),t.debug(f.trackClass(e)+":",e)}},{key:"_removeTrack",value:function(e){return this.tracks.has(e._id)?(e=this.tracks.get(e._id),this._deleteTrack(e),this.emit("trackRemoved",e),e):null}},{key:"_removeTrackPublication",value:function(e){if(!(e=this.trackPublications.get(e.trackSid)))return null;this.trackPublications.delete(e.trackSid),{audio:this.audioTrackPublications,data:this.dataTrackPublications,video:this.videoTrackPublications}[e.kind].delete(e.trackSid),(this._trackPublicationEventReemitters.get(e.trackSid)||new Map).forEach(function(t,n){e.removeListener(n,t)});var t=this._log;return t.info("Removed a "+f.trackPublicationClass(e)+":",e.trackSid),t.debug(f.trackPublicationClass(e)+":",e),e}},{key:"networkQualityLevel",get:function(){return this._signaling.networkQualityLevel}},{key:"_networkQualityLevels",get:function(){return this._signaling.networkQualityLevels}}]),t}();function v(e,t){var n=new Map;"disconnected"!==e.state&&(e._getTrackEvents().forEach(function(r){var i=r[0],a=r[1];n.set(i,function(){var t=[a].concat([].slice.call(arguments));return e.emit.apply(e,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))}),t.on(i,n.get(i))}),e._trackEventReemitters.set(t._id,n))}e.exports=p},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(179).deprecateEvents;e.exports=function(e){return function(t){function n(e,t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,r));return Object.defineProperties(a,{_isEnabled:{value:t,writable:!0},_isSubscribed:{value:!0,writable:!0},_sid:{value:null,writable:!0}}),i("RemoteMediaTrack",a,new Map([["unsubscribed",null]]),a._log),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,e),r(n,[{key:"_setEnabled",value:function(e){this._isEnabled!==e&&(this._isEnabled=e,this.emit(this._isEnabled?"enabled":"disabled",this))}},{key:"_setSid",value:function(e){this._sid||(this._sid=e)}},{key:"_unsubscribe",value:function(){this._isSubscribed&&(this._isSubscribed=!1,this.emit("unsubscribed",this))}},{key:"id",get:function(){return this._log.deprecated("RemoteMediaTrack#id has been deprecated and is scheduled for removal in twilio-video.js@2.0.0. Use the parent RemoteTrackPublication's .trackName or .trackSid instead."),this._id}},{key:"isEnabled",get:function(){return this._isEnabled}},{key:"isSubscribed",get:function(){return this._log.deprecated("RemoteMediaTrack#isSubscribed has been deprecated and is scheduled for removal in twilio-video.js@2.0.0. Use the parent RemoteTrackPublication's .isSubscribed instead."),this._isSubscribed}},{key:"sid",get:function(){return this._sid}}]),n}()}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(169).EventEmitter,a=n(179).buildLogLevels,o=n(213).DEFAULT_LOG_LEVEL,s=n(310),c=0,u=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r=Object.assign({logLevel:o},r);var u=a(r.logLevel);return Object.defineProperties(i,{_instanceId:{value:c++},_log:{value:r.log||new s("default",i,u)},trackName:{value:e},trackSid:{value:n}}),i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toString",value:function(){return"[TrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}();e.exports=u},function(e,t,n){"use strict";var r=n(1544),i=n(1545),a=n(1546),o=n(1547);e.exports=function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!==typeof t)throw new Error("RTCPeerConnection id must be a string");Object.defineProperties(this,{peerConnectionId:{value:t,enumerable:!0},localAudioTrackStats:{value:n.localAudioTrackStats.map(function(e){return new r(e.trackId,e)}),enumerable:!0},localVideoTrackStats:{value:n.localVideoTrackStats.map(function(e){return new i(e.trackId,e)}),enumerable:!0},remoteAudioTrackStats:{value:n.remoteAudioTrackStats.map(function(e){return new a(e.trackId,e)}),enumerable:!0},remoteVideoTrackStats:{value:n.remoteVideoTrackStats.map(function(e){return new o(e.trackId,e)}),enumerable:!0}})}},function(e,t,n){"use strict";var r=n(809),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Object.defineProperties(r,{bytesSent:{value:"number"===typeof n.bytesSent?n.bytesSent:null,enumerable:!0},packetsSent:{value:"number"===typeof n.packetsSent?n.packetsSent:null,enumerable:!0},roundTripTime:{value:"number"===typeof n.roundTripTime?n.roundTripTime:null,enumerable:!0}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";e.exports=function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!==typeof t)throw new Error("Track id must be a string");Object.defineProperties(this,{trackId:{value:t,enumerable:!0},trackSid:{value:n.trackSid,enumerable:!0},timestamp:{value:n.timestamp,enumerable:!0},ssrc:{value:n.ssrc,enumerable:!0},packetsLost:{value:"number"===typeof n.packetsLost?n.packetsLost:null,enumerable:!0},codec:{value:"string"===typeof n.codecName?n.codecName:null,enumerable:!0}})}},function(e,t,n){"use strict";var r=n(809),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Object.defineProperties(r,{bytesReceived:{value:"number"===typeof n.bytesReceived?n.bytesReceived:null,enumerable:!0},packetsReceived:{value:"number"===typeof n.packetsReceived?n.packetsReceived:null,enumerable:!0}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(812),a=n(813),o=n(814),s=function(e){function t(e,n,r,i,a,o,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r)),u=a>0?i/a:0;return Object.defineProperties(c,{deltaPacketsLost:{enumerable:!0,value:i},deltaPacketsReceived:{enumerable:!0,value:a},fractionLost:{enumerable:!0,value:o},jitter:{enumerable:!0,value:s},phonyFractionLost:{enumerable:!0,value:u}}),c}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"summarize",value:function(){return{bitrate:this.bitrate,fractionLost:"number"===typeof this.fractionLost?this.fractionLost:this.phonyFractionLost,jitter:this.jitter}}}],[{key:"of",value:function(e,n,r){if(n.id!==r.id)throw new Error("RTCStats IDs must match");var i=(r.timestamp-n.timestamp)/1e3,a=r.bytesReceived-n.bytesReceived,o=i>0?a/i*8:0,s=Math.max(r.packetsLost-n.packetsLost,0),c=r.packetsReceived-n.packetsReceived,u=r.fractionLost,l=r.jitter;return new t(n.id,e,o,s,c,u,l)}},{key:"summarize",value:function(e){var t=e.map(function(e){return e.summarize()});return{bitrate:o(t.map(function(e){return e.bitrate})),fractionLost:i(t.map(function(e){return e.fractionLost})),jitter:i(t.map(function(e){return e.jitter}))}}}]),t}();e.exports=s},function(e,t,n){"use strict";e.exports=function(e){return(e=e.filter(function(e){return"number"===typeof e})).length<1?void 0:e.reduce(function(e,t){return t+e})/e.length}},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{id:{enumerable:!0,value:t},trackId:{enumerable:!0,value:n},bitrate:{enumerable:!0,value:r}})}},function(e,t,n){"use strict";e.exports=function(e){return e.reduce(function(e,t){return"number"===typeof t?t+e:e},0)}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(812),a=n(813),o=n(814),s=function(e){function t(e,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return Object.defineProperties(a,{rtt:{enumerable:!0,value:i}}),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,null,[{key:"of",value:function(e,n,r,i){if(n.id!==r.id)throw new Error("RTCStats IDs must match");var a=(r.timestamp-n.timestamp)/1e3,o=r.bytesSent-n.bytesSent,s=a>0?o/a*8:0,c=i&&"number"===typeof i.roundTripTime?i.roundTripTime/1e3:void 0;return new t(n.id,e,s,c)}},{key:"summarize",value:function(e){return{bitrate:o(e.map(function(e){return e.bitrate})),rtt:i(e.map(function(e){return e.rtt}))}}}]),t}();e.exports=s},function(e,t,n){"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{id:{enumerable:!0,value:t,writable:!0},trackId:{enumerable:!0,value:n,writable:!0},lastStats:{enumerable:!0,value:r,writable:!0}})}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(169).EventEmitter,a=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(e,{_isEnabled:{value:null,writable:!0},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}}}),e}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"disable",value:function(){return this.enable(!1)}},{key:"enable",value:function(e){return e="boolean"!==typeof e||e,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(817),a=n(347),o={connected:["reconnecting","disconnected"],reconnecting:["connected","disconnected"],disconnected:[]},s=function(e){function t(e,n,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=Object.assign({RecordingSignaling:i},a);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"connected",o)),u=a.RecordingSignaling;return Object.defineProperties(s,{_mediaConnectionIsReconnecting:{writable:!0,value:!1},_options:{value:a},dominantSpeakerSid:{enumerable:!0,value:null,writable:!0},localParticipant:{enumerable:!0,value:e},name:{enumerable:!0,value:r},participants:{enumerable:!0,value:new Map},recording:{enumerable:!0,value:new u},sid:{enumerable:!0,value:n}}),s.on("mediaConnectionStateChanged",function(){return c(s)}),s.on("signalingConnectionStateChanged",function(){return c(s)}),s}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"_disconnect",value:function(e){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[e]),!0)}},{key:"connectParticipant",value:function(e){var t=this;return"disconnected"!==e.state&&(!this.participants.has(e.sid)&&(this.participants.set(e.sid,e),e.on("stateChanged",function n(r){"disconnected"===r&&(e.removeListener("stateChanged",n),t.participants.delete(e.sid),t.emit("participantDisconnected",e))}),this.emit("participantConnected",e),!0))}},{key:"disconnect",value:function(){return this._disconnect()}},{key:"setDominantSpeaker",value:function(e){this.dominantSpeakerSid=e,this.emit("dominantSpeakerChanged")}}]),t}();function c(e){if("disconnected"!==e.state&&"disconnected"!==e.signalingConnectionState){var t=void 0;"reconnecting"===e.signalingConnectionState?t=e.signalingConnectionState:"failed"===e.mediaConnectionState?(e._mediaConnectionIsReconnecting=!0,t="reconnecting"):"new"===e.mediaConnectionState||"checking"===e.mediaConnectionState?t=e._mediaConnectionIsReconnecting?"reconnecting":"connected":(e._mediaConnectionIsReconnecting=!1,t="connected"),t!==e.state&&e.preempt(t)}}e.exports=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(169).EventEmitter,a=function(e){function t(e,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),o=null;return Object.defineProperties(a,{_isEnabled:{value:i,writable:!0},_trackTransceiver:{value:null,writable:!0},_sid:{get:function(){return o},set:function(e){null===o&&(o=e)}},id:{enumerable:!0,value:n},kind:{enumerable:!0,value:r},name:{enumerable:!0,value:e}}),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"disable",value:function(){return this.enable(!1)}},{key:"enable",value:function(e){return e="boolean"!==typeof e||e,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this}},{key:"setTrackTransceiver",value:function(e){return e=e||null,this.trackTransceiver!==e&&(this._trackTransceiver=e,this.emit("updated")),this}},{key:"setSid",value:function(e){return null===this.sid&&(this._sid=e,this.emit("updated")),this}},{key:"isEnabled",get:function(){return this._isEnabled}},{key:"sid",get:function(){return this._sid}},{key:"trackTransceiver",get:function(){return this._trackTransceiver}}]),t}();e.exports=a},function(e,t){e.exports=WebSocket},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(549),a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{createMessage:{enumerable:!0,value:n},peerConnectionManager:{enumerable:!0,value:t}})}return r(e,[{key:"close",value:function(){this.peerConnectionManager.close()}},{key:"getDescription",value:function(){var e=Object.assign({peer_connections:this.peerConnectionManager.getStates()},this.createMessage());return Promise.resolve({body:JSON.stringify(e),contentType:"application/room-signaling+json"})}},{key:"hasDescription",value:function(){return!0}},{key:"hold",value:function(){}},{key:"isReady",value:function(){return!0}},{key:"isMuted",value:function(){return{audio:!1,video:!1}}},{key:"mute",value:function(){}},{key:"render",value:function(){}},{key:"setDescription",value:function(e){var t=function(e){try{return JSON.parse(e.body)}catch(t){return null}}(e);if(t){var n=t.peer_connections;if(n)return this.peerConnectionManager.update(n)}return Promise.resolve()}},{key:"unhold",value:function(){}},{key:"unmute",value:function(){}},{key:"updateIceServers",value:function(){}}],[{key:"defaultFactory",value:function(){}}]),e}();a.defaultFactory.isSupported=function(){return i.WebRTC.isSupported()},e.exports=a},function(e,t,n){"use strict";var r=n(541),i=n(213).DEFAULT_LOG_LEVEL;function a(e,t){t=Object.assign({createLocalTracks:r,logLevel:i},t);var n={};n.logLevel=t.logLevel,delete t.logLevel;var a=t.createLocalTracks;return delete t.createLocalTracks,n[e]=!(Object.keys(t).length>0)||t,a(n).then(function(e){return e[0]})}e.exports={audio:function(e){return a("audio",e)},video:function(e){return a("video",e)}}},function(e,t,n){"use strict";var r=d(n(311)),i=d(n(193)),a=d(n(236)),o=d(n(152)),s=d(n(161)),c=d(n(156)),u=d(n(157)),l=d(n(189));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t,n,r){return new(n||(n=l.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var h=n(169),p=n(229),v=n(247),m=p.Logger.scope("User"),g=function(e){function t(e,n,r){(0,o.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return i.subscribed="initializing",i.setMaxListeners(0),i.services=r,i.state={identity:e,entityName:n,friendlyName:null,attributes:{},online:null,notifiable:null},i}return(0,u.default)(t,e),(0,s.default)(t,[{key:"_update",value:function(e,t){var n=[];switch(m.debug("User for",this.state.identity,"updated:",e,t),e){case"friendlyName":this.state.friendlyName!==t.value&&(n.push("friendlyName"),this.state.friendlyName=t.value);break;case"attributes":var r={};try{r=JSON.parse(t.value)}catch(i){m.warn("Retrieved malformed attributes from the server for user: "+this.state.identity)}v.isDeepEqual(this.state.attributes,r)||(this.state.attributes=r,n.push("attributes"));break;case"reachability":this.state.online!==t.online&&(this.state.online=t.online,n.push("online")),this.state.notifiable!==t.notifiable&&(this.state.notifiable=t.notifiable,n.push("notifiable"));break;default:return}n.length>0&&this.emit("updated",{user:this,updateReasons:n})}},{key:"_updateReachabilityInfo",value:function(e,t){var n=this;return this.services.session.reachabilityEnabled?e.get("reachability").then(t).catch(function(e){m.warn("Failed to get reachability info for ",n.state.identity,e)}):l.default.resolve()}},{key:"_fetch",value:function(){return f(this,void 0,void 0,i.default.mark(function e(){var t=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.entityName){e.next=2;break}return e.abrupt("return",this);case 2:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then(function(e){return t.entity=e,e.on("itemUpdated",function(e){return t._update(e.item.key,e.item.value)}),l.default.all([e.get("friendlyName").then(function(e){return t._update(e.key,e.value)}),e.get("attributes").then(function(e){return t._update(e.key,e.value)}),t._updateReachabilityInfo(e,function(e){return t._update(e.key,e.value)})])}).then(function(){return m.debug("Fetched for",t.identity),t.subscribed="subscribed",t.emit("userSubscribed",t),t}).catch(function(e){throw t.promiseToFetch=null,e}),e.abrupt("return",this.promiseToFetch);case 4:case"end":return e.stop()}},e,this)}))}},{key:"_ensureFetched",value:function(){return this.promiseToFetch||this._fetch()}},{key:"updateAttributes",value:function(e){return f(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&e.constructor===Object){t.next=2;break}throw new Error("Attributes must be an object");case 2:if("unsubscribed"!=this.subscribed){t.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return t.next=6,this.services.session.addCommand("editUserAttributes",{username:this.state.identity,attributes:(0,r.default)(e)});case 6:return t.abrupt("return",this);case 7:case"end":return t.stop()}},t,this)}))}},{key:"updateFriendlyName",value:function(e){return f(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||"string"===typeof e){t.next=2;break}throw new Error("friendlyName must be string or empty");case 2:if("unsubscribed"!=this.subscribed){t.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return t.next=6,this.services.session.addCommand("editUserFriendlyName",{username:this.state.identity,friendlyName:e});case 6:return t.abrupt("return",this);case 7:case"end":return t.stop()}},t,this)}))}},{key:"unsubscribe",value:function(){return f(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.promiseToFetch){e.next=7;break}return e.next=3,this.promiseToFetch;case 3:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 7:case"end":return e.stop()}},e,this)}))}},{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"entityName",set:function(e){this.state.entityName=e}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"online",get:function(){return this.state.online}},{key:"notifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return"subscribed"==this.subscribed}}]),t}(h.EventEmitter);t.User=g},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var n=e.call(this,"Value required at path: "+t)||this;return n.path=t,n.name="MissingError",n}return r(t,e),t}(Error);t.MissingError=i;var a=function(e){function t(t){var n=e.call(this,"Invalid operation: "+t)||this;return n.op=t,n.name="InvalidOperationError",n}return r(t,e),t}(Error);t.InvalidOperationError=a;var o=function(e){function t(t,n){var r=e.call(this,"Test failed: "+t+" != "+n)||this;return r.actual=t,r.expected=n,r.name="TestError",r.actual=t,r.expected=n,r}return r(t,e),t}(Error);t.TestError=o},function(e,t,n){"use strict";function r(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function i(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){void 0===e&&(e=[""]),this.tokens=e}return e.fromJSON=function(t){var n=t.split("/").map(r);if(""!==n[0])throw new Error("Invalid JSON Pointer: "+t);return new e(n)},e.prototype.toString=function(){return this.tokens.map(i).join("/")},e.prototype.evaluate=function(e){for(var t=e,n=null,r=null,i=1,a=this.tokens.length;i<a;i++)t=((n=t)||{})[r=this.tokens[i]];return{parent:n,key:r,value:t}},e.prototype.get=function(e){return this.evaluate(e).value},e.prototype.set=function(e,t){for(var n=e,r=1,i=this.tokens.length-1,a=this.tokens[r];r<i;r++)n=(n||{})[a];n&&(n[this.tokens[this.tokens.length-1]]=t)},e.prototype.push=function(e){this.tokens.push(e)},e.prototype.add=function(t){return new e(this.tokens.concat(String(t)))},e}();t.Pointer=a},function(e,t,n){"use strict";function r(e,t){return e.length===t.length&&function(e,t){for(var n=[],r=0,i=e.length;r<i;r++)n.push([e[r],t[r]]);return n}(e,t).every(function(e){return i(e[0],e[1])})}function i(e,t){return e===t||(Array.isArray(e)&&Array.isArray(t)?r(e,t):Object(e)===e&&Object(t)===t&&function(e,t){var n=Object.keys(e);return!!r(n,Object.keys(t))&&n.every(function(n){return i(e[n],t[n])})}(e,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.compare=i},function(e,t,n){"use strict";var r=a(n(152)),i=a(n(161));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(229),s=n(828),c=o.Logger.scope("ChannelDescriptor");function u(e){try{return new Date(e)}catch(t){return null}}var l=function(){function e(t,n){(0,r.default)(this,e),this.client=t,this.descriptor=n,n.sid?(this.sid=n.sid,this.channel=n.sid+".channel"):(this.sid=n.channel_sid,this.channel=n.channel_sid+".channel"),this.uniqueName=n.unique_name,this.friendlyName=n.friendly_name,this.attributes=function(e){try{return JSON.parse(e)}catch(t){c.warn("Failed to parse channel attributes",t)}return{}}(n.attributes),this.createdBy=n.created_by,this.dateCreated=u(n.date_created),this.dateUpdated=u(n.date_updated),this.messagesCount=n.messages_count,this.membersCount=n.members_count,this.type=n.type,this.isPrivate="private"==n.type,this.lastConsumedMessageIndex=n.last_consumed_message_index,n.notification_level&&(this.notificationLevel=n.notification_level),n.status?this.status=s.filterStatus(n.status):this.status="unknown"}return(0,i.default)(e,[{key:"getChannel",value:function(){return this.client.getChannelBySid(this.sid)}}]),e}();t.ChannelDescriptor=l},function(e,t,n){"use strict";var r=p(n(192)),i=p(n(193)),a=p(n(261)),o=p(n(311)),s=p(n(829)),c=p(n(236)),u=p(n(152)),l=p(n(161)),d=p(n(156)),f=p(n(157)),h=p(n(189));function p(e){return e&&e.__esModule?e:{default:e}}var v=function(e,t,n,r){return new(n||(n=h.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var m=n(169),g=n(229),y=n(1659),b=n(830),_=n(1660),k=n(247),w=g.Logger.scope("Channel"),T={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",name:"friendlyName",notificationLevel:"notificationLevel",sid:"sid",status:"status",type:"type",uniqueName:"uniqueName"};function S(e){try{return new Date(e)}catch(t){return null}}function C(e){switch(e){case"notParticipating":return"known";default:return e}}t.filterStatus=C;var E=function(e){function t(e,n,r){(0,u.default)(this,t);var i=(0,d.default)(this,(t.__proto__||(0,c.default)(t)).call(this)),l=n.attributes||{},f=n.createdBy,h=S(n.dateCreated),p=S(n.dateUpdated),v=n.name||n.friendlyName||null,m=(0,s.default)(n.lastConsumedMessageIndex)?n.lastConsumedMessageIndex:null,g=n.uniqueName||null;try{(0,o.default)(l)}catch(b){throw new Error("Attributes must be a valid JSON object.")}return i.services=e,i.sid=r,i.entityName=n.channel,i.state={uniqueName:g,status:"known",type:n.type,attributes:l,createdBy:f,dateCreated:h,dateUpdated:p,friendlyName:v,lastConsumedMessageIndex:m},n.notificationLevel&&(i.state.notificationLevel=n.notificationLevel),i.members=new a.default,i.membersEntity=new y.Members(i,i.services,i.members),i.membersEntity.on("memberJoined",i.emit.bind(i,"memberJoined")),i.membersEntity.on("memberLeft",i.emit.bind(i,"memberLeft")),i.membersEntity.on("memberUpdated",function(e){return i.emit("memberUpdated",e)}),i.messagesEntity=new _.Messages(i,e),i.messagesEntity.on("messageAdded",function(e){return i._onMessageAdded(e)}),i.messagesEntity.on("messageUpdated",function(e){return i.emit("messageUpdated",e)}),i.messagesEntity.on("messageRemoved",i.emit.bind(i,"messageRemoved")),i}return(0,f.default)(t,e),(0,l.default)(t,[{key:"_subscribe",value:function(){var e=this;return this.entityPromise?this.entityPromise:this.entityPromise=this.entityPromise||this.services.syncClient.document({id:this.entityName,mode:"open_existing"}).then(function(t){return e.entity=t,e.entity.on("updated",function(t){e._update(t.value)}),e.entity.on("removed",function(){return e.emit("removed",e)}),e._update(e.entity.value),t}).catch(function(t){throw e.entity=null,e.entityPromise=null,"disconnected"!=e.services.syncClient.connectionState&&w.error("Failed to get channel object",t),w.debug("ERROR: Failed to get channel object",t),t})}},{key:"_subscribeStreams",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){var t,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._subscribe();case 3:return w.trace("_subscribeStreams, this.entity.value=",this.entity.value),t=this.entity.value.messages,n=this.entity.value.roster,e.next=8,h.default.all([this.messagesEntity.subscribe(t),this.membersEntity.subscribe(n)]);case 8:e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(0),"disconnected"!==this.services.syncClient.connectionState&&w.error("Failed to subscribe on channel objects",this.sid,e.t0),w.debug("ERROR: Failed to subscribe on channel objects",this.sid,e.t0),e.t0;case 15:case"end":return e.stop()}},e,this,[[0,10]])}))}},{key:"_unsubscribe",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrivate||!this.entity){e.next=5;break}return e.next=3,this.entity.close();case 3:this.entity=null,this.entityPromise=null;case 5:return e.abrupt("return",h.default.all([this.membersEntity.unsubscribe(),this.messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}},e,this)}))}},{key:"_setStatus",value:function(e,t){var n=this;this.statusSource=t,this.state.status!==e&&(this.state.status=e,"joined"===e?this._subscribeStreams().catch(function(t){if(w.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t}):"invited"===e?this._subscribe().catch(function(t){if(w.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t}):this.entityPromise&&this._unsubscribe().catch(function(t){if(w.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t}))}},{key:"_statusSource",value:function(){return this.statusSource}},{key:"_update",value:function(e){w.trace("_update",e);var n=[];for(var r in t.preprocessUpdate(e,this.sid),e){var i=T[r];if(i)if(i===T.status)e.status&&"unknown"!=e.status&&this.state.status!==C(e.status)&&(this.state.status=C(e.status),n.push(i));else if(i===T.attributes)k.isDeepEqual(this.state.attributes,e.attributes)||(this.state.attributes=e.attributes,n.push(i));else if(i===T.lastConsumedMessageIndex)"undefined"!==typeof e.lastConsumedMessageIndex&&e.lastConsumedMessageIndex!==this.state.lastConsumedMessageIndex&&(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,n.push(i));else if(i===T.lastMessage){var a=!1;this.state.lastMessage&&!e.lastMessage?(delete this.state.lastMessage,a=!0):(this.state.lastMessage||(this.state.lastMessage={}),e.lastMessage&&"undefined"!==typeof e.lastMessage.index&&e.lastMessage.index!==this.state.lastMessage.index&&(this.state.lastMessage.index=e.lastMessage.index,a=!0),!e.lastMessage||!e.lastMessage.timestamp||this.state.lastMessage.timestamp&&this.state.lastMessage.timestamp.getTime()===e.lastMessage.timestamp.getTime()||(this.state.lastMessage.timestamp=e.lastMessage.timestamp,a=!0),k.isDeepEqual(this.state.lastMessage,{})&&delete this.state.lastMessage),a&&n.push(i)}else e[r]instanceof Date?this.state[i]&&this.state[i].getTime()===e[r].getTime()||(this.state[i]=e[r],n.push(i)):this[i]!==e[r]&&(this.state[i]=e[r],n.push(i))}n.length>0&&this.emit("updated",{channel:this,updateReasons:n})}},{key:"_onMessageAdded",value:function(e){var t=!0,n=!1,i=void 0;try{for(var a,o=(0,r.default)(this.members.values());!(t=(a=o.next()).done);t=!0){var s=a.value;if(s.identity===e.author){s._endTyping();break}}}catch(c){n=!0,i=c}finally{try{!t&&o.return&&o.return()}finally{if(n)throw i}}this.emit("messageAdded",e)}},{key:"add",value:function(e){return v(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"===typeof e){t.next=2;break}throw new Error("Channel.add requires an <String>identity parameter");case 2:return t.abrupt("return",this.membersEntity.add(e));case 3:case"end":return t.stop()}},t,this)}))}},{key:"advanceLastConsumedMessageIndex",value:function(e){return v(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((0,s.default)(e)){t.next=2;break}throw new Error("Channel.advanceLastConsumedMessageIndex requires an integral <Number>index parameter");case 2:return t.next=4,this._subscribeStreams();case 4:return t.abrupt("return",this.services.consumptionHorizon.advanceLastConsumedMessageIndexForChannel(this.sid,e,this.lastConsumedMessageIndex));case 5:case"end":return t.stop()}},t,this)}))}},{key:"decline",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("declineInvitation",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"delete",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("destroyChannel",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getAttributes",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getMessages",value:function(e,t,n){return v(this,void 0,void 0,i.default.mark(function r(){return i.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("undefined"===typeof t||(0,s.default)(t)){r.next=2;break}throw new Error("Anchor should be a valid message index");case 2:return r.next=4,this._subscribeStreams();case 4:return r.abrupt("return",this.messagesEntity.getMessages(e,t,n));case 5:case"end":return r.stop()}},r,this)}))}},{key:"getMembers",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.membersEntity.getMembers());case 3:case"end":return e.stop()}},e,this)}))}},{key:"getMembersCount",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){var t,n,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new k.UriBuilder(t.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(n);case 6:return r=e.sent,e.abrupt("return",r.body.members_count);case 8:case"end":return e.stop()}},e,this)}))}},{key:"getMessagesCount",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){var t,n,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new k.UriBuilder(t.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(n);case 6:return r=e.sent,e.abrupt("return",r.body.messages_count);case 8:case"end":return e.stop()}},e,this)}))}},{key:"getUnconsumedMessagesCount",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){var t,n,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=e.sent,n=new k.UriBuilder(t.myChannelsUrl).arg("ChannelSid",this.sid).build(),e.next=6,this.services.network.get(n);case 6:if(!(r=e.sent).body.channels.length||r.body.channels[0].channel_sid!=this.sid){e.next=11;break}if("undefined"===typeof r.body.channels[0].unread_messages_count||null==r.body.channels[0].unread_messages_count){e.next=10;break}return e.abrupt("return",r.body.channels[0].unread_messages_count);case 10:return e.abrupt("return",null);case 11:throw new Error("Channel is not in user channels list");case 12:case"end":return e.stop()}},e,this)}))}},{key:"invite",value:function(e){return v(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"===typeof e&&e.length){t.next=2;break}throw new Error("Channel.invite requires an <String>identity parameter");case 2:return t.abrupt("return",this.membersEntity.invite(e));case 3:case"end":return t.stop()}},t,this)}))}},{key:"join",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("joinChannelV2",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"leave",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this.state.status){e.next=3;break}return e.next=3,this.services.session.addCommand("leaveChannel",{channelSid:this.sid});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}},e,this)}))}},{key:"removeMember",value:function(e){return v(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&("string"===typeof e||e instanceof b.Member)){t.next=2;break}throw new Error("Channel.removeMember requires a <String|Member>member parameter.");case 2:return t.abrupt("return",this.membersEntity.remove("string"===typeof e?e:e.identity));case 3:case"end":return t.stop()}},t,this)}))}},{key:"sendMessage",value:function(e,t){return v(this,void 0,void 0,i.default.mark(function n(){var r,a;return i.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("string"!==typeof e){n.next=7;break}return n.next=3,this.messagesEntity.send(e,t);case 3:return r=n.sent,n.abrupt("return",k.parseToNumber(r.messageId));case 7:return n.next=9,this.messagesEntity.sendMedia(e,t);case 9:return a=n.sent,n.abrupt("return",k.parseToNumber(a.messageId));case 11:case"end":return n.stop()}},n,this)}))}},{key:"setAllMessagesConsumed",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.getMessages(1);case 4:if(!((t=e.sent).items.length>0)){e.next=7;break}return e.abrupt("return",this.advanceLastConsumedMessageIndex(t.items[0].index));case 7:return e.abrupt("return",h.default.resolve(0));case 8:case"end":return e.stop()}},e,this)}))}},{key:"setNoMessagesConsumed",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,null));case 3:case"end":return e.stop()}},e,this)}))}},{key:"setUserNotificationLevel",value:function(e){return v(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("notificationLevel can't be null");case 2:return t.next=4,this.services.session.addCommand("editNotificationLevel",{channelSid:this.sid,notificationLevel:e});case 4:case"end":return t.stop()}},t,this)}))}},{key:"typing",value:function(){return this.services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:function(e){return v(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=4;break}throw new Error("Attributes can't be null");case 4:if(e.constructor===Object){t.next=6;break}throw new Error("Attributes must be a valid JSON object.");case 6:return t.next=8,this.services.session.addCommand("editAttributes",{channelSid:this.sid,attributes:(0,o.default)(e)});case 8:return t.abrupt("return",this);case 9:case"end":return t.stop()}},t,this)}))}},{key:"updateFriendlyName",value:function(e){return v(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.friendlyName===e){t.next=3;break}return t.next=3,this.services.session.addCommand("editFriendlyName",{channelSid:this.sid,friendlyName:e});case 3:return t.abrupt("return",this);case 4:case"end":return t.stop()}},t,this)}))}},{key:"updateLastConsumedMessageIndex",value:function(e){return v(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((0,s.default)(e)||null===e){t.next=2;break}throw new Error('Incorrect argument "index": integer number or null expected');case 2:return t.next=4,this._subscribeStreams();case 4:return t.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,e));case 5:case"end":return t.stop()}},t,this)}))}},{key:"updateUniqueName",value:function(e){return v(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.uniqueName===e){t.next=3;break}return t.next=3,this.services.session.addCommand("editUniqueName",{channelSid:this.sid,uniqueName:e});case 3:return t.abrupt("return",this);case 4:case"end":return t.stop()}},t,this)}))}},{key:"getUserDescriptors",value:function(){return v(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getChannelUserDescriptors(this.sid));case 1:case"end":return e.stop()}},e,this)}))}},{key:"status",get:function(){return this.state.status}},{key:"type",get:function(){return this.state.type}},{key:"uniqueName",get:function(){return this.state.uniqueName}},{key:"isPrivate",get:function(){return"private"===this.state.type}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"createdBy",get:function(){return this.state.createdBy}},{key:"attributes",get:function(){return this.state.attributes}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}},{key:"lastMessage",get:function(){return this.state.lastMessage}},{key:"notificationLevel",get:function(){return this.state.notificationLevel}}],[{key:"preprocessUpdate",value:function(e,t){try{"string"===typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&(0,o.default)(e.attributes)}catch(n){w.warn("Retrieved malformed attributes from the server for channel: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(n){w.warn("Retrieved malformed dateCreated from the server for channel: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(n){w.warn("Retrieved malformed dateUpdated from the server for channel: "+t),delete e.dateUpdated}try{e.lastMessage&&e.lastMessage.timestamp&&(e.lastMessage.timestamp=new Date(e.lastMessage.timestamp))}catch(n){w.warn("Retrieved malformed lastMessage.timestamp from the server for channel: "+t),delete e.lastMessage.timestamp}}}]),t}(m.EventEmitter);t.Channel=E},function(e,t,n){e.exports={default:n(1656),__esModule:!0}},function(e,t,n){"use strict";var r=d(n(193)),i=d(n(829)),a=d(n(236)),o=d(n(152)),s=d(n(156)),c=d(n(161)),u=d(n(157)),l=d(n(189));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t,n,r){return new(n||(n=l.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(e,n,r,c){(0,o.default)(this,t);var u=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this));if(u.channel=n,u.services=e,u.state={sid:c,typingTimeout:null,isTyping:!1,identity:r.identity,roleSid:r.roleSid||null,lastConsumedMessageIndex:(0,i.default)(r.lastConsumedMessageIndex)?r.lastConsumedMessageIndex:null,lastConsumptionTimestamp:r.lastConsumptionTimestamp?new Date(r.lastConsumptionTimestamp):null,userInfo:r.userInfo},!r.identity)throw new Error("Received invalid Member object from server: Missing identity.");return u}return(0,u.default)(t,e),(0,c.default)(t,[{key:"sid",get:function(){return this.state.sid}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}},{key:"lastConsumptionTimestamp",get:function(){return this.state.lastConsumptionTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}}]),(0,c.default)(t,[{key:"_startTyping",value:function(e){var t=this;return clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this.state.typingTimeout=setTimeout(function(){return t._endTyping()},e),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(e){var t=[];if(e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,t.push("roleSid")),!(0,i.default)(e.lastConsumedMessageIndex)&&null!==e.lastConsumedMessageIndex||this.state.lastConsumedMessageIndex===e.lastConsumedMessageIndex||(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,t.push("lastConsumedMessageIndex")),e.lastConsumptionTimestamp){var n=new Date(e.lastConsumptionTimestamp);this.state.lastConsumptionTimestamp&&this.state.lastConsumptionTimestamp.getTime()===n.getTime()||(this.state.lastConsumptionTimestamp=n,t.push("lastConsumptionTimestamp"))}return t.length>0&&this.emit("updated",{member:this,updateReasons:t}),this}},{key:"getUserDescriptor",value:function(){return f(this,void 0,void 0,r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getUserDescriptor(this.state.identity));case 1:case"end":return e.stop()}},e,this)}))}},{key:"getUser",value:function(){return f(this,void 0,void 0,r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 1:case"end":return e.stop()}},e,this)}))}},{key:"remove",value:function(){return this.channel.removeMember(this)}}]),t}(n(169).EventEmitter);t.Member=h},function(e,t){e.exports=window.FormData},function(e,t,n){"use strict";var r,i=n(152),a=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0});var o=function e(){(0,a.default)(this,e)};o.TYPING_INDICATOR="twilio.ipmsg.typing_indicator",o.NEW_MESSAGE="twilio.channel.new_message",o.ADDED_TO_CHANNEL="twilio.channel.added_to_channel",o.INVITED_TO_CHANNEL="twilio.channel.invited_to_channel",o.REMOVED_FROM_CHANNEL="twilio.channel.removed_from_channel",o.CONSUMPTION_UPDATE="twilio.channel.consumption_update",t.NotificationTypes=o},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=n(284);function o(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}).length}function s(e){var t=Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join("").replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n});return decodeURIComponent(t)}function c(e){return JSON.parse(s(e))}var u=function(){function e(){r(this,e)}return i(e,null,[{key:"parse",value:function(e){var t=new Uint8Array(e),n=function(e){for(var t="",n=0;n<e.length;++n){var r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}var i=t.split(" ");return{size:n,protocol:i[0],version:i[1],headerSize:Number(i[2])}}(t);if("TWILSOCK"===n.protocol&&"V3.0"===n.version){var r=null;try{r=c(t.subarray(n.size,n.size+n.headerSize))}catch(l){return void a.log.error("failed to parse message header",l,e)}a.log.debug("message received: ",r.method),a.log.trace("message received: ",r);var i=null;if(r.payload_size>0){var o=2+n.size+n.headerSize,u=r.payload_size;if(r.hasOwnProperty("payload_type")&&0!==r.payload_type.indexOf("application/json"))0===r.payload_type.indexOf("text/plain")&&(i=s(t.subarray(o,o+u)));else try{i=c(t.subarray(o,o+u))}catch(l){return void a.log.error("failed to parse message body",l,e)}}return{method:r.method,header:r,payload:i}}a.log.error("unsupported protocol: ".concat(n.protocol," ver ").concat(n.version))}},{key:"createPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=o(t);var n=JSON.stringify(e)+"\r\n",r="TWILSOCK V3.0 "+(o(n)-2)+"\r\n";return a.log.debug("send request:",r+n+t),function(e){var t=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,function(e,t){n[t]=e.charCodeAt(0)}),n}(r+n+t).buffer}}]),e}();t.Parser=u},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173);Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(e,n){var o;return r(this,t),(o=i(this,a(t).call(this,e))).reply=n,o}return o(t,e),t}(n(285).TwilsockError);t.TwilsockReplyError=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1693);t.Notifications=r.Client},function(e,t,n){"use strict";var r=n(405),i=n(0),a=n(185),o=n(172),s=n(170),c=n(173),u=n(702),l=n(159),d=n(165);Object.defineProperty(t,"__esModule",{value:!0});var f=n(169),h=n(552),p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;l(this,e),this.token=t,this.notificationId=n,this.messageTypes=r}return d(e,[{key:"clone",value:function(){return new e(this.token,this.notificationId,new Set(this.messageTypes))}}]),e}();function v(e,t){var n=new Set;return e.notificationId!==t.notificationId&&n.add("notificationId"),e.token!==t.token&&n.add("token"),function(e,t){return u(u(e).filter(function(e){return!t.has(e)})).concat(u(u(t).filter(function(t){return!e.has(t)})))}(e.messageTypes,t.messageTypes).length>0&&n.add("messageType"),[n.size>0,n]}t.RegistrationState=p;var m=function(e){function t(e){var n;return l(this,t),(n=o(this,s(t).call(this))).config=e,n.desiredState=new p,n.currentState=new p,n.hasActiveAttempt=!1,n}return c(t,e),d(t,[{key:"subscribe",value:function(){var e=a(i.mark(function e(t){return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.desiredState.messageTypes.has(t)){e.next=3;break}return h.log.debug("message type already registered ",t),e.abrupt("return");case 3:this.desiredState.messageTypes.add(t),this.persistRegistration();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(){var e=a(i.mark(function e(t){return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.desiredState.messageTypes.has(t)){e.next=2;break}return e.abrupt("return");case 2:this.desiredState.messageTypes.delete(t),this.persistRegistration();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateToken",value:function(e){this.desiredState.token=e,this.persistRegistration()}},{key:"persistRegistration",value:function(){var e=a(i.mark(function e(){var t,n,a,o,s,c,u=this;return i.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.token&&0!==this.config.token.length){e.next=3;break}return h.log.trace("Can't persist registration: token is not set"),e.abrupt("return");case 3:if(!this.hasActiveAttempt){e.next=6;break}return h.log.trace("One registration attempt is already in progress"),e.abrupt("return");case 6:if(t=v(this.desiredState,this.currentState),n=r(t,2),a=n[0],o=n[1],a){e.next=9;break}return e.abrupt("return");case 9:if(this.currentState.notificationId||o.delete("notificationId"),h.log.trace("Persisting registration",o,this.desiredState),e.prev=11,this.hasActiveAttempt=!0,!((s=this.desiredState.clone()).messageTypes.size>0)){e.next=24;break}return e.next=17,this.updateRegistration(s,o);case 17:c=e.sent,this.currentState.token=c.token,this.currentState.notificationId=c.notificationId,this.currentState.messageTypes=c.messageTypes,this.emit("stateChanged","registered"),e.next=30;break;case 24:return e.next=26,this.removeRegistration();case 26:this.currentState.token=s.token,this.currentState.notificationId=s.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged","unregistered");case 30:return e.prev=30,this.hasActiveAttempt=!1,setTimeout(function(){return u.persistRegistration()},0),e.finish(30);case 34:case"end":return e.stop()}},e,this,[[11,,30,34]])}));return function(){return e.apply(this,arguments)}}()},{key:"setNotificationId",value:function(e){this.desiredState.notificationId=e,this.persistRegistration()}}]),t}(f.EventEmitter);t.Connector=m},function(e,t,n){var r=n(169),i=n(553);function a(e){r.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}n(197).inherits(a,r.EventEmitter),a.prototype.failAfter=function(e){i.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},a.prototype.backoff=function(e){i.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},a.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},a.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},e.exports=a},function(e,t,n){n(169),n(197);function r(e){return void 0!==e&&null!==e}function i(e){if(r((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(r(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(r(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}i.prototype.getMaxDelay=function(){return this.maxDelay_},i.prototype.getInitialDelay=function(){return this.initialDelay_},i.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)},i.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},i.prototype.reset=function(){this.reset_()},i.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},e.exports=i},function(e,t,n){var r=n(197),i=n(840);function a(e){i.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}r.inherits(a,i),a.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e,e},a.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},e.exports=a},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165),s=n(172),c=n(170),u=n(173);Object.defineProperty(t,"__esModule",{value:!0});var l=n(287),d=n(426),f=n(314),h=n(554),p=n(286),v=function(e){function t(e,n,r){var i;a(this,t),(i=s(this,c(t).call(this,e,r))).isDeleted=!1;return i.updateMergingQueue=new h.MergingQueue(function(e,t){return"number"===typeof t.ttl?{ttl:t.ttl}:e}),i.descriptor=n,i.descriptor.data=i.descriptor.data||{},i.descriptor.date_updated=new Date(i.descriptor.date_updated),i}return u(t,e),o(t,[{key:"_update",value:function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":e.id>this.lastEventId?(this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.emit("updated",{value:e.document_data,isLocal:!1}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data})):l.default.trace("Document update skipped, current:",this.lastEventId,", remote:",e.id);break;case"document_removed":this.onRemoved(!1)}}},{key:"set",value:function(){var e=i(r.mark(function e(t,n){var i,a=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n||{},f.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(i,function(e){return a._setUnconditionally(t,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"mutate",value:function(){var e=i(r.mark(function e(t,n){var i,a=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n||{},f.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.add(i,function(e){return a._setWithIfMatch(t,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=i(r.mark(function e(t,n){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(function(e){return Object.assign(e,t)},n));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setTtl",value:function(){var e=i(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f.validateMandatoryTtl(t),e.next=3,this._postUpdateToServer({ttl:t});case 3:n=e.sent,this.descriptor.date_expires=n.date_expires;case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_setUnconditionally",value:function(){var e=i(r.mark(function e(t,n){var i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({data:t,revision:void 0,ttl:n});case 2:return i=e.sent,this._handleSuccessfulUpdateResult(i),e.abrupt("return",this.value);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"_setWithIfMatch",value:function(){var e=i(r.mark(function e(t,n){var i,a,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=t(f.deepClone(this.value)))){e.next=22;break}return a=this.revision,e.prev=3,e.next=6,this._postUpdateToServer({data:i,revision:a,ttl:n});case 6:return o=e.sent,this._handleSuccessfulUpdateResult(o),e.abrupt("return",this.value);case 11:if(e.prev=11,e.t0=e.catch(3),412!==e.t0.status){e.next=19;break}return e.next=16,this._softSync();case 16:return e.abrupt("return",this._setWithIfMatch(t));case 19:throw e.t0;case 20:e.next=23;break;case 22:return e.abrupt("return",this.value);case 23:case"end":return e.stop()}},e,this,[[3,11]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"_handleSuccessfulUpdateResult",value:function(e){e.last_event_id>this.descriptor.last_event_id&&(this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.emit("updated",{value:this.value,isLocal:!0}))}},{key:"_postUpdateToServer",value:function(){var e=i(r.mark(function e(t){var n,i,a;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=17;break}return n={data:t.data},"number"===typeof t.ttl&&(n.ttl=t.ttl),i=t.revision,e.prev=4,e.next=7,this.services.network.post(this.uri,n,i);case 7:return a=e.sent,e.abrupt("return",{revision:a.body.revision,data:t.data,last_event_id:a.body.last_event_id,date_updated:a.body.date_updated,date_expires:a.body.date_expires});case 11:throw e.prev=11,e.t0=e.catch(4),404===e.t0.status&&this.onRemoved(!1),e.t0;case 15:e.next=18;break;case 17:return e.abrupt("return",Promise.reject(new p.SyncError("The Document has been removed",404,54100)));case 18:case"end":return e.stop()}},e,this,[[4,11]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_softSync",value:function(){var e=i(r.mark(function e(){var t=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.network.get(this.uri).then(function(e){var n={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return t._update(n),t}).catch(function(e){404===e.status?t.onRemoved(!1):l.default.error("Can't get updates for ".concat(t.sid,":"),e)}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onRemoved",value:function(e){this.isDeleted||(this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e}))}},{key:"removeDocument",value:function(){var e=i(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",Promise.reject(new p.SyncError("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"value",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}}],[{key:"type",get:function(){return"document"}}]),t}(d.SyncEntity);t.SyncDocument=v,t.default=v},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165),s=n(172),c=n(170),u=n(173);Object.defineProperty(t,"__esModule",{value:!0});var l=n(314),d=n(287),f=n(426),h=n(844),p=n(845),v=n(846),m=n(554),g=n(286),y=function(e){function t(e,n,r){var i;a(this,t);return(i=s(this,c(t).call(this,e,r))).updateMergingQueue=new m.NamespacedMergingQueue(function(e,t){return"number"===typeof t.ttl?{ttl:t.ttl}:e}),i.cache=new v.Cache,i.descriptor=n,i.descriptor.date_updated=new Date(i.descriptor.date_updated),i}return u(t,e),o(t,[{key:"_addOrUpdateItemOnServer",value:function(){var e=i(r.mark(function e(t,n,i,a){var o,s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o={data:n},"number"===typeof a&&(o.ttl=a),e.next=4,this.services.network.post(t,o,i);case 4:return(s=e.sent).body.data=n,s.body.date_updated=new Date(s.body.date_updated),e.abrupt("return",s.body);case 8:case"end":return e.stop()}},e,this)}));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"push",value:function(){var e=i(r.mark(function e(t,n){var i,a,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=(n||{}).ttl,l.validateOptionalTtl(i),e.next=4,this._addOrUpdateItemOnServer(this.links.items,t,void 0,i);case 4:return a=e.sent,o=Number(a.index),this._handleItemMutated(o,a.url,a.last_event_id,a.revision,t,a.date_updated,a.date_expires,!0,!1),e.abrupt("return",this.cache.get(o));case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t,n){var r=this,i=n||{};return l.validateOptionalTtl(i.ttl),this.updateMergingQueue.squashAndAdd(e,i,function(n){return r._updateItemUnconditionally(e,t,n.ttl)})}},{key:"_updateItemUnconditionally",value:function(){var e=i(r.mark(function e(t,n,i){var a,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return a=e.sent,e.next=5,this._addOrUpdateItemOnServer(a.uri,n,void 0,i);case 5:return o=e.sent,this._handleItemMutated(t,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 8:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_updateItemWithIfMatch",value:function(){var e=i(r.mark(function e(t,n,i){var a,o,s,c;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:if(a=e.sent,!(o=n(l.deepClone(a.value)))){e.next=25;break}return s=a.revision,e.prev=6,e.next=9,this._addOrUpdateItemOnServer(a.uri,o,s,i);case 9:return c=e.sent,this._handleItemMutated(t,c.url,c.last_event_id,c.revision,c.data,c.date_updated,c.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 14:if(e.prev=14,e.t0=e.catch(6),412!==e.t0.status){e.next=22;break}return e.next=19,this._getItemFromServer(t);case 19:return e.abrupt("return",this._updateItemWithIfMatch(t,n,i));case 22:throw e.t0;case 23:e.next=26;break;case 25:return e.abrupt("return",a);case 26:case"end":return e.stop()}},e,this,[[6,14]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"mutate",value:function(){var e=i(r.mark(function e(t,n,i){var a,o=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=i||{},l.validateOptionalTtl(a.ttl),e.abrupt("return",this.updateMergingQueue.add(t,a,function(e){return o._updateItemWithIfMatch(t,n,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=i(r.mark(function e(t,n,i){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,function(e){return Object.assign(e,n)},i));case 1:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=i(r.mark(function e(t){var n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,e.next=5,this.services.network.delete(n.uri);case 5:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,void 0,new Date(i.body.date_updated),!1);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=i(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))){e.next=5;break}return e.abrupt("return",n);case 5:return e.abrupt("return",this._getItemFromServer(t));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:function(){var e=i(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({index:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new g.SyncError("No item with index ".concat(t," found"),404,54151);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"queryItems",value:function(){var e=i(r.mark(function e(t){var n,i,a,o,s=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new l.UriBuilder(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Index",t.index).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return i=e.sent,a=i.body.items.map(function(e){return e.date_updated=new Date(e.date_updated),s.cache.get(e.index)?s._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):s.cache.store(Number(e.index),new h.ListItem({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,value:e.data}),e.last_event_id),s.cache.get(e.index)}),o=i.body.meta,e.abrupt("return",new p.Paginator(a,function(e){return s.queryItems({pageToken:e})},o.previous_token,o.next_token));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:function(){var e=i(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},l.validatePageSize(t.pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getContext",value:function(){var e=i(r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=5;break}return e.next=3,this.services.network.get(this.links.context);case 3:t=e.sent,this._updateContextIfRequired(t.body.data,t.body.last_event_id);case 5:return e.abrupt("return",this.context);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setTtl",value:function(){var e=i(r.mark(function e(t){var n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.validateMandatoryTtl(t),e.prev=1,n={ttl:t},e.next=5,this.services.network.post(this.uri,n);case 5:i=e.sent,this.descriptor.date_expires=i.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"setItemTtl",value:function(){var e=i(r.mark(function e(t,n){var i,a,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.validateMandatoryTtl(n),e.next=3,this.get(t);case 3:return i=e.sent,a={ttl:n},e.next=7,this.services.network.post(i.uri,a);case 7:o=e.sent,i.updateDateExpires(o.body.date_expires);case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeList",value:function(){var e=i(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){var n=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(n,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(n,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,a,o,s,c){if(this.shouldIgnoreEvent(e,n))d.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(a);var u=this.cache.get(e);if(u)u.lastEventId<n&&(u.update(n,r,i,a),void 0!==o&&u.updateDateExpires(o),this.emitItemMutationEvent(u,c,!1));else{var l=new h.ListItem({index:e,uri:t,lastEventId:n,revision:r,value:i,dateUpdated:a,dateExpires:o});this.cache.store(e,l,n),this.emitItemMutationEvent(l,c,s)}}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=n?"itemAdded":"itemUpdated";this.emit(r,{item:e,isLocal:!t})}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.emit("itemRemoved",{index:e,isLocal:!i,value:n})}},{key:"_handleContextUpdate",value:function(e,t,n){this._updateRootDateUpdated(n),this._updateContextIfRequired(e,t)&&this.emit("contextUpdated",{context:e,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(d.default.trace("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}],[{key:"type",get:function(){return"list"}}]),t}(f.SyncEntity);t.SyncList=y,t.default=y},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t){r(this,e),this.data=t}return i(e,[{key:"update",value:function(e,t,n,r){return this.data.lastEventId=e,this.data.revision=t,this.data.value=n,this.data.dateUpdated=r,this}},{key:"updateDateExpires",value:function(e){this.data.dateExpires=e}},{key:"uri",get:function(){return this.data.uri}},{key:"revision",get:function(){return this.data.revision}},{key:"lastEventId",get:function(){return this.data.lastEventId}},{key:"dateUpdated",get:function(){return this.data.dateUpdated}},{key:"dateExpires",get:function(){return this.data.dateExpires}},{key:"index",get:function(){return this.data.index}},{key:"value",get:function(){return this.data.value}}]),e}();t.ListItem=a,t.default=a},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165);Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(t,n,r,i){a(this,e),this.prevToken=r,this.nextToken=i,this.items=t,this.source=n}return o(e,[{key:"nextPage",value:function(){var e=i(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"prevPage",value:function(){var e=i(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}}]),e}();t.Paginator=s},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=n(1710),o=function(){function e(t,n){r(this,e),this.value=t,this.revision=n||0}return i(e,[{key:"isValid",get:function(){return!0}}]),e}(),s=function(){function e(t){r(this,e),this.revision=t}return i(e,[{key:"isValid",get:function(){return!1}}]),e}(),c=function(){function e(){r(this,e),this.items=new a.TreeMap}return i(e,[{key:"store",value:function(e,t,n){var r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new o(t,n)),t)}},{key:"delete",value:function(e,t){var n=this.items.get(e);(!n||n.revision<t)&&this.items.set(e,new s(t))}},{key:"isKnown",value:function(e,t){var n=this.items.get(e);return n&&n.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}}]),e}();t.Cache=c,t.default=c},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165),s=n(172),c=n(170),u=n(173);Object.defineProperty(t,"__esModule",{value:!0});var l=n(314),d=n(287),f=n(426),h=n(848),p=n(845),v=n(846),m=n(554),g=n(286),y=function(e){function t(e,n,r){var i;a(this,t);return(i=s(this,c(t).call(this,e,r))).updateMergingQueue=new m.NamespacedMergingQueue(function(e,t){return"number"===typeof t.ttl?{ttl:t.ttl}:e}),i.cache=new v.Cache,i.descriptor=n,i.descriptor.date_updated=new Date(i.descriptor.date_updated),n.items&&n.items.forEach(function(e){e.date_updated=new Date(e.date_updated),i.cache.store(e.key,new h.MapItem(e),e.last_event_id)}),i}return u(t,e),o(t,[{key:"set",value:function(){var e=i(r.mark(function e(t,n,i){var a,o=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=i||{},l.validateOptionalTtl(a.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,a,function(e){return o._putItemUnconditionally(t,n,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=i(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=4;break}return e.abrupt("return",this.cache.get(t));case 4:return e.abrupt("return",this._getItemFromServer(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:function(){var e=i(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({key:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new g.SyncError("No item with key ".concat(t," found"),404,54201);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mutate",value:function(){var e=i(r.mark(function e(t,n,i){var a,o=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=i||{},l.validateOptionalTtl(a.ttl),e.abrupt("return",this.updateMergingQueue.add(t,a,function(e){return o._putItemWithIfMatch(t,n,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=i(r.mark(function e(t,n,i){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,function(e){return Object.assign(e,n)},i));case 1:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_putItemUnconditionally",value:function(){var e=i(r.mark(function e(t,n,i){var a,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._putItemToServer(t,n,void 0,i);case 2:return a=e.sent,o=a.item,this._handleItemMutated(o.key,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,a.added,!1),e.abrupt("return",this.cache.get(o.key));case 6:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_putItemWithIfMatch",value:function(){var e=i(r.mark(function e(t,n,i){var a,o,s,c,u;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t).catch(function(e){if(404===e.status)return new h.MapItem({key:t,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw e});case 2:if(a=e.sent,!(o=n(l.deepClone(a.value)))){e.next=26;break}return s=a.revision,e.prev=6,e.next=9,this._putItemToServer(t,o,s,i);case 9:return c=e.sent,u=c.item,this._handleItemMutated(u.key,u.url,u.last_event_id,u.revision,u.data,u.date_updated,u.date_expires,c.added,!1),e.abrupt("return",this.cache.get(u.key));case 15:if(e.prev=15,e.t0=e.catch(6),412!==e.t0.status){e.next=23;break}return e.next=20,this._getItemFromServer(t);case 20:return e.abrupt("return",this._putItemWithIfMatch(t,n,i));case 23:throw e.t0;case 24:e.next=27;break;case 26:return e.abrupt("return",a);case 27:case"end":return e.stop()}},e,this,[[6,15]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_putItemToServer",value:function(){var e=i(r.mark(function e(t,n,i,a){var o,s,c,u,d;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new l.UriBuilder(this.links.items).pathSegment(t).build(),s={data:n},"number"===typeof a&&(s.ttl=a),e.prev=3,e.next=6,this.services.network.put(o,s,i);case 6:return c=e.sent,(u=c.body).data=n,u.date_updated=new Date(u.date_updated),d=201===c.status.code,e.abrupt("return",{added:d,item:u});case 14:throw e.prev=14,e.t0=e.catch(3),404===e.t0.status&&this.onRemoved(!1),e.t0;case 18:case"end":return e.stop()}},e,this,[[3,14]])}));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=i(r.mark(function e(t){var n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof t){e.next=2;break}throw new Error("Key argument is invalid");case 2:return e.next=4,this.get(t);case 4:return n=e.sent,e.next=7,this.services.network.delete(n.uri);case 7:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,void 0,new Date(i.body.date_updated),!1);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"queryItems",value:function(){var e=i(r.mark(function e(t){var n,i,a,o,s=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new l.UriBuilder(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Key",t.key).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return i=e.sent,a=i.body.items.map(function(e){return e.date_updated=new Date(e.date_updated),s.cache.get(e.key)?s._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):s.cache.store(e.key,new h.MapItem(e),e.last_event_id),s.cache.get(e.key)}),o=i.body.meta,e.abrupt("return",new p.Paginator(a,function(e){return s.queryItems({pageToken:e})},o.previous_token,o.next_token));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:function(){var e=i(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},l.validatePageSize(t.pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"forEach",value:function(e){var t=this;return new Promise(function(n,r){t.queryItems().then(function t(i){i.items.forEach(function(t){return e(t)}),i.hasNextPage?i.nextPage().then(t).catch(r):n()}).catch(r)})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,a,o,s,c){if(this.shouldIgnoreEvent(e,n))d.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(a);var u=this.cache.get(e);u?u.lastEventId<n&&(u.update(n,r,i,a),void 0!==o&&u.updateDateExpires(o),this.emitItemMutationEvent(u,c,!1)):(u=new h.MapItem({key:e,url:t,last_event_id:n,revision:r,data:i,date_updated:a,date_expires:o}),this.cache.store(e,u,n),this.emitItemMutationEvent(u,c,s))}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=n?"itemAdded":"itemUpdated";this.emit(r,{item:e,isLocal:!t})}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.emit("itemRemoved",{key:e,isLocal:!i,value:n})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"setTtl",value:function(){var e=i(r.mark(function e(t){var n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.validateMandatoryTtl(t),e.prev=1,n={ttl:t},e.next=5,this.services.network.post(this.uri,n);case 5:i=e.sent,this.descriptor.date_expires=i.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"setItemTtl",value:function(){var e=i(r.mark(function e(t,n){var i,a,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.validateMandatoryTtl(n),e.next=3,this.get(t);case 3:return i=e.sent,a={ttl:n},e.next=7,this.services.network.post(i.uri,a);case 7:o=e.sent,i.updateDateExpires(o.body.date_expires);case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeMap",value:function(){var e=i(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}],[{key:"type",get:function(){return"map"}}]),t}(f.SyncEntity);t.SyncMap=y,t.default=y},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t){r(this,e),this.descriptor=t}return i(e,[{key:"update",value:function(e,t,n,r){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.date_updated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.date_expires=e}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"value",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}]),e}();t.MapItem=a},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=n(348);function o(e,t){return["".concat((new Date).toISOString()," MCS Client ").concat(e,":")].concat(Array.from(t))}var s=function(){function e(t){r(this,e),this.prefix="",this.prefix=null!==t&&void 0!==t&&t.length>0?t+" ":""}return i(e,[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.trace.apply(null,o(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.debug.apply(null,o(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.info.apply(null,o(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.warn.apply(null,o(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.error.apply(null,o(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.trace.apply(null,o("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.debug.apply(null,o("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.info.apply(null,o("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.warn.apply(null,o("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.error.apply(null,o("E",t))}}]),e}();t.Logger=s},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t,n,i){r(this,e);var a=i.MCS||i||{};this.region=a.region||i.region,this.baseUrl=("undefined"===typeof this.region?"https://mcs.us1.twilio.com":"https://mcs.".concat(this.region,".twilio.com"))+n,this.token=t,this.retryWhenThrottledOverride=a.retryWhenThrottledOverride,this.backoffConfigOverride=a.backoffConfigOverride}return i(e,[{key:"updateToken",value:function(e){this.token=e}}],[{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}},{key:"retryWhenThrottledDefault",get:function(){return!0}}]),e}();t.Configuration=a},function(e,t,n){"use strict";var r=d(n(581)),i=d(n(580)),a=d(n(457)),o=d(n(1726)),s=d(n(236)),c=d(n(152)),u=d(n(156)),l=d(n(157));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return r.name=r.constructor.name,r.message=e,r.code=n,Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,r}return(0,l.default)(t,e),t}(function(e){function t(){var t=(0,o.default)(e,(0,a.default)(arguments));return(0,i.default)(t,(0,s.default)(this)),t}return t.prototype=(0,r.default)(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i.default?(0,i.default)(t,e):t.__proto__=e,t}(Error));t.SessionError=f},function(e,t,n){"use strict";var r=o(n(189)),i=o(n(152)),a=o(n(161));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){var t=this;(0,i.default)(this,e),this._promise=new r.default(function(e,n){t._resolve=e,t._reject=n})}return(0,a.default)(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();t.Deferred=s},function(e){e.exports={_args:[["twilio-chat@3.1.0","/Users/yraj/lts-code/remotepatientmonitoring/client"]],_from:"twilio-chat@3.1.0",_id:"twilio-chat@3.1.0",_inBundle:!1,_integrity:"sha512-Lkj2JPnmfey5zO65B6uqcOLaxCYZtdV3/E4Ie78VnJSRLMmlpxbMw7uahhMLyQ3+hcU+lAtJWSEEpoltWulkkA==",_location:"/twilio-chat",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"twilio-chat@3.1.0",name:"twilio-chat",escapedName:"twilio-chat",rawSpec:"3.1.0",saveSpec:null,fetchSpec:"3.1.0"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/twilio-chat/-/twilio-chat-3.1.0.tgz",_spec:"3.1.0",_where:"/Users/yraj/lts-code/remotepatientmonitoring/client",author:{name:"Twilio"},browser:"browser/index.js",dependencies:{"iso8601-duration":"^1.1.1","isomorphic-form-data":"^1.0.0",loglevel:"^1.6.1","operation-retrier":"latest",platform:"^1.3.5",rfc6902:"^2.2.2","twilio-mcs-client":"^0.2.2","twilio-notifications":"^0.5.2","twilio-sync":"^0.8.5",twilsock:"^0.5.6",uuid:"^3.2.1"},description:"Twilio Chat service client library",devDependencies:{"@types/chai":"^4.1.2","@types/chai-as-promised":"7.1.0","@types/chai-string":"^1.4.1","@types/core-js":"^0.9.46","@types/mocha":"^5.0.0","@types/node":"^9.6.5","@types/sinon":"^4.3.2","@types/sinon-chai":"^2.7.30",async:"^2.6.0","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-eslint":"^8.2.3","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0",babelify:"^8.0.0",backoff:"^2.5.0",browserify:"^16.0.0","browserify-replace":"^0.9.0",chai:"^4.1.2","chai-as-promised":"^7.1.1","chai-string":"^1.4.0",cheerio:"^1.0.0-rc.2",del:"^3.0.0","fancy-log":"^1.3.2",fs:"0.0.1-security",gulp:"^4.0.0","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-if":"^2.0.2","gulp-insert":"^0.5.0","gulp-rename":"^1.2.2","gulp-sourcemaps":"^2.6.4","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.2","gulp-typescript":"^4.0.2","gulp-uglify-es":"^1.0.1","ink-docstrap":"^1.3.2",jsdoc:"^3.5.5","jsdoc-strip-async-await":"^0.1.0",mocha:"^5.0.2","mocha.parallel":"^0.15.5",nyc:"^11.7.3",path:"^0.12.7",sinon:"^5.0.7","sinon-chai":"^3.0.0","source-map-explorer":"^1.5.0","ts-node":"^4.1.0",tslint:"^5.9.1",twilio:"^3.15.0",typescript:"^2.8.1","uglify-save-license":"^0.4.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},engines:{node:">=6"},license:"MIT",main:"lib/index.js",name:"twilio-chat",types:"./lib/client.d.ts",version:"3.1.0"}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(6),i=n(182),a=n(562),o=n(166),s=n(154),c=n(240),u=n(354),l=n(168);function d(e){return(d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var g=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n},y=function(e){function t(e){var n,i,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,o=p(t).call(this,e),(n=!o||"object"!==d(o)&&"function"!==typeof o?m(i):o).onConfirm=function(e){n.setVisible(!1,e);var t=n.props.onConfirm;t&&t.call(m(m(n)),e)},n.onCancel=function(e){n.setVisible(!1,e);var t=n.props.onCancel;t&&t.call(m(m(n)),e)},n.onVisibleChange=function(e){n.setVisible(e)},n.saveTooltip=function(e){n.tooltip=e},n.renderOverlay=function(e,t){var i=n.props,a=i.okButtonProps,o=i.cancelButtonProps,c=i.title,u=i.cancelText,l=i.okText,d=i.okType,h=i.icon;return r.createElement("div",null,r.createElement("div",{className:"".concat(e,"-inner-content")},r.createElement("div",{className:"".concat(e,"-message")},h,r.createElement("div",{className:"".concat(e,"-message-title")},c)),r.createElement("div",{className:"".concat(e,"-buttons")},r.createElement(s.a,f({onClick:n.onCancel,size:"small"},o),u||t.cancelText),r.createElement(s.a,f({onClick:n.onConfirm,type:d,size:"small"},a),l||t.okText))))},n.renderConfirm=function(e){var t=e.getPrefixCls,i=n.props,o=i.prefixCls,s=i.placement,l=g(i,["prefixCls","placement"]),d=t("popover",o),h=r.createElement(c.a,{componentName:"Popconfirm",defaultLocale:u.a.Popconfirm},function(e){return n.renderOverlay(d,e)});return r.createElement(a.a,f({},l,{prefixCls:d,placement:s,onVisibleChange:n.onVisibleChange,visible:n.state.visible,overlay:h,ref:n.saveTooltip}))},n.state={visible:e.visible},n}var n,i,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,r["Component"]),n=t,o=[{key:"getDerivedStateFromProps",value:function(e){return"visible"in e?{visible:e.visible}:"defaultVisible"in e?{visible:e.defaultVisible}:null}}],(i=[{key:"getPopupDomNode",value:function(){return this.tooltip.getPopupDomNode()}},{key:"setVisible",value:function(e,t){var n=this.props;"visible"in n||this.setState({visible:e});var r=n.onVisibleChange;r&&r(e,t)}},{key:"render",value:function(){return r.createElement(l.a,null,this.renderConfirm)}}])&&h(n.prototype,i),o&&h(n,o),t}();y.defaultProps={transitionName:"zoom-big",placement:"top",trigger:"click",okType:"primary",icon:r.createElement(o.a,{type:"exclamation-circle",theme:"filled"})},Object(i.polyfill)(y),t.a=y},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(539).version,i={};Object.defineProperties(i,{connect:{enumerable:!0,value:n(1517)},createLocalAudioTrack:{enumerable:!0,value:n(822).audio},createLocalTracks:{enumerable:!0,value:n(541)},createLocalVideoTrack:{enumerable:!0,value:n(822).video},isSupported:{enumerable:!0,value:n(1631)()},LocalAudioTrack:{enumerable:!0,value:n(421)},LocalDataTrack:{enumerable:!0,value:n(422)},LocalVideoTrack:{enumerable:!0,value:n(423)},version:{enumerable:!0,value:r}}),e.exports=i},function(e,t,n){"use strict";var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(540),a=n(1518),o=n(541),s=n(1535),c=n(213),u=n(1536),l=n(213).typeErrors,d=n(1549),f=n(179).guessBrowser,h=n(421),p=n(422),v=n(1550),m=n(423),g=n(310),y=n(283).MediaStreamTrack,b=n(1554),_=n(1559),k=n(179),w=0,T=!1;function S(e){var t="string"===typeof e?{codec:e}:e;switch(t.codec.toLowerCase()){case"vp8":return Object.assign({simulcast:!1},t);default:return t}}e.exports=function(e,t){if("undefined"===typeof t&&(t={}),"object"!==("undefined"===typeof t?"undefined":r(t))||Array.isArray(t))return i.reject(l.INVALID_TYPE("options","object"));t=Object.assign({abortOnIceServersTimeout:!1,createLocalTracks:o,environment:c.DEFAULT_ENVIRONMENT,iceServersTimeout:c.ICE_SERVERS_TIMEOUT_MS,insights:!0,LocalAudioTrack:h,LocalDataTrack:p,LocalParticipant:v,LocalVideoTrack:m,MediaStreamTrack:y,logLevel:c.DEFAULT_LOG_LEVEL,maxAudioBitrate:null,maxVideoBitrate:null,name:null,preferredAudioCodecs:[],preferredVideoCodecs:[],realm:c.DEFAULT_REALM,signaling:_},k.filterObject(t)),t=Object.assign({wsServer:c.WS_SERVER(t.environment,t.realm)},t);var n=k.buildLogLevels(t.logLevel),C="[connect #"+ ++w+"]",E=void 0;try{E=new g("default",C,n)}catch(M){return i.reject(M)}if(t.log=E,"safari"!==f()||T||"error"===E.logLevel||"off"===E.logLevel||(T=!0,E.warn(["This release of twilio-video.js includes experimental support for",'Safari 11 and newer. Support for Safari is "experimental" because,',"at the time of writing, Safari does not support VP8. This means you","may experience codec issues in Group Rooms. You may also experience","codec issues in Peer-to-Peer (P2P) Rooms containing Android- or","iOS-based Participants who do not support H.264. However, P2P Rooms","with browser-based Participants should work. Please test this release","and report any issues to https://github.com/twilio/twilio-video.js"].join(" "))),"string"!==typeof e)return i.reject(l.INVALID_TYPE("token","string"));var R=Object.assign({},t);if(delete R.name,"tracks"in t){if(!Array.isArray(t.tracks))return i.reject(l.INVALID_TYPE("options.tracks","Array of LocalAudioTrack, LocalVideoTrack or MediaStreamTrack"));try{t.tracks=t.tracks.map(function(e){return k.asLocalTrack(e,R)})}catch(M){return i.reject(M)}}var O=new(0,t.signaling)(t.wsServer,t);E.info("Connecting to a Room"),E.debug("Options:",t);var x=new d({maxAudioBitrate:t.maxAudioBitrate,maxVideoBitrate:t.maxVideoBitrate}),P=Object.assign({},t,{abortOnTimeout:t.abortOnIceServersTimeout,timeout:t.iceServersTimeout}),I=Array.isArray(t.iceServers)?new s(t.iceServers):"object"===r(t.iceServers)?t.iceServers:new b(e,P),A={audio:t.preferredAudioCodecs,video:t.preferredVideoCodecs.map(S)},j=a(function(e,t){var n=e.log;return e.shouldStopLocalTracks=!e.tracks,e.shouldStopLocalTracks?n.info("LocalTracks were not provided, so they will be acquired automatically before connecting to the Room. LocalTracks will be released if connecting to the Room fails or if the Room is disconnected"):(n.info("Getting LocalTracks"),n.debug("Options:",e)),e.createLocalTracks(e).then(function(r){var i=t(r);return i.catch(function(){e.shouldStopLocalTracks&&(n.info("The automatically acquired LocalTracks will now be stopped"),r.forEach(function(e){e.stop()}))}),i})}.bind(null,t),function(e,t,n,r,i){var a=e.createLocalParticipantSignaling(n);return t.debug("Creating a new LocalParticipant:",a),new r.LocalParticipant(a,i,r)}.bind(null,O,E,x,t),function(e,t,n,r,i,a,o){var s=t.log;return s.info("Getting ICE servers"),s.debug("Options:",t),r.start().then(function(c){var u={token:e};return s.info("Got ICE servers"),s.debug("ICE servers:",c),t.iceServers=c,s.debug("Creating a new RoomSignaling"),s.debug("RoomSignaling params:",u),n.connect(o._signaling,e,r,i,a,t)})}.bind(null,e,t,O,I,x,A),function(e,t,n){var r=new u(t,n,e),i=e.log;return i.debug("Creating a new Room:",r),n.on("stateChanged",function e(){i.info("Disconnected from Room:",r.toString()),n.removeListener("stateChanged",e)}),r}.bind(null,t));return j.then(function(e){return E.info("Connected to Room:",e.toString()),E.info("Room name:",e.name),E.debug("Room:",e),e},function(e){I.isStarted&&I.stop(),j._isCanceled?E.info("Attempt to connect to a Room was canceled"):E.info("Error while connecting to a Room:",e)}),j}},function(e,t,n){"use strict";var r=n(540);e.exports=function(e,t,n,i){var a=void 0,o=new Error("Canceled");return new r(function(s,c,u){var l=void 0;e(function(e){return u()?r.reject(o):(l=t(e),n(l).then(function(e){if(u())throw o;return a=e()}))}).then(function(e){if(u())throw e.disconnect(),o;s(i(l,e))}).catch(function(e){c(e)})},function(){a&&a.cancel()})}},function(e,t,n){"use strict";var r=n(259).flatMap;function i(e){var t=Array.from(e.values()).find(function(e){return"candidate-pair"===e.type&&e.nominated});if(!t)return null;var n=e.get(t.localCandidateId),r=e.get(t.remoteCandidateId),i=[{key:"candidateType",type:"string"},{key:"ip",type:"string"},{key:"port",type:"number"},{key:"priority",type:"number"},{key:"protocol",type:"string"},{key:"url",type:"string"}],a=i.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),o=n?a.reduce(function(e,t){return e[t.key]=typeof n[t.key]===t.type?n[t.key]:"deleted"!==t.key&&null,e},{}):null,s=r?i.reduce(function(e,t){return e[t.key]=typeof r[t.key]===t.type?r[t.key]:null,e},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string"},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(e,n){return e[n.key]=typeof t[n.key]===n.type?t[n.key]:null,e},{localCandidate:o,remoteCandidate:s})}function a(e){var t=Array.from(e.values()).find(function(e){return"candidate-pair"===e.type&&e.nominated});if(!t)return null;var n=e.get(t.localCandidateId),r=e.get(t.remoteCandidateId),i=[{key:"candidateType",type:"string"},{key:"ip",ffKey:"ipAddress",type:"string"},{key:"port",ffKey:"portNumber",type:"number"},{key:"priority",type:"number"},{key:"protocol",ffKey:"transport",type:"string"},{key:"url",type:"string"}],a=i.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),o={host:"host",peerreflexive:"prflx",relayed:"relay",serverreflexive:"srflx"},s=n?a.reduce(function(e,t){var r=t.ffKey||t.key;return e[t.key]=typeof n[r]===t.type?"candidateType"===r&&o[n[r]]||n[r]:"deleted"!==r&&null,e},{}):null,c=r?i.reduce(function(e,t){var n=t.ffKey||t.key;return e[t.key]=typeof r[n]===t.type?"candidateType"===n&&o[r[n]]||r[n]:null,e},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string"},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(e,n){return e[n.key]=typeof t[n.key]===n.type?t[n.key]:null,e},{localCandidate:s,remoteCandidate:c})}function o(e,t,n){var i="local"===n?"getSenders":"getReceivers";return e[i]?e[i]().map(function(e){return e.track}).filter(function(e){return e&&e.kind===t}):r(e["local"===n?"getLocalStreams":"getRemoteStreams"](),function(e){return e["audio"===t?"getAudioTracks":"getVideoTracks"]()})}e.exports=function(e,t){return e&&"function"===typeof e.getStats?function(e,t){var n=o(e,"audio","local"),s=o(e,"video","local"),c=o(e,"audio"),u=o(e,"video"),l={activeIceCandidatePair:null,localAudioTrackStats:[],localVideoTrackStats:[],remoteAudioTrackStats:[],remoteVideoTrackStats:[]},d=r([[n,"localAudioTrackStats"],[s,"localVideoTrackStats"],[c,"remoteAudioTrackStats"],[u,"remoteVideoTrackStats"]],function(n){var r=n[0],i=n[1];return r.map(function(n){return function(e,t,n){return"undefined"!==typeof(n=n||{}).testForChrome||"undefined"!==typeof webkitRTCPeerConnection?function(e,t){return new Promise(function(n,r){e.getStats(function(e){n(function(e,t){var n=e.result().find(function(e){return"ssrc"===e.type&&e.stat("googTrackId")===t.id}),r={};return n&&(r.timestamp=Math.round(Number(n.timestamp)),r=n.names().reduce(function(e,t){switch(t){case"googCodecName":e.codecName=n.stat(t);break;case"googRtt":e.roundTripTime=Number(n.stat(t));break;case"googJitterReceived":e.jitter=Number(n.stat(t));break;case"googFrameWidthInput":e.frameWidthInput=Number(n.stat(t));break;case"googFrameHeightInput":e.frameHeightInput=Number(n.stat(t));break;case"googFrameWidthSent":e.frameWidthSent=Number(n.stat(t));break;case"googFrameHeightSent":e.frameHeightSent=Number(n.stat(t));break;case"googFrameWidthReceived":e.frameWidthReceived=Number(n.stat(t));break;case"googFrameHeightReceived":e.frameHeightReceived=Number(n.stat(t));break;case"googFrameRateInput":e.frameRateInput=Number(n.stat(t));break;case"googFrameRateSent":e.frameRateSent=Number(n.stat(t));break;case"googFrameRateReceived":e.frameRateReceived=Number(n.stat(t));break;case"ssrc":e[t]=n.stat(t);break;case"bytesReceived":case"bytesSent":case"packetsLost":case"packetsReceived":case"packetsSent":case"audioInputLevel":case"audioOutputLevel":e[t]=Number(n.stat(t))}return e},r)),r}(e,t))},null,r)})}(e,t):"undefined"!==typeof n.testForFirefox||"undefined"!==typeof mozRTCPeerConnection?function(e,t){return new Promise(function(n,r){e.getStats(t).then(function(e){n(function(e){e=e||new Map;var t=Array.from(e.values()).find(function(e){return"inbound-rtp"===e.type}),n=Array.from(e.values()).find(function(e){return"outbound-rtp"===e.type}),r={};function i(e){var r=n,i=t;return n&&n.isRemote&&(r=t,i=n),r&&"undefined"!==typeof r[e]?r[e]:i&&"undefined"!==typeof i[e]?i[e]:null}var a=i("timestamp");r.timestamp=Math.round(a);var o=i("ssrc");"string"===typeof o&&(r.ssrc=o);var s=i("bytesSent");"number"===typeof s&&(r.bytesSent=s);var c=i("packetsLost");"number"===typeof c&&(r.packetsLost=c);var u=i("packetsSent");"number"===typeof u&&(r.packetsSent=u);var l=i("mozRtt");"number"===typeof l&&(r.roundTripTime=l);var d=i("jitter");"number"===typeof d&&(r.jitter=Math.round(1e3*d));var f=i("framerateMean");"number"===typeof f&&(r.frameRateSent=Math.round(f));var h=i("bytesReceived");"number"===typeof h&&(r.bytesReceived=h);var p=i("packetsReceived");"number"===typeof p&&(r.packetsReceived=p);var v=i("framerateMean");return"number"===typeof v&&(r.frameRateReceived=Math.round(v)),r}(e))},r)})}(e,t):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(e,n,t).then(function(e){e.trackId=n.id,l[i].push(e)})})});return Promise.all(d).then(function(){return function(e,t){return"undefined"!==typeof(t=t||{}).testForChrome||"undefined"!==typeof webkitRTCPeerConnection?e.getStats().then(i):"undefined"!==typeof t.testForFirefox||"undefined"!==typeof mozRTCPeerConnection?e.getStats().then(a):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(e,t)}).then(function(e){return l.activeIceCandidatePair=e,l})}(e,t):Promise.reject(new Error("Given PeerConnection does not support getStats"))}},function(e,t,n){"use strict";e.exports=function(e){return new Promise(function(t,n){!function(e,t,n){if("undefined"!==typeof window&&"undefined"!==typeof navigator){if("object"===typeof navigator.mediaDevices&&"function"===typeof navigator.mediaDevices.getUserMedia)return void navigator.mediaDevices.getUserMedia(e).then(t,n);if("function"===typeof navigator.webkitGetUserMedia)return void navigator.webkitGetUserMedia(e,t,n);if("function"===typeof navigator.mozGetUserMedia)return void navigator.mozGetUserMedia(e,t,n)}n(new Error("getUserMedia is not supported"))}(e||{audio:!0,video:!0},t,n)})}},function(e,t,n){"use strict";"undefined"!==typeof MediaStreamTrack?e.exports=MediaStreamTrack:e.exports=function(){throw new Error("WebRTC is not supported in this browser")}},function(e,t,n){"use strict";"undefined"!==typeof RTCIceCandidate?e.exports=RTCIceCandidate:"undefined"!==typeof mozRTCIceCandidate?e.exports=mozRTCIceCandidate:e.exports=function(){throw new Error("WebRTC is unsupported")}},function(e,t,n){"use strict";switch((0,n(259).guessBrowser)()){case"chrome":e.exports=n(1524);break;case"firefox":e.exports=n(1525);break;case"safari":e.exports=n(1526);break;default:if("undefined"===typeof RTCPeerConnection)break;e.exports=RTCPeerConnection}},function(e,t,n){"use strict";var r=n(792),i=n(542),a=n(197).inherits,o=n(793),s=n(791),c=n(543),u=n(544),l=n(259),d="undefined"!==typeof RTCPeerConnection?RTCPeerConnection:webkitRTCPeerConnection;function f(e,t){if(!(this instanceof f))return new f(e,t);i.call(this);var n=Object.assign({sdpSemantics:"plan-b"},e);n.iceTransportPolicy&&(n.iceTransports=n.iceTransportPolicy),l.interceptEvent(this,"datachannel"),l.interceptEvent(this,"signalingstatechange"),l.interceptEvent(this,"track");var r=new d(n,t),a=function(e){return u.checkIfSdpSemanticsIsSupported()?e:"plan-b"}(n.sdpSemantics);Object.defineProperties(this,{_localStream:{value:new s},_peerConnection:{value:r},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_sdpSemantics:{value:a},_senders:{value:new Map},_signalingStateLatch:{value:new o},_tracksToSSRCs:{value:new Map},localDescription:{enumerable:!0,get:function(){return this._pendingLocalOffer?this._pendingLocalOffer:r.localDescription}},remoteDescription:{enumerable:!0,get:function(){return this._pendingRemoteOffer?this._pendingRemoteOffer:r.remoteDescription}},signalingState:{enumerable:!0,get:function(){return this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":r.signalingState}}});var c=this;r.addEventListener("datachannel",function(e){g(e.channel),c.dispatchEvent(e)}),r.addEventListener("signalingstatechange",function(){c._pendingLocalOffer||c._pendingRemoteOffer||c.dispatchEvent.apply(c,arguments)}),r.ontrack=function(){},r.addStream(this._localStream),l.proxyProperties(d.prototype,this,r)}function h(e,t){var n=l.flatMap(e.getRemoteStreams(),function(e){return e.getTracks()});l.difference(n,t).forEach(function(t){var n=new Event("track");n.track=t,e.dispatchEvent(n)})}function p(e,t,n){var r,i,a=l.flatMap(e.getRemoteStreams(),function(e){return e.getTracks()}),o=t?e._pendingLocalOffer:e._pendingRemoteOffer,s=t?e._pendingRemoteOffer:e._pendingLocalOffer,c=t?"have-local-offer":"have-remote-offer",u=t?"setLocalDescription":"setRemoteDescription";if(!t&&s&&"answer"===n.type)r=function(e,t){var n=l.flatMap(e.getRemoteStreams(),function(e){return e.getTracks()}),r=e._pendingLocalOffer;return e._peerConnection.setLocalDescription(r).then(function(){return e._pendingLocalOffer=null,e.setRemoteDescription(t)}).then(function(){h(e,n),e._signalingStateLatch.lower()})}(e,n);else if("offer"===n.type){if(e.signalingState!==c&&"stable"!==e.signalingState)return Promise.reject(new Error("Cannot set "+(t?"local":"remote")+" offer in state "+e.signalingState));o||"low"!==e._signalingStateLatch.state||e._signalingStateLatch.raise();var d=e.signalingState;i=v(n),t?e._pendingLocalOffer=i:e._pendingRemoteOffer=i,r=Promise.resolve(),e.signalingState!==d&&r.then(function(){e.dispatchEvent(new Event("signalingstatechange"))})}else"rollback"===n.type&&(e.signalingState!==c?r=Promise.reject(new Error("Cannot rollback "+(t?"local":"remote")+" description in "+e.signalingState)):(t?e._pendingLocalOffer=null:e._pendingRemoteOffer=null,(r=Promise.resolve()).then(function(){e.dispatchEvent(new Event("signalingstatechange"))})));return r||e._peerConnection[u](v(n)).then(function(){t||h(e,a)})}function v(e){return e instanceof r&&e._description?e._description:new RTCSessionDescription(e)}function m(){return"maxRetransmitTime"in RTCDataChannel.prototype&&!("maxPacketLifeTime"in RTCDataChannel.prototype)}function g(e){return Object.defineProperty(e,"maxRetransmits",{value:65535===e.maxRetransmits?null:e.maxRetransmits}),m()&&Object.defineProperty(e,"maxPacketLifeTime",{value:65535===e.maxRetransmitTime?null:e.maxRetransmitTime}),e}function y(e,t,n){return"unified-plan"===e?u.updateUnifiedPlanTrackIdsToSSRCs(t,n):u.updatePlanBTrackIdsToSSRCs(t,n)}a(f,i),f.prototype.addTrack=function(){var e=[].slice.call(arguments);if(this._peerConnection.addTrack)return this._peerConnection.addTrack.apply(this._peerConnection,e);var t=e[0];if("closed"===this._peerConnection.signalingState)throw new Error("Cannot add MediaStreamTrack ["+t.id+", "+t.kind+"]: RTCPeerConnection is closed");var n=this._senders.get(t);if(n&&n.track)throw new Error("Cannot add MediaStreamTrack ["+t.id+", "+t.kind+"]: RTCPeerConnection already has it");return this._peerConnection.removeStream(this._localStream),this._localStream.addTrack(t),this._peerConnection.addStream(this._localStream),n=new c(t),this._senders.set(t,n),n},f.prototype.removeTrack=function(e){if("closed"===this._peerConnection.signalingState)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");if(this._peerConnection.removeTrack)try{this._peerConnection.removeTrack(e)}catch(n){}else{var t=e.track;t&&(e=this._senders.get(t))&&e.track&&(e.track=null,this._peerConnection.removeStream(this._localStream),this._localStream.removeTrack(t),this._peerConnection.addStream(this._localStream))}},f.prototype.getSenders=function(){return this._peerConnection.getSenders?this._peerConnection.getSenders():Array.from(this._senders.values())},f.prototype.addIceCandidate=function(e){var t,n=[].slice.call(arguments),r=this;return t="have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return r._peerConnection.addIceCandidate(e)}):this._peerConnection.addIceCandidate(e),n.length>1?l.legacyPromise(t,n[1],n[2]):t},f.prototype.close=function(){"closed"!==this.signalingState&&(this._pendingLocalOffer=null,this._pendingRemoteOffer=null,this._peerConnection.close())},f.prototype.createAnswer=function(){var e,t=[].slice.call(arguments),n=this;if(this._pendingRemoteOffer){var r=l.flatMap(this.getRemoteStreams(),function(e){return e.getTracks()});e=this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return h(n,r),n._signalingStateLatch.lower(),n._peerConnection.createAnswer()}).then(function(e){return n._pendingRemoteOffer=null,new RTCSessionDescription({type:"answer",sdp:y(n._sdpSemantics,n._tracksToSSRCs,e.sdp)})},function(e){throw n._pendingRemoteOffer=null,e})}else e=this._peerConnection.createAnswer().then(function(e){return new RTCSessionDescription({type:"answer",sdp:y(n._sdpSemantics,n._tracksToSSRCs,e.sdp)})});return t.length>1?l.legacyPromise(e,t[0],t[1]):e},f.prototype.createOffer=function(){var e=[].slice.call(arguments),t=(e.length>1?e[2]:e[0])||{},n=this,i=this._peerConnection.createOffer(t).then(function(e){return new r({type:e.type,sdp:y(n._sdpSemantics,n._tracksToSSRCs,e.sdp)})});return e.length>1?l.legacyPromise(i,e[0],e[1]):i},f.prototype.createDataChannel=function(e,t){t=function(e){e=Object.assign({},e),m()&&"maxPacketLifeTime"in e&&(e.maxRetransmitTime=e.maxPacketLifeTime);return e}(t);var n=this._peerConnection.createDataChannel(e,t);return g(n),n},f.prototype.setLocalDescription=function(){var e=[].slice.call(arguments),t=p(this,!0,e[0]);return e.length>1?l.legacyPromise(t,e[1],e[2]):t},f.prototype.setRemoteDescription=function(){var e=[].slice.call(arguments),t=p(this,!1,e[0]);return e.length>1?l.legacyPromise(t,e[1],e[2]):t},l.delegateMethods(d.prototype,f.prototype,"_peerConnection"),e.exports=f},function(e,t,n){"use strict";var r=n(542),i=n(794),a=n(543),o=n(197).inherits,s=n(544).updateUnifiedPlanTrackIdsToSSRCs,c=n(259),u="undefined"!==typeof RTCPeerConnection?RTCPeerConnection:mozRTCPeerConnection,l="object"===typeof navigator&&navigator.userAgent&&(navigator.userAgent.match(/Firefox\/61/)||navigator.userAgent.match(/Firefox\/62/));function d(e){if(!(this instanceof d))return new d(e);r.call(this),c.interceptEvent(this,"signalingstatechange");var t=new u(e);Object.defineProperties(this,{_initiallyNegotiatedDtlsRole:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:t},_rollingBack:{value:!1,writable:!0},_senders:{value:new Map},_tracksToSSRCs:{value:new Map},iceGatheringState:{enumerable:!0,get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState}},localDescription:{enumerable:!0,get:function(){return p(this._peerConnection.localDescription,this._initiallyNegotiatedDtlsRole)}},signalingState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._peerConnection.signalingState}}});var n,i=this;t.addEventListener("signalingstatechange",function(){if(!i._rollingBack&&i.signalingState!==n){n=i.signalingState;var e=i.dispatchEvent.apply.bind(i.dispatchEvent,i,arguments);i._isClosed?setTimeout(e):e()}}),c.proxyProperties(u.prototype,this,t)}function f(e,t,n){var r=t?"setLocalDescription":"setRemoteDescription";return e._rollingBack=!0,e._peerConnection[r](new i({type:"rollback"})).then(n).then(function(t){return e._rollingBack=!1,t},function(t){throw e._rollingBack=!1,t})}function h(e,t,n){if(!e._initiallyNegotiatedDtlsRole&&"offer"!==t.type){var r=t.sdp.match(/a=setup:([a-z]+)/);if(r){var i=r[1];e._initiallyNegotiatedDtlsRole=n?{active:"passive",passive:"active"}[i]:i}}}function p(e,t){return e&&"answer"===e.type&&t?new i({type:e.type,sdp:e.sdp.replace(/a=setup:[a-z]+/g,"a=setup:"+t)}):e}o(d,r),Object.defineProperty(d.prototype,"peerIdentity",{enumerable:!0,value:Promise.resolve({idp:"",name:""})}),d.prototype.addTrack=function(){var e,t=[].slice.call(arguments),n=t[0],r=this._senders.get(n);if(r&&r.track)throw new Error("Cannot add MediaStreamTrack ["+n.id+", "+n.kind+"]: RTCPeerConnection already has it");return r=(e=this._peerConnection,new Map(e.getSenders().filter(function(e){return e.track}).map(function(e){return[e.track,e]}))).get(n)||this._peerConnection.addTrack.apply(this._peerConnection,t),l&&r.replaceTrack(n),this._senders.set(n,r),r},u.prototype.addTransceiver&&(d.prototype.addTransceiver=function(){var e=this._peerConnection.addTransceiver.apply(this._peerConnection,arguments),t=e.sender,n=t.track;return n&&l&&t.replaceTrack(n),this._senders.set(n,t),e}),d.prototype.removeTrack=function(e){if(this._isClosed)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");var t=e.track;t&&(e=this._senders.get(t))&&e.track&&this._senders.set(t,new a(null))},d.prototype.getSenders=function(){return Array.from(this._senders.values())},d.prototype.createAnswer=function(){var e,t=[].slice.call(arguments),n=this;return e=this._peerConnection.createAnswer().then(function(e){return h(n,e),p(e,n._initiallyNegotiatedDtlsRole)}),"function"===typeof t[0]?c.legacyPromise(e,t[0],t[1]):e},d.prototype.createOffer=function(){var e,t=[].slice.call(arguments),n=(t.length>1?t[2]:t[0])||{},r=this;"have-local-offer"===this.signalingState||"have-remote-offer"===this.signalingState?e=f(this,"have-local-offer"===this.signalingState,function(){return r.createOffer(n)}):e=r._peerConnection.createOffer(n);return e=e.then(function(e){return new i({type:e.type,sdp:s(r._tracksToSSRCs,e.sdp)})}),t.length>1?c.legacyPromise(e,t[0],t[1]):e},d.prototype.setLocalDescription=function(){var e,t=[].slice.call(arguments),n=t[0];return n&&"answer"===n.type&&"have-local-offer"===this.signalingState&&(e=Promise.reject(new Error("Cannot set local answer in state have-local-offer"))),e?t.length>1?c.legacyPromise(e,t[1],t[2]):e:this._peerConnection.setLocalDescription.apply(this._peerConnection,t)},d.prototype.setRemoteDescription=function(){var e,t=[].slice.call(arguments),n=t[0],r=this;return n&&"have-remote-offer"===this.signalingState&&("answer"===n.type?e=Promise.reject(new Error("Cannot set remote answer in state have-remote-offer")):"offer"===n.type&&(e=f(this,!1,function(){return r._peerConnection.setRemoteDescription(n)}))),e||(e=this._peerConnection.setRemoteDescription(n)),e=e.then(function(){h(r,n,!0)}),t.length>1?c.legacyPromise(e,t[1],t[2]):e},d.prototype.close=function(){"closed"!==this.signalingState&&(this._isClosed=!0,this._peerConnection.close())},c.delegateMethods(u.prototype,d.prototype,"_peerConnection"),e.exports=d},function(e,t,n){"use strict";var r=n(542),i=n(197).inherits,a=n(793),o=n(543),s=n(544).updatePlanBTrackIdsToSSRCs,c=n(259);function u(e){if(!(this instanceof u))return new u(e);r.call(this),c.interceptEvent(this,"datachannel"),c.interceptEvent(this,"iceconnectionstatechange"),c.interceptEvent(this,"signalingstatechange");var t=new RTCPeerConnection(e);Object.defineProperties(this,{_audioTransceiver:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:t},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_senders:{value:new Map},_signalingStateLatch:{value:new a},_tracksToSSRCs:{value:new Map},_videoTransceiver:{value:null,writable:!0},localDescription:{enumerable:!0,get:function(){return this._isClosed?null:this._pendingLocalOffer||this._peerConnection.localDescription}},iceConnectionState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._peerConnection.iceConnectionState}},iceGatheringState:{enumerable:!0,get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState}},remoteDescription:{enumerable:!0,get:function(){return this._isClosed?null:this._pendingRemoteOffer||this._peerConnection.remoteDescription}},signalingState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState}}});var n=this;t.addEventListener("datachannel",function(e){d(e.channel),n.dispatchEvent(e)}),t.addEventListener("iceconnectionstatechange",function(){n._isClosed||n.dispatchEvent.apply(n,arguments)}),t.addEventListener("signalingstatechange",function(){n._isClosed||n._pendingLocalOffer||n._pendingRemoteOffer||n.dispatchEvent.apply(n,arguments)}),c.proxyProperties(RTCPeerConnection.prototype,this,t)}function l(e,t,n){var r,i=t?e._pendingLocalOffer:e._pendingRemoteOffer,a=t?e._pendingRemoteOffer:e._pendingLocalOffer,o=t?"have-local-offer":"have-remote-offer",s=t?"setLocalDescription":"setRemoteDescription";if(!t&&a&&"answer"===n.type)return function(e,t){var n=e._pendingLocalOffer;return e._peerConnection.setLocalDescription(n).then(function(){return e._pendingLocalOffer=null,e.setRemoteDescription(t)}).then(function(){e._signalingStateLatch.lower()})}(e,n);if("offer"===n.type){if(e.signalingState!==o&&"stable"!==e.signalingState)return Promise.reject(new Error("Cannot set "+(t?"local":"remote")+" offer in state "+e.signalingState));i||"low"!==e._signalingStateLatch.state||e._signalingStateLatch.raise();var c=e.signalingState;return r=n,t?e._pendingLocalOffer=r:e._pendingRemoteOffer=r,e.signalingState!==c?Promise.resolve().then(function(){e.dispatchEvent(new Event("signalingstatechange"))}):Promise.resolve()}return"rollback"===n.type?e.signalingState!==o?Promise.reject(new Error("Cannot rollback "+(t?"local":"remote")+" description in "+e.signalingState)):(t?e._pendingLocalOffer=null:e._pendingRemoteOffer=null,Promise.resolve().then(function(){e.dispatchEvent(new Event("signalingstatechange"))})):e._peerConnection[s](n)}function d(e){return Object.defineProperties(e,{maxPacketLifeTime:{value:65535===e.maxPacketLifeTime?null:e.maxPacketLifeTime},maxRetransmits:{value:65535===e.maxRetransmits?null:e.maxRetransmits}})}function f(e){return new Map(e.getSenders().filter(function(e){return e.track}).map(function(e){return[e.track,e]}))}i(u,r),u.prototype.addIceCandidate=function(e){var t=this;return"have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return t._peerConnection.addIceCandidate(e)}):this._peerConnection.addIceCandidate(e)},u.prototype.createOffer=function(e){e=Object.assign({},e);var t=this;return e.offerToReceiveAudio&&!this._audioTransceiver&&(delete e.offerToReceiveAudio,this._audioTransceiver=this.addTransceiver("audio")),e.offerToReceiveVideo&&!this._videoTransceiver&&(delete e.offerToReceiveVideo,this._videoTransceiver=this.addTransceiver("video")),this._peerConnection.createOffer(e).then(function(e){return new RTCSessionDescription({type:e.type,sdp:s(t._tracksToSSRCs,e.sdp)})})},u.prototype.createAnswer=function(e){var t=this;return this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return t._signalingStateLatch.lower(),t._peerConnection.createAnswer()}).then(function(e){return t._pendingRemoteOffer=null,e},function(e){throw t._pendingRemoteOffer=null,e}):this._peerConnection.createAnswer(e)},u.prototype.createDataChannel=function(e,t){var n=this._peerConnection.createDataChannel(e,t);return d(n),n},u.prototype.setLocalDescription=function(e){return l(this,!0,e)},u.prototype.setRemoteDescription=function(e){return l(this,!1,e)},u.prototype.close=function(){if(!this._isClosed){this._isClosed=!0,this._peerConnection.close();var e=this;setTimeout(function(){e.dispatchEvent(new Event("iceconnectionstatechange")),e.dispatchEvent(new Event("signalingstatechange"))})}},u.prototype.addTrack=function(){var e=[].slice.call(arguments),t=e[0],n=this._senders.get(t);if(n&&n.track)throw new Error("Cannot add MediaStreamTrack ["+t.id+", "+t.kind+"]: RTCPeerConnection already has it");return n=(n=f(this._peerConnection).get(t)||this._peerConnection.addTrack.apply(this._peerConnection,e))||f(this._peerConnection).get(t),this._senders.set(t,n),n},u.prototype.removeTrack=function(e){if(this._isClosed)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");var t=e.track;t&&(e=this._senders.get(t))&&e.track&&this._senders.set(t,new o(null))},u.prototype.getSenders=function(){return Array.from(this._senders.values())},c.delegateMethods(RTCPeerConnection.prototype,u.prototype,"_peerConnection"),e.exports=u},function(e,t,n){"use strict";switch((0,n(259).guessBrowser)()){case"chrome":e.exports=n(792);break;case"firefox":e.exports=n(794);break;default:if("undefined"===typeof RTCSessionDescription)break;e.exports=RTCSessionDescription}},function(e){e.exports={_args:[["@twilio/webrtc@2.1.3","/Users/yraj/lts-code/remotepatientmonitoring/client"]],_from:"@twilio/webrtc@2.1.3",_id:"@twilio/webrtc@2.1.3",_inBundle:!1,_integrity:"sha512-K3/Ttlj2alDW8jw41Qpc0LPkK4w36DplXA2uTs+mjIyY9cFkn2OdavMo0mZ7iuzau0clmj28fc8l50nGSD0KCQ==",_location:"/@twilio/webrtc",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"@twilio/webrtc@2.1.3",name:"@twilio/webrtc",escapedName:"@twilio%2fwebrtc",scope:"@twilio",rawSpec:"2.1.3",saveSpec:null,fetchSpec:"2.1.3"},_requiredBy:["/twilio-video"],_resolved:"https://registry.npmjs.org/@twilio/webrtc/-/webrtc-2.1.3.tgz",_spec:"2.1.3",_where:"/Users/yraj/lts-code/remotepatientmonitoring/client",author:{name:"Manjesh Malavalli",email:"mmalavalli@twilio.com"},bugs:{url:"https://github.com/twilio/twilio-webrtc.js/issues"},contributors:[{name:"Mark Roberts",email:"mroberts@twilio.com"},{name:"Ryan Rowland",email:"rrowland@twilio.com"}],description:"WebRTC-related APIs and shims used by twilio-video.js",devDependencies:{browserify:"^14.4.0",envify:"^4.1.0",eslint:"^4.4.1",istanbul:"^0.4.5",karma:"^1.7.0","karma-browserify":"^5.1.1","karma-chrome-launcher":"^2.2.0","karma-firefox-launcher":"^1.0.1","karma-mocha":"^1.3.0","karma-safaritechpreview-launcher":"0.0.6","karma-spec-reporter":"0.0.31",mocha:"^3.5.0","npm-run-all":"^4.0.2","release-tool":"^0.2.2",rimraf:"^2.6.1","travis-multirunner":"^4.2.3",watchify:"^3.9.0","webrtc-adapter":"^6.0.1"},homepage:"https://github.com/twilio/twilio-webrtc.js#readme",keywords:["shim","twilio","video","webrtc"],license:"BSD-3-Clause",main:"./lib/index.js",name:"@twilio/webrtc",repository:{type:"git",url:"git+https://github.com/twilio/twilio-webrtc.js.git"},scripts:{build:"npm-run-all clean lint test",clean:"rimraf coverage",lint:"eslint ./lib",test:"npm-run-all test:*","test:integration":"npm-run-all test:integration:*","test:integration:adapter":"karma start karma/integration.adapter.conf.js","test:integration:native":"karma start karma/integration.conf.js","test:unit":"istanbul cover node_modules/mocha/bin/_mocha -- ./test/unit/index.js"},version:"2.1.3"}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0};var a=n(795),o=n(797)(a),s=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"toString",value:function(){return"[LocalAudioTrack #"+this._instanceId+": "+this.id+"]"}},{key:"attach",value:function(e){return(e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attach",this).call(this,e)).muted=!0,e}},{key:"_end",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_end",this).apply(this,arguments)}},{key:"disable",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"disable",this).apply(this,arguments)}},{key:"enable",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"enable",this).apply(this,arguments)}},{key:"stop",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).apply(this,arguments)}}]),t}();e.exports=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(545),a=n(1531),o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=new(0,(e=Object.assign({DataTrackSender:a,maxPacketLifeTime:null,maxRetransmits:null,ordered:!0},e)).DataTrackSender)(e.maxPacketLifeTime,e.maxRetransmits,e.ordered),r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n.id,"data",e));return Object.defineProperties(r,{_trackSender:{value:n},maxPacketLifeTime:{enumerable:!0,value:e.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:e.maxRetransmits},ordered:{enumerable:!0,value:e.ordered},reliable:{enumerable:!0,value:null===e.maxPacketLifeTime&&null===e.maxRetransmits}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"send",value:function(e){this._trackSender.send(e)}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(801),a=n(179).makeUUID,o=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,a(),e,n,r));return Object.defineProperties(i,{_dataChannels:{value:new Set}}),i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"addDataChannel",value:function(e){return this._dataChannels.add(e),this}},{key:"removeDataChannel",value:function(e){return this._dataChannels.delete(e),this}},{key:"send",value:function(e){return this._dataChannels.forEach(function(t){try{t.send(e)}catch(n){}}),this}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0};var a=n(797)(n(802)),o=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"toString",value:function(){return"[LocalVideoTrack #"+this._instanceId+": "+this.id+"]"}},{key:"_end",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_end",this).apply(this,arguments)}},{key:"disable",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"disable",this).apply(this,arguments)}},{key:"enable",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"enable",this).apply(this,arguments)}},{key:"stop",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).apply(this,arguments)}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=n(1534);e.exports=function(e,t,i,a,o){a="number"===typeof a?a:3;var s=0,c=n(803),u={},l=c.getOrCreate(u);return function n(){return t(i).then(function(t){return(i.audio?r(l,t,o).catch(function(){return!0}):Promise.resolve(!1)).then(function(r){return r?a<=0?(e.warn("Got a silent audio MediaStreamTrack. Normally we would try to get a new one, but we've run out of retries; returning it anyway."),t):(e.warn("Got a silent audio MediaStreamTrack. Stopping all MediaStreamTracks and calling getUserMedia again. This is retry #"+ ++s+"."),t.getTracks().forEach(function(e){return e.stop()}),a--,n()):(e.info("Got a non-silent audio MediaStreamTrack; returning it."),t)})})}().then(function(e){return c.release(u),e},function(e){throw c.release(u),e})}},function(e,t,n){"use strict";e.exports=function(e,t,n){n="number"===typeof n?n:250;var r=e.createMediaStreamSource(t),i=e.createAnalyser();i.fftSize=2048,r.connect(i);var a=new Uint8Array(i.fftSize),o=!1;return setTimeout(function(){o=!0},n),function e(){return o?Promise.resolve(!0):(i.getByteTimeDomainData(a),a.some(function(e){return e})?Promise.resolve(!1):(t="number"===typeof t?t:0,new Promise(function(e){return setTimeout(e,t)})).then(e));var t}().then(function(e){return r.disconnect(),e},function(e){throw r.disconnect(),e})}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(169).EventEmitter,a=0,o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(n,{_instance:{value:++a},_iceServers:{enumerable:!0,value:e,writable:!0},_isStarted:{value:!1,writable:!0},isStarted:{enumerable:!0,get:function(){return this._isStarted}},status:{enumerable:!0,value:"overrode"}}),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"start",value:function(){return this._isStarted=!0,Promise.resolve(this._iceServers)}},{key:"stop",value:function(){this._isStarted=!1}},{key:"toString",value:function(){return"[ConstantIceServerSource #"+this._instance+"]"}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=n(169).EventEmitter,o=n(1537),s=n(807),c=n(179).deprecateEvents,u=n(217).MediaConnectionError,l=0,d=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i,a,o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),s=r.log.createLog("default",o),d=new Map;return Object.defineProperties(o,{_log:{value:s},_instanceId:{value:++l},_options:{value:r},_participants:{value:d},_signaling:{value:n},dominantSpeaker:{enumerable:!0,get:function(){return this.participants.get(n.dominantSpeakerSid)||null}},isRecording:{enumerable:!0,get:function(){return n.recording.isEnabled||!1}},localParticipant:{enumerable:!0,value:e},name:{enumerable:!0,value:n.name},participants:{enumerable:!0,value:d},sid:{enumerable:!0,value:n.sid},state:{enumerable:!0,get:function(){return n.state}}}),c("Room",o,new Map([["trackAdded","trackSubscribed"],["trackRemoved","trackUnsubscribed"]]),s),i=o,(a=n.recording).on("updated",function(){var e=a.isEnabled;i._log.info("Recording "+(e?"started":"stopped")),i.emit("recording"+(e?"Started":"Stopped"))}),function(e,t){var n=e._log;n.debug("Creating a new RemoteParticipant for each ParticipantSignaling in the RoomSignaling"),t.participants.forEach(f.bind(null,e)),n.debug("Setting up RemoteParticipant creation for all subsequent ParticipantSignalings that connect to the RoomSignaling"),t.on("participantConnected",f.bind(null,e)),t.on("dominantSpeakerChanged",function(){return e.emit("dominantSpeakerChanged",e.dominantSpeaker)}),t.on("stateChanged",function r(i,a){switch(n.info("Transitioned to state:",i),i){case"disconnected":e.participants.forEach(function(e){e._unsubscribeTracks()}),e.emit(i,e,a),t.removeListener("stateChanged",r);break;case"reconnecting":e.emit("reconnecting",new u);break;default:e.emit("reconnected")}})}(o,n),s.info("Created a new Room:",o.name),s.debug("Initial RemoteParticipants:",Array.from(o._participants.values())),o}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),i(t,[{key:"toString",value:function(){return"[Room #"+this._instanceId+": "+this.sid+"]"}},{key:"disconnect",value:function(){return this._log.info("Disconnecting"),this._signaling.disconnect(),this}},{key:"getStats",value:function(){return this._signaling.getStats().then(function(e){return Array.from(e).map(function(e){var t=r(e,2),n=t[0],i=t[1];return new s(n,i)})})}}]),t}();function f(e,t){var n=e._log,r=new o(t,{log:n});n.info("A new RemoteParticipant connected:",r),e._participants.set(r.sid,r),e.emit("participantConnected",r);var i=[["trackSubscribed","trackAdded"],"trackDimensionsChanged","trackDisabled","trackEnabled","trackMessage","trackPublished",["trackUnsubscribed","trackRemoved"],"trackStarted","trackSubscribed","trackSubscriptionFailed","trackUnpublished","trackUnsubscribed"].map(function(t){var n="string"===typeof t?t:t[0],i="string"===typeof t?t:t[1];function a(){var t=[].slice.call(arguments);t.unshift(i),t.push(r),e.emit.apply(e,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))}return r.on(n,a),[n,a]});r.once("disconnected",function(){var t=e.dominantSpeaker;n.info("RemoteParticipant disconnected:",r),e._participants.delete(r.sid),i.forEach(function(e){r.removeListener(e[0],e[1])}),e.emit("participantDisconnected",r),r===t&&e.emit("dominantSpeakerChanged",e.dominantSpeaker)})}e.exports=d},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0};var a=n(804),o=n(179).deprecateEvents,s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o("RemoteParticipant",r,new Map([["trackAdded","trackSubscribed"],["trackRemoved","trackUnsubscribed"]]),r._log),r._handleTrackSignalingEvents(),r.once("disconnected",r._unsubscribeTracks.bind(r)),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"toString",value:function(){return"[RemoteParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"}},{key:"_addTrack",value:function(e,n){return e._setSid(n.trackSid),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addTrack",this).call(this,e)?(n._subscribed(e),this.emit("trackSubscribed",e),e):null}},{key:"_addTrackPublication",value:function(e){var n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addTrackPublication",this).call(this,e);return n?(this.emit("trackPublished",n),n):null}},{key:"_getTrackPublicationEvents",value:function(){return[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_getTrackPublicationEvents",this).call(this)),[["subscriptionFailed","trackSubscriptionFailed"]])}},{key:"_unsubscribeTracks",value:function(){var e=this;this.trackPublications.forEach(function(t){if(t.isSubscribed){var n=t.track;t._unsubscribe(),e.emit("trackUnsubscribed",n)}})}},{key:"_removeTrack",value:function(e,t){var n=this.tracks.get(e._id);return n?(this._deleteTrack(n),t._unsubscribe(),this.emit("trackUnsubscribed",n),this.emit("trackRemoved",n),n):null}},{key:"_removeTrackPublication",value:function(e){var n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_removeTrackPublication",this).call(this,e);return n?(this.emit("trackUnpublished",n),n):null}}]),t}();e.exports=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(795),a=n(805)(i),o=function(e){function t(e,n,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"toString",value:function(){return"[RemoteAudioTrack #"+this._instanceId+": "+this.sid+"]"}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(546),a=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toString",value:function(){return"[RemoteAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(179).deprecateEvents,a=n(545),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.id,"data",n));return Object.defineProperties(r,{_isSubscribed:{value:!0,writable:!0},_sid:{value:null,writable:!0},isEnabled:{enumerable:!0,value:!0},maxPacketLifeTime:{enumerable:!0,value:e.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:e.maxRetransmits},ordered:{enumerable:!0,value:e.ordered},reliable:{enumerable:!0,value:null===e.maxPacketLifeTime&&null===e.maxRetransmits}}),i("RemoteDataTrack",r,new Map([["unsubscribed",null]]),r._log),e.on("message",function(e){r.emit("message",e,r)}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"_setEnabled",value:function(){}},{key:"_setSid",value:function(e){this._sid||(this._sid=e)}},{key:"_unsubscribe",value:function(){this._isSubscribed&&(this._isSubscribed=!1,this.emit("unsubscribed",this))}},{key:"id",get:function(){return this._log.deprecated("RemoteDataTrack#id has been deprecated and is scheduled for removal in twilio-video.js@2.0.0. Use the parent RemoteTrackPublication's .trackName or .trackSid instead."),this._id}},{key:"isSubscribed",get:function(){return this._log.deprecated("RemoteDataTrack#isSubscribed has been deprecated and is scheduled for removal in twilio-video.js@2.0.0. Use the parent RemoteTrackPublication's .isSubscribed instead."),this._isSubscribed}},{key:"sid",get:function(){return this._sid}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(546),a=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toString",value:function(){return"[RemoteDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(805)(n(802)),a=function(e){function t(e,n,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toString",value:function(){return"[RemoteVideoTrack #"+this._instanceId+": "+this.sid+"]"}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(546),a=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toString",value:function(){return"[RemoteVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=n(808),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Object.defineProperties(r,{audioLevel:{value:"number"===typeof n.audioInputLevel?n.audioInputLevel:null,enumerable:!0},jitter:{value:"number"===typeof n.jitter?n.jitter:null,enumerable:!0}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";var r=n(808),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=null;"number"===typeof n.frameWidthInput&&"number"===typeof n.frameHeightInput&&(i={},Object.defineProperties(i,{width:{value:n.frameWidthInput,enumerable:!0},height:{value:n.frameHeightInput,enumerable:!0}}));var a=null;return"number"===typeof n.frameWidthSent&&"number"===typeof n.frameHeightSent&&(a={},Object.defineProperties(a,{width:{value:n.frameWidthSent,enumerable:!0},height:{value:n.frameHeightSent,enumerable:!0}})),Object.defineProperties(r,{captureDimensions:{value:i,enumerable:!0},dimensions:{value:a,enumerable:!0},captureFrameRate:{value:"number"===typeof n.frameRateInput?n.frameRateInput:null,enumerable:!0},frameRate:{value:"number"===typeof n.frameRateSent?n.frameRateSent:null,enumerable:!0}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";var r=n(810),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Object.defineProperties(r,{audioLevel:{value:"number"===typeof n.audioOutputLevel?n.audioOutputLevel:null,enumerable:!0},jitter:{value:"number"===typeof n.jitter?n.jitter:null,enumerable:!0}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";var r=n(810),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=null;return"number"===typeof n.frameWidthReceived&&"number"===typeof n.frameHeightReceived&&(i={},Object.defineProperties(i,{width:{value:n.frameWidthReceived,enumerable:!0},height:{value:n.frameHeightReceived,enumerable:!0}})),Object.defineProperties(r,{dimensions:{value:i,enumerable:!0},frameRate:{value:"number"===typeof n.frameRateReceived?n.frameRateReceived:null,enumerable:!0}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=[].slice.call(arguments,1),i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(r)))),a=Error.apply(i,r);return a.name="TwilioError",Object.defineProperty(i,"code",{value:e,enumerable:!0}),Object.getOwnPropertyNames(a).forEach(function(e){Object.defineProperty(this,e,{value:a[e],enumerable:!0})},i),i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Error),r(t,[{key:"toString",value:function(){var e=this.message?": "+this.message:"";return this.name+" "+this.code+e}}]),t}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(169).EventEmitter,a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e=Object.assign({maxAudioBitrate:null,maxVideoBitrate:null},e),Object.defineProperties(n,{maxAudioBitrate:{value:e.maxAudioBitrate,writable:!0},maxVideoBitrate:{value:e.maxVideoBitrate,writable:!0}}),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toJSON",value:function(){return{maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate}}},{key:"update",value:function(e){var t=this;e=Object.assign({maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate},e),["maxAudioBitrate","maxVideoBitrate"].reduce(function(n,r){return t[r]!==e[r]&&(t[r]=e[r],n=!0),n},!1)&&this.emit("changed")}}]),t}();e.exports=a},function(e,t,n){"use strict";var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0};var o=n(179),s=n(213).typeErrors,c=n(421),u=n(422),l=n(423),d=n(283).MediaStreamTrack,f=n(804),h=n(1551),p=n(1552),v=n(1553),m=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=(r=Object.assign({LocalAudioTrack:c,LocalVideoTrack:l,LocalDataTrack:u,MediaStreamTrack:d,LocalAudioTrackPublication:h,LocalVideoTrackPublication:v,LocalDataTrackPublication:p,shouldStopLocalTracks:!1,tracks:n},r)).shouldStopLocalTracks?new Set(n.filter(function(e){return"data"!==e.kind})):new Set,a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return Object.defineProperties(a,{_LocalAudioTrack:{value:r.LocalAudioTrack},_LocalDataTrack:{value:r.LocalDataTrack},_LocalVideoTrack:{value:r.LocalVideoTrack},_MediaStreamTrack:{value:r.MediaStreamTrack},_LocalAudioTrackPublication:{value:r.LocalAudioTrackPublication},_LocalDataTrackPublication:{value:r.LocalDataTrackPublication},_LocalVideoTrackPublication:{value:r.LocalVideoTrackPublication},_tracksToStop:{value:i}}),a._handleTrackSignalingEvents(),o.deprecateEvents("LocalParticipant",a,new Map([["trackAdded",null],["trackRemoved",null]]),a._log),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f),i(t,[{key:"_addTrack",value:function(e){var n=a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addTrack",this).call(this,e);return n&&"disconnected"!==this.state&&this._addLocalTrack(e),n}},{key:"_addLocalTrack",value:function(e){this._signaling.addTrack(e._trackSender,e.name),this._log.info("Added a new "+o.trackClass(e,!0)+":",e.id),this._log.debug(o.trackClass(e,!0)+":",e)}},{key:"_removeTrack",value:function(e){var n=a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_removeTrack",this).call(this,e);return n&&"disconnected"!==this.state&&(this._signaling.removeTrack(e._trackSender),this._log.info("Removed a "+o.trackClass(e,!0)+":",e.id),this._log.debug(o.trackClass(e,!0)+":",e)),n}},{key:"_getTrackEvents",value:function(){return a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_getTrackEvents",this).call(this).concat([["stopped","trackStopped"]])}},{key:"toString",value:function(){return"[LocalParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"}},{key:"_handleTrackSignalingEvents",value:function(){var e=this,t=this._log;if("disconnected"!==this.state){var n=this._signaling;this.on("trackDisabled",i),this.on("trackEnabled",a),this.tracks.forEach(function(t){e._addLocalTrack(t),e._getOrCreateLocalTrackPublication(t).catch(function(){})});var r=this;n.on("stateChanged",function e(o){t.debug("Transitioned to state:",o),"disconnected"===o&&(t.debug("Removing LocalTrack event listeners"),n.removeListener("stateChanged",e),r.removeListener("trackDisabled",i),r.removeListener("trackEnabled",a),t.info("LocalParticipant disconnected. Stopping "+r._tracksToStop.size+" automatically-acquired LocalTracks"),r._tracksToStop.forEach(function(e){e.stop()}))})}function i(e){n.tracks.get(e.id).disable(),t.debug("Disabled the "+o.trackClass(e,!0)+":",e.id)}function a(e){n.tracks.get(e.id).enable(),t.debug("Enabled the "+o.trackClass(e,!0)+":",e.id)}}},{key:"_getOrCreateLocalTrackPublication",value:function(e){var t=g(this.trackPublications,e);if(t)return t;var n=this._log,r=this,i=this._signaling.tracks.get(e.id);if(!i)return Promise.reject(new Error("Unexpected error: The "+e+" cannot be published"));function a(e){r.unpublishTrack(e.track)}return new Promise(function(s,c){i.on("updated",function u(){var l=i.error;if(l)return i.removeListener("updated",u),n.warn("Failed to publish the "+o.trackClass(e,!0)+": "+l.message),r._removeTrack(e),setTimeout(function(){r.emit("trackPublicationFailed",l,e)}),void c(l);if(!r.tracks.has(e.id))return i.removeListener("updated",u),void c(new Error("The "+e+" was unpublished"));var d=i.sid;if(d){i.removeListener("updated",u);var f={log:n,LocalAudioTrackPublication:r._LocalAudioTrackPublication,LocalDataTrackPublication:r._LocalDataTrackPublication,LocalVideoTrackPublication:r._LocalVideoTrackPublication};(t=g(r.trackPublications,e))||(t=o.asLocalTrackPublication(e,d,a,f),r._addTrackPublication(t)),"connected"===r._signaling.state&&setTimeout(function(){r.emit("trackPublished",t)}),s(t)}})})}},{key:"addTrack",value:function(e){return this._log.deprecated("LocalParticipant#addTrack has been deprecated. Use LocalParticipant#publishTrack instead."),o.validateLocalTrack(e,{LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack}),this.tracks.has(e.id)?null:(this.publishTrack(e).catch(function(){}),this.tracks.get(e.id))}},{key:"addTracks",value:function(e){if(this._log.deprecated("LocalParticipant#addTracks has been deprecated. Use LocalParticipant#publishTracks instead."),!Array.isArray(e))throw s.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return e=e.filter(function(e){return!this.tracks.has(e.id)},this),this.publishTracks(e).catch(function(){}),e.map(function(e){return this.tracks.get(e.id)},this)}},{key:"publishTrack",value:function(e,t){var n=g(this.trackPublications,e);if(n)return Promise.resolve(n);t=Object.assign({log:this._log,LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack},t);var r=void 0;try{r=o.asLocalTrack(e,t)}catch(i){return Promise.reject(i)}return r=this._addTrack(r)||this.tracks.get(r.id),this._getOrCreateLocalTrackPublication(r)}},{key:"publishTracks",value:function(e){if(!Array.isArray(e))throw s.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return Promise.all(e.map(this.publishTrack,this))}},{key:"removeTrack",value:function(e,t){this._log.deprecated("LocalParticipant#removeTrack has been deprecated. Use LocalParticipant#unpublishTrack instead.");var n=this.unpublishTrack(e);return t="boolean"!==typeof t||t,(e=n&&n.track)&&t&&"data"!==e.kind&&(e.stop(),this._log.info("Stopped LocalTrack:",e)),e}},{key:"removeTracks",value:function(e,t){return this._log.deprecated("LocalParticipant#removeTracks has been deprecated. Use LocalParticipant#unpublishTracks instead."),t="boolean"!==typeof t||t,this.unpublishTracks(e).map(function(e){var n=e.track;return t&&"data"!==n.kind&&n.stop(),n})}},{key:"setParameters",value:function(e){if("undefined"!==typeof e&&"object"!==("undefined"===typeof e?"undefined":r(e)))throw s.INVALID_TYPE("encodingParameters","EncodingParameters, null or undefined");return e?["maxAudioBitrate","maxVideoBitrate"].forEach(function(t){if("undefined"!==typeof e[t]&&"number"!==typeof e[t]&&null!==e[t])throw s.INVALID_TYPE("encodingParameters."+t,"number, null or undefined")}):null===e&&(e={maxAudioBitrate:null,maxVideoBitrate:null}),this._signaling.setParameters(e),this}},{key:"unpublishTrack",value:function(e){o.validateLocalTrack(e,{LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack});var t=this.tracks.get(e.id);if(!t)return null;this._signaling.tracks.get(t.id).publishFailed(new Error("The "+t+" was unpublished"));var n=g(this.trackPublications,t);return this._removeTrack(t),n&&this._removeTrackPublication(n),n}},{key:"unpublishTracks",value:function(e){var t=this;if(!Array.isArray(e))throw s.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return e.reduce(function(e,n){var r=t.unpublishTrack(n);return r?e.concat(r):e},[])}}]),t}();function g(e,t){return Array.from(e.values()).find(function(e){return e.track===t||e.track.mediaStreamTrack===t})||null}e.exports=m},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(547),a=function(e){function t(e,n,r,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toString",value:function(){return"[LocalAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(547),a=function(e){function t(e,n,r,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toString",value:function(){return"[LocalDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(547),a=function(e){function t(e,n,r,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toString",value:function(){return"[LocalVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(213),a=n(1555),o=n(169).EventEmitter,s=n(310),c=n(1558),u=n(179),l=n(217).ConfigurationAcquireFailedError,d=n(539).version,f=0,h=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n=Object.assign({abortOnTimeout:!1,defaultTTL:i.ICE_SERVERS_DEFAULT_TTL,environment:i.DEFAULT_ENVIRONMENT,getConfiguration:a.getConfiguration,realm:i.DEFAULT_REALM,timeout:i.ICE_SERVERS_TIMEOUT_MS},n);var o=i.DEFAULT_ICE_SERVERS(n.environment),c=n.ecsServer||i.ECS_SERVER(n.environment,n.realm),l=n.log?n.log.createLog("default",r):new s("default",r,u.buildLogLevels("off"));return Object.defineProperties(r,{_abortOnTimeout:{value:n.abortOnTimeout},_currentPoll:{value:null,writable:!0},_defaultIceServers:{value:o},_defaultTTL:{value:n.defaultTTL},_ecsServer:{value:c},_getConfiguration:{value:n.getConfiguration},_instance:{value:++f},_nextPoll:{value:null,writable:!0},_log:{value:l},_status:{value:null,writable:!0},_stopped:{value:u.defer(),writable:!0},_timeout:{value:n.timeout},_token:{value:e}}),r._log.info("Created a new NTSIceServerSource"),r._log.debug("ECS server:",r._ecsServer),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"start",value:function(){return this.isStarted?this._log.warn("Already started"):(this._log.info("Starting"),this._currentPoll=function e(t){t._log.debug("Getting ECS configuration");var n={configUrl:t._ecsServer+"/v2/Configuration",body:{service:"video",sdk_version:d}};var r=new Error("Already stopped");var a=t._getConfiguration(t._token,n);var o=new c(a,t._timeout);return Promise.race([o,t._stopped.promise]).then(function(e){if(!e)throw r;var n=function(e,t){var n=u.getOrNull(t,"video.network_traversal_service");if(!n)throw new Error("network_traversal_service not available");n.warning&&e._log.warn(n.warning);var r=n.ice_servers;if(!r)throw new Error("ice_servers not available");e._log.info("Got ICE servers: "+JSON.stringify(r));var i=n.ttl||e._defaultTTL;return[r,i]}(t,e);return t._status="success",n}).catch(function(e){if(t._status="failure",!t.isStarted)throw r;if(o.isTimedOut){if(t._abortOnTimeout)throw t._log.warn("Getting ICE servers took too long"),new l;t._log.warn("Getting ICE servers took too long (using defaults)")}else e.code&&2===Math.floor(e.code/1e4)&&t.stop(),t._log.warn("Failed to get ICE servers (using defaults):",e);return[t._defaultIceServers,t._defaultTTL]}).then(function(n){var r=n[0],a=n[1];t.isStarted&&(t._log.info("Getting ICE servers again in "+a+" seconds"),t._nextPoll=setTimeout(function(){t.isStarted&&(t._currentPoll=e(t))},1e3*(a-i.ECS_TIMEOUT))),t._iceServers=r;try{t.emit("iceServers",r)}catch(o){}return r})}(this)),this._currentPoll}},{key:"stop",value:function(){this.isStarted?(this._log.info("Stopping"),this._currentPoll=null,clearTimeout(this._nextPoll),this._stopped.resolve(),this._stopped=u.defer(),this._log.debug("Stopped")):this._log.warn("Already stopped")}},{key:"toString",value:function(){return"[NTSIceServerSource #"+this._instance+"]"}},{key:"isStarted",get:function(){return!!this._currentPoll}},{key:"status",get:function(){return this._status}}]),t}();e.exports=h},function(e,t,n){"use strict";var r=n(1556),i=n(217).createTwilioError,a=n(217).ConfigurationAcquireFailedError,o="https://ecs.us1.twilio.com/v1/Configuration";function s(e){var t=null;try{t=JSON.parse(e)}catch(n){throw new a}return t}e.exports.getConfiguration=function(e,t){if(!e)throw new Error("<String>token is a required argument.");var n,a={url:(t=Object.assign({configUrl:o},t)).configUrl,headers:{"X-Twilio-Token":e,"Content-Type":"application/x-www-form-urlencoded"}};return t.body&&(a.body=(n=t.body,Object.keys(n||{}).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&"))),r.post(a).then(function(e){return s(e)},function(e){var t=s(e);throw i(t.code,t.message)})}},function(e,t,n){"use strict";var r=n(1557).XMLHttpRequest;function i(e,t){return new Promise(function(n,i){if("string"!==typeof e||!t)throw new Error("<String>method and <Object>params are required args.");var a=new r;for(var o in a.open(e.toUpperCase(),t.url,!0),a.withCredentials=!!t.withCredentials,a.onreadystatechange=function(){4===a.readyState&&(200<=a.status&&a.status<300?n(a.responseText):i(a.responseText))},t.headers)a.setRequestHeader(o,t.headers[o]);a.send(t.body)})}i.get=i.bind(null,"GET"),i.post=i.bind(null,"POST"),e.exports=i},function(e,t){t.XMLHttpRequest=XMLHttpRequest},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(169).EventEmitter,a=n(179),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=a.defer(),o=!1,s=new Error("Timed out"),c=null,u=null;return Object.defineProperties(r,{_deferred:{value:i},_isTimedOut:{get:function(){return o},set:function(e){o=e}},_timedOut:{value:s},_timeout:{get:function(){return c},set:function(e){c=e}},_timer:{get:function(){return u},set:function(e){u=e}},_promise:{value:i.promise},isTimedOut:{enumerable:!0,get:function(){return o}},timeout:{enumerable:!0,get:function(){return c}}}),e.then(function(e){clearTimeout(r._timer),i.resolve(e)},function(e){clearTimeout(r._timer),i.reject(e)}),n&&r.start(n),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"catch",value:function(){var e;return(e=this._promise).catch.apply(e,arguments)}},{key:"start",value:function(e){var t=this;return this._timer?this:(this._timeout=e,this._timer=setTimeout(function(){t._timer&&(t._isTimedOut=!0,t.emit("timedOut",t),t._deferred.reject(t._timedOut))},this.timeout),this)}},{key:"then",value:function(){var e;return(e=this._promise).then.apply(e,arguments)}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(213),a=n(1560),o=n(1627),s=n(1630),c=n(549),u=n(821),l=n(179),d=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=l.makeClientSIPURI(),o="debug"===(n=Object.assign({createCancelableRoomSignalingPromise:a,registrarServer:i.REGISTRAR_SERVER,UA:c.UA},n)).logLevel,s=e.startsWith("wss://"),d=new(0,n.UA)({autostart:!1,log:{builtinEnabled:o},extraSupported:["room-signaling","timer"],hackAllowUnregisteredOptionTags:!0,keepAliveInterval:30,mediaHandlerFactory:u.defaultFactory,register:!1,registrarServer:n.registrarServer,traceSip:o,uri:r,wsServers:e,hackWssInTransport:s}),f=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(f,{_createCancelableRoomSignalingPromise:{value:n.createCancelableRoomSignalingPromise},_options:{value:n},_ua:{value:d}}),f}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s),r(t,[{key:"_close",value:function(e){return this.transition("closing",e),this._ua.stop(),this._ua.transport.disconnect(),this.transition("closed",e),Promise.resolve(this)}},{key:"_open",value:function(e){var t=this,n=this._ua;return this.transition("opening",e),l.promiseFromEvents(function(){n.start()},n,"connected","disconnected").then(function(){return t.transition("open",e),t},function(){throw t.transition("closed",e),new Error("Open failed")})}},{key:"_connect",value:function(e,t,n,r,i,a){a=Object.assign({},this._options,a);var o=this._ua;return this._createCancelableRoomSignalingPromise.bind(null,t,o,e,n,r,i,a)}},{key:"createLocalParticipantSignaling",value:function(e){return new o(e)}}]),t}();e.exports=d},function(e,t,n){"use strict";var r=n(540),i=n(1561),a=n(1574),o=n(1590),s=n(217).SignalingConnectionDisconnectedError,c=n(217).SignalingIncomingMessageInvalidError,u=n(179).flatMap;e.exports=function(e,t,n,l,d,f,h){h=Object.assign({PeerConnectionManager:i,RoomV2:a,Transport:o},h);var p=void 0,v=h.PeerConnectionManager,m=h.RoomV2,g=new v(l,d,f,h),y=u(n.tracks,function(e){return[e.trackTransceiver]});g.setConfiguration(h),g.setTrackSenders(y);var b=new Error("Canceled");return new r(function(r,i,a){g.createAndOffer().then(function(){return g.dequeue("description"),new Promise(function(r,i){if(a())i(b);else{var o="string"===typeof h.wsServerInsights?{wsServerInsights:h.wsServerInsights}:{};h.InsightsPublisher&&(o.InsightsPublisher=h.InsightsPublisher),h.NullInsightsPublisher&&(o.NullInsightsPublisher=h.NullInsightsPublisher),o=Object.assign({dominantSpeaker:h.dominantSpeaker,environment:h.environment,networkQuality:h.networkQuality,iceServerSourceStatus:l.status,insights:h.insights,realm:h.realm,sdpSemantics:h.sdpSemantics},o);var u=h.Transport;(p=new u(h.name,e,n,g,t,o)).once("connected",function(e){a()?i(b):e.participant?r(new m(n,e,p,g,h)):i(new c)}),p.once("stateChanged",function(e,t){"disconnected"===e&&(t=t||new s,p=null,i(t))})}})}).then(function(e){if(a())return g.close(),e.disconnect(),void i(b);r(e)}).catch(function(e){p&&(p.disconnect(),p=null),g.close(),i(e)})},function(){p&&(p.disconnect(),p=null)})}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(1562),a=n(798),o=n(1573),s=n(179),c="firefox"===s.guessBrowser(),u=function(e){function t(e,r,o,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),f=(u=Object.assign({audioContextFactory:c?n(803):null,PeerConnectionV2:i},u)).audioContextFactory?u.audioContextFactory.getOrCreate(d):null,h=f?{offerToReceiveVideo:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:!0};return Object.defineProperties(d,{_audioContextFactory:{value:u.audioContextFactory},_closedPeerConnectionIds:{value:new Set},_configuration:{writable:!0,value:null},_configurationDeferred:{writable:!0,value:s.defer()},_dummyAudioTrackSender:{value:f?new a(l(f)):null},_encodingParameters:{value:r},_iceConnectionState:{writable:!0,value:"new"},_iceServerSource:{value:e},_dataTrackSenders:{writable:!0,value:new Set},_lastIceConnectionState:{writable:!0,value:"new"},_mediaTrackSenders:{writable:!0,value:new Set},_offerOptions:{value:h},_peerConnections:{value:new Map},_preferredCodecs:{value:o},_PeerConnectionV2:{value:u.PeerConnectionV2}}),d}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"_getConfiguration",value:function(){return this._configurationDeferred.promise}},{key:"_getOrCreate",value:function(e,t){var n=this,r=this,i=this._peerConnections.get(e);if(!i){var a=this._PeerConnectionV2,o=Object.assign({dummyAudioMediaStreamTrack:this._dummyAudioTrackSender?this._dummyAudioTrackSender.track:null,offerOptions:this._offerOptions},t);i=new a(e,this._encodingParameters,this._preferredCodecs,o),this._peerConnections.set(i.id,i),i.on("candidates",this.queue.bind(this,"candidates")),i.on("description",this.queue.bind(this,"description")),i.on("trackAdded",this.queue.bind(this,"trackAdded")),i.on("stateChanged",function e(t){"closed"===t&&(i.removeListener("stateChanged",e),r._peerConnections.delete(i.id),r._closedPeerConnectionIds.add(i.id),m(r))}),i.on("iceConnectionStateChanged",function(){return m(n)}),this._dataTrackSenders.forEach(i.addDataTrackSender,i),this._mediaTrackSenders.forEach(i.addMediaTrackSender,i),m(this)}return i}},{key:"close",value:function(){return this._iceServerSource.isStarted&&this._iceServerSource.stop(),this._peerConnections.forEach(function(e){e.close()}),this._dummyAudioTrackSender&&this._dummyAudioTrackSender.track.stop(),this._audioContextFactory&&this._audioContextFactory.release(this),m(this),this}},{key:"createAndOffer",value:function(){var e=this;return this._getConfiguration().then(function(t){var n=void 0;do{n=s.makeUUID()}while(e._peerConnections.has(n));return e._getOrCreate(n,t)}).then(function(e){return e.offer()}).then(function(){return e})}},{key:"getTrackReceivers",value:function(){return s.flatMap(this._peerConnections,function(e){return e.getTrackReceivers()})}},{key:"getStates",value:function(){var e=[];return this._peerConnections.forEach(function(t){var n=t.getState();n&&e.push(n)}),e}},{key:"setConfiguration",value:function(e){return this._configuration&&(this._configurationDeferred=s.defer(),this._peerConnections.forEach(function(t){t.setConfiguration(e)})),this._configuration=e,this._configurationDeferred.resolve(e),this}},{key:"setTrackSenders",value:function(e){var t=new Set(e.filter(function(e){return"data"===e.kind})),n=new Set(e.filter(function(e){return e&&("audio"===e.kind||"video"===e.kind)})),r=function(e,t,n){return{data:d(e,t),media:f(e,n)}}(this,t,n);return this._dataTrackSenders=t,this._mediaTrackSenders=n,function(e,t){(t.data.add.size||t.data.remove.size||t.media.add.size||t.media.remove.size)&&e._peerConnections.forEach(function(e){t.data.remove.forEach(e.removeDataTrackSender,e),t.media.remove.forEach(e.removeMediaTrackSender,e),t.data.add.forEach(e.addDataTrackSender,e),t.media.add.forEach(e.addMediaTrackSender,e),e.offer()})}(this,r),this}},{key:"update",value:function(e){var t=this;return this._getConfiguration().then(function(n){return Promise.all(e.map(function(e){return t._closedPeerConnectionIds.has(e.id)?null:t._getOrCreate(e.id,n).update(e)}))}).then(function(){return t})}},{key:"getStats",value:function(){var e=Array.from(this._peerConnections.values());return Promise.all(e.map(function(e){return e.getStats().then(function(t){return[e.id,t]})})).then(function(e){return new Map(e)})}},{key:"iceConnectionState",get:function(){return this._iceConnectionState}}]),t}();function l(e){return e.createMediaStreamDestination().stream.getAudioTracks()[0]}function d(e,t){return{add:s.difference(t,e._dataTrackSenders),remove:s.difference(e._dataTrackSenders,t)}}function f(e,t){return{add:s.difference(t,e._mediaTrackSenders),remove:s.difference(e._mediaTrackSenders,t)}}var h={new:0,checking:1,connected:2,completed:3,disconnected:-1,failed:-2,closed:-3},p=void 0;function v(){return Object.keys(h).reduce(function(e,t){return Object.assign(e,(n={},r=h[t],i=t,r in n?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,n));var n,r,i},{})}function m(e){var t;e._lastIceConnectionState=e.iceConnectionState,e._iceConnectionState=(t=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e._peerConnections.values())).map(function(e){return e.iceConnectionState})).length?(p=p||v(),t.reduce(function(e,t){return p[Math.max(h[e],h[t])]})):"new",e.iceConnectionState!==e._lastIceConnectionState&&e.emit("iceConnectionStateChanged")}e.exports=u},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(283),a=i.MediaStream,o=i.RTCIceCandidate,s=i.RTCPeerConnection,c=i.RTCSessionDescription,u=i.getStats,l=n(260).getMediaSections,d=n(179).guessBrowser,f=n(179).oncePerTick,h=n(260).setBitrateParameters,p=n(260).setCodecPreferences,v=n(260).setSimulcast,m=n(1564),g=n(217).MediaClientLocalDescFailedError,y=n(217).MediaClientRemoteDescFailedError,b=n(1566),_=n(1568),k=n(347),w=n(179),T=w.buildLogLevels,S=w.getSdpFormat,C=w.makeUUID,E=n(213).DEFAULT_LOG_LEVEL,R=n(310),O=n(1569),x=n(1570),P=n(1571),I=n(1572),A="chrome"===d(),j="firefox"===d(),M="safari"===d(),D={open:["closed","updating"],updating:["closed","open"],closed:[]},N=function(e){function t(e,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"open",D)),l=$(i=Object.assign({dummyAudioMediaStreamTrack:null,iceServers:[],logLevel:E,offerOptions:{},setBitrateParameters:h,setCodecPreferences:p,setSimulcast:v,MediaStream:a,RTCIceCandidate:o,RTCPeerConnection:s,RTCSessionDescription:c},i)),d=T(i.logLevel),g=i.RTCPeerConnection,y=new g(l,i.chromeSpecificConstraints),b=S(i.sdpSemantics),_=j&&g.prototype.addTransceiver?null:new i.MediaStream;i.dummyAudioMediaStreamTrack&&y.addTrack(i.dummyAudioMediaStreamTrack,_||new MediaStream),j&&y.createDataChannel(C()),Object.defineProperties(u,{_dataChannels:{value:new Map},_dataTrackReceivers:{value:new Set},_descriptionRevision:{writable:!0,value:0},_encodingParameters:{value:n},_isRestartingIce:{writable:!0,value:!1},_lastIceConnectionState:{writable:!0,value:null},_lastStableDescriptionRevision:{writable:!0,value:0},_localCandidates:{writable:!0,value:[]},_localCandidatesRevision:{writable:!0,value:1},_localDescription:{writable:!0,value:null},_localMediaStream:{value:_},_localUfrag:{writable:!0,value:null},_log:{value:i.log?i.log.createLog("signaling",u):new R("webrtc",u,d)},_rtpSenders:{value:new Map},_mediaTrackReceivers:{value:new Set},_needsInitialAnswer:{writable:!0,value:!1},_negotiationRole:{writable:!0,value:null},_offerOptions:{writable:!0,value:i.offerOptions},_peerConnection:{value:y},_preferredAudioCodecs:{value:r.audio},_preferredVideoCodecs:{value:r.video},_queuedDescription:{writable:!0,value:null},_remoteCandidates:{writable:!0,value:new m},_sdpFormat:{value:b},_setBitrateParameters:{value:i.setBitrateParameters},_setCodecPreferences:{value:i.setCodecPreferences},_setSimulcast:{value:i.setSimulcast},_RTCIceCandidate:{value:i.RTCIceCandidate},_RTCPeerConnection:{value:i.RTCPeerConnection},_RTCSessionDescription:{value:i.RTCSessionDescription},_shouldOffer:{writable:!0,value:!1},_shouldRestartIce:{writable:!0,value:!1},_trackIdsToAttributes:{value:new Map},_trackMatcher:{writable:!0,value:null},id:{enumerable:!0,value:e}}),n.on("changed",f(u.offer.bind(u))),y.addEventListener("datachannel",u._handleDataChannelEvent.bind(u)),y.addEventListener("icecandidate",u._handleIceCandidateEvent.bind(u)),y.addEventListener("iceconnectionstatechange",u._handleIceConnectionStateChange.bind(u)),y.addEventListener("signalingstatechange",u._handleSignalingStateChange.bind(u)),y.addEventListener("track",u._handleTrackEvent.bind(u));var k=u;return u.on("stateChanged",function e(t){"closed"===t&&(k.removeListener("stateChanged",e),k._dataChannels.forEach(function(e,t){k.removeDataTrackSender(t)}))}),u}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,k),r(t,[{key:"_addIceCandidate",value:function(e){var t=this;return Promise.resolve().then(function(){return e=new t._RTCIceCandidate(e),t._peerConnection.addIceCandidate(e)})}},{key:"_addIceCandidates",value:function(e){return Promise.all(e.map(this._addIceCandidate,this)).then(function(){})}},{key:"_checkIceBox",value:function(e){var t=L(e);if(!t)return Promise.resolve();var n=this._remoteCandidates.setUfrag(t);return this._addIceCandidates(n)}},{key:"_answer",value:function(e){var t=this;return Promise.resolve().then(function(){return t._negotiationRole||(t._negotiationRole="answerer"),t._setRemoteDescription(e)}).catch(function(){throw new y}).then(function(){return t._peerConnection.createAnswer()}).then(function(e){return j||(e=I(e)),t._setLocalDescription(e)}).then(function(){return t._checkIceBox(e)}).then(function(){return t._peerConnection.localDescription?t._maybeReoffer(t._peerConnection.localDescription):Promise.resolve()}).catch(function(e){throw e instanceof y?e:new g})}},{key:"_close",value:function(){return"closed"!==this._peerConnection.signalingState&&(this._peerConnection.close(),!0)}},{key:"_handleDataChannelEvent",value:function(e){var t=this,n=e.channel,r=new b(n);this._dataTrackReceivers.add(r),n.addEventListener("close",function(){t._dataTrackReceivers.delete(r)}),this.emit("trackAdded",r)}},{key:"_handleGlare",value:function(e){var t=this;return this._log.debug("Glare detected; rolling back"),this._isRestartingIce&&(this._log.debug("An ICE restart was in progress; we'll need to restart ICE again after rolling back"),this._isRestartingIce=!1,this._shouldRestartIce=!0),Promise.resolve().then(function(){return t._setLocalDescription({type:"rollback"})}).then(function(){return t._answer(e)}).then(function(){return t._offer()})}},{key:"_handleIceCandidateEvent",value:function(e){e.candidate&&this._localCandidates.push(e.candidate);var t={ice:{candidates:this._localCandidates.slice(),revision:this._localCandidatesRevision++,ufrag:this._localUfrag},id:this.id};e.candidate||(t.ice.complete=!0),this.emit("candidates",t)}},{key:"_handleIceConnectionStateChange",value:function(){var e=this._peerConnection.iceConnectionState;this._log.debug('ICE connection state is "'+e+'"'),"failed"===this._lastIceConnectionState||"failed"!==e||this._shouldRestartIce||this._isRestartingIce?"failed"!==this._lastIceConnectionState||"connected"!==e&&"completed"!==e||this._log.info("ICE reconnected"):(this._log.warn("ICE failed; attempting to restart ICE"),this._shouldRestartIce=!0,this.offer()),this._lastIceConnectionState=e,this.emit("iceConnectionStateChanged")}},{key:"_handleSignalingStateChange",value:function(){"closed"===this._peerConnection.signalingState&&"closed"!==this.state&&this.preempt("closed")}},{key:"_handleTrackEvent",value:function(e){var t=this,n=this._peerConnection.remoteDescription?this._peerConnection.remoteDescription.sdp:null;this._trackMatcher||(this._trackMatcher=e.transceiver&&e.transceiver.mid?new P:M||"unified"===this._sdpFormat?new x:new O),this._trackMatcher.update(n);var r=e.track,i=this._trackMatcher.match(e)||r.id,a=new _(i,r);this._mediaTrackReceivers.add(a),r.addEventListener("ended",function(){t._mediaTrackReceivers.delete(a)}),this.emit("trackAdded",a)}},{key:"_maybeReoffer",value:function(e){var t=this._shouldOffer;if(j){var n=this._peerConnection.getSenders().filter(function(e){return e.track});t=["audio","video"].reduce(function(t,r){var i=l(e.sdp,r,"(sendrecv|sendonly)"),a=n.filter(function(e,t){var n=t.track;return n&&n.kind===e&&"ended"!==n.readyState}.bind(null,r));return t||i.length<a.length},t)}var r=this._dataChannels.size>0,i=l(e.sdp,"application").length>0;return(t=t||r&&!i)?this._offer():Promise.resolve()}},{key:"_offer",value:function(){var e=this,t=Object.assign({},this._offerOptions);return this._shouldRestartIce&&(this._shouldRestartIce=!1,this._isRestartingIce=!0,t.iceRestart=!0),Promise.resolve().then(function(){return e._peerConnection.createOffer(t)}).catch(function(){throw new g}).then(function(t){j||(t=I(t));var n=e._setCodecPreferences(t.sdp,e._preferredAudioCodecs,e._preferredVideoCodecs);return e._shouldOffer=!1,e._negotiationRole||(e._negotiationRole="offerer",e._needsInitialAnswer=!0),e._setLocalDescription({type:"offer",sdp:n})})}},{key:"_setLocalDescription",value:function(e){var t=this,n=e.revision,r=this._preferredVideoCodecs.some(function(e){return"vp8"===e.codec.toLowerCase()&&e.simulcast});return Promise.resolve().then(function(){return e.sdp&&(e={type:e.type,sdp:A&&r?t._setSimulcast(e.sdp,t._trackIdsToAttributes):e.sdp}),"answer"===(e=new t._RTCSessionDescription(e)).type&&(t._lastStableDescriptionRevision=n),t._peerConnection.setLocalDescription(e)}).catch(function(n){throw t._log.warn('Calling setLocalDescription with an RTCSessionDescription of type "'+e.type+'" failed with the error "'+n.message+'".'),e.sdp&&t._log.warn("The SDP was "+e.sdp),new g}).then(function(){"rollback"!==e.type&&(t._localDescription=e,t._localCandidates=[],"offer"===e.type&&t._descriptionRevision++,t._localUfrag=L(e),t.emit("description",t.getState()))})}},{key:"_setRemoteDescription",value:function(e){var t=this;return e.sdp&&(e.sdp=this._setBitrateParameters(e.sdp,j?"TIAS":"AS",this._encodingParameters.maxAudioBitrate,this._encodingParameters.maxVideoBitrate),e.sdp=this._setCodecPreferences(e.sdp,this._preferredAudioCodecs,this._preferredVideoCodecs),j&&(e.sdp=e.sdp.replace(/a=msid:[^ ]+ /g,"a=msid:- "))),e=new this._RTCSessionDescription(e),this._peerConnection.setRemoteDescription(e).then(function(){"answer"===e.type&&t._isRestartingIce&&(t._log.debug("An ICE restart was in-progress and is now completed"),t._isRestartingIce=!1),"unified"===t._sdpFormat&&t._peerConnection.getTransceivers()&&t._peerConnection.getTransceivers().forEach(function(t){(function(e,t){if(!t.stop||t.stopped||!t.mid)return!1;var n=function(e){return e.match(/\r\na=mid:.+$/gm).map(function(e){return e.split(":")[1]}).filter(function(e){return e})}(e);if(t.mid===n[0]||t.mid===n[1])return!1;if("inactive"===t.currentDirection)return!0;var r=function(e,t){var n=l(e).find(function(e){return e.match("a=mid:"+t)});if(!n)return null;var r=n.match(/a=(sendrecv|sendonly|recvonly|inactive)/);return r?r[1]:null}(e,t.mid);if("inactive"===r)return!0;if("recvonly"===r&&!t.sender.track)return!0;return!1})(e.sdp,t)&&t.stop()})},function(n){throw t._log.warn('Calling setRemoteDescription with an RTCSessionDescription of type "'+e.type+'" failed with the error "'+n.message+'".'),e.sdp&&t._log.warn("The SDP was "+e.sdp),n})}},{key:"_updateDescription",value:function(e){var t=this;switch(e.type){case"answer":case"pranswer":if(e.revision!==this._descriptionRevision||"have-local-offer"!==this._peerConnection.signalingState)return Promise.resolve();this._descriptionRevision=e.revision;break;case"close":return this._close();case"create-offer":return e.revision<=this._lastStableDescriptionRevision?Promise.resolve():this._needsInitialAnswer?(this._queuedDescription=e,Promise.resolve()):(this._descriptionRevision=e.revision,this._offer());case"offer":return e.revision<=this._lastStableDescriptionRevision||"closed"===this._peerConnection.signalingState?Promise.resolve():"have-local-offer"===this._peerConnection.signalingState?this._needsInitialAnswer?(this._queuedDescription=e,Promise.resolve()):(this._descriptionRevision=e.revision,this._handleGlare(e)):(this._descriptionRevision=e.revision,this._answer(e))}var n=e.revision;return Promise.resolve().then(function(){return"answer"===e.type&&(t._lastStableDescriptionRevision=n),t._setRemoteDescription(e)}).catch(function(){throw new y}).then(function(){return"answer"===e.type&&(t._needsInitialAnswer=!1),t._checkIceBox(e)}).then(function(){return t._queuedDescription&&t._updateDescription(t._queuedDescription)}).then(function(){return t._queuedDescription=null,t._peerConnection.localDescription?t._maybeReoffer(t._peerConnection.localDescription):Promise.resolve()})}},{key:"_updateIce",value:function(e){var t=this._remoteCandidates.update(e);return this._addIceCandidates(t)}},{key:"addDataTrackSender",value:function(e){if(!this._dataChannels.has(e))try{var t={ordered:e.ordered};null!==e.maxPacketLifeTime&&(t.maxPacketLifeTime=e.maxPacketLifeTime),null!==e.maxRetransmits&&(t.maxRetransmits=e.maxRetransmits);var n=this._peerConnection.createDataChannel(e.id,t);e.addDataChannel(n),this._dataChannels.set(e,n)}catch(r){}}},{key:"addMediaTrackSender",value:function(e){if("closed"!==this._peerConnection.signalingState&&!this._rtpSenders.has(e)){var t=void 0;if(this._localMediaStream)this._localMediaStream.addTrack(e.track),t=this._peerConnection.addTrack(e.track,this._localMediaStream);else t=this._peerConnection.addTransceiver(e.track).sender;e.addSender(t),this._rtpSenders.set(e,t)}}},{key:"close",value:function(){this._close()&&(this._descriptionRevision++,this._localDescription={type:"close"},this.emit("description",this.getState()))}},{key:"getTrackReceivers",value:function(){return Array.from(this._dataTrackReceivers).concat(Array.from(this._mediaTrackReceivers))}},{key:"getState",value:function(){if(!this._localDescription)return null;var e={type:this._localDescription.type,revision:this._descriptionRevision};return this._localDescription.sdp&&(e.sdp=this._localDescription.sdp),{description:e,id:this.id}}},{key:"offer",value:function(){var e=this;return this._needsInitialAnswer||this._isRestartingIce?(this._shouldOffer=!0,Promise.resolve()):this.bracket("offering",function(t){return e.transition("updating",t),e._offer().then(function(){e.tryTransition("open",t)},function(n){throw e.tryTransition("open",t),n})})}},{key:"removeDataTrackSender",value:function(e){var t=this._dataChannels.get(e);t&&(e.removeDataChannel(t),this._dataChannels.delete(e),t.close())}},{key:"removeMediaTrackSender",value:function(e){if("closed"!==this._peerConnection.signalingState&&this._rtpSenders.has(e)){var t=this._rtpSenders.get(e);this._peerConnection.removeTrack(t),this._localMediaStream&&this._localMediaStream.removeTrack(e.track),e.removeSender(t),this._rtpSenders.delete(e)}}},{key:"setConfiguration",value:function(e){"function"===typeof this._peerConnection.setConfiguration&&this._peerConnection.setConfiguration($(e))}},{key:"update",value:function(e){var t=this;return this.bracket("updating",function(n){if("closed"===t.state)return Promise.resolve();t.transition("updating",n);var r=[];return e.ice&&r.push(t._updateIce(e.ice)),e.description&&r.push(t._updateDescription(e.description)),Promise.all(r).then(function(){t.tryTransition("open",n)},function(e){throw t.tryTransition("open",n),e})})}},{key:"getStats",value:function(){var e=this;return u(this._peerConnection).then(function(t){return function(e,t){return Object.assign(t,{remoteAudioTrackStats:t.remoteAudioTrackStats.map(function(t){return U(e,t)}),remoteVideoTrackStats:t.remoteVideoTrackStats.map(function(t){return U(e,t)})})}(e,t)})}},{key:"iceConnectionState",get:function(){return this._peerConnection.iceConnectionState}}]),t}();function U(e,t){var n=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e._mediaTrackReceivers)).find(function(e){return e.track.id===t.trackId}),r=n?n.id:null;return Object.assign(t,{trackId:r})}function L(e){if(e.sdp){var t=e.sdp.match(/^a=ice-ufrag:([a-zA-Z0-9+\/]+)/m);if(t)return t[1]}return null}function $(e){return Object.assign({bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},e)}e.exports=N},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(179).difference,a=n(179).flatMap;function o(){return String(Math.floor(4294967295*Math.random()))}var s=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{cName:{enumerable:!0,value:r},isSimulcastEnabled:{enumerable:!0,value:!1,writable:!0},primarySSRCs:{enumerable:!0,value:new Set},rtxPairs:{enumerable:!0,value:new Map},streamId:{enumerable:!0,value:n},trackId:{enumerable:!0,value:t}})}return r(e,[{key:"addSimulcastSSRCs",value:function(){if(!this.isSimulcastEnabled){var e=[o(),o()];e.forEach(function(e){this.primarySSRCs.add(e)},this),this.rtxPairs.size&&e.forEach(function(e){this.rtxPairs.set(o(),e)},this)}}},{key:"addSSRC",value:function(e,t,n){t?this.rtxPairs.set(e,t):this.primarySSRCs.add(e),this.isSimulcastEnabled=this.isSimulcastEnabled||n}},{key:"toSdpLines",value:function(e){var t=this,n=e?[]:Array.from(this.rtxPairs.entries()).map(function(e){return e.reverse()}),r=Array.from(this.primarySSRCs.values()),i=n.length?a(n):r,o=a(i,function(e){return["a=ssrc:"+e+" cname:"+t.cName,"a=ssrc:"+e+" msid:"+t.streamId+" "+t.trackId]}),s=n.map(function(e){return"a=ssrc-group:FID "+e.join(" ")}),c=["a=ssrc-group:SIM "+r.join(" ")];return s.concat(o).concat(c)}}]),e}();function c(e,t){return(e.match(new RegExp(t,"gm"))||[]).map(function(e){return(e.match(new RegExp(t))||[]).slice(1)})}function u(e){var t=function(e){return new Set(a(c(e,"^a=ssrc-group:SIM ([0-9]+) ([0-9]+) ([0-9]+)$")))}(e),n=c(e,"^a=ssrc:([0-9]+) msid:([^\\s]+) ([^\\s]+)$"),r=function(e){return new Map(c(e,"^a=ssrc-group:FID ([0-9]+) ([0-9]+)$").map(function(e){return e.reverse()}))}(e);return n.reduce(function(n,i){var a=i[0],o=i[1],c=i[2],u=n.get(c)||new s(c,o,function(e,t,n){var r="a=ssrc:"+t+" "+n+":(.+)";return e.match(new RegExp(r))[1]}(e,a,"cname")),l=r.get(a)||null;return u.addSSRC(a,l,t.has(a)),n.set(c,u)},new Map)}e.exports=function(e,t){var n=u(e),r=Array.from(n.keys()),o=Array.from(t.keys()),s=i(r,o),c=i(o,r);a(s,function(e){return n.get(e)}).forEach(function(e){e.addSimulcastSSRCs(),t.set(e.trackId,e)}),o=Array.from(t.keys());var l=i(o,c),d=a(l,function(e){return t.get(e)}),f=!e.match(/a=rtpmap:[0-9]+ rtx/),h=a(d,function(e){return e.toSdpLines(f)}),p=new Set(e.split("\r\n").concat(h));return a(p).join("\r\n")}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(1565),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_filter:{value:new i({getKey:function(e){return e.ufrag},isLessThanOrEqualTo:function(e,t){return e.revision<=t.revision}})},_ufrag:{writable:!0,value:null},ufrag:{enumerable:!0,get:function(){return this._ufrag}}})}return r(e,[{key:"setUfrag",value:function(e){this._ufrag=e;var t=this._filter.toMap().get(e);return t?t.candidates:[]}},{key:"update",value:function(e){e.candidates=e.candidates||[];var t=this._filter.toMap().get(e.ufrag),n=t?t.candidates:[];return this._filter.update(e)&&this._ufrag===e.ufrag?e.candidates.slice(n.length):[]}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Object.assign({getKey:function(e){return e},getValue:function(e){return e},isLessThanOrEqualTo:function(e,t){return e<=t}},t),Object.defineProperties(this,{_getKey:{value:t.getKey},_getValue:{value:t.getValue},_isLessThanOrEqualTo:{value:t.isLessThanOrEqualTo},_map:{value:new Map}})}return r(e,[{key:"toMap",value:function(){return new Map(this._map)}},{key:"updateAndFilter",value:function(e){return e.filter(this.update,this)}},{key:"update",value:function(e){var t=this._getKey(e),n=this._getValue(e);return(!this._map.has(t)||!this._isLessThanOrEqualTo(n,this._map.get(t)))&&(this._map.set(t,n),!0)}}]),e}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(801),a=n(1567),o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.label,e.maxPacketLifeTime,e.maxRetransmits,e.ordered));return Object.defineProperties(n,{_dataChannel:{value:e}}),e.binaryType="arraybuffer",e.addEventListener("message",function(e){n.emit("message",e.data)}),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"toDataTransport",value:function(){return new a(this._dataChannel)}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(169).EventEmitter,a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(n,{_dataChannel:{value:e},_messageQueue:{value:[]}}),e.addEventListener("open",function(){n._messageQueue.splice(0).forEach(function(e){return n._publish(e)})}),e.addEventListener("message",function(e){var t=e.data;try{var r=JSON.parse(t);n.emit("message",r)}catch(i){}}),n.publish({type:"ready"}),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"_publish",value:function(e){var t=JSON.stringify(e);this._dataChannel.send(t)}},{key:"publish",value:function(e){var t=this._dataChannel;return"closing"!==t.readyState&&"closed"!==t.readyState&&("connecting"===t.readyState?(this._messageQueue.push(e),!0):(this._publish(e),!0))}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=n(799),i=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"match",value:function(e){return e.track.id}},{key:"update",value:function(){}}]),e}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(179),a=n(260).getMediaSections;function o(){return{matched:new Set,unmatched:new Set}}var s=function(){function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(this instanceof e))return new e;Object.defineProperties(this,{audio:{enumerable:!0,value:o()},video:{enumerable:!0,value:o()}})}return r(e,[{key:"match",value:function(e){return function(e){var t=Array.from(e.unmatched);if(!t.length)return null;var n=t[0];return e.matched.add(n),e.unmatched.delete(n),n}(this[e.track.kind])}},{key:"update",value:function(e){["audio","video"].forEach(function(t){var n,r;n=this[t],r=function(e,t){var n=a(t,e);return new Set(i.flatMap(n,function(e){return e.match(new RegExp("msid: ?(.+) +(.+) ?$","mg"))||[]}).map(function(e){return e.match(new RegExp("msid: ?(.+) +(.+) ?$"))[2]}))}(t,e),r=new Set(r),i.difference(n.matched,r).forEach(n.matched.delete,n.matched),n.unmatched=i.difference(r,n.matched)},this)}}]),e}();e.exports=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(260).getMediaSections,a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_midsToTrackIds:{value:new Map,writable:!0}})}return r(e,[{key:"match",value:function(e){return this._midsToTrackIds.get(e.transceiver.mid)||null}},{key:"update",value:function(e){var t=i(e,"(audio|video)");this._midsToTrackIds=t.reduce(function(e,t){var n=t.match(/^a=mid:(.+)$/m)||[],r=t.match(/^a=msid:.+ (.+)$/m)||[],i=n[1],a=r[1];return i&&a?e.set(i,a):e},this._midsToTrackIds)}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(283).RTCSessionDescription,i=n(260).createPtToCodecName,a=n(260).getMediaSections;function o(e){var t=i(e),n=function(e){var t=new Map;return e.forEach(function(e,n){var r=t.get(e)||new Set;return t.set(e,r.add(n))}),t}(t),r=n.get("rtx")||new Set,a=new Set,o=function(e,t){var n=Array.from(e).reduce(function(e,t){var n=t[0],r=t[1],i=e.get(r)||new Set;return e.set(r,i.add(n))},new Map);return Array.from(n).reduce(function(e,n){var r=n[0],i=Array.from(n[1]);return i.length>1?(i.forEach(function(e){t.add(e)}),e):e.set(r,i[0])},new Map)}(function(e,t,n,r){return Array.from(n).reduce(function(n,i){var a=new RegExp("a=fmtp:"+i+" apt=(\\d+)"),o=e.match(a);if(!o)return r.add(i),n;var s=Number.parseInt(o[1]);if(!t.has(s))return r.add(i),n;var c=t.get(s);return"rtx"===c?(r.add(i),n):n.set(i,s)},new Map)}(e,t,r,a),a),c=Array.from(a);return["h264","vp8","vp9"].reduce(function(e,t){var r=n.get(t)||new Set;return Array.from(r).reduce(function(e,t){return o.has(t)?e:e.add(t)},e)},new Set).forEach(function(t){if(c.length){var n=c.shift();e=function(e,t,n){return e.endsWith("\r\n")?e+"a=fmtp:"+t+" apt="+n+"\r\n":e+"\r\na=fmtp:"+t+" apt="+n}(e=s(e,n),n,t)}}),c.forEach(function(t){e=function(e,t){var n=new RegExp("a=rtpmap:"+t+".*\r\n","gm");return e.replace(n,"")}(e=s(e,t),t)}),e}function s(e,t){var n=new RegExp("a=fmtp:"+t+".*\r\n","gm");return e.replace(n,"")}e.exports=function(e){var t={type:e.type};return"rollback"!==e.type&&(t.sdp=function(e){var t=a(e);return[e.split("\r\nm=")[0]].concat(t.map(o)).join("\r\n")}(e.sdp)),new r(t)}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a=n(169).EventEmitter,o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(e,{_queuedEvents:{value:new Map}}),e}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"dequeue",value:function(e){var t=this,n=!0;if(!e)return this._queuedEvents.forEach(function(e,t){n=this.dequeue(t)&&n},this),n;var r=this._queuedEvents.get(e)||[];return this._queuedEvents.delete(e),r.reduce(function(n,r){return t.emit.apply(t,i([e].concat(r)))&&n},n)}},{key:"queue",value:function(){var e=[].slice.call(arguments);if(this.emit.apply(this,i(e)))return!0;var t=e[0];return this._queuedEvents.has(t)||this._queuedEvents.set(t,[]),this._queuedEvents.get(t).push(e.slice(1)),!1}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=n(1575),o=n(1576),s=n(1583),c=n(1585),u=n(818),l=n(1586),d=n(807),f=n(179),h=n(217).createTwilioError,p=1e3,v=function(e){function t(e,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=Object.assign({NetworkQualityMonitor:o,NetworkQualitySignaling:s,RecordingSignaling:c,RemoteParticipantV2:l,statsPublishIntervalMs:p},a);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.sid,n.name,a));return Object.defineProperties(u,{_dominantSpeakerSignaling:{value:null,writable:!0},_dominantSpeakerSignalingPromise:{value:null,writable:!0},_disconnectedParticipantSids:{value:new Set},_NetworkQualityMonitor:{value:a.NetworkQualityMonitor},_NetworkQualitySignaling:{value:a.NetworkQualitySignaling},_networkQualityMonitor:{value:null,writable:!0},_networkQualityMonitorPromise:{value:null,writable:!0},_peerConnectionManager:{value:i},_published:{value:new Map},_publishedRevision:{value:0,writable:!0},_RemoteParticipantV2:{value:a.RemoteParticipantV2},_subscribed:{value:new Map},_subscribedRevision:{value:0,writable:!0},_subscriptionFailures:{value:new Map},_transport:{value:r},_trackReceiverDeferreds:{value:new Map}}),function(e,t){var n=f.oncePerTick(function(){var n=f.flatMap(t.tracks,function(e){return e.trackTransceiver});e._peerConnectionManager.setTrackSenders(n)}),r=f.oncePerTick(function(){e._publishNewLocalParticipantState()});t.on("trackAdded",n),t.on("trackRemoved",n),t.on("updated",r),e.on("stateChanged",function i(a){"disconnected"===a&&(t.removeListener("trackAdded",n),t.removeListener("trackRemoved",n),t.removeListener("updated",r),e.removeListener("stateChanged",i),t.disconnect())})}(u,e),function(e,t){t.on("description",function(t){e._publishPeerConnectionState(t)}),t.dequeue("description"),t.on("candidates",function(t){e._publishPeerConnectionState(t)}),t.dequeue("candidates"),t.on("trackAdded",e._addTrackReceiver.bind(e)),t.dequeue("trackAdded"),t.getTrackReceivers().forEach(e._addTrackReceiver,e),t.on("iceConnectionStateChanged",function(){e.emit("mediaConnectionStateChanged"),"failed"===e.mediaConnectionState&&null!==e.localParticipant.networkQualityLevel&&e.localParticipant.setNetworkQualityLevel(0)})}(u,i),function(e,t){t.on("message",e._update.bind(e)),t.on("stateChanged",function n(r,i){"disconnected"===r&&("disconnected"!==e.state&&e._disconnect(i),t.removeListener("stateChanged",n)),e.emit("signalingConnectionStateChanged")})}(u,r),function(e,t,n,r){var i=setInterval(function(){e.getStats().then(function(r){r.forEach(function(r,i){var a=new d(i,r);n.publishEvent("quality","stats-report",{audioTrackStats:a.remoteAudioTrackStats,localAudioTrackStats:a.localAudioTrackStats,localVideoTrackStats:a.localVideoTrackStats,participantSid:t.sid,peerConnectionId:a.peerConnectionId,roomSid:e.sid,videoTrackStats:a.remoteVideoTrackStats});var o=function(e,t){return(e=Object.assign({availableIncomingBitrate:0,availableOutgoingBitrate:0,bytesReceived:0,bytesSent:0,consentRequestsSent:0,currentRoundTripTime:0,lastPacketReceivedTimestamp:0,lastPacketSentTimestamp:0,nominated:!1,peerConnectionId:t,priority:0,readable:!1,requestsReceived:0,requestsSent:0,responsesReceived:0,responsesSent:0,retransmissionsReceived:0,retransmissionsSent:0,state:"failed",totalRoundTripTime:0,transportId:"",writable:!1},f.filterObject(e||{},null))).localCandidate=Object.assign({candidateType:"host",deleted:!1,ip:"",port:0,priority:0,protocol:"udp",relayProtocol:"udp",url:""},f.filterObject(e.localCandidate||{},null)),e.remoteCandidate=Object.assign({candidateType:"host",ip:"",port:0,priority:0,protocol:"udp",url:""},f.filterObject(e.remoteCandidate||{},null)),e}(r.activeIceCandidatePair,a.peerConnectionId);n.publishEvent("quality","active-ice-candidate-pair",o)})},function(){})},r);e.on("stateChanged",function t(n){"disconnected"===n&&(clearInterval(i),e.removeListener("stateChanged",t))})}(u,e,r,a.statsPublishIntervalMs),u._update(n),u}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u),i(t,[{key:"_deleteTrackReceiverDeferred",value:function(e){return this._trackReceiverDeferreds.delete(e)}},{key:"_getOrCreateTrackReceiverDeferred",value:function(e){var t=this._trackReceiverDeferreds.get(e)||f.defer(),n=this._peerConnectionManager.getTrackReceivers().find(function(t){return t.id===e&&"ended"!==t.readyState});return n?t.resolve(n):this._trackReceiverDeferreds.set(e,t),t}},{key:"_addTrackReceiver",value:function(e){return this._getOrCreateTrackReceiverDeferred(e.id).resolve(e),this}},{key:"_disconnect",value:function(e){var n=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_disconnect",this).call(this,e);return n&&(this._teardownDominantSpeakerSignaling(),this._teardownNetworkQualityMonitor(),this._transport.disconnect(),this._peerConnectionManager.close()),this.localParticipant.tracks.forEach(function(t){t.publishFailed(e||new Error("LocalParticipant disconnected"))}),n}},{key:"_getTrackReceiver",value:function(e){var t=this;return this._getOrCreateTrackReceiverDeferred(e).promise.then(function(n){return t._deleteTrackReceiverDeferred(e),n})}},{key:"_getOrCreateRemoteParticipant",value:function(e){var t=this._RemoteParticipantV2,n=this.participants.get(e.sid),r=this;return n||((n=new t(e,this._getTrackReceiver.bind(this))).on("stateChanged",function e(t){"disconnected"===t&&(n.removeListener("stateChanged",e),r.participants.delete(n.sid),r._disconnectedParticipantSids.add(n.sid))}),this.connectParticipant(n)),n}},{key:"_getState",value:function(){return{participant:this.localParticipant.getState()}}},{key:"_publishNewLocalParticipantState",value:function(){this._transport.publish(this._getState())}},{key:"_publishPeerConnectionState",value:function(e){this._transport.publish(Object.assign({peer_connections:[e]},this._getState()))}},{key:"_update",value:function(e){var t=this,n=new Set;if(e.subscribed&&e.subscribed.revision>this._subscribedRevision){this._subscribedRevision=e.subscribed.revision,e.subscribed.tracks.forEach(function(e){e.id?(this._subscriptionFailures.delete(e.sid),this._subscribed.set(e.id,e.sid)):e.error&&!this._subscriptionFailures.has(e.sid)&&this._subscriptionFailures.set(e.sid,e.error)},this);var r=new Set(e.subscribed.tracks.filter(function(e){return!!e.id}).map(function(e){return e.id}));this._subscribed.forEach(function(e,n){r.has(n)||t._subscribed.delete(n)})}return(e.participants||[]).forEach(function(e){if(e.sid!==this.localParticipant.sid&&!this._disconnectedParticipantSids.has(e.sid)){var t=this._getOrCreateRemoteParticipant(e);t.update(e),n.add(t)}},this),function(e){var t=new Map(f.flatMap(e.participants,function(e){return Array.from(e.tracks.values()).map(function(e){return[e.sid,e]})}));e._subscriptionFailures.forEach(function(n,r){var i=t.get(r);i&&(e._subscriptionFailures.delete(r),i.subscribeFailed(h(n.code,n.message)))});var n=new Set(Array.from(e._subscribed.keys()));t.forEach(function(t){n.has(t.id)?t.isSubscribed||e._getTrackReceiver(t.id).then(function(e){return t.setTrackTransceiver(e)}):t.setTrackTransceiver(null)})}(this),e.peer_connections&&this._peerConnectionManager.update(e.peer_connections),e.recording&&this.recording.update(e.recording),e.published&&e.published.revision>this._publishedRevision&&(this._publishedRevision=e.published.revision,e.published.tracks.forEach(function(e){e.sid&&this._published.set(e.id,e.sid)},this),this.localParticipant.update(e.published)),e.participant&&this.localParticipant.connect(e.participant.sid,e.participant.identity),!this._dominantSpeakerSignalingPromise&&e.media_signaling&&e.media_signaling.active_speaker&&e.media_signaling.active_speaker.transport&&"data-channel"===e.media_signaling.active_speaker.transport.type&&this._setupDataTransportBackedDominantSpeakerSignaling(e.media_signaling.active_speaker.transport.label),!this._networkQualityMonitorPromise&&e.media_signaling&&e.media_signaling.network_quality&&e.media_signaling.network_quality.transport&&"data-channel"===e.media_signaling.network_quality.transport.type&&this._setupDataTransportBackedNetworkQualityMonitor(e.media_signaling.network_quality.transport.label),this}},{key:"_setupDataTransportBackedDominantSpeakerSignaling",value:function(e){var t=this;this._teardownDominantSpeakerSignaling();var n=this._getTrackReceiver(e).then(function(e){if("data"!==e.kind)throw new Error("Expected a DataTrackReceiver");if(t._dominantSpeakerSignalingPromise===n){var r=new a(e.toDataTransport());t._setDominantSpeakerSignaling(r)}});this._dominantSpeakerSignalingPromise=n}},{key:"_setupDataTransportBackedNetworkQualityMonitor",value:function(e){var t=this;this._teardownNetworkQualityMonitor();var n=this._getTrackReceiver(e).then(function(e){if("data"!==e.kind)throw new Error("Expected a DataTrackReceiver");if(t._networkQualityMonitorPromise===n){var r=new t._NetworkQualitySignaling(e.toDataTransport()),i=new t._NetworkQualityMonitor(t._peerConnectionManager,r);t._setNetworkQualityMonitor(i)}});this._networkQualityMonitorPromise=n}},{key:"_setDominantSpeakerSignaling",value:function(e){var t=this;this._dominantSpeakerSignaling=e,e.on("updated",function(){return t.setDominantSpeaker(e.loudestParticipantSid)})}},{key:"_setNetworkQualityMonitor",value:function(e){var t=this;this._networkQualityMonitor=e,e.on("updated",function(){"failed"!==t.mediaConnectionState&&t.localParticipant.setNetworkQualityLevel(e.level,e.levels)}),e.start()}},{key:"_teardownDominantSpeakerSignaling",value:function(){this._dominantSpeakerSignalingPromise=null,this._dominantSpeakerSignaling=null}},{key:"_teardownNetworkQualityMonitor",value:function(){this._networkQualityMonitorPromise=null,this._networkQualityMonitor&&(this._networkQualityMonitor.stop(),this._networkQualityMonitor=null)}},{key:"getStats",value:function(){var e=this;return this._peerConnectionManager.getStats().then(function(t){return new Map(Array.from(t).map(function(t){var n=r(t,2),i=n[0],a=n[1];return[i,Object.assign({},a,{localAudioTrackStats:g(e,a.localAudioTrackStats),localVideoTrackStats:g(e,a.localVideoTrackStats),remoteAudioTrackStats:y(e,a.remoteAudioTrackStats),remoteVideoTrackStats:y(e,a.remoteVideoTrackStats)})]}))})}},{key:"signalingConnectionState",get:function(){return"syncing"===this._transport.state?"reconnecting":this._transport.state}},{key:"mediaConnectionState",get:function(){return this._peerConnectionManager.iceConnectionState}}]),t}();function m(e,t){return t.reduce(function(t,n){var r=e.get(n.trackId);return r?[Object.assign({},n,{trackSid:r})].concat(t):t},[])}function g(e,t){return m(e._published,t)}function y(e,t){return m(e._subscribed,t)}e.exports=v},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(169).EventEmitter,a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(n,{_loudestParticipantSid:{value:null,writable:!0}}),e.on("message",function(e){switch(e.type){case"active_speaker":n._setLoudestParticipantSid(e.participant)}}),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"_setLoudestParticipantSid",value:function(e){this.loudestParticipantSid!==e&&(this._loudestParticipantSid=e,this.emit("updated"))}},{key:"loudestParticipantSid",get:function(){return this._loudestParticipantSid}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=n(169),o=n(1577),s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(r,{_factories:{value:new WeakMap},_manager:{value:e},_signaling:{value:n}}),n.on("updated",function(){return r.emit("updated")}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),i(t,[{key:"start",value:function(){var e=this;this.stop();var t=setTimeout(function(){e._timeout===t&&function(e){var t=(e._manager._peerConnections?Array.from(e._manager._peerConnections.values()):[]).map(function(e){return e._peerConnection}).filter(function(e){return"closed"!==e.signalingState}).map(function(t){if(e._factories.has(t))return e._factories.get(t);var n=new o(t);return e._factories.set(t,n),n}).map(function(e){return e.next().catch(function(){return null})});return Promise.all(t).then(function(e){return e.filter(function(e){return e}).map(function(e){return e.summarize()})})}(e).then(function(n){if(e._timeout===t){if(n.length){var i=r(n,1)[0];e._signaling.put(i)}e.start()}})},200);this._timeout=t}},{key:"stop",value:function(){clearTimeout(this._timeout),this._timeout=null}},{key:"level",get:function(){return this._signaling.level}},{key:"levels",get:function(){return this._signaling.levels}}]),t}();e.exports=s},function(e,t,n){"use strict";var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var o=n(1578),s=n(1580),c=n(1581),u=n(1582),l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{pc:{enumerable:!0,value:t},ice:{enumerable:!0,value:new o},audio:{enumerable:!0,value:{send:new Map,recv:new Map}},video:{enumerable:!0,value:{send:new Map,recv:new Map}},lastReport:{enumerable:!0,value:null,writable:!0}})}return i(e,[{key:"next",value:function(){var e,t=this;return("undefined"!==typeof mozRTCPeerConnection?function(e){var t=e.pc.getTransceivers().filter(function(e){return e.currentDirection&&e.currentDirection.match(/send/)&&e.sender.track}).map(function(e){return e.sender}),n=e.pc.getTransceivers().filter(function(e){return e.currentDirection&&e.currentDirection.match(/recv/)}).map(function(e){return e.receiver});return Promise.all([d(t),d(n),e.pc.getStats()]).then(function(t){var n=r(t,3),i=n[0],a=n[1],o=n[2],s=h(e),c=g(e);i.forEach(function(t,n){return b(e,t,c,n)}),k(s,c);var u=p(e),l=y(e);a.forEach(function(t,n){return _(e,t,l,n)}),k(u,l),w(e.ice,o)})}(this):(e=this).pc.getStats().then(function(t){var n=h(e),r=g(e);b(e,t,r),k(n,r);var i=p(e),a=y(e);_(e,t,a),k(i,a),w(e.ice,t)})).then(function(){var e=[].concat(a(t.audio.send.values())),n=[].concat(a(t.video.send.values())),r=[].concat(a(t.audio.recv.values())),i=[].concat(a(t.video.recv.values())),o=new s(t.ice.lastReport,{send:e.map(function(e){return e.lastReport}).filter(function(e){return e}),recv:r.map(function(e){return e.lastReport}).filter(function(e){return e})},{send:n.map(function(e){return e.lastReport}).filter(function(e){return e}),recv:i.map(function(e){return e.lastReport}).filter(function(e){return e})});return t.lastReport=o,o})}}]),e}();function d(e){return Promise.all(e.map(function(e){var t=e.track.id;return e.getStats().then(function(e){var n=!0,r=!1,i=void 0;try{for(var a,o=e.values()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;"inbound-rtp"===s.type&&(s.id=t+"-"+s.id)}}catch(c){r=!0,i=c}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return[t,e]})})).then(function(e){return new Map(e)})}function f(e,t,n,r,i){var a=t[r.mediaType];if(!i){var o=n.get(r.trackId);o&&(i=o.trackIdentifier)}if(a&&i){if(a.has(r.id))return a.get(r.id);var s=new e(i,r);a.set(r.id,s)}return null}function h(e){return{audio:e.audio.send,video:e.video.send}}function p(e){return{audio:e.audio.recv,video:e.video.recv}}function v(e,t,n,r){return f(u,h(e),t,n,r)}function m(e,t,n,r){return f(c,p(e),t,n,r)}function g(e){return{audio:new Set(e.audio.send.keys()),video:new Set(e.video.send.keys())}}function y(e){return{audio:new Set(e.audio.recv.keys()),video:new Set(e.video.recv.keys())}}function b(e,t,n,r){var i=!0,a=!1,o=void 0;try{for(var s,c=t.values()[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;if("outbound-rtp"===u.type&&!u.isRemote){if("undefined"===typeof mozRTCPeerConnection&&!u.trackId)continue;var l=n[u.mediaType];l&&l.delete(u.id);var d=v(e,t,u,r);if(d){var f=t.get(u.remoteId);d.next(r||d.trackId,u,f)}}}}catch(h){a=!0,o=h}finally{try{!i&&c.return&&c.return()}finally{if(a)throw o}}}function _(e,t,n,r){var i=!0,a=!1,o=void 0;try{for(var s,c=t.values()[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;if("inbound-rtp"===u.type&&!u.isRemote){var l=n[u.mediaType];l&&l.delete(u.id);var d=m(e,t,u,r);d&&d.next(r||d.trackId,u)}}}catch(f){a=!0,o=f}finally{try{!i&&c.return&&c.return()}finally{if(a)throw o}}}function k(e,t){var n=function(n){var r=e[n];t[n].forEach(function(e){return r.delete(e)})};for(var r in t)n(r)}function w(e,t){var n=void 0,r=!0,i=!1,a=void 0;try{for(var o,s=t.values()[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;"transport"===c.type&&(n=t.get(c.selectedCandidatePairId))}}catch(v){i=!0,a=v}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}if(n)e.next(n);else{var u=!0,l=!1,d=void 0;try{for(var f,h=t.values()[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var p=f.value;"candidate-pair"!==p.type||!p.nominated||"selected"in p&&!p.selected||e.next(p)}}catch(v){l=!0,d=v}finally{try{!u&&h.return&&h.return()}finally{if(l)throw d}}}}e.exports=l},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(1579),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{lastReport:{enumerable:!0,value:new i(0,0),writable:!0},lastStats:{enumerable:!0,value:null,writable:!0}})}return r(e,[{key:"next",value:function(e){var t=this.lastStats;if(this.lastStats=e,t){var n=t.id===e.id?i.of(t,e):new i(0,0);this.lastReport=n}return this.lastReport}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{availableSend:{enumerable:!0,value:r},recv:{enumerable:!0,value:n},rtt:{enumerable:!0,value:i},send:{enumerable:!0,value:t}})}return r(e,null,[{key:"of",value:function(t,n){var r=(n.timestamp-t.timestamp)/1e3,i=n.bytesSent-t.bytesSent,a=n.bytesReceived-t.bytesReceived;return new e(r>0?i/r*8:0,r>0?a/r*8:0,n.availableOutgoingBitrate,n.currentRoundTripTime)}}]),e}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(811),a=n(815),o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{ice:{enumerable:!0,value:t},audio:{enumerable:!0,value:n},video:{enumerable:!0,value:r}})}return r(e,[{key:"summarize",value:function(){var e=this.audio.send.concat(this.video.send),t=a.summarize(e),n=this.audio.recv.concat(this.video.recv),r=i.summarize(n);return{ice:this.ice,send:t,recv:r,audio:{send:a.summarize(this.audio.send),recv:i.summarize(this.audio.recv)},video:{send:a.summarize(this.video.send),recv:i.summarize(this.video.recv)}}}}]),e}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(811),a=n(816),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n.id,e,n));return Object.defineProperties(r,{lastReport:{enumerable:!0,value:null,writable:!0}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"next",value:function(e,t){var n=this.lastStats;this.lastStats=t,this.trackId=e;var r=i.of(e,n,t);return this.lastReport=r,r}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(816),a=n(815),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n.id,e,n));return Object.defineProperties(r,{lastReport:{enumerable:!0,value:null,writable:!0}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"next",value:function(e,t,n){var r=this.lastStats;this.lastStats=t,this.trackId=e;var i=a.of(e,r,t,n);return this.lastReport=i,i}}]),t}();e.exports=o},function(e,t,n){"use strict";var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=n(169).EventEmitter,o=n(1584),s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(n,{_level:{value:null,writable:!0},_levels:{value:null,writable:!0},_mediaSignalingTransport:{value:e},_networkQualityInputs:{value:new o}}),e.on("message",function(e){switch(e.type){case"network_quality":n._handleNetworkQualityMessage(e)}}),n._sendNetworkQualityInputs(),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),i(t,[{key:"_handleNetworkQualityMessage",value:function(e){var t=this,n=null,i=e?e.local:null;"number"===typeof i?(n=i,this._levels=null):"object"===("undefined"===typeof i?"undefined":r(i))&&i&&(this._levels=i,n="number"===typeof i.level?i.level:Math.min(i.audio.send,i.audio.recv,i.video.send,i.video.recv)),null!==n&&this.level!==n&&(this._level=n,this.emit("updated")),setTimeout(function(){return t._sendNetworkQualityInputs()},1e3)}},{key:"_sendNetworkQualityInputs",value:function(){var e=this;return this._networkQualityInputs.take().then(function(t){e._mediaSignalingTransport.publish(function(e){return Object.assign({type:"network_quality"},e)}(t))})}},{key:"put",value:function(e){this._networkQualityInputs.put(e)}},{key:"level",get:function(){return this._level}},{key:"levels",get:function(){return this._levels}}]),t}();e.exports=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(179).defer,a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_deferreds:{value:[]},_hasValue:{value:!1,writable:!0},_value:{value:null,writable:!0}})}return r(e,[{key:"put",value:function(e){this._hasValue=!0,this._value=e;var t=this._deferreds.shift();return t&&t.resolve(e),this}},{key:"take",value:function(){var e=this;if(this._hasValue&&!this._deferreds.length)return this._hasValue=!1,Promise.resolve(this._value);var t=i();return this._deferreds.push(t),t.promise.then(function(t){return e._hasValue=!1,t})}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(817),a=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(e,{_revision:{value:1,writable:!0}}),e}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"update",value:function(e){return e.revision<this._revision?this:(this._revision=e.revision,this.enable(e.enabled))}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var a=n(1587),o=n(1588),s=function(e){function t(e,n,r){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.sid,e.identity));return r=Object.assign({RemoteTrackPublicationV2:o},r),Object.defineProperties(s,{_revision:{writable:!0,value:null},_RemoteTrackPublicationV2:{value:r.RemoteTrackPublicationV2},_getTrackReceiver:{value:n},revision:{enumerable:!0,get:function(){return this._revision}}}),a=s.update(e),i(s,a)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"_getOrCreateTrack",value:function(e){var t=this._RemoteTrackPublicationV2,n=this.tracks.get(e.id);return n||(n=new t(e),this.addTrack(n)),n}},{key:"update",value:function(e){if(null!==this.revision&&e.revision<=this.revision)return this;this._revision=e.revision;var t=new Set;return e.tracks.forEach(function(e){var n=this._getOrCreateTrack(e);n.update(e),t.add(n)},this),this.tracks.forEach(function(e){t.has(e)||this.removeTrack(e)},this),"disconnected"===e.state&&"connected"===this.state&&this.preempt("disconnected"),this}},{key:"addTrack",value:function(e){return function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addTrack",this).call(this,e),this._getTrackReceiver(e.id).then(e.setTrackTransceiver.bind(e)),this}}]),t}();e.exports=s},function(e,t,n){"use strict";var r=n(548),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.connect(e,n),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),t}();e.exports=i},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(1589),a=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.sid,e.name,e.id,e.kind,e.enabled))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"update",value:function(e){return this.enable(e.enabled),this}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(819),a=function(e){function t(e,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,r,i,a));return Object.defineProperties(o,{_error:{value:null,writable:!0}}),o.setSid(e),o}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"subscribeFailed",value:function(e){return this.error||(this._error=e,this.emit("updated")),this}},{key:"error",get:function(){return this._error}},{key:"isSubscribed",get:function(){return!!this.trackTransceiver}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(213),a=n(539),o=n(1591),s=n(1592),c=n(549),u=n(821),l=n(347),d=n(179),f=n(217).RoomCompletedError,h=n(217),p=h.SignalingConnectionDisconnectedError,v=h.SignalingConnectionError,m=h.SignalingConnectionTimeoutError,g=h.SignalingIncomingMessageInvalidError,y=h.createTwilioError,b=a.name+".js",_=a.version,k=1,w={connecting:["connected","disconnected"],connected:["disconnected","syncing"],syncing:["connected","disconnected"],disconnected:[]},T=function(e){function t(e,n,r,i,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l=Object.assign({InsightsPublisher:o,NullInsightsPublisher:s,sdpSemantics:null,SIPJSMediaHandler:u,userAgent:d.getUserAgent()},l);var h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"connecting",w)),y={};l.wsServerInsights&&(y.gateway=l.wsServerInsights);var T=l.insights?l.InsightsPublisher:l.NullInsightsPublisher;return Object.defineProperties(h,{_eventPublisher:{value:new T(n,b,_,l.environment,l.realm,y)},_sdpSemantics:{value:l.sdpSemantics},_updatesReceived:{value:[]},_updatesToSend:{value:[]},_userAgent:{value:l.userAgent}}),Object.defineProperties(h,{_session:{value:S(h,e,n,r,i,a,l.SIPJSMediaHandler,l.iceServerSourceStatus,l.dominantSpeaker,l.networkQuality)}}),function(e,t,n){function r(t,n){var r=void 0;if(!t||t instanceof c.OutgoingRequest||(r=R(t)),!r)switch(n){case c.C.causes.REQUEST_TIMEOUT:r=new m;break;case c.C.causes.CONNECTION_ERROR:r=new v;break;default:r=new p}e.disconnect(r)}function i(t){if(!(t instanceof c.OutgoingRequest)){var n=void 0;try{n=R(t)}catch(i){if(i instanceof g)return;n=i}if(n)e.disconnect(n);else{var r=void 0;try{r=E(t)}catch(i){}if(r)switch(e.state){case"connected":switch(r.type){case"connected":case"synced":case"update":return void e.emit("message",r);case"disconnected":return void e.disconnect("completed"===r.status?new f:null);default:return}case"connecting":switch(r.type){case"connected":return e.emit("connected",r),void e.preempt("connected");case"synced":case"update":return void e._updatesReceived.push(r);case"disconnected":return void e.disconnect("completed"===r.status?new f:null);default:return}case"disconnected":return;case"syncing":switch(r.type){case"connected":case"update":return void e._updatesReceived.push(r);case"synced":return e.emit("message",r),void e.preempt("connected");case"disconnected":return void e.disconnect("completed"===r.status?new f:null);default:return}default:return}}}}t.on("info",i),t.once("bye",r),t.once("accepted",i),t.once("failed",r),e.on("stateChanged",function a(o){switch(o){case"connected":t.removeListener("accepted",i),t.removeListener("failed",r);var s=e._updatesToSend.splice(0);return s.length&&e.publish(function(e){return e.reduce(function(e,t){return!e.participant&&t.participant?e.participant=t.participant:e.participant&&t.participant&&t.participant.revision>e.participant.revision&&(e.participant=t.participant),!e.peer_connections&&t.peer_connections?e.peer_connections=C(t.peer_connections):e.peer_connections&&t.peer_connections&&(e.peer_connections=C(e.peer_connections.concat(t.peer_connections))),e},{type:"update",version:k})}(s)),void e._updatesReceived.splice(0).forEach(e.emit.bind(e,"message"));case"disconnected":return t.removeListener("accepted",i),t.removeListener("failed",r),t.removeListener("info",i),t.removeListener("bye",r),e.removeListener("stateChanged",a),void n.stop();case"syncing":default:return}}),n.once("disconnected",r),n.once("keepAliveTimeout",function(){return e.disconnect(new m)})}(h,h._session,a),h}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l),r(t,[{key:"disconnect",value:function(e){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[e]),this._session.terminate({body:JSON.stringify({type:"disconnect",version:k}),extraHeaders:["Content-Type: application/room-signaling+json"]}),this._eventPublisher.disconnect(),!0)}},{key:"publish",value:function(e){switch(e=Object.assign({type:"update",version:k},e),this.state){case"connected":return function e(t,n,r,a){a=a||0;return new Promise(function(o,s){function c(c){switch(Math.floor(c.status_code/100)){case 2:o();break;case 5:a<i.PUBLISH_MAX_ATTEMPTS?o(e(t,n,r,++a)):s(new Error("Transport failed to send a message even after "+i.PUBLISH_MAX_ATTEMPTS+" attempts"));break;default:s(c)}}function u(){"disconnected"!==t.state&&n.sendRequest("INFO",{body:JSON.stringify(r),extraHeaders:["Content-Type: application/room-signaling+json","Event: room-signaling","Info-Package: room-signaling"],receiveResponse:c})}if(0!==a){var l=(1<<a-1)*i.PUBLISH_BACKOFF_MS;setTimeout(u,function(e,t){var n=Math.random();return e-t+Math.floor(2*t*n+.5)}(l,i.PUBLISH_BACKOFF_JITTER))}else u()})}(this,this._session,e),!0;case"connecting":case"syncing":return this._updatesToSend.push(e),!0;case"disconnected":default:return!1}}},{key:"publishEvent",value:function(e,t,n){return this._eventPublisher.publish(e,t,n)}},{key:"sync",value:function(){return"connected"===this.state&&(this.preempt("syncing"),this._session.sendReinvite(),!0)}}]),t}();function S(e,t,n,r,a,o,s,c,u,l){var f="sip:"+d.makeServerSIPURI();return o.invite(f,{extraHeaders:[i.headers.X_TWILIO_ACCESSTOKEN+": "+n,"Session-Expires: 120"],media:{stream:{}},mediaHandlerFactory:function(){return new s(a,function(){if("disconnected"===e.state)return{type:"disconnect",version:k};var n={connecting:"connect",syncing:"sync"}[e.state]||"update",i={name:t,participant:r.getState(),type:n,version:k};"connect"===i.type&&(i.ice_servers=c,i.publisher={name:b,sdk_version:_,user_agent:e._userAgent},i.media_signaling={},l&&(i.media_signaling.network_quality={transports:[{type:"data-channel"}]}),u&&(i.media_signaling.active_speaker={transports:[{type:"data-channel"}]}));var a=d.getSdpFormat(e._sdpSemantics);return"connect"===n&&a&&(i.format=a),i})},onInfo:function(e){this.emit("info",e),e.reply(200)}})}function C(e){return Array.from(e.reduce(function(e,t){var n=e.get(t.id)||t;return!n.description&&t.description?n.description=t.description:n.description&&t.description&&t.description.revision>n.description.revision&&(n.description=t.description),!n.ice&&t.ice?n.ice=t.ice:n.ice&&t.ice&&t.ice.revision>n.ice.revision&&(n.ice=t.ice),e.set(n.id,n),e},new Map).values())}function E(e){if(e.body)try{return JSON.parse(e.body)}catch(t){throw new g}return null}function R(e){return function(e){var t=e.headers;if(t&&t["X-Twilio-Error"]){var n=t["X-Twilio-Error"][0].raw.split(" "),r=parseInt(n[0],10),i=n.slice(1).join(" ");return y(r,i)}return null}(e)||function(e){try{var t=E(e);if(t)switch(t.type){case"disconnected":if("completed"===t.status)return new f;break;case"error":return y(t.code,t.message)}return null}catch(n){return n}}(e)}e.exports=T},function(e,t,n){"use strict";(function(t){var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(169).EventEmitter,a=n(179).getUserAgent,o=5,s=50,c=1e3,u=t.window||t,l=u.WebSocket?u.WebSocket:n(820),d=function(e){function t(e,n,r,i,c,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));u=Object.assign({gateway:h(i,c)+"/v1/VideoEvents",maxReconnectAttempts:o,reconnectIntervalMs:s,userAgent:a(),WebSocket:l},u),Object.defineProperties(d,{_connectTimestamp:{value:0,writable:!0},_eventQueue:{value:[]},_reconnectAttemptsLeft:{value:u.maxReconnectAttempts,writable:!0},_ws:{value:null,writable:!0},_WebSocket:{value:u.WebSocket}});var p=d;return d.on("disconnected",function t(i){if(p._session=null,i&&p._reconnectAttemptsLeft>0)return p.emit("reconnecting"),void function(e,t,n,r,i){var a=Date.now()-e._connectTimestamp,o=i.reconnectIntervalMs-a;if(o>0)return void setTimeout(function(){f(e,t,n,r,i)},o);f(e,t,n,r,i)}(p,e,n,r,u);p.removeListener("disconnected",t)}),f(d,e,n,r,u),d}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"_publish",value:function(e){e.session=this._session,this._ws.send(JSON.stringify(e))}},{key:"disconnect",value:function(){if(this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED)return!1;try{this._ws.close()}catch(e){}return this.emit("disconnected"),!0}},{key:"publish",value:function(e,t,n){return this._ws.readyState!==this._WebSocket.CLOSING&&this._ws.readyState!==this._WebSocket.CLOSED&&(("string"===typeof this._session?this._publish.bind(this):this._eventQueue.push.bind(this._eventQueue))({group:e,name:t,payload:n,timestamp:Date.now(),type:"event",version:1}),!0)}}]),t}();function f(e,t,n,r,i){e._connectTimestamp=Date.now(),e._reconnectAttemptsLeft--,e._ws=new i.WebSocket(i.gateway);var a=e._ws;a.addEventListener("close",function(t){t.code!==c?e.emit("disconnected",new Error("WebSocket Error "+t.code+": "+t.reason)):e.emit("disconnected")}),a.addEventListener("message",function(t){!function(e,t,n){switch(t.type){case"connected":e._session=t.session,e._reconnectAttemptsLeft=n.maxReconnectAttempts,e._eventQueue.splice(0).forEach(e._publish,e),e.emit("connected");break;case"error":e._ws.close(),e.emit("disconnected",new Error(t.message))}}(e,JSON.parse(t.data),i)}),a.addEventListener("open",function(){var e={type:"connect",token:t,version:1};e.publisher={name:n,sdkVersion:r,userAgent:i.userAgent},a.send(JSON.stringify(e))})}function h(e,t){return"prod"===e?"wss://sdkgw."+t+".twilio.com":"wss://sdkgw."+e+"-"+t+".twilio.com"}e.exports=d}).call(this,n(48))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_connected:{writable:!0,value:!0}})}return r(e,[{key:"disconnect",value:function(){return!!this._connected&&(this._connected=!1,!0)}},{key:"publish",value:function(){return this._connected}}]),e}();e.exports=i},function(e,t,n){"use strict";e.exports=function(e,t){var n;return(n=function(e,t){this.logger=e.getLogger("sip.transport"),this.ua=e,this.ws=null,this.server=t,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.keepAliveInterval=e.configuration.keepAliveInterval,this.keepAliveTimeout=null,this.keepAliveTimer=null,this.ua.transport=this,this.connect()}).prototype={send:function(e){var n=e.toString();return this.ws&&this.ws.readyState===t.OPEN?(!0===this.ua.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+n+"\n"),this.ws.send(n),!0):(this.logger.warn("unable to send message, WebSocket is not open"),!1)},sendKeepAlive:function(){if(!this.keepAliveTimeout)return this.keepAliveTimeout=e.Timers.setTimeout(function(){this.ua.emit("keepAliveTimeout")}.bind(this),1e4),this.send("\r\n\r\n")},startSendingKeepAlives:function(){this.keepAliveInterval&&!this.keepAliveTimer&&(this.keepAliveTimer=e.Timers.setTimeout(function(){this.sendKeepAlive(),this.keepAliveTimer=null,this.startSendingKeepAlives()}.bind(this),function(e){var t=.8*e;return 1e3*(Math.random()*(e-t)+t)}(this.keepAliveInterval)))},stopSendingKeepAlives:function(){e.Timers.clearTimeout(this.keepAliveTimer),e.Timers.clearTimeout(this.keepAliveTimeout),this.keepAliveTimer=null,this.keepAliveTimeout=null},disconnect:function(){this.ws&&(e.Timers.clearTimeout(this.reconnectTimer),this.stopSendingKeepAlives(),this.closed=!0,this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},connect:function(){var e=this;if(this.ws&&(this.ws.readyState===t.OPEN||this.ws.readyState===t.CONNECTING))return this.logger.log("WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),this.logger.log("connecting to WebSocket "+this.server.ws_uri),this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{this.ws=new t(this.server.ws_uri,"sip")}catch(n){this.logger.warn("error connecting to WebSocket "+this.server.ws_uri+": "+n)}this.ws.binaryType="arraybuffer",this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(t){e.onClose(t)},this.ws.onmessage=function(t){e.onMessage(t)},this.ws.onerror=function(t){e.onError(t)}},onOpen:function(){this.connected=!0,this.logger.log("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this),this.startSendingKeepAlives()},onClose:function(e){var t=this.connected;this.lastTransportError.code=e.code,this.lastTransportError.reason=e.reason,this.stopSendingKeepAlives(),this.reconnection_attempts>0?(this.logger.log("Reconnection attempt "+this.reconnection_attempts+" failed (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),this.reconnect()):(this.connected=!1,this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),!1===e.wasClean&&this.logger.warn("WebSocket abrupt disconnection"),!0===t?(this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reconnect()):this.ua.onTransportError(this))},onMessage:function(t){var n,r,i=t.data;if("\r\n"===i)return e.Timers.clearTimeout(this.keepAliveTimeout),this.keepAliveTimeout=null,void(!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if("string"!==typeof i){try{i=String.fromCharCode.apply(null,new Uint8Array(i))}catch(a){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+i+"\n")}else!0===this.ua.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+i+"\n");if((n=e.Parser.parseMessage(i,this.ua))&&!(this.ua.status===e.UA.C.STATUS_USER_CLOSED&&n instanceof e.IncomingRequest)&&e.sanityCheck(n,this.ua,this))if(n instanceof e.IncomingRequest)n.transport=this,this.ua.receiveRequest(n);else if(n instanceof e.IncomingResponse)switch(n.method){case e.C.INVITE:(r=this.ua.transactions.ict[n.via_branch])&&r.receiveResponse(n);break;case e.C.ACK:break;default:(r=this.ua.transactions.nict[n.via_branch])&&r.receiveResponse(n)}},onError:function(e){this.logger.warn("WebSocket connection error: "+JSON.stringify(e))},reconnect:function(){var t=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.wsServerMaxReconnection?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):1===this.reconnection_attempts?(this.logger.log("Connection to WebSocket "+this.server.ws_uri+" severed, attempting first reconnect"),t.connect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=e.Timers.setTimeout(function(){t.connect(),t.reconnectTimer=null},1e3*this.ua.configuration.wsServerReconnectionTimeout))}},n.C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2},n}},function(e,t,n){"use strict";e.exports=function(e){var t=n(1595),r=Object.defineProperties({},{version:{get:function(){return t.version}},name:{get:function(){return t.title}}});return n(1596)(r,e),r.LoggerFactory=n(1597)(e.console),r.EventEmitter=n(1598)(e.console),r.C=n(1599)(r.name,r.version),r.Exceptions=n(1600),r.Timers=n(1601)(e.timers),r.Transport=e.Transport(r,e.WebSocket),n(1602)(r),n(1603)(r),n(1604)(r),n(1605)(r),n(1606)(r),n(1607)(r),n(1609)(r),n(1610)(r),r.MediaHandler=n(1611)(r.EventEmitter),n(1612)(r),n(1613)(r),n(1614)(r,e),n(1617)(r),r.WebRTC=n(1618)(r,e),n(1621)(r,e),r.Hacks=n(1622)(r),n(1623)(r),r.DigestAuthentication=n(1624)(r.Utils),r.Grammar=n(1625)(r),r}},function(e){e.exports={_args:[["@twilio/sip.js@0.7.7","/Users/yraj/lts-code/remotepatientmonitoring/client"]],_from:"@twilio/sip.js@0.7.7",_id:"@twilio/sip.js@0.7.7",_inBundle:!1,_integrity:"sha1-z/UPZvmyldRvIZc3tyeAx9Dm31I=",_location:"/@twilio/sip.js",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"@twilio/sip.js@0.7.7",name:"@twilio/sip.js",escapedName:"@twilio%2fsip.js",scope:"@twilio",rawSpec:"0.7.7",saveSpec:null,fetchSpec:"0.7.7"},_requiredBy:["/twilio-video"],_resolved:"https://registry.npmjs.org/@twilio/sip.js/-/sip.js-0.7.7.tgz",_spec:"0.7.7",_where:"/Users/yraj/lts-code/remotepatientmonitoring/client",author:{name:"OnSIP",email:"developer@onsip.com",url:"http://sipjs.com/authors/"},browser:{"./src/environment.js":"./src/environment_browser.js"},bugs:{url:"https://github.com/onsip/SIP.js/issues"},contributors:[{url:"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],description:"A simple, intuitive, and powerful JavaScript signaling library",devDependencies:{beefy:"^2.1.5",browserify:"^4.1.8",grunt:"~0.4.0","grunt-browserify":"^4.0.1","grunt-cli":"~0.1.6","grunt-contrib-copy":"^0.5.0","grunt-contrib-jasmine":"^1.0.3","grunt-contrib-jshint":">0.5.0","grunt-contrib-uglify":"~0.2.0","grunt-peg":"~1.3.1","grunt-trimtrailingspaces":"^0.4.0",pegjs:"^0.8.0","release-tool":"^0.2.2"},engines:{node:">=0.12"},homepage:"http://sipjs.com",keywords:["sip","websocket","webrtc","library","javascript"],license:"MIT",main:"src/index.js",name:"@twilio/sip.js",repository:{type:"git",url:"git+https://github.com/onsip/SIP.js.git"},scripts:{build:"grunt build",repl:"beefy test/repl.js --open",test:"grunt travis --verbose"},title:"SIP.js",version:"0.7.7"}},function(e,t,n){"use strict";e.exports=function(e,t){var n;n={Promise:t.Promise,defer:function(){var e={};return e.promise=new n.Promise(function(t,n){e.resolve=t,e.reject=n}),e},promisify:function(e,t,r){var i=e[t];return function(t,a,o){return new n.Promise(function(n,a){var o=[t,n,a];r&&(o=[n,a,t]),i.apply(e,o)}).then(a,o)}},augment:function(e,t,n,r){var i,a;for(i in a=t.prototype)(r||void 0===e[i])&&(e[i]=a[i]);t.apply(e,n)},optionsOverride:function(e,t,n,r,i,a){r&&e[n]&&i.warn(n+" is deprecated, please use "+t+" instead"),e[t]&&e[n]&&i.warn(t+" overriding "+n),e[t]=e[t]||e[n]||a},str_utf8_length:function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},generateFakeSDP:function(e){if(e){var t=e.indexOf("o="),n=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,n)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},isFunction:function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},isDecimal:function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},createRandomToken:function(e,t){var n,r="";for(t=t||32,n=0;n<e;n++)r+=(Math.random()*t|0).toString(t);return r},newTag:function(){return e.Utils.createRandomToken(e.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},hostType:function(t){if(t)return-1!==(t=e.Grammar.parse(t,"host"))?t.host_type:void 0},normalizeTarget:function(t,n){var r,i,a,o;if(t){if(t instanceof e.URI)return t;if("string"===typeof t){switch((i=t.split("@")).length){case 1:if(!n)return;a=t,o=n;break;case 2:a=i[0],o=i[1];break;default:a=i.slice(0,i.length-1).join("@"),o=i[i.length-1]}return a=a.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(a)&&(a=a.replace(/[\-\.\(\)]/g,"")),t=e.C.SIP+":"+e.Utils.escapeUser(a)+"@"+o,(r=e.URI.parse(t))?r:void 0}}else;},escapeUser:function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(e){var t,n={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i="",a=r.length;for(t=0;t<a;t++)0!==t&&(i+="-"),i+=r[t].charAt(0).toUpperCase()+r[t].substring(1);return n[i]&&(i=n[i]),i},sipErrorCause:function(t){var n;for(n in e.C.SIP_ERROR_CAUSES)if(-1!==e.C.SIP_ERROR_CAUSES[n].indexOf(t))return e.C.causes[n];return e.C.causes.SIP_FAILURE_CODE},getReasonPhrase:function(t,n){return n||e.C.REASON_PHRASE[t]||""},getReasonHeaderValue:function(t,n){return"SIP ;cause="+t+' ;text="'+(n=e.Utils.getReasonPhrase(t,n))+'"'},getCancelReason:function(t,n){if(t&&t<200||t>699)throw new TypeError("Invalid status_code: "+t);if(t)return e.Utils.getReasonHeaderValue(t,n)},buildStatusLine:function(e,t){if(t=t||null,!(e=e||null)||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!==typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);return"SIP/2.0 "+e+" "+(t=n.getReasonPhrase(e,t))+"\r\n"},getRandomTestNetIP:function(){return"192.0.2."+(e=1,t=254,Math.floor(Math.random()*(t-e+1)+e));var e,t},calculateMD5:function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,i,a,o;return i=2147483648&e,a=2147483648&t,o=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(r=1073741824&t)?2147483648^o^i^a:n|r?1073741824&o?3221225472^o^i^a:1073741824^o^i^a:o^i^a}function r(e,r,i,a,o,s,c){return e=n(e,n(n(function(e,t,n){return e&t|~e&n}(r,i,a),o),c)),n(t(e,s),r)}function i(e,r,i,a,o,s,c){return e=n(e,n(n(function(e,t,n){return e&n|t&~n}(r,i,a),o),c)),n(t(e,s),r)}function a(e,r,i,a,o,s,c){return e=n(e,n(n(function(e,t,n){return e^t^n}(r,i,a),o),c)),n(t(e,s),r)}function o(e,r,i,a,o,s,c){return e=n(e,n(n(function(e,t,n){return t^(e|~n)}(r,i,a),o),c)),n(t(e,s),r)}function s(e){var t,n="",r="";for(t=0;t<=3;t++)n+=(r="0"+(e>>>8*t&255).toString(16)).substr(r.length-2,2);return n}var c,u,l,d,f,h,p,v,m,g;for(c=function(e){for(var t,n=e.length,r=n+8,i=16*((r-r%64)/64+1),a=Array(i-1),o=0,s=0;s<n;)o=s%4*8,a[t=(s-s%4)/4]=a[t]|e.charCodeAt(s)<<o,s++;return o=s%4*8,a[t=(s-s%4)/4]=a[t]|128<<o,a[i-2]=n<<3,a[i-1]=n>>>29,a}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}(e)),p=1732584193,v=4023233417,m=2562383102,g=271733878,u=0;u<c.length;u+=16)l=p,d=v,f=m,h=g,p=r(p,v,m,g,c[u+0],7,3614090360),g=r(g,p,v,m,c[u+1],12,3905402710),m=r(m,g,p,v,c[u+2],17,606105819),v=r(v,m,g,p,c[u+3],22,3250441966),p=r(p,v,m,g,c[u+4],7,4118548399),g=r(g,p,v,m,c[u+5],12,1200080426),m=r(m,g,p,v,c[u+6],17,2821735955),v=r(v,m,g,p,c[u+7],22,4249261313),p=r(p,v,m,g,c[u+8],7,1770035416),g=r(g,p,v,m,c[u+9],12,2336552879),m=r(m,g,p,v,c[u+10],17,4294925233),v=r(v,m,g,p,c[u+11],22,2304563134),p=r(p,v,m,g,c[u+12],7,1804603682),g=r(g,p,v,m,c[u+13],12,4254626195),m=r(m,g,p,v,c[u+14],17,2792965006),p=i(p,v=r(v,m,g,p,c[u+15],22,1236535329),m,g,c[u+1],5,4129170786),g=i(g,p,v,m,c[u+6],9,3225465664),m=i(m,g,p,v,c[u+11],14,643717713),v=i(v,m,g,p,c[u+0],20,3921069994),p=i(p,v,m,g,c[u+5],5,3593408605),g=i(g,p,v,m,c[u+10],9,38016083),m=i(m,g,p,v,c[u+15],14,3634488961),v=i(v,m,g,p,c[u+4],20,3889429448),p=i(p,v,m,g,c[u+9],5,568446438),g=i(g,p,v,m,c[u+14],9,3275163606),m=i(m,g,p,v,c[u+3],14,4107603335),v=i(v,m,g,p,c[u+8],20,1163531501),p=i(p,v,m,g,c[u+13],5,2850285829),g=i(g,p,v,m,c[u+2],9,4243563512),m=i(m,g,p,v,c[u+7],14,1735328473),p=a(p,v=i(v,m,g,p,c[u+12],20,2368359562),m,g,c[u+5],4,4294588738),g=a(g,p,v,m,c[u+8],11,2272392833),m=a(m,g,p,v,c[u+11],16,1839030562),v=a(v,m,g,p,c[u+14],23,4259657740),p=a(p,v,m,g,c[u+1],4,2763975236),g=a(g,p,v,m,c[u+4],11,1272893353),m=a(m,g,p,v,c[u+7],16,4139469664),v=a(v,m,g,p,c[u+10],23,3200236656),p=a(p,v,m,g,c[u+13],4,681279174),g=a(g,p,v,m,c[u+0],11,3936430074),m=a(m,g,p,v,c[u+3],16,3572445317),v=a(v,m,g,p,c[u+6],23,76029189),p=a(p,v,m,g,c[u+9],4,3654602809),g=a(g,p,v,m,c[u+12],11,3873151461),m=a(m,g,p,v,c[u+15],16,530742520),p=o(p,v=a(v,m,g,p,c[u+2],23,3299628645),m,g,c[u+0],6,4096336452),g=o(g,p,v,m,c[u+7],10,1126891415),m=o(m,g,p,v,c[u+14],15,2878612391),v=o(v,m,g,p,c[u+5],21,4237533241),p=o(p,v,m,g,c[u+12],6,1700485571),g=o(g,p,v,m,c[u+3],10,2399980690),m=o(m,g,p,v,c[u+10],15,4293915773),v=o(v,m,g,p,c[u+1],21,2240044497),p=o(p,v,m,g,c[u+8],6,1873313359),g=o(g,p,v,m,c[u+15],10,4264355552),m=o(m,g,p,v,c[u+6],15,2734768916),v=o(v,m,g,p,c[u+13],21,1309151649),p=o(p,v,m,g,c[u+4],6,4149444226),g=o(g,p,v,m,c[u+11],10,3174756917),m=o(m,g,p,v,c[u+2],15,718787259),v=o(v,m,g,p,c[u+9],21,3951481745),p=n(p,l),v=n(v,d),m=n(m,f),g=n(g,h);return(s(p)+s(v)+s(m)+s(g)).toLowerCase()}},e.Utils=n}},function(e,t,n){"use strict";var r={error:0,warn:1,log:2,debug:3};e.exports=function(e){var t=function(){var e,t=2,n=!0,i=null;this.loggers={},e=this.getLogger("sip.loggerfactory"),Object.defineProperties(this,{builtinEnabled:{get:function(){return n},set:function(t){"boolean"===typeof t?n=t:e.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(t))}},level:{get:function(){return t},set:function(n){n>=0&&n<=3?t=n:n>3?t=3:r.hasOwnProperty(n)?t=r[n]:e.error('invalid "level" parameter value: '+JSON.stringify(n))}},connector:{get:function(){return i},set:function(t){null===t||""===t||void 0===t?i=null:"function"===typeof t?i=t:e.error('invalid "connector" parameter value: '+JSON.stringify(t))}}})};function n(e,t,n){this.logger=e,this.category=t,this.label=n}return t.prototype.print=function(t,n,r,i){if("string"===typeof i){var a=[new Date,n];r&&a.push(r),i=a.concat(i).join(" | ")}t.call(e,i)},Object.keys(r).forEach(function(i){n.prototype[i]=function(e){this.logger[i](this.category,this.label,e)},t.prototype[i]=function(t,n,a){this.level>=r[i]&&(this.builtinEnabled&&this.print(e[i],t,n,a),this.connector&&this.connector(i,t,n,a))}}),t.prototype.getLogger=function(e,t){var r;return t&&3===this.level?new n(this,e,t):this.loggers[e]?this.loggers[e]:(r=new n(this,e),this.loggers[e]=r,r)},t}},function(e,t,n){"use strict";var r=n(169).EventEmitter;e.exports=function(e){function t(){r.call(this)}return t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t.prototype.off=function(t,n){return"SIP.EventEmitter#off is deprecated and may be removed in future SIP.js versions.\n","Please use removeListener or removeAllListeners instead.\n","See here for more details:\n","http://nodejs.org/api/events.html#events_emitter_removelistener_event_listener",e.warn("SIP.EventEmitter#off is deprecated and may be removed in future SIP.js versions.\nPlease use removeListener or removeAllListeners instead.\nSee here for more details:\nhttp://nodejs.org/api/events.html#events_emitter_removelistener_event_listener"),arguments.length<2?this.removeAllListeners.apply(this,arguments):this.removeListener(t,n)},t}},function(e,t,n){"use strict";e.exports=function(e,t){return{USER_AGENT:e+"/"+t,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",NO_PRACK:"No PRACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},supported:{UNSUPPORTED:"none",SUPPORTED:"supported",REQUIRED:"required"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REFER:"REFER",PRACK:"PRACK",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},OPTION_TAGS:{"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0}}}},function(e,t,n){"use strict";e.exports={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),GetDescriptionError:function(){var e=function(e){this.code=4,this.name="GET_DESCRIPTION_ERROR",this.message=e};return e.prototype=new Error,e}()}},function(e,t,n){"use strict";var r=500;e.exports=function(e){var t={T1:r,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};return["setTimeout","clearTimeout","setInterval","clearInterval"].forEach(function(n){t[n]=function(){return e[n].apply(e,arguments)}}),t}},function(e,t,n){"use strict";e.exports=function(e){var t;function n(e,t){var n=t,r=0,i=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===r;){if(-1===(i=e.indexOf("\r\n",n)))return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?n=i+2:r=i}return r}function r(t,n,r,i){var a,o,s,c,u=n.indexOf(":",r),l=n.substring(r,u).trim(),d=n.substring(u+1,i).trim();switch(l.toLowerCase()){case"via":case"v":t.addHeader("via",d),1===t.getHeaders("via").length?(c=t.parseHeader("Via"))&&(t.via=c,t.via_branch=c.branch):c=0;break;case"from":case"f":t.setHeader("from",d),(c=t.parseHeader("from"))&&(t.from=c,t.from_tag=c.getParam("tag"));break;case"to":case"t":t.setHeader("to",d),(c=t.parseHeader("to"))&&(t.to=c,t.to_tag=c.getParam("tag"));break;case"record-route":if(-1===(c=e.Grammar.parse(d,"Record_Route"))){c=void 0;break}for(s=c.length,o=0;o<s;o++)a=c[o],t.addHeader("record-route",d.substring(a.position,a.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=a.parsed;break;case"call-id":case"i":t.setHeader("call-id",d),(c=t.parseHeader("call-id"))&&(t.call_id=d);break;case"contact":case"m":if(-1===(c=e.Grammar.parse(d,"Contact"))){c=void 0;break}for(s=c.length,o=0;o<s;o++)a=c[o],t.addHeader("contact",d.substring(a.position,a.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=a.parsed;break;case"content-length":case"l":t.setHeader("content-length",d),c=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",d),c=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",d),(c=t.parseHeader("cseq"))&&(t.cseq=c.value),t instanceof e.IncomingResponse&&(t.method=c.method);break;case"max-forwards":t.setHeader("max-forwards",d),c=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",d),c=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",d),c=t.parseHeader("proxy-authenticate");break;case"refer-to":case"r":t.setHeader("refer-to",d),(c=t.parseHeader("refer-to"))&&(t.refer_to=c);break;default:t.setHeader(l,d),c=0}return void 0!==c||{error:'error parsing header "'+l+'"'}}(t={}).parseMessage=function(t,i){var a,o,s,c,u,l=0,d=t.indexOf("\r\n"),f=i.getLogger("sip.parser");if(-1!==d){if(o=t.substring(0,d),-1!==(u=e.Grammar.parse(o,"Request_Response"))){for(u.status_code?((a=new e.IncomingResponse(i)).status_code=u.status_code,a.reason_phrase=u.reason_phrase):((a=new e.IncomingRequest(i)).method=u.method,a.ruri=u.uri),a.data=t,l=d+2;;){if(-2===(d=n(t,l))){c=l+2;break}if(-1===d)return void f.error("malformed message");if(!0!==(u=r(a,t,l,d)))return void f.error(u.error);l=d+2}return a.hasHeader("content-length")?(s=a.getHeader("content-length"),a.body=t.substr(c,s)):a.body=t.substring(c),a}f.warn('error parsing first line of SIP message: "'+o+'"')}else f.warn("no CRLF found, not a SIP message, discarded")},e.Parser=t}},function(e,t,n){"use strict";e.exports=function(e){var t,n,r,i;function a(t){var n=t.ua.configuration.hackAllowUnregisteredOptionTags,r=[],i={};return t.method===e.C.REGISTER?r.push("path","gruu"):t.method===e.C.INVITE&&(t.ua.contact.pub_gruu||t.ua.contact.temp_gruu)&&r.push("gruu"),t.ua.configuration.rel100===e.C.supported.SUPPORTED&&r.push("100rel"),t.ua.configuration.replaces===e.C.supported.SUPPORTED&&r.push("replaces"),r.push("outbound"),"Supported: "+(r=(r=r.concat(t.ua.configuration.extraSupported)).filter(function(t){var r=e.C.OPTION_TAGS[t],a=!i[t];return i[t]=!0,(r||n)&&a})).join(", ")+"\r\n"}(t=function(t,n,r,i,a,o){var s,c,u,l,d,f;if(i=i||{},!t||!n||!r)return null;this.logger=r.getLogger("sip.sipmessage"),this.ua=r,this.headers={},this.method=t,this.ruri=n,this.body=o,this.extraHeaders=(a||[]).slice(),this.statusCode=i.status_code,this.reasonPhrase=i.reason_phrase,i.route_set?this.setHeader("route",i.route_set):r.configuration.usePreloadedRoute&&this.setHeader("route",r.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",e.UA.C.MAX_FORWARDS),d=i.to_uri||n,s=i.to_displayName||0===i.to_displayName?'"'+i.to_displayName+'" ':"",s+="<"+(d&&d.toRaw?d.toRaw():d)+">",s+=i.to_tag?";tag="+i.to_tag:"",this.to=new e.NameAddrHeader.parse(s),this.setHeader("to",s),f=i.from_uri||r.configuration.uri,c=i.from_displayName||0===i.from_displayName?'"'+i.from_displayName+'" ':r.configuration.displayName?'"'+r.configuration.displayName+'" ':"",c+="<"+(f&&f.toRaw?f.toRaw():f)+">;tag=",c+=i.from_tag||e.Utils.newTag(),this.from=new e.NameAddrHeader.parse(c),this.setHeader("from",c),u=i.call_id||r.configuration.sipjsId+e.Utils.createRandomToken(15),this.call_id=u,this.setHeader("call-id",u),l=i.cseq||Math.floor(1e4*Math.random()),this.cseq=l,this.setHeader("cseq",l+" "+t)}).prototype={setHeader:function(t,n){this.headers[e.Utils.headerize(t)]=n instanceof Array?n:[n]},getHeader:function(t){var n,r,i=this.extraHeaders.length,a=this.headers[e.Utils.headerize(t)];if(a){if(a[0])return a[0]}else for(n=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<i;r++)if(a=this.extraHeaders[r],n.test(a))return a.substring(a.indexOf(":")+1).trim()},getHeaders:function(t){var n,r,i,a=this.headers[e.Utils.headerize(t)],o=[];if(a){for(r=a.length,n=0;n<r;n++)o.push(a[n]);return o}for(r=this.extraHeaders.length,i=new RegExp("^\\s*"+t+"\\s*:","i"),n=0;n<r;n++)a=this.extraHeaders[n],i.test(a)&&o.push(a.substring(a.indexOf(":")+1).trim());return o},hasHeader:function(t){var n,r,i=this.extraHeaders.length;if(this.headers[e.Utils.headerize(t)])return!0;for(n=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<i;r++)if(n.test(this.extraHeaders[r]))return!0;return!1},toString:function(){var t,n,r,i="";for(t in i+=this.method+" "+(this.ruri.toRaw?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n",this.headers)for(n=this.headers[t].length,r=0;r<n;r++)i+=t+": "+this.headers[t][r]+"\r\n";for(n=this.extraHeaders.length,r=0;r<n;r++)i+=this.extraHeaders[r].trim()+"\r\n";return i+=a(this),i+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"===typeof this.body?(i+="Content-Length: "+(n=e.Utils.str_utf8_length(this.body))+"\r\n\r\n",i+=this.body):this.body.body&&this.body.contentType?(n=e.Utils.str_utf8_length(this.body.body),i+="Content-Type: "+this.body.contentType+"\r\n",i+="Content-Length: "+n+"\r\n\r\n",i+=this.body.body):i+="Content-Length: 0\r\n\r\n":i+="Content-Length: 0\r\n\r\n",i}},(n=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null}).prototype={addHeader:function(t,n){var r={raw:n};t=e.Utils.headerize(t),this.headers[t]?this.headers[t].push(r):this.headers[t]=[r]},getHeader:function(t){var n=this.headers[e.Utils.headerize(t)];if(n)return n[0]?n[0].raw:void 0},getHeaders:function(t){var n,r,i=this.headers[e.Utils.headerize(t)],a=[];if(!i)return[];for(r=i.length,n=0;n<r;n++)a.push(i[n].raw);return a},hasHeader:function(t){return!!this.headers[e.Utils.headerize(t)]},parseHeader:function(t,n){var r,i,a;if(t=e.Utils.headerize(t),n=n||0,this.headers[t]){if(!(n>=this.headers[t].length))return i=(r=this.headers[t][n]).raw,r.parsed?r.parsed:-1===(a=e.Grammar.parse(i,t.replace(/-/g,"_")))?(this.headers[t].splice(n,1),void this.logger.warn('error parsing "'+t+'" header field with value "'+i+'"')):(r.parsed=a,a);this.logger.log('not so many "'+t+'" headers present')}else this.logger.log('header "'+t+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(t,n){var r={raw:n};this.headers[e.Utils.headerize(t)]=[r]},toString:function(){return this.data}},((r=function(e){this.logger=e.getLogger("sip.sipmessage"),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}).prototype=new n).reply=function(t,n,r,i,o,s){var c,u,l,d,f,h=this.getHeader("To"),p=0,v=0;if(f=e.Utils.buildStatusLine(t,n),r=(r||[]).slice(),this.method===e.C.INVITE&&t>100&&t<=200)for(l=(c=this.getHeaders("record-route")).length;p<l;p++)f+="Record-Route: "+c[p]+"\r\n";for(l=(u=this.getHeaders("via")).length;v<l;v++)f+="Via: "+u[v]+"\r\n";for(!this.to_tag&&t>100?h+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(h+=";tag="+this.to_tag),f+="To: "+h+"\r\n",f+="From: "+this.getHeader("From")+"\r\n",f+="Call-ID: "+this.call_id+"\r\n",f+="CSeq: "+this.cseq+" "+this.method+"\r\n",l=r.length,d=0;d<l;d++)f+=r[d].trim()+"\r\n";return f+=a(this),f+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",i?"string"===typeof i?(f+="Content-Type: application/sdp\r\n",f+="Content-Length: "+(l=e.Utils.str_utf8_length(i))+"\r\n\r\n",f+=i):i.body&&i.contentType?(l=e.Utils.str_utf8_length(i.body),f+="Content-Type: "+i.contentType+"\r\n",f+="Content-Length: "+l+"\r\n\r\n",f+=i.body):f+="Content-Length: 0\r\n\r\n":f+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(t,f).then(o,s),f},r.prototype.reply_sl=function(t,n){var r,i,a=0,o=this.getHeaders("via"),s=o.length;for(i=e.Utils.buildStatusLine(t,n);a<s;a++)i+="Via: "+o[a]+"\r\n";r=this.getHeader("To"),!this.to_tag&&t>100?r+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(r+=";tag="+this.to_tag),i+="To: "+r+"\r\n",i+="From: "+this.getHeader("From")+"\r\n",i+="Call-ID: "+this.call_id+"\r\n",i+="CSeq: "+this.cseq+" "+this.method+"\r\n",i+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",i+="Content-Length: 0\r\n\r\n",this.transport.send(i)},(i=function(e){this.logger=e.getLogger("sip.sipmessage"),this.headers={},this.status_code=null,this.reason_phrase=null}).prototype=new n,e.OutgoingRequest=t,e.IncomingRequest=r,e.IncomingResponse=i}},function(e,t,n){"use strict";e.exports=function(e){var t;(t=function(t,n,r,i,a,o){var s,c,u,l;if(!r)throw new TypeError('missing or invalid "host" parameter');for(s in t=t||e.C.SIP,this.parameters={},this.headers={},a)this.setParam(s,a[s]);for(c in o)this.setHeader(c,o[c]);u={scheme:t,user:n,host:r,port:i},l={scheme:t.toLowerCase(),user:n,host:r.toLowerCase(),port:i},Object.defineProperties(this,{_normal:{get:function(){return l}},_raw:{get:function(){return u}},scheme:{get:function(){return l.scheme},set:function(e){u.scheme=e,l.scheme=e.toLowerCase()}},user:{get:function(){return l.user},set:function(e){l.user=u.user=e}},host:{get:function(){return l.host},set:function(e){u.host=e,l.host=e.toLowerCase()}},aor:{get:function(){return l.user+"@"+l.host}},port:{get:function(){return l.port},set:function(e){l.port=u.port=0===e?e:parseInt(e,10)||null}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]="undefined"===typeof t||null===t?null:t.toString().toLowerCase())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return!!this.parameters.hasOwnProperty(e.toLowerCase())},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(t,n){this.headers[e.Utils.headerize(t)]=n instanceof Array?n:[n]},getHeader:function(t){if(t)return this.headers[e.Utils.headerize(t)]},hasHeader:function(t){if(t)return!!this.headers.hasOwnProperty(e.Utils.headerize(t))},deleteHeader:function(t){var n;if(t=e.Utils.headerize(t),this.headers.hasOwnProperty(t))return n=this.headers[t],delete this.headers[t],n},clearHeaders:function(){this.headers={}},clone:function(){return new t(this._raw.scheme,this._raw.user,this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toRaw:function(){return this._toString(this._raw)},toString:function(){return this._toString(this._normal)},_toString:function(t){var n,r,i,a,o=[];for(r in a=t.scheme+":",t.scheme.toLowerCase().match("^sips?$")||(a+="//"),t.user&&(a+=e.Utils.escapeUser(t.user)+"@"),a+=t.host,(t.port||0===t.port)&&(a+=":"+t.port),this.parameters)a+=";"+r,null!==this.parameters[r]&&(a+="="+this.parameters[r]);for(n in this.headers)for(i in this.headers[n])o.push(n+"="+this.headers[n][i]);return o.length>0&&(a+="?"+o.join("&")),a}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"SIP_URI"))?t:void 0},e.URI=t}},function(e,t,n){"use strict";e.exports=function(e){var t;(t=function(t,n,r){var i;if(!t||!(t instanceof e.URI))throw new TypeError('missing or invalid "uri" parameter');for(i in this.uri=t,this.parameters={},r)this.setParam(i,r[i]);Object.defineProperties(this,{friendlyName:{get:function(){return this.displayName||t.aor}},displayName:{get:function(){return n},set:function(e){n=0===e?"0":e}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]="undefined"===typeof t||null===t?null:t.toString())},getParam:e.URI.prototype.getParam,hasParam:e.URI.prototype.hasParam,deleteParam:e.URI.prototype.deleteParam,clearParams:e.URI.prototype.clearParams,clone:function(){return new t(this.uri.clone(),this.displayName,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;for(t in e=this.displayName||0===this.displayName?'"'+this.displayName+'" ':"",e+="<"+this.uri.toString()+">",this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"Name_Addr_Header"))?t:void 0},e.NameAddrHeader=t}},function(e,t,n){"use strict";e.exports=function(e){var t={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};function n(e,t,n){var r;return r="SIP/2.0/"+(e.ua.configuration.hackViaTcp?"TCP":t.server.scheme),r+=" "+e.ua.configuration.viaHost+";branch="+n,e.ua.configuration.forceRport&&(r+=";rport"),r}var r=function(e,r,i){var a;this.type=t.NON_INVITE_CLIENT,this.transport=i,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=r,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),a=n(e,i,this.id),this.request.setHeader("via",a),this.request_sender.ua.newTransaction(this)};(r.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},r.prototype.send=function(){this.stateChanged(t.STATUS_TRYING),this.F=e.Timers.setTimeout(this.timer_F.bind(this),e.Timers.TIMER_F),this.transport.send(this.request)||this.onTransportError()},r.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id),e.Timers.clearTimeout(this.F),e.Timers.clearTimeout(this.K),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},r.prototype.timer_F=function(){this.logger.log("Timer F expired for non-INVITE client transaction "+this.id),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},r.prototype.timer_K=function(){this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},r.prototype.receiveResponse=function(n){var r=n.status_code;if(r<200)switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_PROCEEDING),this.request_sender.receiveResponse(n)}else switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),e.Timers.clearTimeout(this.F),408===r?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(n),this.K=e.Timers.setTimeout(this.timer_K.bind(this),e.Timers.TIMER_K)}};var i=function(e,r,i){var a,o=this;this.type=t.INVITE_CLIENT,this.transport=i,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=r,this.logger=e.ua.getLogger("sip.transaction.ict",this.id),a=n(e,i,this.id),this.request.setHeader("via",a),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e,t){for(var n=(t=(t||[]).slice()).length,r=null,i=0;i<n;i++)r=(r||"")+t[i].trim()+"\r\n";o.cancel_request(o,e,r)}};(i.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},i.prototype.send=function(){this.stateChanged(t.STATUS_CALLING),this.B=e.Timers.setTimeout(this.timer_B.bind(this),e.Timers.TIMER_B),this.transport.send(this.request)||this.onTransportError()},i.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),e.Timers.clearTimeout(this.D),e.Timers.clearTimeout(this.M),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.state!==t.STATUS_ACCEPTED&&this.request_sender.onTransportError()},i.prototype.timer_M=function(){this.logger.log("Timer M expired for INVITE client transaction "+this.id),this.state===t.STATUS_ACCEPTED&&(e.Timers.clearTimeout(this.B),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},i.prototype.timer_B=function(){this.logger.log("Timer B expired for INVITE client transaction "+this.id),this.state===t.STATUS_CALLING&&(this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},i.prototype.timer_D=function(){this.logger.log("Timer D expired for INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.sendACK=function(t){this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+t.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="Content-Length: 0\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n\r\n",this.D=e.Timers.setTimeout(this.timer_D.bind(this),e.Timers.TIMER_D),this.transport.send(this.ack)},i.prototype.cancel_request=function(n,r,i){var a=n.request;this.cancel=e.C.CANCEL+" "+a.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+a.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+a.headers.Route.toString()+"\r\n"),this.cancel+="To: "+a.headers.To.toString()+"\r\n",this.cancel+="From: "+a.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+a.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+a.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",r&&(this.cancel+="Reason: "+r+"\r\n"),i&&(this.cancel+=i),this.cancel+="Content-Length: 0\r\n\r\n",this.state===t.STATUS_PROCEEDING&&this.transport.send(this.cancel)},i.prototype.receiveResponse=function(n){var r=n.status_code;if(r>=100&&r<=199)switch(this.state){case t.STATUS_CALLING:this.stateChanged(t.STATUS_PROCEEDING),this.request_sender.receiveResponse(n),this.cancel&&this.transport.send(this.cancel);break;case t.STATUS_PROCEEDING:this.request_sender.receiveResponse(n)}else if(r>=200&&r<=299)switch(this.state){case t.STATUS_CALLING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_ACCEPTED),this.M=e.Timers.setTimeout(this.timer_M.bind(this),e.Timers.TIMER_M),this.request_sender.receiveResponse(n);break;case t.STATUS_ACCEPTED:this.request_sender.receiveResponse(n)}else if(r>=300&&r<=699)switch(this.state){case t.STATUS_CALLING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),this.sendACK(n),this.request_sender.receiveResponse(n);break;case t.STATUS_COMPLETED:this.sendACK(n)}};var a=function(e,t,r){var i;this.transport=r,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),i=n(e,r,this.id),this.request.setHeader("via",i)};(a.prototype=Object.create(e.EventEmitter.prototype)).send=function(){this.transport.send(this.request)||this.onTransportError()},a.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id),this.request_sender.onTransportError()};var o=function(e,n){this.type=t.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=n,this.last_response="",e.server_transaction=this,this.logger=n.getLogger("sip.transaction.nist",this.id),this.state=t.STATUS_TRYING,n.newTransaction(this)};(o.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},o.prototype.timer_J=function(){this.logger.log("Timer J expired for non-INVITE server transaction "+this.id),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},o.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),e.Timers.clearTimeout(this.J),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.receiveResponse=function(n,r){var i=e.Utils.defer();if(100===n)switch(this.state){case t.STATUS_TRYING:this.stateChanged(t.STATUS_PROCEEDING),this.transport.send(r)||this.onTransportError();break;case t.STATUS_PROCEEDING:this.last_response=r,this.transport.send(r)?i.resolve():(this.onTransportError(),i.reject())}else if(n>=200&&n<=699)switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),this.last_response=r,this.J=e.Timers.setTimeout(this.timer_J.bind(this),e.Timers.TIMER_J),this.transport.send(r)?i.resolve():(this.onTransportError(),i.reject())}return i.promise};var s=function(e,n){this.type=t.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=n,this.last_response="",e.server_transaction=this,this.logger=n.getLogger("sip.transaction.ist",this.id),this.state=t.STATUS_PROCEEDING,n.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100)};(s.prototype=Object.create(e.EventEmitter.prototype)).stateChanged=function(e){this.state=e,this.emit("stateChanged")},s.prototype.timer_H=function(){this.logger.log("Timer H expired for INVITE server transaction "+this.id),this.state===t.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},s.prototype.timer_I=function(){this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},s.prototype.timer_L=function(){this.logger.log("Timer L expired for INVITE server transaction "+this.id),this.state===t.STATUS_ACCEPTED&&(this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},s.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+this.id),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),e.Timers.clearTimeout(this.L),e.Timers.clearTimeout(this.H),e.Timers.clearTimeout(this.I),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},s.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},s.prototype.receiveResponse=function(n,r){var i=this,a=e.Utils.defer();if(n>=100&&n<=199)switch(this.state){case t.STATUS_PROCEEDING:this.transport.send(r)||this.onTransportError(),this.last_response=r}if(n>100&&n<=199&&this.state===t.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=e.Timers.setInterval(i.resend_provisional.bind(i),e.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(n>=200&&n<=299)switch(this.state){case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_ACCEPTED),this.last_response=r,this.L=e.Timers.setTimeout(i.timer_L.bind(i),e.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case t.STATUS_ACCEPTED:this.transport.send(r)?a.resolve():(this.onTransportError(),a.reject())}else if(n>=300&&n<=699)switch(this.state){case t.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(r)?(this.stateChanged(t.STATUS_COMPLETED),this.H=e.Timers.setTimeout(i.timer_H.bind(i),e.Timers.TIMER_H),a.resolve()):(this.onTransportError(),a.reject())}return a.promise};e.Transactions={C:t,checkTransaction:function(n,r){var i;switch(r.method){case e.C.INVITE:if(i=n.transactions.ist[r.via_branch]){switch(i.state){case t.STATUS_PROCEEDING:i.transport.send(i.last_response)}return!0}break;case e.C.ACK:if(!(i=n.transactions.ist[r.via_branch]))return!1;if(i.state===t.STATUS_ACCEPTED)return!1;if(i.state===t.STATUS_COMPLETED)return i.stateChanged(t.STATUS_CONFIRMED),i.I=e.Timers.setTimeout(i.timer_I.bind(i),e.Timers.TIMER_I),!0;break;case e.C.CANCEL:return(i=n.transactions.ist[r.via_branch])?(r.reply_sl(200),i.state!==t.STATUS_PROCEEDING):(r.reply_sl(481),!0);default:if(i=n.transactions.nist[r.via_branch]){switch(i.state){case t.STATUS_TRYING:break;case t.STATUS_PROCEEDING:case t.STATUS_COMPLETED:i.transport.send(i.last_response)}return!0}}},NonInviteClientTransaction:r,InviteClientTransaction:i,AckClientTransaction:a,NonInviteServerTransaction:o,InviteServerTransaction:s}}},function(e,t,n){"use strict";e.exports=function(e){var t,r=n(1608)(e),i={STATUS_EARLY:1,STATUS_CONFIRMED:2};(t=function(t,n,r,a){var o;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!n.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};a=n instanceof e.IncomingResponse?n.status_code<200?i.STATUS_EARLY:i.STATUS_CONFIRMED:a||i.STATUS_CONFIRMED,o=n.parseHeader("contact"),"UAS"===r?(this.id={call_id:n.call_id,local_tag:n.to_tag,remote_tag:n.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=a,this.remote_seqnum=n.cseq,this.local_uri=n.parseHeader("to").uri,this.remote_uri=n.parseHeader("from").uri,this.remote_target=o.uri,this.route_set=n.getHeaders("record-route"),this.invite_seqnum=n.cseq,this.local_seqnum=n.cseq):"UAC"===r&&(this.id={call_id:n.call_id,local_tag:n.from_tag,remote_tag:n.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=a,this.invite_seqnum=n.cseq,this.local_seqnum=n.cseq,this.local_uri=n.parseHeader("from").uri,this.pracked=[],this.remote_uri=n.parseHeader("to").uri,this.remote_target=o.uri,this.route_set=n.getHeaders("record-route").reverse(),this.state!==i.STATUS_EARLY||t.hasOffer||(this.mediaHandler=t.mediaHandlerFactory(t))),this.logger=t.ua.getLogger("sip.dialog",this.id.toString()),this.owner=t,t.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+r+" dialog created with status "+(this.state===i.STATUS_EARLY?"EARLY":"CONFIRMED")),t.emit("dialog",this)}).prototype={update:function(e,t){this.state=i.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted"),this.mediaHandler&&this.state!==i.STATUS_CONFIRMED&&this.mediaHandler.peerConnection.close(),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(t,n,r){var i,a;return n=(n||[]).slice(),this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),i=t===e.C.CANCEL||t===e.C.ACK?this.invite_seqnum:this.local_seqnum+=1,(a=new e.OutgoingRequest(t,this.remote_target,this.owner.ua,{cseq:i,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},n,r)).dialog=this,a},checkInDialogRequest:function(t){var n=this;if(this.remote_seqnum){if(t.cseq<this.remote_seqnum)return t.method!==e.C.ACK&&t.reply(500),t.cseq===this.invite_seqnum;t.cseq>this.remote_seqnum&&(this.remote_seqnum=t.cseq)}else this.remote_seqnum=t.cseq;switch(t.method){case e.C.INVITE:if(!0===this.uac_pending_reply)t.reply(491);else{if(!0===this.uas_pending_reply){var r=1+(10*Math.random()|0);return t.reply(500,null,["Retry-After:"+r]),!1}this.uas_pending_reply=!0,t.server_transaction.on("stateChanged",function t(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",t),n.uas_pending_reply=!1,!1===n.uac_pending_reply&&n.owner.onReadyToReinvite())})}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_ACCEPTED&&(n.remote_target=t.parseHeader("contact").uri)});break;case e.C.NOTIFY:t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_COMPLETED&&(n.remote_target=t.parseHeader("contact").uri)})}return!0},sendRequest:function(e,t,n){var i=((n=n||{}).extraHeaders||[]).slice(),a=null;n.body&&(n.body.body?a=n.body:((a={}).body=n.body,n.contentType&&(a.contentType=n.contentType)));var o=this.createRequest(t,i,a);return new r(this,e,o).send(),o},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}},t.C=i,e.Dialog=t}},function(e,t,n){"use strict";e.exports=function(e){var t;return(t=function(e,t,n){this.dialog=e,this.applicant=t,this.request=n,this.reattempt=!1,this.reattemptTimer=null}).prototype={send:function(){var t=this,n=new e.RequestSender(this,this.dialog.owner.ua);n.send(),this.request.method===e.C.INVITE&&n.clientTransaction.state!==e.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,n.clientTransaction.on("stateChanged",function n(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",n),t.dialog.uac_pending_reply=!1,!1===t.dialog.uas_pending_reply&&t.dialog.owner.onReadyToReinvite())}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var n=this;408===t.status_code||481===t.status_code?this.applicant.onDialogError(t):t.method===e.C.INVITE&&491===t.status_code?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=e.Timers.setTimeout(function(){n.applicant.owner.status!==e.Session.C.STATUS_TERMINATED&&(n.reattempt=!0,n.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(t)}},t}},function(e,t,n){"use strict";e.exports=function(e){var t;(t=function(t,n){this.logger=n.getLogger("sip.requestsender"),this.ua=n,this.applicant=t,this.method=t.request.method,this.request=t.request,this.credentials=null,this.challenged=!1,this.staled=!1,n.status!==e.UA.C.STATUS_USER_CLOSED||this.method===e.C.BYE&&this.method===e.C.ACK||this.onTransportError()}).prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new e.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new e.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new e.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}return this.clientTransaction.send(),this.clientTransaction},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var n,r,i,a=t.status_code;if(401===a||407===a){if(401===t.status_code?(r=t.parseHeader("www-authenticate"),i="authorization"):(r=t.parseHeader("proxy-authenticate"),i="proxy-authorization"),!r)return this.logger.warn(t.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(t);if(!this.challenged||!this.staled&&!0===r.stale){if(this.credentials||(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),!this.credentials.authenticate(this.request,r))return void this.applicant.receiveResponse(t);this.challenged=!0,r.stale&&(this.staled=!0),t.method===e.C.REGISTER?n=this.applicant.cseq+=1:this.request.dialog?n=this.request.dialog.local_seqnum+=1:(n=this.request.cseq+1,this.request.cseq=n),this.request.setHeader("cseq",n+" "+this.method),this.request.setHeader(i,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(t)}else this.applicant.receiveResponse(t)}},e.RequestSender=t}},function(e,t,n){"use strict";e.exports=function(e){var t;(t=function(t){var n={};this.registrar=t.configuration.registrarServer,this.expires=t.configuration.registerExpires,this.contact=t.contact.toString(),this.contact+=";reg-id=1",this.contact+=';+sip.instance="<urn:uuid:'+t.configuration.instanceId+'>"',this.call_id=e.Utils.createRandomToken(22),this.cseq=80,this.to_uri=t.configuration.uri,n.to_uri=this.to_uri,n.to_displayName=t.configuration.displayName,n.call_id=this.call_id,n.cseq=this.cseq,e.Utils.augment(this,e.ClientContext,[t,"REGISTER",this.registrar,{params:n}]),this.registrationTimer=null,this.registrationExpiredTimer=null,this.registered=!1,this.logger=t.getLogger("sip.registercontext")}).prototype={register:function(t){var n,r=this;this.options=t||{},(n=(this.options.extraHeaders||[]).slice()).push("Contact: "+this.contact+";expires="+this.expires),n.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(t){var n,i,a,o=t.getHeaders("contact").length;if(t.cseq===this.cseq)switch(null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.emit("accepted",t),t.hasHeader("expires")&&(i=t.getHeader("expires")),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),!o){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(;o--;){if((n=t.parseHeader("contact",o)).uri.user===this.ua.contact.uri.user){i=n.getParam("expires");break}n=null}if(!n){this.logger.warn("no Contact header pointing to us, response ignored");break}i||(i=this.expires),this.registrationTimer=e.Timers.setTimeout(function(){r.registrationTimer=null,r.register(r.options)},1e3*i-3e3),this.registrationExpiredTimer=e.Timers.setTimeout(function(){r.logger.warn("registration expired"),r.registered&&r.unregistered(null,e.C.causes.EXPIRES)},1e3*i),n.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=e.URI.parse(n.getParam("temp-gruu").replace(/"/g,""))),n.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=e.URI.parse(n.getParam("pub-gruu").replace(/"/g,""))),this.registered=!0,this.emit("registered",t||null);break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(this.expires=t.getHeader("min-expires"),this.register(this.options)):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,e.C.causes.SIP_FAILURE_CODE));break;default:a=e.Utils.sipErrorCause(t.status_code),this.registrationFailure(t,a)}},this.onRequestTimeout=function(){this.registrationFailure(null,e.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,e.C.causes.CONNECTION_ERROR)},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=n,this.send()},registrationFailure:function(e,t){this.emit("failed",e||null,t||null)},onTransportClosed:function(){this.registered_before=this.registered,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.registered&&this.unregistered(null,e.C.causes.CONNECTION_ERROR)},onTransportConnected:function(){this.register(this.options)},close:function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registered_before=this.registered,this.unregister(e)},unregister:function(t){var n;t=t||{},this.registered||t.all?(n=(t.extraHeaders||[]).slice(),this.registered=!1,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),t.all?(n.push("Contact: *"),n.push("Expires: 0")):n.push("Contact: "+this.contact+";expires=0"),this.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",t),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.unregistered(t);break;default:n=e.Utils.sipErrorCause(t.status_code),this.unregistered(t,n)}},this.onRequestTimeout=function(){},this.onTransportError=function(){},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=n,this.send()):this.logger.warn("already unregistered")},unregistered:function(e,t){this.registered=!1,this.emit("unregistered",e||null,t||null)}},e.RegisterContext=t}},function(e,t,n){"use strict";e.exports=function(e){var t=function(e,t){e=e,t=t};return t.prototype=Object.create(e.prototype,{isReady:{value:function(){}},close:{value:function(){}},getDescription:{value:function(e){e=e}},hasDescription:{value:function(e){e=e}},setDescription:{value:function(e){e=e}}}),t}},function(e,t,n){"use strict";e.exports=function(e){var t;((t=function(t,n,r,i){var a=r;if(void 0===r)throw new TypeError("Not enough arguments");if(this.ua=t,this.logger=t.getLogger("sip.clientcontext"),this.method=n,!(r=t.normalizeTarget(r)))throw new TypeError("Invalid target: "+a);(i=Object.create(i||Object.prototype)).extraHeaders=(i.extraHeaders||[]).slice(),this.request=new e.OutgoingRequest(this.method,r,this.ua,i.params,i.extraHeaders),i.body&&(this.body={},this.body.body=i.body,i.contentType&&(this.body.contentType=i.contentType),this.request.body=this.body),this.localIdentity=this.request.from,this.remoteIdentity=this.request.to,this.data={}}).prototype=Object.create(e.EventEmitter.prototype)).send=function(){return new e.RequestSender(this,this.ua).send(),this},t.prototype.cancel=function(t){(t=t||{}).extraHeaders=(t.extraHeaders||[]).slice();var n=e.Utils.getCancelReason(t.status_code,t.reason_phrase);this.request.cancel(n,t.extraHeaders),this.emit("cancel")},t.prototype.receiveResponse=function(t){var n=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,n);break;case/^2[0-9]{2}$/.test(t.status_code):this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("accepted",t,n);break;default:this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("rejected",t,n),this.emit("failed",t,n)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ClientContext=t}},function(e,t,n){"use strict";e.exports=function(e){var t;((t=function(t,n){this.ua=t,this.logger=t.getLogger("sip.servercontext"),this.request=n,n.method===e.C.INVITE?this.transaction=new e.Transactions.InviteServerTransaction(n,t):this.transaction=new e.Transactions.NonInviteServerTransaction(n,t),n.body&&(this.body=n.body),n.hasHeader("Content-Type")&&(this.contentType=n.getHeader("Content-Type")),this.method=n.method,this.data={},this.localIdentity=n.to,this.remoteIdentity=n.from}).prototype=Object.create(e.EventEmitter.prototype)).progress=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=180),e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=200),e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return(e=Object.create(e||Object.prototype)).statusCode||(e.statusCode=480),e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(t){var n,r=(t=t||{}).statusCode||100,i=t.minCode||100,a=t.maxCode||699,o=e.Utils.getReasonPhrase(r,t.reasonPhrase),s=t.extraHeaders||[],c=t.body,u=t.events||[];if(r<i||r>a)throw new TypeError("Invalid statusCode: "+r);return n=this.request.reply(r,o,s,c),u.forEach(function(e){this.emit(e,n,o)},this),this},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ServerContext=t}},function(e,t,n){"use strict";e.exports=function(e,t){var r,i,a,o=n(1615)(e),s=n(1616)(e.Timers),c={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_PRACK:6,STATUS_WAITING_FOR_ACK:7,STATUS_CANCELED:8,STATUS_TERMINATED:9,STATUS_ANSWERED_WAITING_FOR_PRACK:10,STATUS_EARLY_MEDIA:11,STATUS_CONFIRMED:12};(r=function(t){this.status=c.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.mediaHandlerFactory=t||e.WebRTC.MediaHandler.defaultFactory,this.hasOffer=!1,this.hasAnswer=!1,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,rel1xxTimer:null,prackTimer:null},this.startTime=null,this.endTime=null,this.tones=null,this.local_hold=!1,this.remote_hold=!1,this.pending_actions={actions:[],length:function(){return this.actions.length},isPending:function(e){for(var t=0,n=this.actions.length;t<n;t++)if(this.actions[t].name===e)return!0;return!1},shift:function(){return this.actions.shift()},push:function(e){this.actions.push({name:e})},pop:function(e){for(var t=0,n=this.actions.length;t<n;t++)this.actions[t].name===e&&(this.actions.splice(t,1),n--,t--)}},this.early_sdp=null,this.rel100=e.C.supported.UNSUPPORTED}).prototype={dtmf:function(t,n){var r=[],i=this;if(n=n||{},void 0===t)throw new TypeError("Not enough arguments");if(this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.status);if("string"!==typeof t&&"number"!==typeof t||!t.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+t);for(t=t.toString().split("");t.length>0;)r.push(new o(this,t.shift(),n));if(this.tones)return this.tones=this.tones.concat(r),this;return this.tones=r,function t(){var r,a;if(i.status===c.STATUS_TERMINATED||!i.tones||0===i.tones.length)return i.tones=null,this;(r=i.tones.shift()).on("failed",function(){i.tones=null}),r.send(n),a=r.duration+r.interToneGap,e.Timers.setTimeout(t,a)}(),this},bye:function(t){var n=(t=Object.create(t||Object.prototype)).statusCode;if(this.status===c.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;if(this.logger.log("terminating Session"),n&&(n<200||n>=700))throw new TypeError("Invalid statusCode: "+n);return t.receiveResponse=function(){},this.sendRequest(e.C.BYE,t).terminated()},refer:function(t,n){var r=((n=n||{}).extraHeaders||[]).slice(),i=t instanceof e.InviteServerContext||t instanceof e.InviteClientContext,a=t;if(void 0===t)throw new TypeError("Not enough arguments");if(this.status!==c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);if(i)t='"'+t.remoteIdentity.friendlyName+'" <'+t.dialog.remote_target.toString()+"?Replaces="+t.dialog.id.call_id+"%3Bto-tag%3D"+t.dialog.id.remote_tag+"%3Bfrom-tag%3D"+t.dialog.id.local_tag+">";else{try{t=e.Grammar.parse(t,"Refer_To").uri||t}catch(o){this.logger.debug(".refer() cannot parse Refer_To from",t),this.logger.debug("...falling through to normalizeTarget()")}if(!(t=this.ua.normalizeTarget(t)))throw new TypeError("Invalid target: "+a)}return r.push("Contact: "+this.contact),r.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),r.push("Refer-To: "+t),this.sendRequest(e.C.REFER,{extraHeaders:r,body:n.body,receiveResponse:function(e){/^2[0-9]{2}$/.test(e.status_code)&&(i||t.scheme&&t.scheme.match("^sips?$"))&&this.terminate()}.bind(this)}),this},followRefer:function(n){return function(n,r){var i=r.parseHeader("refer-to"),a=i.uri;if(a.scheme.match("^sips?$")){var o=[],s=a.getHeader("Replaces");void 0!==s&&o.push("Replaces: "+decodeURIComponent(s)),a.clearHeaders();var c=this.mediaHandler.getReferMedia,u=c?c.call(this.mediaHandler):this.mediaHint;e.Hacks.Chrome.getsConfusedAboutGUM(this);var l=this.ua.invite(a,{media:u,params:{to_displayName:i.friendlyName},extraHeaders:o});n.call(this,r,l),this.terminate()}else{var d=a.toString();"function"===typeof t.open?t.open(d):this.logger.warn("referred to non-SIP URI but `open` isn't in the environment: "+d)}}.bind(this,n)},sendRequest:function(t,n){n=n||{};var r=this,i=new e.OutgoingRequest(t,this.dialog.remote_target,this.ua,{cseq:n.cseq||(this.dialog.local_seqnum+=1),call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set,statusCode:n.statusCode,reasonPhrase:n.reasonPhrase},n.extraHeaders||[],n.body);return new e.RequestSender({request:i,onRequestTimeout:function(){r.onRequestTimeout()},onTransportError:function(){r.onTransportError()},receiveResponse:n.receiveResponse||function(e){r.receiveNonInviteResponse(e)}},this.ua).send(),this.emit(t.toLowerCase(),i),this},close:function(){var t;if(this.status===c.STATUS_TERMINATED)return this;for(t in this.logger.log("closing INVITE session "+this.id),this.mediaHandler&&this.mediaHandler.close(),this.timers)e.Timers.clearTimeout(this.timers[t]);for(t in this.dialog&&(this.dialog.terminate(),delete this.dialog),this.earlyDialogs)this.earlyDialogs[t].terminate(),delete this.earlyDialogs[t];return this.status=c.STATUS_TERMINATED,delete this.ua.sessions[this.id],this},createDialog:function(t,n,r){var i,a,o=t["UAS"===n?"to_tag":"from_tag"],s=t["UAS"===n?"from_tag":"to_tag"],c=t.call_id+o+s;if(a=this.earlyDialogs[c],r)return!!a||((a=new e.Dialog(this,t,n,e.Dialog.C.STATUS_EARLY)).error?(this.logger.error(a.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[c]=a,!0));if(a){for(var u in a.update(t,n),this.dialog=a,delete this.earlyDialogs[c],this.earlyDialogs)this.earlyDialogs[u].terminate(),delete this.earlyDialogs[u];return!0}return(i=new e.Dialog(this,t,n)).error?(this.logger.error(i.error),this.failed(t,e.C.causes.INTERNAL_ERROR),!1):(this.to_tag=t.to_tag,this.dialog=i,!0)},isReadyToReinvite:function(){return this.mediaHandler.isReady()&&!this.dialog.uac_pending_reply&&!this.dialog.uas_pending_reply},mute:function(e){var t=this.mediaHandler.mute(e);t&&this.onmute(t)},unmute:function(e){var t=this.mediaHandler.unmute(e);t&&this.onunmute(t)},hold:function(){if(this.status!==c.STATUS_WAITING_FOR_ACK&&this.status!==c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.mediaHandler.hold(),this.isReadyToReinvite()?!0!==this.local_hold&&(this.onhold("local"),this.sendReinvite()):this.pending_actions.isPending("unhold")?this.pending_actions.pop("unhold"):this.pending_actions.isPending("hold")||this.pending_actions.push("hold")},unhold:function(t){if(this.status!==c.STATUS_WAITING_FOR_ACK&&this.status!==c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.mediaHandler.unhold(),this.isReadyToReinvite()?!1!==this.local_hold&&(this.onunhold("local"),this.sendReinvite(t)):this.pending_actions.isPending("hold")?this.pending_actions.pop("hold"):this.pending_actions.isPending("unhold")||this.pending_actions.push("unhold")},isOnHold:function(){return{local:this.local_hold,remote:this.remote_hold}},receiveReinvite:function(t){var n=this;if(!this.mediaHandler.hasDescription(t))return this.logger.warn("invalid Content-Type"),void t.reply(415);this.mediaHandler.setDescription(t).then(this.mediaHandler.getDescription.bind(this.mediaHandler,this.mediaHint)).then(function(e){var r=["Contact: "+n.contact];t.reply(200,null,r,e,function(){n.status=c.STATUS_WAITING_FOR_ACK,n.setInvite2xxTimer(t,e),n.setACKTimer(),n.remote_hold&&!n.mediaHandler.remote_hold?n.onunhold("remote"):!n.remote_hold&&n.mediaHandler.remote_hold&&n.onhold("remote")})}).catch(function(r){var i;r instanceof e.Exceptions.GetDescriptionError?i=500:(n.logger.error(r),i=488),t.reply(i)})},sendReinvite:function(t){var n,r=this,i=((t=t||{}).extraHeaders||[]).slice(),a=t.eventHandlers||{};a.succeeded&&(n=a.succeeded),this.reinviteSucceeded=function(){e.Timers.clearTimeout(r.timers.ackTimer),e.Timers.clearTimeout(r.timers.invite2xxTimer),r.status=c.STATUS_CONFIRMED,n&&n.apply(this,arguments)},a.failed?this.reinviteFailed=a.failed:this.reinviteFailed=function(){},i.push("Contact: "+this.contact),i.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=this.receiveReinviteResponse,this.mediaHandler.getDescription(r.mediaHint).then(function(t){r.dialog.sendRequest(r,e.C.INVITE,{extraHeaders:i,body:t})},function(){r.isReadyToReinvite()&&r.onReadyToReinvite(),r.reinviteFailed()})},receiveRequest:function(t){switch(t.method){case e.C.BYE:t.reply(200),this.status===c.STATUS_CONFIRMED&&(this.emit("bye",t),this.terminated(t,e.C.causes.BYE));break;case e.C.INVITE:this.status===c.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(t));break;case e.C.INFO:if(this.status===c.STATUS_1XX_RECEIVED||this.status===c.STATUS_WAITING_FOR_PRACK||this.status===c.STATUS_WAITING_FOR_ACK||this.status===c.STATUS_ANSWERED_WAITING_FOR_PRACK||this.status===c.STATUS_EARLY_MEDIA||this.status===c.STATUS_CONFIRMED||this.dialog){if(this.onInfo)return this.onInfo(t);var n,r,i,a=t.getHeader("content-type"),s=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,u=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;a&&(a.match(/^application\/dtmf-relay/i)?(t.body&&2===(n=t.body.split("\r\n",2)).length&&(s.test(n[0])&&(r=n[0].replace(s,"$2")),u.test(n[1])&&(i=parseInt(n[1].replace(u,"$2"),10))),new o(this,r,{duration:i}).init_incoming(t)):t.reply(415,null,["Accept: application/dtmf-relay"]))}break;case e.C.REFER:if(this.status===c.STATUS_CONFIRMED)this.logger.log("REFER received"),this.listeners("refer").length?(t.reply(202,"Accepted"),"SIP/2.0 100 Trying",this.sendRequest(e.C.NOTIFY,{extraHeaders:["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],body:"SIP/2.0 100 Trying",receiveResponse:function(){}}),this.emit("refer",t)):t.reply(603,"Declined");break;case e.C.NOTIFY:t.reply(200,"OK"),this.emit("notify",t)}},receiveReinviteResponse:function(t){var n=this;if(this.status!==c.STATUS_TERMINATED)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(this.status=c.STATUS_CONFIRMED,this.sendRequest(e.C.ACK,{cseq:t.cseq}),!this.mediaHandler.hasDescription(t)){this.reinviteFailed();break}this.mediaHandler.setDescription(t).then(function(){n.reinviteSucceeded()},function(){n.reinviteFailed()});break;default:this.reinviteFailed()}},acceptAndTerminate:function(t,n,r){var i=[];return n&&i.push("Reason: "+e.Utils.getReasonHeaderValue(n,r)),(this.dialog||this.createDialog(t,"UAC"))&&(this.sendRequest(e.C.ACK,{cseq:t.cseq}),this.sendRequest(e.C.BYE,{extraHeaders:i})),this},setInvite2xxTimer:function(t,n){var r=this,i=e.Timers.T1;this.timers.invite2xxTimer=e.Timers.setTimeout(function a(){if(r.status===c.STATUS_WAITING_FOR_ACK){r.logger.log("no ACK received, attempting to retransmit OK");var o=["Contact: "+r.contact];t.reply(200,null,o,n),i=Math.min(2*i,e.Timers.T2),r.timers.invite2xxTimer=e.Timers.setTimeout(a,i)}},i)},setACKTimer:function(){var t=this;this.timers.ackTimer=e.Timers.setTimeout(function(){t.status===c.STATUS_WAITING_FOR_ACK&&(t.logger.log("no ACK received for an extended period of time, terminating the call"),e.Timers.clearTimeout(t.timers.invite2xxTimer),t.sendRequest(e.C.BYE),t.terminated(null,e.C.causes.NO_ACK))},e.Timers.TIMER_H)},onReadyToReinvite:function(){var e=this.pending_actions.shift();e&&this[e.name]&&this[e.name]()},onTransportError:function(){this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===c.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==c.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))},onDialogError:function(t){this.status===c.STATUS_CONFIRMED?this.terminated(t,e.C.causes.DIALOG_ERROR):this.status!==c.STATUS_TERMINATED&&(this.failed(t,e.C.causes.DIALOG_ERROR),this.terminated(t,e.C.causes.DIALOG_ERROR))},onhold:function(e){this["local"===e?"local_hold":"remote_hold"]=!0,this.emit("hold",{originator:e})},onunhold:function(e){this["local"===e?"local_hold":"remote_hold"]=!1,this.emit("unhold",{originator:e})},onmute:function(e){this.emit("muted",{audio:e.audio,video:e.video})},onunmute:function(e){this.emit("unmuted",{audio:e.audio,video:e.video})},failed:function(e,t){return this.status===c.STATUS_TERMINATED?this:(this.emit("failed",e||null,t||null),this)},rejected:function(e,t){return this.emit("rejected",e||null,t||null),this},canceled:function(){return this.emit("cancel"),this},accepted:function(t,n){return n=e.Utils.getReasonPhrase(t&&t.status_code,n),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),t&&s.updateState(this.dialog,t,e.Parser.parseMessage,this.ua),this.emit("accepted",t,n),this},terminated:function(e,t){return this.status===c.STATUS_TERMINATED?this:(this.endTime=new Date,this.close(),this.emit("terminated",e||null,t||null),this)},connecting:function(e){return this.emit("connecting",{request:e}),this}},r.desugar=function(e){return t.HTMLMediaElement&&e instanceof t.HTMLMediaElement&&(e={media:{constraints:{audio:!0,video:"VIDEO"===e.tagName},render:{remote:e}}}),e||{}},r.C=c,e.Session=r,(i=function(t,n){var r,i=this,a=n.getHeader("Content-Type"),o=n.parseHeader("Content-Disposition");if(e.Utils.augment(this,e.ServerContext,[t,n]),e.Utils.augment(this,e.Session,[t.configuration.mediaHandlerFactory]),this.mediaHandler=this.mediaHandlerFactory(this,{RTCConstraints:{optional:[{DtlsSrtpKeyAgreement:"true"}]}}),!o&&!this.mediaHandler.hasDescription(n)||o&&"render"===o.type)this.renderbody=n.body,this.rendertype=a;else if(!this.mediaHandler.hasDescription(n)&&o&&"session"===o.type)return void n.reply(415);function u(e,t){n.hasHeader(e)&&n.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(i.rel100=t)}function l(){var t={extraHeaders:["Contact: "+i.contact]};i.rel100!==e.C.supported.REQUIRED&&i.progress(t),i.status=c.STATUS_WAITING_FOR_ANSWER,i.timers.userNoAnswerTimer=e.Timers.setTimeout(function(){n.reply(408),i.failed(n,e.C.causes.NO_ANSWER),i.terminated(n,e.C.causes.NO_ANSWER)},i.ua.configuration.noAnswerTimeout),r&&(i.timers.expiresTimer=e.Timers.setTimeout(function(){i.status===c.STATUS_WAITING_FOR_ANSWER&&(n.reply(487),i.failed(n,e.C.causes.EXPIRES),i.terminated(n,e.C.causes.EXPIRES))},r)),i.emit("invite",n)}s.hasSmallMinSE(n)?n.reply(422,null,["Min-SE: "+s.localMinSE]):(this.status=c.STATUS_INVITE_RECEIVED,this.from_tag=n.from_tag,this.id=n.call_id+this.from_tag,this.request=n,this.contact=this.ua.contact.toString(),this.receiveNonInviteResponse=function(){},this.logger=t.getLogger("sip.inviteservercontext",this.id),this.ua.sessions[this.id]=this,n.hasHeader("expires")&&(r=1e3*n.getHeader("expires")),u("require",e.C.supported.REQUIRED),u("supported",e.C.supported.SUPPORTED),n.to_tag=e.Utils.newTag(),this.createDialog(n,"UAS",!0)?(this.mediaHandler&&this.mediaHandler.getRemoteStreams&&(this.getRemoteStreams=this.mediaHandler.getRemoteStreams.bind(this.mediaHandler),this.getLocalStreams=this.mediaHandler.getLocalStreams.bind(this.mediaHandler)),!this.mediaHandler.hasDescription(n)||this.renderbody?e.Timers.setTimeout(l,0):(this.hasOffer=!0,this.mediaHandler.setDescription(n).then(l,function(e){i.logger.warn("invalid description"),i.logger.warn(e),n.reply(488)}))):n.reply(500,"Missing Contact header field"))}).prototype={reject:function(t){if(this.status===c.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);return this.logger.log("rejecting RTCSession"),e.ServerContext.prototype.reject.call(this,t),this.terminated()},terminate:function(t){var n,r=((t=t||{}).extraHeaders||[]).slice(),i=t.body,a=this;return this.status===c.STATUS_WAITING_FOR_ACK&&this.request.server_transaction.state!==e.Transactions.C.STATUS_TERMINATED?(n=this.dialog,this.receiveRequest=function(t){t.method===e.C.ACK&&(this.sendRequest(e.C.BYE,{extraHeaders:r,body:i}),n.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===e.Transactions.C.STATUS_TERMINATED&&this.dialog&&(this.request=new e.OutgoingRequest(e.C.BYE,this.dialog.remote_target,this.ua,{cseq:this.dialog.local_seqnum+=1,call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set},r,i),new e.RequestSender({request:this.request,onRequestTimeout:function(){a.onRequestTimeout()},onTransportError:function(){a.onTransportError()},receiveResponse:function(){}},this.ua).send(),n.terminate())}),this.emit("bye",this.request),this.terminated(),this.dialog=n,this.ua.dialogs[n.id.toString()]=n):this.status===c.STATUS_CONFIRMED?this.bye(t):this.reject(t),this},progress:function(t){var n,r,i=(t=t||{}).statusCode||180,a=t.reasonPhrase,o=(t.extraHeaders||[]).slice(),s=t.stunServers||null,u=t.turnServers||null,l=t.body;if(i<100||i>199)throw new TypeError("Invalid statusCode: "+i);if(this.isCanceled||this.status===c.STATUS_TERMINATED)return this;if(s||u){if(s){if(!(n=e.UA.configuration_check.optional.stunServers(s)))throw new TypeError("Invalid stunServers: "+s);this.stunServers=n}if(u){if(!(n=e.UA.configuration_check.optional.turnServers(u)))throw new TypeError("Invalid turnServers: "+u);this.turnServers=n}this.mediaHandler.updateIceServers({stunServers:this.stunServers,turnServers:this.turnServers})}return 100!==t.statusCode&&(this.rel100===e.C.supported.REQUIRED||this.rel100===e.C.supported.SUPPORTED&&t.rel100||this.rel100===e.C.supported.SUPPORTED&&this.ua.configuration.rel100===e.C.supported.REQUIRED)?function(){i=t.statusCode||183,this.status=c.STATUS_WAITING_FOR_PRACK,o.push("Contact: "+this.contact),o.push("Require: 100rel"),o.push("RSeq: "+Math.floor(1e4*Math.random())),this.mediaHint=t.media,this.mediaHandler.getDescription(t.media).then(function(t){if(!this.isCanceled&&this.status!==c.STATUS_TERMINATED){this.early_sdp=t.body,this[this.hasOffer?"hasAnswer":"hasOffer"]=!0;var n=e.Timers.T1;this.timers.rel1xxTimer=e.Timers.setTimeout(function r(){this.request.reply(i,null,o,t),n*=2,this.timers.rel1xxTimer=e.Timers.setTimeout(r.bind(this),n)}.bind(this),n),this.timers.prackTimer=e.Timers.setTimeout(function(){this.status===c.STATUS_WAITING_FOR_PRACK&&(this.logger.log("no PRACK received, rejecting the call"),e.Timers.clearTimeout(this.timers.rel1xxTimer),this.request.reply(504),this.terminated(null,e.C.causes.NO_PRACK))}.bind(this),64*e.Timers.T1),r=this.request.reply(i,a,o,t),this.emit("progress",r,a)}}.bind(this),function(){this.request.reply(480),this.failed(null,e.C.causes.WEBRTC_ERROR),this.terminated(null,e.C.causes.WEBRTC_ERROR)}.bind(this))}.apply(this):function(){r=this.request.reply(i,a,o,l),this.emit("progress",r,a)}.apply(this),this},accept:function(t){t=Object.create(r.desugar(t)),e.Utils.optionsOverride(t,"media","mediaConstraints",!0,this.logger,this.ua.configuration.media),this.mediaHint=t.media,this.onInfo=t.onInfo;var n,i=this,a=this.request,o=(t.extraHeaders||[]).slice(),s=t.stunServers||null,u=t.turnServers||null,l=function(t){var n;i.mediaHandler.render(),o.push("Contact: "+i.contact),o.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString());var r=a.parseHeader("Supported")||[],s=a.parseHeader("Session-Expires")||{},u=s.deltaSeconds;if(u){var l=s.refresher||"uas";o.push("Session-Expires: "+u+";"+l),("uac"===l||r.indexOf("timer")>=0)&&o.push("Require: timer")}i.hasOffer?i.hasAnswer=!0:i.hasOffer=!0,n=a.reply(200,null,o,t,function(){i.status=c.STATUS_WAITING_FOR_ACK,i.setInvite2xxTimer(a,t),i.setACKTimer()},function(){i.failed(null,e.C.causes.CONNECTION_ERROR),i.terminated(null,e.C.causes.CONNECTION_ERROR)}),i.status!==c.STATUS_TERMINATED&&i.accepted(n,e.Utils.getReasonPhrase(200))};if(this.status===c.STATUS_WAITING_FOR_PRACK)return this.status=c.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===c.STATUS_WAITING_FOR_ANSWER)this.status=c.STATUS_ANSWERED;else if(this.status!==c.STATUS_EARLY_MEDIA)throw new e.Exceptions.InvalidStateError(this.status);if((s||u)&&this.status!==c.STATUS_EARLY_MEDIA&&this.status!==c.STATUS_ANSWERED_WAITING_FOR_PRACK){if(s){if(!(n=e.UA.configuration_check.optional.stunServers(s)))throw new TypeError("Invalid stunServers: "+s);this.stunServers=n}if(u){if(!(n=e.UA.configuration_check.optional.turnServers(u)))throw new TypeError("Invalid turnServers: "+u);this.turnServers=n}this.mediaHandler.updateIceServers({stunServers:this.stunServers,turnServers:this.turnServers})}return this.createDialog(a,"UAS")?(e.Timers.clearTimeout(this.timers.userNoAnswerTimer),this.status===c.STATUS_EARLY_MEDIA?l({}):this.mediaHandler.getDescription(i.mediaHint).then(l,function(){i.status!==c.STATUS_TERMINATED&&(i.request.reply(480),i.failed(null,e.C.causes.WEBRTC_ERROR),i.terminated(null,e.C.causes.WEBRTC_ERROR))}),this):(a.reply(500,"Missing Contact header field"),this)},receiveRequest:function(t){function n(){var n;e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=c.STATUS_CONFIRMED,this.unmute(),n=t.getHeader("Content-Type"),this.mediaHandler.hasDescription(t)||(this.renderbody=t.body,this.rendertype=n),this.emit("confirmed",t)}switch(t.method){case e.C.CANCEL:this.status!==c.STATUS_WAITING_FOR_ANSWER&&this.status!==c.STATUS_WAITING_FOR_PRACK&&this.status!==c.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==c.STATUS_EARLY_MEDIA&&this.status!==c.STATUS_ANSWERED||(this.status=c.STATUS_CANCELED,this.request.reply(487),this.canceled(t),this.rejected(t,e.C.causes.CANCELED),this.failed(t,e.C.causes.CANCELED),this.terminated(t,e.C.causes.CANCELED));break;case e.C.ACK:this.status===c.STATUS_WAITING_FOR_ACK&&(this.hasAnswer?n.apply(this):this.mediaHandler.hasDescription(t)?(this.hasAnswer=!0,this.mediaHandler.setDescription(t).then(n.bind(this),function(n){this.logger.warn(n),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):this.early_sdp?n.apply(this):(this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION)));break;case e.C.PRACK:this.status===c.STATUS_WAITING_FOR_PRACK||this.status===c.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),t.reply(200),this.status===c.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=c.STATUS_EARLY_MEDIA,this.accept()),this.status=c.STATUS_EARLY_MEDIA,this.mute()):this.mediaHandler.hasDescription(t)?(this.hasAnswer=!0,this.mediaHandler.setDescription(t).then(function(){e.Timers.clearTimeout(this.timers.rel1xxTimer),e.Timers.clearTimeout(this.timers.prackTimer),t.reply(200),this.status===c.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=c.STATUS_EARLY_MEDIA,this.accept()),this.status=c.STATUS_EARLY_MEDIA,this.mute()}.bind(this),function(n){this.logger.warn(n),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t,e.C.causes.BAD_MEDIA_DESCRIPTION)):this.status===c.STATUS_EARLY_MEDIA&&t.reply(200);break;default:r.prototype.receiveRequest.apply(this,[t])}},onTransportError:function(){this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===c.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==c.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}},e.InviteServerContext=i,(a=function(t,n,i){(i=Object.create(r.desugar(i))).params=Object.create(i.params||Object.prototype);var a,o=(i.extraHeaders||[]).slice(),s=i.stunServers||null,u=i.turnServers||null,l=i.mediaHandlerFactory||t.configuration.mediaHandlerFactory,d=l.isSupported;if(d&&!d())throw new e.Exceptions.NotSupportedError("Media not supported");if(this.RTCConstraints=i.RTCConstraints||{},this.inviteWithoutSdp=i.inviteWithoutSdp||!1,this.anonymous=i.anonymous||!1,this.renderbody=i.renderbody||null,this.rendertype=i.rendertype||"text/plain",i.params.from_tag=this.from_tag,this.contact=t.contact.toString({anonymous:this.anonymous,outbound:this.anonymous?!t.contact.temp_gruu:!t.contact.pub_gruu}),this.anonymous&&(i.params.from_displayName="Anonymous",i.params.from_uri="sip:anonymous@anonymous.invalid",o.push("P-Preferred-Identity: "+t.configuration.uri.toString()),o.push("Privacy: id")),o.push("Contact: "+this.contact),o.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.inviteWithoutSdp&&this.renderbody&&(o.push("Content-Type: "+this.rendertype),o.push("Content-Disposition: render;handling=optional")),t.configuration.rel100===e.C.supported.REQUIRED&&o.push("Require: 100rel"),t.configuration.replaces===e.C.supported.REQUIRED&&o.push("Require: replaces"),i.extraHeaders=o,e.Utils.augment(this,e.ClientContext,[t,e.C.INVITE,n,i]),e.Utils.augment(this,e.Session,[l]),this.status!==c.STATUS_NULL)throw new e.Exceptions.InvalidStateError(this.status);if(this.from_tag=e.Utils.newTag(),this.isCanceled=!1,this.received_100=!1,this.method=e.C.INVITE,this.receiveNonInviteResponse=this.receiveResponse,this.receiveResponse=this.receiveInviteResponse,this.logger=t.getLogger("sip.inviteclientcontext"),s){if(!(a=e.UA.configuration_check.optional.stunServers(s)))throw new TypeError("Invalid stunServers: "+s);this.stunServers=a}if(u){if(!(a=e.UA.configuration_check.optional.turnServers(u)))throw new TypeError("Invalid turnServers: "+u);this.turnServers=a}t.applicants[this]=this,this.id=this.request.call_id+this.from_tag,this.mediaHandler=this.mediaHandlerFactory(this,{RTCConstraints:this.RTCConstraints,stunServers:this.stunServers,turnServers:this.turnServers}),this.mediaHandler&&this.mediaHandler.getRemoteStreams&&(this.getRemoteStreams=this.mediaHandler.getRemoteStreams.bind(this.mediaHandler),this.getLocalStreams=this.mediaHandler.getLocalStreams.bind(this.mediaHandler)),e.Utils.optionsOverride(i,"media","mediaConstraints",!0,this.logger,this.ua.configuration.media),this.mediaHint=i.media,this.onInfo=i.onInfo}).prototype={invite:function(){var t=this;return this.ua.sessions[this.id]=this,this.inviteWithoutSdp?(this.request.body=t.renderbody,this.status=c.STATUS_INVITE_SENT,this.send()):this.mediaHandler.getDescription(t.mediaHint).then(function(e){t.isCanceled||t.status===c.STATUS_TERMINATED||(t.hasOffer=!0,t.request.body=e,t.status=c.STATUS_INVITE_SENT,t.send())},function(){t.status!==c.STATUS_TERMINATED&&(t.failed(null,e.C.causes.WEBRTC_ERROR),t.terminated(null,e.C.causes.WEBRTC_ERROR))}),this},receiveInviteResponse:function(t){var n,r=this,i=t.call_id+t.from_tag+t.to_tag,a=[],o={};if(this.status!==c.STATUS_TERMINATED&&t.method===e.C.INVITE){if(this.dialog&&t.status_code>=200&&t.status_code<=299){if(i!==this.dialog.id.toString()){if(!this.createDialog(t,"UAC",!0))return;return this.earlyDialogs[i].sendRequest(this,e.C.ACK,{body:e.Utils.generateFakeSDP(t.body)}),this.earlyDialogs[i].sendRequest(this,e.C.BYE),void(this.status!==c.STATUS_CONFIRMED&&(this.failed(t,e.C.causes.WEBRTC_ERROR),this.terminated(t,e.C.causes.WEBRTC_ERROR)))}if(this.status===c.STATUS_CONFIRMED)return void this.sendRequest(e.C.ACK,{cseq:t.cseq});if(!this.hasAnswer)return}if(this.dialog&&t.status_code<200){if(-1!==this.dialog.pracked.indexOf(t.getHeader("rseq"))||this.dialog.pracked[this.dialog.pracked.length-1]>=t.getHeader("rseq")&&this.dialog.pracked.length>0)return;if(!this.earlyDialogs[i]&&!this.createDialog(t,"UAC",!0))return;if(-1!==this.earlyDialogs[i].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[i].pracked[this.earlyDialogs[i].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[i].pracked.length>0)return;return a.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[i].pracked.push(t.getHeader("rseq")),void this.earlyDialogs[i].sendRequest(this,e.C.PRACK,{extraHeaders:a,body:e.Utils.generateFakeSDP(t.body)})}if(this.isCanceled)t.status_code>=100&&t.status_code<200?(this.request.cancel(this.cancelReason,a),this.canceled(null)):t.status_code>=200&&t.status_code<299?(this.acceptAndTerminate(t),this.emit("bye",this.request)):t.status_code>=300&&(n=e.C.REASON_PHRASE[t.status_code]||e.C.causes.CANCELED,this.rejected(t,n),this.failed(t,n),this.terminated(t,n));else switch(!0){case/^100$/.test(t.status_code):this.received_100=!0,this.emit("progress",t);break;case/^1[0-9]{2}$/.test(t.status_code):if(!t.to_tag){this.logger.warn("1xx response received without to tag");break}if(t.hasHeader("contact")&&!this.createDialog(t,"UAC",!0))break;if(this.status=c.STATUS_1XX_RECEIVED,t.hasHeader("require")&&-1!==t.getHeader("require").indexOf("100rel")){if(this.dialog||!this.earlyDialogs[i])break;if(-1!==this.earlyDialogs[i].pracked.indexOf(t.getHeader("rseq"))||this.earlyDialogs[i].pracked[this.earlyDialogs[i].pracked.length-1]>=t.getHeader("rseq")&&this.earlyDialogs[i].pracked.length>0)return;if(this.mediaHandler.hasDescription(t))if(this.hasOffer){if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.dialog.pracked.push(t.getHeader("rseq")),this.mediaHandler.setDescription(t).then(function(){a.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),r.sendRequest(e.C.PRACK,{extraHeaders:a,receiveResponse:function(){}}),r.status=c.STATUS_EARLY_MEDIA,r.mute(),r.emit("progress",t)},function(n){r.logger.warn(n),r.acceptAndTerminate(t,488,"Not Acceptable Here"),r.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)})}else{var s=this.earlyDialogs[i],u=s.mediaHandler;s.pracked.push(t.getHeader("rseq")),u.setDescription(t).then(u.getDescription.bind(u,r.mediaHint)).then(function(n){a.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),s.sendRequest(r,e.C.PRACK,{extraHeaders:a,body:n}),r.status=c.STATUS_EARLY_MEDIA,r.emit("progress",t)}).catch(function(n){if(n instanceof e.Exceptions.GetDescriptionError){if(s.pracked.push(t.getHeader("rseq")),r.status===c.STATUS_TERMINATED)return;r.failed(null,e.C.causes.WEBRTC_ERROR),r.terminated(null,e.C.causes.WEBRTC_ERROR)}else s.pracked.splice(s.pracked.indexOf(t.getHeader("rseq")),1),r.logger.warn("invalid description"),r.logger.warn(n)})}else a.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq")),this.earlyDialogs[i].pracked.push(t.getHeader("rseq")),this.earlyDialogs[i].sendRequest(this,e.C.PRACK,{extraHeaders:a}),this.emit("progress",t)}else this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.request.cseq+" "+this.request.method!==t.getHeader("cseq"))break;if(this.status===c.STATUS_EARLY_MEDIA&&this.dialog){this.status=c.STATUS_CONFIRMED,this.unmute(),o={},this.renderbody&&(a.push("Content-Type: "+this.rendertype),o.extraHeaders=a,o.body=this.renderbody),o.cseq=t.cseq,this.sendRequest(e.C.ACK,o),this.accepted(t);break}if(this.dialog)break;if(this.hasOffer)if(this.hasAnswer)this.renderbody&&(a.push("Content-Type: "+r.rendertype),o.extraHeaders=a,o.body=this.renderbody),this.sendRequest(e.C.ACK,o);else{if(!this.mediaHandler.hasDescription(t)){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasAnswer=!0,this.mediaHandler.setDescription(t).then(function(){var n={};r.status=c.STATUS_CONFIRMED,r.unmute(),r.renderbody&&(a.push("Content-Type: "+r.rendertype),n.extraHeaders=a,n.body=r.renderbody),n.cseq=t.cseq,r.sendRequest(e.C.ACK,n),r.accepted(t)},function(n){r.logger.warn(n),r.acceptAndTerminate(t,488,"Not Acceptable Here"),r.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION)})}else if(this.earlyDialogs[i]&&this.earlyDialogs[i].mediaHandler.localMedia){if(this.hasOffer=!0,this.hasAnswer=!0,this.mediaHandler=this.earlyDialogs[i].mediaHandler,!this.createDialog(t,"UAC"))break;this.status=c.STATUS_CONFIRMED,this.sendRequest(e.C.ACK,{cseq:t.cseq}),this.unmute(),this.accepted(t)}else{if(!this.mediaHandler.hasDescription(t)){this.acceptAndTerminate(t,400,"Missing session description"),this.failed(t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.hasOffer=!0,this.mediaHandler.setDescription(t).then(this.mediaHandler.getDescription.bind(this.mediaHandler,this.mediaHint)).then(function(n){r.isCanceled||r.status===c.STATUS_TERMINATED||(r.status=c.STATUS_CONFIRMED,r.hasAnswer=!0,r.unmute(),r.sendRequest(e.C.ACK,{body:n,cseq:t.cseq}),r.accepted(t))}).catch(function(n){n instanceof e.Exceptions.GetDescriptionError?r.logger.warn("there was a problem"):(r.logger.warn("invalid description"),r.logger.warn(n),t.reply(488))})}break;default:n=e.Utils.sipErrorCause(t.status_code),this.rejected(t,n),this.failed(t,n),this.terminated(t,n)}}},cancel:function(t){if((t=t||{}).extraHeaders=(t.extraHeaders||[]).slice(),this.status===c.STATUS_TERMINATED||this.status===c.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession");var n=e.Utils.getCancelReason(t.status_code,t.reason_phrase);return this.status===c.STATUS_NULL||this.status===c.STATUS_INVITE_SENT&&!this.received_100?(this.isCanceled=!0,this.cancelReason=n):this.status!==c.STATUS_INVITE_SENT&&this.status!==c.STATUS_1XX_RECEIVED&&this.status!==c.STATUS_EARLY_MEDIA||this.request.cancel(n,t.extraHeaders),this.canceled()},terminate:function(e){return this.status===c.STATUS_TERMINATED?this:(this.status===c.STATUS_WAITING_FOR_ACK||this.status===c.STATUS_CONFIRMED?this.bye(e):this.cancel(e),this)},receiveRequest:function(t){return t.method,e.C.CANCEL,t.method===e.C.ACK&&this.status===c.STATUS_WAITING_FOR_ACK&&(e.Timers.clearTimeout(this.timers.ackTimer),e.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=c.STATUS_CONFIRMED,this.unmute(),this.accepted()),r.prototype.receiveRequest.apply(this,[t])},onTransportError:function(){this.status!==c.STATUS_CONFIRMED&&this.status!==c.STATUS_TERMINATED&&this.failed(null,e.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===c.STATUS_CONFIRMED?this.terminated(null,e.C.causes.REQUEST_TIMEOUT):this.status!==c.STATUS_TERMINATED&&(this.failed(null,e.C.causes.REQUEST_TIMEOUT),this.terminated(null,e.C.causes.REQUEST_TIMEOUT))}},e.InviteClientContext=a}},function(e,t,n){"use strict";e.exports=function(e){var t;return(t=function(n,r,i){var a,o;if(void 0===r)throw new TypeError("Not enough arguments");if(this.logger=n.ua.getLogger("sip.invitecontext.dtmf",n.id),this.owner=n,this.direction=null,a=(i=i||{}).duration||null,o=i.interToneGap||null,"string"===typeof r)r=r.toUpperCase();else{if("number"!==typeof r)throw new TypeError("Invalid tone: "+r);r=r.toString()}if(!r.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+r);if(this.tone=r,a&&!e.Utils.isDecimal(a))throw new TypeError("Invalid tone duration: "+a);if(a?a<t.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+t.C.MIN_DURATION+" milliseconds"),a=t.C.MIN_DURATION):a>t.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+t.C.MAX_DURATION+" milliseconds"),a=t.C.MAX_DURATION):a=Math.abs(a):a=t.C.DEFAULT_DURATION,this.duration=a,o&&!e.Utils.isDecimal(o))throw new TypeError("Invalid interToneGap: "+o);o?o<t.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+t.C.MIN_INTER_TONE_GAP+" milliseconds"),o=t.C.MIN_INTER_TONE_GAP):o=Math.abs(o):o=t.C.DEFAULT_INTER_TONE_GAP,this.interToneGap=o}).prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(t){var n,r={};if(this.direction="outgoing",this.owner.status!==e.Session.C.STATUS_CONFIRMED&&this.owner.status!==e.Session.C.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.owner.status);n=(t=t||{}).extraHeaders?t.extraHeaders.slice():[],r.contentType="application/dtmf-relay",r.body="Signal= "+this.tone+"\r\n",r.body+="Duration= "+this.duration,this.request=this.owner.dialog.sendRequest(this,e.C.INFO,{extraHeaders:n,body:r}),this.owner.emit("dtmf",this.request,this)},t.prototype.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("succeeded",{originator:"remote",response:t});break;default:n=e.Utils.sipErrorCause(t.status_code),this.emit("failed",t,n)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(t){this.emit("failed",t,e.C.causes.DIALOG_ERROR),this.owner.onDialogError(t)},t.prototype.init_incoming=function(e){this.direction="incoming",this.request=e,e.reply(200),this.tone&&this.duration?this.owner.emit("dtmf",e,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},t}},function(e,t){var n=90;e.exports=function(e){return{localMinSE:n,hasSmallMinSE:function(e){var t=e.parseHeader("Supported")||[],r=e.parseHeader("Session-Expires")||{};return t.indexOf("timer")>=0&&r.deltaSeconds<n},updateState:function(t,n,r,i){t.sessionTimerState=t.sessionTimerState||{},e.clearTimeout(t.sessionTimerState.timeout);var a="string"===typeof n;a&&(n=r(n,i));var o=n.parseHeader("Session-Expires");if(o){var s=o.deltaSeconds,c=a===("uas"===o.refresher);t.sessionTimerState={interval:s,isRefresher:c};var u=1e3*s,l=this;if(c)t.sessionTimerState.timeout=e.setInterval(function(){t.owner.ua.dialogs[t.id.toString()]?t.sendRequest(l,"UPDATE",{extraHeaders:["Session-Expires: "+s]}):e.clearInterval(t.sessionTimerState.timeout)},u/2);else{var d=Math.min(32e3,u/3);t.sessionTimerState.timeout=e.setTimeout(function(){},u-d)}}else t.sessionTimerState=null},receiveResponse:function(e){},onDialogError:function(e){},onRequestTimeout:function(){},onTransportError:function(){}}}},function(e,t,n){"use strict";e.exports=function(e){e.Subscription=function(t,n,r,i){if(i=Object.create(i||Object.prototype),this.extraHeaders=i.extraHeaders=(i.extraHeaders||[]).slice(),this.id=null,this.state="init",!r)throw new TypeError("Event necessary to create a subscription.");this.event=r,"number"!==typeof i.expires?(t.logger.warn("expires must be a number. Using default of 3600."),this.expires=3600):this.expires=i.expires,i.extraHeaders.push("Event: "+this.event),i.extraHeaders.push("Expires: "+this.expires),i.body&&(this.body=i.body),this.contact=t.contact.toString(),i.extraHeaders.push("Contact: "+this.contact),i.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),e.Utils.augment(this,e.ClientContext,[t,e.C.SUBSCRIBE,n,i]),this.logger=t.getLogger("sip.subscription"),this.dialog=null,this.timers={N:null,sub_duration:null},this.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604]},e.Subscription.prototype={subscribe:function(){return"active"===this.state?(this.refresh(),this):"notify_wait"===this.state?this:(e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(this.timer_fire.bind(this),e.Timers.TIMER_N),this.send(),this.state="notify_wait",this)},refresh:function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog.sendRequest(this,e.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},receiveResponse:function(t){var n,r=e.Utils.getReasonPhrase(t.status_code);"notify_wait"===this.state&&t.status_code>=300||"notify_wait"!==this.state&&-1!==this.errorCodes.indexOf(t.status_code)?this.failed(t,null):/^2[0-9]{2}$/.test(t.status_code)&&(n=t.getHeader("Expires"),e.Timers.clearTimeout(this.timers.N),this.createConfirmedDialog(t,"UAC")&&(this.id=this.dialog.id.toString(),this.ua.subscriptions[this.id]=this,this.emit("accepted",t,r)),n&&n<=this.expires?(this.expires=n,this.timers.sub_duration=e.Timers.setTimeout(this.refresh.bind(this),900*n)):n?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(t,e.C.INVALID_EXPIRES_HEADER)):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(t,e.C.EXPIRES_HEADER_MISSING)))},unsubscribe:function(){var t=[];this.state="terminated",t.push("Event: "+this.event),t.push("Expires: 0"),t.push("Contact: "+this.contact),t.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=function(){},this.dialog.sendRequest(this,this.method,{extraHeaders:t,body:this.body}),e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(this.timer_fire.bind(this),e.Timers.TIMER_N)},timer_fire:function(){"terminated"===this.state?(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]):"pending"===this.state||"notify_wait"===this.state?this.close():this.refresh()},close:function(){"notify_wait"!==this.state&&"terminated"!==this.state&&this.unsubscribe()},createConfirmedDialog:function(t,n){var r;return this.terminateDialog(),!(r=new e.Dialog(this,t,n)).error&&(this.dialog=r,!0)},terminateDialog:function(){this.dialog&&(delete this.ua.subscriptions[this.id],this.dialog.terminate(),delete this.dialog)},receiveRequest:function(t){var n,r=this;function i(){n.expires&&(e.Timers.clearTimeout(r.timers.sub_duration),n.expires=Math.min(r.expires,Math.max(n.expires,0)),r.timers.sub_duration=e.Timers.setTimeout(r.refresh.bind(r),900*n.expires))}if(this.matchEvent(t))if(n=t.parseHeader("Subscription-State"),t.reply(200,e.C.REASON_200),e.Timers.clearTimeout(this.timers.N),this.emit("notify",{request:t}),"terminated"!==this.state)switch(n.state){case"active":this.state="active",i();break;case"pending":"notify_wait"===this.state&&i(),this.state="pending";break;case"terminated":if(e.Timers.clearTimeout(this.timers.sub_duration),n.reason)switch(this.logger.log("terminating subscription with reason "+n.reason),n.reason){case"deactivated":case"timeout":return void this.subscribe();case"probation":case"giveup":return void(n.params&&n.params["retry-after"]?this.timers.sub_duration=e.Timers.setTimeout(r.subscribe.bind(r),n.params["retry-after"]):this.subscribe())}this.close()}else"terminated"===n.state&&(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]);else t.reply(489)},failed:function(e,t){return this.close(),this.emit("failed",e,t),this},onDialogError:function(t){this.failed(t,e.C.causes.DIALOG_ERROR)},matchEvent:function(e){var t;return e.hasHeader("Event")?e.hasHeader("Subscription-State")?(t=e.parseHeader("event").event,this.event===t||(this.logger.warn("event match failed"),e.reply(481,"Event Match Failed"),!1)):(this.logger.warn("missing Subscription-State header"),!1):(this.logger.warn("missing Event header"),!1)}}}},function(e,t,n){"use strict";e.exports=function(e,t){var r,i;return(r={}).MediaHandler=n(1619)(e),r.MediaStreamManager=n(1620)(e,t),r.isSupported=function(){return void 0!==i?i:(r.MediaStream=t.MediaStream,r.getUserMedia=t.getUserMedia,r.RTCPeerConnection=t.RTCPeerConnection,r.RTCSessionDescription=t.RTCSessionDescription,r.RTCPeerConnection&&r.RTCSessionDescription?(r.getUserMedia&&(r.getUserMedia=e.Utils.promisify(t,"getUserMedia")),i=!0):i=!1,i)},r}},function(e,t,n){"use strict";e.exports=function(e){var t=function(t,n){n=n||{},this.logger=t.ua.getLogger("sip.invitecontext.mediahandler",t.id),this.session=t,this.localMedia=null,this.ready=!0,this.mediaStreamManager=n.mediaStreamManager||new e.WebRTC.MediaStreamManager(this.logger),this.audioMuted=!1,this.videoMuted=!1,this.local_hold=!1,this.remote_hold=!1;var r=this.prepareIceServers(n.stunServers,n.turnServers);function i(e,t){e.mediaStreamManager.on&&e.mediaStreamManager.on(t,function(){e.emit.apply(e,[t].concat(Array.prototype.slice.call(arguments)))})}this.RTCConstraints=n.RTCConstraints||{},this.initPeerConnection(r),i(this,"userMediaRequest"),i(this,"userMedia"),i(this,"userMediaFailed")};return(t.defaultFactory=function(e,n){return new t(e,n)}).isSupported=function(){return e.WebRTC.isSupported()},t.prototype=Object.create(e.MediaHandler.prototype,{isReady:{writable:!0,value:function(){return this.ready}},close:{writable:!0,value:function(){this.logger.log("closing PeerConnection"),this._remoteStreams=[],this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.close(),this.localMedia&&this.mediaStreamManager.release(this.localMedia))}},getDescription:{writable:!0,value:function(t){var n,r=this,i=r.mediaStreamManager.acquire;return i.length>1&&(i=e.Utils.promisify(this.mediaStreamManager,"acquire",!0)),!0===(t=t||{}).dataChannel&&(t.dataChannel={}),this.mediaHint=t,r.localMedia?(r.logger.log("already have local media"),n=e.Utils.Promise.resolve(r.localMedia)):(r.logger.log("acquiring local media"),n=i.call(r.mediaStreamManager,t).then(function(e){return r.logger.log("acquired local media streams"),r.localMedia=e,r.session.connecting(),e},function(e){throw r.logger.error("unable to acquire streams"),r.logger.error(e),r.session.connecting(),e}).then(this.addStreams.bind(this))),n.then(function(){return r.hasOffer("remote")?r.peerConnection.ondatachannel=function(e){r.dataChannel=e.channel,r.emit("dataChannel",r.dataChannel)}:t.dataChannel&&r.peerConnection.createDataChannel&&(r.dataChannel=r.peerConnection.createDataChannel("sipjs",t.dataChannel),r.emit("dataChannel",r.dataChannel)),r.render(),r.createOfferOrAnswer(r.RTCConstraints)}).then(function(t){return t=e.Hacks.Firefox.hasMissingCLineInSDP(t),r.local_hold&&(t=/a=(sendrecv|sendonly|recvonly|inactive)/.test(t)?(t=t.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n")).replace(/a=recvonly\r\n/g,"a=inactive\r\n"):t.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n")),{body:t,contentType:"application/sdp"}})}},hasDescription:{writeable:!0,value:function(e){return"application/sdp"===e.getHeader("Content-Type")&&!!e.body}},setDescription:{writable:!0,value:function(t){var n=t.body;this.remote_hold=/a=(sendonly|inactive)/.test(n),n=e.Hacks.Firefox.cannotHandleExtraWhitespace(n),n=e.Hacks.AllBrowsers.maskDtls(n);var r={type:this.hasOffer("local")?"answer":"offer",sdp:n};this.emit("setDescription",r);var i=new e.WebRTC.RTCSessionDescription(r);return e.Utils.promisify(this.peerConnection,"setRemoteDescription")(i)}},getReferMedia:{writable:!0,value:function(){function e(e,t){return t[e]().length>0}function t(t){return this.getLocalStreams().some(e.bind(null,t))&&this.getRemoteStreams().some(e.bind(null,t))}return{constraints:{audio:t.call(this,"getAudioTracks"),video:t.call(this,"getVideoTracks")}}}},updateIceServers:{writeable:!0,value:function(e){var t=this.prepareIceServers(e.stunServers,e.turnServers);this.RTCConstraints=e.RTCConstraints||this.RTCConstraints,this.initPeerConnection(t)}},isMuted:{writable:!0,value:function(){return{audio:this.audioMuted,video:this.videoMuted}}},mute:{writable:!0,value:function(e){if(0!==this.getLocalStreams().length){var t=!1,n=!1;return(e=e||{audio:this.getLocalStreams()[0].getAudioTracks().length>0,video:this.getLocalStreams()[0].getVideoTracks().length>0}).audio&&!this.audioMuted&&(t=!0,this.audioMuted=!0,this.toggleMuteAudio(!0)),e.video&&!this.videoMuted&&(n=!0,this.videoMuted=!0,this.toggleMuteVideo(!0)),t||n?{audio:t,video:n}:void 0}}},unmute:{writable:!0,value:function(e){if(0!==this.getLocalStreams().length){var t=!1,n=!1;return(e=e||{audio:this.getLocalStreams()[0].getAudioTracks().length>0,video:this.getLocalStreams()[0].getVideoTracks().length>0}).audio&&this.audioMuted&&(t=!0,this.audioMuted=!1,this.toggleMuteAudio(!1)),e.video&&this.videoMuted&&(n=!0,this.videoMuted=!1,this.toggleMuteVideo(!1)),t||n?{audio:t,video:n}:void 0}}},hold:{writable:!0,value:function(){this.local_hold=!0,this.toggleMuteAudio(!0),this.toggleMuteVideo(!0)}},unhold:{writable:!0,value:function(){this.local_hold=!1,this.audioMuted||this.toggleMuteAudio(!1),this.videoMuted||this.toggleMuteVideo(!1)}},getLocalStreams:{writable:!0,value:function(){var e=this.peerConnection;return e&&"closed"===e.signalingState?(this.logger.warn("peerConnection is closed, getLocalStreams returning []"),[]):e.getLocalStreams&&e.getLocalStreams()||e.localStreams||[]}},getRemoteStreams:{writable:!0,value:function(){var e=this.peerConnection;return e&&"closed"===e.signalingState?(this.logger.warn("peerConnection is closed, getRemoteStreams returning this._remoteStreams"),this._remoteStreams):e.getRemoteStreams&&e.getRemoteStreams()||e.remoteStreams||[]}},render:{writable:!0,value:function(t){if(!(t=t||this.mediaHint&&this.mediaHint.render))return!1;var n={local:"getLocalStreams",remote:"getRemoteStreams"};Object.keys(n).forEach(function(r){var i=this[n[r]]();e.WebRTC.MediaStreamManager.render(i,t[r])}.bind(this))}},hasOffer:{writable:!0,value:function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t}},prepareIceServers:{writable:!0,value:function(e,t){var n=[],r=this.session.ua.configuration;return e=e||r.stunServers,t=t||r.turnServers,[].concat(e).forEach(function(e){n.push({urls:e})}),[].concat(t).forEach(function(e){n.push({urls:e.urls,username:e.username,credential:e.password})}),n}},initPeerConnection:{writable:!0,value:function(t){var n=this,r=this.session.ua.configuration;this.onIceCompleted=e.Utils.defer(),this.onIceCompleted.promise.then(function(t){n.emit("iceGatheringComplete",t),n.iceCheckingTimer&&(e.Timers.clearTimeout(n.iceCheckingTimer),n.iceCheckingTimer=null)}),this.peerConnection&&this.peerConnection.close(),this.peerConnection=new e.WebRTC.RTCPeerConnection({iceServers:t}),this._remoteStreams=[],this.peerConnection.onaddstream=function(e){n.logger.log("stream added: "+e.stream.id),n._remoteStreams.push(e.stream),n.render(),n.emit("addStream",e)},this.peerConnection.onremovestream=function(e){n.logger.log("stream removed: "+e.stream.id)},this.startIceCheckingTimer=function(){n.iceCheckingTimer||(n.iceCheckingTimer=e.Timers.setTimeout(function(){n.logger.log("RTCIceChecking Timeout Triggered after "+r.iceCheckingTimeout+" milliseconds"),n.onIceCompleted.resolve(this)}.bind(this.peerConnection),r.iceCheckingTimeout))},this.peerConnection.onicecandidate=function(e){n.emit("iceCandidate",e),e.candidate?(n.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())),n.startIceCheckingTimer()):n.onIceCompleted.resolve(this)},this.peerConnection.onicegatheringstatechange=function(){n.logger.log("RTCIceGatheringState changed: "+this.iceGatheringState),"gathering"===this.iceGatheringState&&n.emit("iceGathering",this),"complete"===this.iceGatheringState&&n.onIceCompleted.resolve(this)},this.peerConnection.oniceconnectionstatechange=function(){var e;switch("checking"===this.iceConnectionState&&n.startIceCheckingTimer(),this.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void n.logger.warn("Unknown iceConnection state:",this.iceConnectionState)}n.emit(e,this)},this.peerConnection.onstatechange=function(){n.logger.log('PeerConnection state changed to "'+this.readyState+'"')}}},createOfferOrAnswer:{writable:!0,value:function(t){var n,r=this,i=r.peerConnection;return r.ready=!1,n=r.hasOffer("remote")?"createAnswer":"createOffer",e.Utils.promisify(i,n,!0)(t).then(e.Utils.promisify(i,"setLocalDescription")).then(function(){var t=e.Utils.defer();return"complete"===i.iceConnectionState||"completed"===i.iceConnectionState?t.resolve():r.onIceCompleted.promise.then(t.resolve),t.promise}).then(function(){var t=i.localDescription.sdp;t=e.Hacks.Chrome.needsExplicitlyInactiveSDP(t),t=e.Hacks.AllBrowsers.unmaskDtls(t);var a={type:"createOffer"===n?"offer":"answer",sdp:t};return r.emit("getDescription",a),r.session.ua.configuration.hackStripTcp&&(a.sdp=a.sdp.replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,"")),r.ready=!0,a.sdp}).catch(function(t){throw r.logger.error(t),r.ready=!0,new e.Exceptions.GetDescriptionError(t)})}},addStreams:{writable:!0,value:function(t){try{(t=[].concat(t)).forEach(function(e){this.peerConnection.addStream(e)},this)}catch(n){return this.logger.error("error adding stream"),this.logger.error(n),e.Utils.Promise.reject(n)}return e.Utils.Promise.resolve()}},toggleMuteHelper:{writable:!0,value:function(e,t){this.getLocalStreams().forEach(function(n){n[e]().forEach(function(e){e.enabled=!t})})}},toggleMuteAudio:{writable:!0,value:function(e){this.toggleMuteHelper("getAudioTracks",e)}},toggleMuteVideo:{writable:!0,value:function(e){this.toggleMuteHelper("getVideoTracks",e)}}}),t}},function(e,t,n){"use strict";e.exports=function(e,t){var n=function(t,n){if(!e.WebRTC.isSupported())throw new e.Exceptions.NotSupportedError("Media not supported");this.mediaHint=n||{constraints:{audio:!0,video:!0}},this.acquisitions={}};return n.streamId=function(e){return e.getAudioTracks().concat(e.getVideoTracks()).map(function(e){return e.id}).join("")},n.render=function(n,r){if(!r)return!1;if(Array.isArray(r)&&!r.length)throw new TypeError("elements must not be empty");r=[].concat(r),[].concat(n).forEach(function(n,r,i){var a,o=n[i%n.length];"function"===typeof o&&(o=o()),(t.attachMediaStream||function(e,t){e.srcObject=t})(o,r),(a=o).ensurePlayingIntervalId=e.Timers.setInterval(function(){a.paused&&a.srcObject?a.play():e.Timers.clearInterval(a.ensurePlayingIntervalId)},100)}.bind(null,r))},n.prototype=Object.create(e.EventEmitter.prototype,{acquire:{writable:!0,value:function(t){t=Object.keys(t||{}).length?t:this.mediaHint;var r=function(t,r){return(r=[].concat(r)).forEach(function(e){var r=n.streamId(e);this.acquisitions[r]=!!t},this),e.Utils.Promise.resolve(r)}.bind(this);if(t.stream)return r(!0,t.stream);var i=t.constraints||this.mediaHint&&this.mediaHint.constraints||{audio:!0,video:!0},a=e.Utils.defer();return e.Timers.setTimeout(function(){this.emit("userMediaRequest",i);var t=function(e,t){var n=Array.prototype.slice.call(arguments,2),r=[e].concat(n);return this.emit.apply(this,r),t.apply(null,n)}.bind(this);i.audio||i.video?a.resolve(e.WebRTC.getUserMedia(i).then(t.bind(this,"userMedia",r.bind(null,!1)),t.bind(this,"userMediaFailed",function(e){throw e}))):a.resolve([])}.bind(this),0),a.promise}},release:{writable:!0,value:function(e){(e=[].concat(e)).forEach(function(e){var t=n.streamId(e);!1===this.acquisitions[t]&&e.getTracks().forEach(function(e){e.stop()}),delete this.acquisitions[t]},this)}}}),n}},function(e,t,n){"use strict";(function(t){e.exports=function(e,n){var r,i={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};function a(t){if(t instanceof Function)return t.initialize||(t.initialize=function(){return e.Utils.Promise.resolve()}),t}((r=function(r){var a=this;function o(e){return a.emit.bind(a,e)}i.ACCEPTED_BODY_TYPES=i.ACCEPTED_BODY_TYPES.toString(),this.log=new e.LoggerFactory,this.logger=this.getLogger("sip.ua"),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.applicants={},this.data={},this.sessions={},this.subscriptions={},this.transport=null,this.contact=null,this.status=i.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.transportRecoverAttempts=0,this.transportRecoveryTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],n=0;for(e in t)n+=Object.keys(this.transactions[t[e]]).length;return n}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===r?r={}:("string"===typeof r||r instanceof String)&&(r={uri:r}),r.log&&(r.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=r.log.builtinEnabled),r.log.hasOwnProperty("level")&&(this.log.level=r.log.level),r.log.hasOwnProperty("connector")&&(this.log.connector=r.log.connector));try{this.loadConfig(r)}catch(s){throw this.status=i.STATUS_NOT_READY,this.error=i.CONFIGURATION_ERROR,s}this.registerContext=new e.RegisterContext(this),this.registerContext.on("failed",o("registrationFailed")),this.registerContext.on("registered",o("registered")),this.registerContext.on("unregistered",o("unregistered")),this.configuration.autostart&&this.start(),"function"===typeof n.addEventListener&&(t.chrome&&t.chrome.app&&t.chrome.app.runtime||n.addEventListener("unload",this.stop.bind(this)))}).prototype=Object.create(e.EventEmitter.prototype)).register=function(e){return this.configuration.register=!0,this.registerContext.register(e),this},r.prototype.unregister=function(e){this.configuration.register=!1;var t=this.registerContext;return this.afterConnected(t.unregister.bind(t,e)),this},r.prototype.isRegistered=function(){return this.registerContext.registered},r.prototype.isConnected=function(){return!!this.transport&&this.transport.connected},r.prototype.afterConnected=function(e){this.isConnected()?e():this.once("connected",e)},r.prototype.invite=function(t,n){var r=new e.InviteClientContext(this,t,n);return this.afterConnected(r.invite.bind(r)),r},r.prototype.subscribe=function(t,n,r){var i=new e.Subscription(this,t,n,r);return this.afterConnected(i.subscribe.bind(i)),i},r.prototype.message=function(t,n,r){if(void 0===n)throw new TypeError("Not enough arguments");return(r=Object.create(r||Object.prototype)).contentType||(r.contentType="text/plain"),r.body=n,this.request(e.C.MESSAGE,t,r)},r.prototype.request=function(t,n,r){var i=new e.ClientContext(this,t,n,r);return this.afterConnected(i.send.bind(i)),i},r.prototype.stop=function(){var t,n,r,a=this;if(this.logger.log("user requested closure..."),this.status===i.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;for(t in e.Timers.clearTimeout(this.transportRecoveryTimer),this.logger.log("closing registerContext"),this.registerContext.close(),this.sessions)this.logger.log("closing session "+t),this.sessions[t].terminate();for(n in this.subscriptions)this.logger.log("unsubscribing from subscription "+n),this.subscriptions[n].close();for(r in this.applicants)this.applicants[r].close();return this.status=i.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount?this.transport&&this.transport.disconnect():this.on("transactionDestroyed",function e(){0===a.nistTransactionsCount&&0===a.nictTransactionsCount&&(a.removeListener("transactionDestroyed",e),a.transport.disconnect())}),this},r.prototype.start=function(){var t;return this.logger.log("user requested startup..."),this.status===i.STATUS_INIT?(t=this.getNextWsServer(),this.status=i.STATUS_STARTING,new e.Transport(this,t)):this.status===i.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=i.STATUS_READY,this.transport.connect()):this.status===i.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===i.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect"),this},r.prototype.normalizeTarget=function(t){return e.Utils.normalizeTarget(t,this.configuration.hostportParams)},r.prototype.saveCredentials=function(e){return this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e,this},r.prototype.getCredentials=function(e){var t,n;return t=e.ruri.host,this.cache.credentials[t]&&this.cache.credentials[t][e.ruri]&&((n=this.cache.credentials[t][e.ruri]).method=e.method),n},r.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},r.prototype.onTransportClosed=function(t){var n,r,i,a=["nict","ict","nist","ist"];for(t.server.status=e.Transport.C.STATUS_DISCONNECTED,this.logger.log("connection state set to "+e.Transport.C.STATUS_DISCONNECTED),i=a.length,n=0;n<i;n++)for(r in this.transactions[a[n]])this.transactions[a[n]][r].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()},r.prototype.onTransportError=function(t){var n;this.logger.log("transport "+t.server.ws_uri+" failed | connection state set to "+e.Transport.C.STATUS_ERROR),t.server.status=e.Transport.C.STATUS_ERROR,this.emit("disconnected",{transport:t}),this.status!==i.STATUS_USER_CLOSED&&((n=this.getNextWsServer())?new e.Transport(this,n):(this.closeSessionsOnTransportError(),this.error&&this.error===i.NETWORK_ERROR||(this.status=i.STATUS_NOT_READY,this.error=i.NETWORK_ERROR),this.recoverTransport()))},r.prototype.onTransportConnected=function(t){this.transport=t,this.transportRecoverAttempts=0,t.server.status=e.Transport.C.STATUS_READY,this.logger.log("connection state set to "+e.Transport.C.STATUS_READY),this.status!==i.STATUS_USER_CLOSED&&(this.status=i.STATUS_READY,this.error=null,this.configuration.register&&this.configuration.authenticationFactory.initialize().then(function(){this.registerContext.onTransportConnected()}.bind(this)),this.emit("connected",{transport:t}))},r.prototype.onTransportConnecting=function(e,t){this.emit("connecting",{transport:e,attempts:t})},r.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},r.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},r.prototype.receiveRequest=function(t){var n,r,a,o,s,c=t.method,u=this;function l(e){return e&&e.user===t.ruri.user}if(!(l(this.configuration.uri)||l(this.contact.uri)||l(this.contact.pub_gruu)||l(this.contact.temp_gruu)))return this.logger.warn("Request-URI does not point to us"),void(t.method!==e.C.ACK&&t.reply_sl(404));if(t.ruri.scheme!==e.C.SIPS){if(!e.Transactions.checkTransaction(this,t))if(c===e.C.OPTIONS?(new e.Transactions.NonInviteServerTransaction(t,this),t.reply(200,null,["Allow: "+e.UA.C.ALLOWED_METHODS.toString(),"Accept: "+i.ACCEPTED_BODY_TYPES])):c===e.C.MESSAGE?((a=new e.ServerContext(this,t)).body=t.body,a.content_type=t.getHeader("Content-Type")||"text/plain",t.reply(200,null),this.emit("message",a)):c!==e.C.INVITE&&c!==e.C.ACK&&new e.ServerContext(this,t),t.to_tag)(n=this.findDialog(t))?(c===e.C.INVITE&&new e.Transactions.InviteServerTransaction(t,this),n.receiveRequest(t)):c===e.C.NOTIFY?(r=this.findSession(t))?r.receiveRequest(t):(this.logger.warn("received NOTIFY request for a non existent session"),t.reply(481,"Subscription does not exist")):c!==e.C.ACK&&t.reply(481);else switch(c){case e.C.INVITE:if(o=this.configuration.replaces!==e.C.supported.UNSUPPORTED&&t.parseHeader("replaces")){if(!(s=this.dialogs[o.call_id+o.replaces_to_tag+o.replaces_from_tag]))return void t.reply_sl(481,null);if(s.owner.status===e.Session.C.STATUS_TERMINATED)return void t.reply_sl(603,null);if(s.state===e.Dialog.C.STATUS_CONFIRMED&&o.early_only)return void t.reply_sl(486,null)}var d=this.configuration.mediaHandlerFactory.isSupported;!d||d()?((r=new e.InviteServerContext(this,t)).replacee=s&&s.owner,r.on("invite",function(){u.emit("invite",this)})):(this.logger.warn("INVITE received but WebRTC is not supported"),t.reply(488));break;case e.C.BYE:t.reply(481);break;case e.C.CANCEL:(r=this.findSession(t))?r.receiveRequest(t):this.logger.warn("received CANCEL request for a non existent session");break;case e.C.ACK:break;case e.C.NOTIFY:this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0?(t.reply(200,null),u.emit("notify",{request:t})):t.reply(481,"Subscription does not exist");break;default:t.reply(405)}}else t.reply_sl(416)},r.prototype.findSession=function(e){return this.sessions[e.call_id+e.from_tag]||this.sessions[e.call_id+e.to_tag]||null},r.prototype.findDialog=function(e){return this.dialogs[e.call_id+e.from_tag+e.to_tag]||this.dialogs[e.call_id+e.to_tag+e.from_tag]||null},r.prototype.getNextWsServer=function(){var t,n,r,i=[];for(n=this.configuration.wsServers.length,t=0;t<n;t++)(r=this.configuration.wsServers[t]).status!==e.Transport.C.STATUS_ERROR&&(0===i.length?i.push(r):r.weight>i[0].weight?i=[r]:r.weight===i[0].weight&&i.push(r));return i[t=Math.floor(Math.random()*i.length)]},r.prototype.closeSessionsOnTransportError=function(){var e;for(e in this.sessions)this.sessions[e].onTransportError();this.registerContext.onTransportClosed()},r.prototype.recoverTransport=function(t){var n,r,i,a,o;for(a=(t=t||this).transportRecoverAttempts,r=t.configuration.wsServers.length,n=0;n<r;n++)t.configuration.wsServers[n].status=0;o=t.getNextWsServer(),(i=Math.floor(Math.random()*Math.pow(2,a)+1)*t.configuration.connectionRecoveryMinInterval)>t.configuration.connectionRecoveryMaxInterval&&(this.logger.log("time for next connection attempt exceeds connectionRecoveryMaxInterval, resetting counter"),i=t.configuration.connectionRecoveryMinInterval,a=0),this.logger.log("next connection attempt in "+i+" seconds"),this.transportRecoveryTimer=e.Timers.setTimeout(function(){t.transportRecoverAttempts=a+1,new e.Transport(t,o)},1e3*i)},r.prototype.loadConfig=function(t){var n,i,o,s,c,u={viaHost:e.Utils.createRandomToken(12)+".invalid",uri:new e.URI("sip","anonymous."+e.Utils.createRandomToken(6),"anonymous.invalid",null,null),wsServers:[{scheme:"WSS",sip_uri:"<sip:edge.sip.onsip.com;transport=ws;lr>",status:0,weight:0,ws_uri:"wss://edge.sip.onsip.com"}],password:null,registerExpires:600,register:!0,registrarServer:null,wsServerMaxReconnection:3,wsServerReconnectionTimeout:4,connectionRecoveryMinInterval:2,connectionRecoveryMaxInterval:30,keepAliveInterval:0,extraSupported:[],usePreloadedRoute:!1,userAgentString:e.C.USER_AGENT,iceCheckingTimeout:5e3,noAnswerTimeout:60,stunServers:["stun:stun.l.google.com:19302"],turnServers:[],traceSip:!1,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,hackCleanJitsiSdpImageattr:!1,hackStripTcp:!1,contactTransport:"ws",forceRport:!1,autostart:!0,rel100:e.C.supported.UNSUPPORTED,replaces:e.C.supported.UNSUPPORTED,mediaHandlerFactory:e.WebRTC.MediaHandler.defaultFactory,authenticationFactory:a(function(t){return new e.DigestAuthentication(t)}),allowLegacyNotifications:!1};function l(e,n){var r=e.replace(/([a-z][A-Z])/g,function(e){return e[0]+"_"+e[1].toLowerCase()});if(e!==r){var i=t.hasOwnProperty(e);t.hasOwnProperty(r)&&(n.warn(r+" is deprecated, please use "+e),i&&n.warn(e+" overriding "+r)),t[e]=i?t[e]:t[r]}}for(n in r.configuration_check.mandatory){if(l(n,this.logger),!t.hasOwnProperty(n))throw new e.Exceptions.ConfigurationError(n);if(i=t[n],void 0===(o=r.configuration_check.mandatory[n](i)))throw new e.Exceptions.ConfigurationError(n,i);u[n]=o}e.Utils.optionsOverride(t,"rel100","reliable",!0,this.logger,e.C.supported.UNSUPPORTED);var d=["stunServers","turnServers"];for(n in r.configuration_check.optional)if(l(n,this.logger),t.hasOwnProperty(n)){if((i=t[n])instanceof Array&&0===i.length&&d.indexOf(n)<0)continue;if(null===i||""===i||void 0===i)continue;if("number"===typeof i&&isNaN(i))continue;if(void 0===(o=r.configuration_check.optional[n](i)))throw new e.Exceptions.ConfigurationError(n,i);u[n]=o}if(u.connectionRecoveryMaxInterval<u.connectionRecoveryMinInterval)throw new e.Exceptions.ConfigurationError("connectionRecoveryMaxInterval",u.connectionRecoveryMaxInterval);for(n in 0===u.displayName&&(u.displayName="0"),u.instanceId||(u.instanceId=e.Utils.newUUID()),u.sipjsId=e.Utils.createRandomToken(5),(s=u.uri.clone()).user=null,u.hostportParams=s.toRaw().replace(/^sip:/i,""),u.authorizationUser||(u.authorizationUser=u.uri.user),u.registrarServer||((c=u.uri.clone()).user=null,u.registrarServer=c),u.noAnswerTimeout=1e3*u.noAnswerTimeout,u.hackIpInContact&&("boolean"===typeof u.hackIpInContact?u.viaHost=e.Utils.getRandomTestNetIP():"string"===typeof u.hackIpInContact&&(u.viaHost=u.hackIpInContact)),u.hackWssInTransport&&(u.contactTransport="wss"),this.contact={pub_gruu:null,temp_gruu:null,uri:new e.URI("sip",e.Utils.createRandomToken(8),u.viaHost,null,{transport:u.contactTransport}),toString:function(e){var t=(e=e||{}).anonymous||null,n=e.outbound||null,r="<";return r+=t?(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport="+u.contactTransport).toString():(this.pub_gruu||this.uri).toString(),n&&(r+=";ob"),r+=">"}},e.Utils.optionsOverride(u,"media","mediaConstraints",!0,this.logger),u)r.configuration_skeleton[n].value=u[n];for(n in Object.defineProperties(this.configuration,r.configuration_skeleton),u)r.configuration_skeleton[n].value="";for(n in this.logger.log("configuration parameters after validation:"),u)switch(n){case"uri":case"registrarServer":case"mediaHandlerFactory":this.logger.log("\xb7 "+n+": "+u[n]);break;case"password":this.logger.log("\xb7 "+n+": NOT SHOWN");break;default:this.logger.log("\xb7 "+n+": "+JSON.stringify(u[n]))}},r.configuration_skeleton=function(){var e,t={},n=["sipjsId","hostportParams","uri","wsServers","authorizationUser","connectionRecoveryMaxInterval","connectionRecoveryMinInterval","keepAliveInterval","extraSupported","displayName","hackViaTcp","hackIpInContact","hackWssInTransport","hackAllowUnregisteredOptionTags","hackCleanJitsiSdpImageattr","hackStripTcp","contactTransport","forceRport","iceCheckingTimeout","instanceId","noAnswerTimeout","password","registerExpires","registrarServer","reliable","rel100","replaces","userAgentString","autostart","stunServers","traceSip","turnServers","usePreloadedRoute","wsServerMaxReconnection","wsServerReconnectionTimeout","mediaHandlerFactory","media","mediaConstraints","authenticationFactory","allowLegacyNotifications","via_core_value","viaHost"];for(e in n)t[n[e]]={value:"",writable:!1,configurable:!1};return t.register={value:"",writable:!0,configurable:!1},t}(),r.configuration_check={mandatory:{},optional:{uri:function(t){var n;return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(n=e.URI.parse(t))&&n.user?n:void 0},wsServers:function(t){var n,r,i;if("string"===typeof t)t=[{ws_uri:t}];else{if(!(t instanceof Array))return;for(r=t.length,n=0;n<r;n++)"string"===typeof t[n]&&(t[n]={ws_uri:t[n]})}if(0===t.length)return!1;for(r=t.length,n=0;n<r;n++){if(!t[n].ws_uri)return;if(t[n].weight&&!Number(t[n].weight))return;if(-1===(i=e.Grammar.parse(t[n].ws_uri,"absoluteURI")))return;if(["wss","ws","udp"].indexOf(i.scheme)<0)return;t[n].sip_uri="<sip:"+i.host+(i.port?":"+i.port:"")+";transport="+i.scheme.replace(/^wss$/i,"ws")+";lr>",t[n].weight||(t[n].weight=0),t[n].status=0,t[n].scheme=i.scheme.toUpperCase()}return t},authorizationUser:function(t){return-1===e.Grammar.parse('"'+t+'"',"quoted_string")?void 0:t},connectionRecoveryMaxInterval:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},connectionRecoveryMinInterval:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},displayName:function(t){return-1===e.Grammar.parse('"'+t+'"',"displayName")?void 0:t},hackViaTcp:function(e){if("boolean"===typeof e)return e},hackIpInContact:function(t){return"boolean"===typeof t?t:"string"===typeof t&&-1!==e.Grammar.parse(t,"host")?t:void 0},iceCheckingTimeout:function(t){if(e.Utils.isDecimal(t))return Math.max(500,t)},hackWssInTransport:function(e){if("boolean"===typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"===typeof e)return e},hackCleanJitsiSdpImageattr:function(e){if("boolean"===typeof e)return e},hackStripTcp:function(e){if("boolean"===typeof e)return e},contactTransport:function(e){if("string"===typeof e)return e},forceRport:function(e){if("boolean"===typeof e)return e},instanceId:function(t){if("string"===typeof t)return/^uuid:/i.test(t)&&(t=t.substr(5)),-1===e.Grammar.parse(t,"uuid")?void 0:t},keepAliveInterval:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},extraSupported:function(e){var t,n;if(e instanceof Array){for(n=e.length,t=0;t<n;t++)if("string"!==typeof e[t])return;return e}},noAnswerTimeout:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},password:function(e){return String(e)},rel100:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},replaces:function(t){return t===e.C.supported.REQUIRED?e.C.supported.REQUIRED:t===e.C.supported.SUPPORTED?e.C.supported.SUPPORTED:e.C.supported.UNSUPPORTED},register:function(e){if("boolean"===typeof e)return e},registerExpires:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},registrarServer:function(t){var n;if("string"===typeof t)return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(n=e.URI.parse(t))?n.user?void 0:n:void 0},stunServers:function(t){var n,r,i;if("string"===typeof t)t=[t];else if(!(t instanceof Array))return;for(r=t.length,n=0;n<r;n++){if(i=t[n],/^stuns?:/.test(i)||(i="stun:"+i),-1===e.Grammar.parse(i,"stun_URI"))return;t[n]=i}return t},traceSip:function(e){if("boolean"===typeof e)return e},turnServers:function(t){var n,r,i,a,o,s;for(t instanceof Array||(t=[t]),i=t.length,n=0;n<i;n++){if((a=t[n]).server&&(a.urls=[a.server]),!a.urls||!a.username||!a.password)return;for(a.urls instanceof Array?o=a.urls.length:(a.urls=[a.urls],o=1),r=0;r<o;r++)if(s=a.urls[r],/^turns?:/.test(s)||(s="turn:"+s),-1===e.Grammar.parse(s,"turn_URI"))return}return t},userAgentString:function(e){if("string"===typeof e)return e},usePreloadedRoute:function(e){if("boolean"===typeof e)return e},wsServerMaxReconnection:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},wsServerReconnectionTimeout:function(t){var n;if(e.Utils.isDecimal(t)&&(n=Number(t))>0)return n},autostart:function(e){if("boolean"===typeof e)return e},mediaHandlerFactory:function(t){if(t instanceof Function){var n=function(){var n=t.apply(this,arguments);function r(t){if(n[t].length>1){var r="getDescription"===t;n[t]=e.Utils.promisify(n,t,r)}}return r("getDescription"),r("setDescription"),n};return n.isSupported=t.isSupported,n}},authenticationFactory:a,allowLegacyNotifications:function(e){if("boolean"===typeof e)return e}}},r.C=i,e.UA=r}}).call(this,n(48))},function(e,t,n){"use strict";e.exports=function(e){e=e;var t={AllBrowsers:{maskDtls:function(e){return e&&(e=e.replace(/ UDP\/TLS\/RTP\/SAVP/gim," RTP/SAVP")),e},unmaskDtls:function(e){return e.replace(/ RTP\/SAVP/gim," UDP/TLS/RTP/SAVP")}},Firefox:{isFirefox:function(){return"undefined"!==typeof mozRTCPeerConnection},cannotHandleExtraWhitespace:function(e){return this.isFirefox()&&e&&(e=e.replace(/ \r\n/g,"\r\n")),e},hasMissingCLineInSDP:function(e){var t,n;if(e.indexOf("c=")>e.indexOf("m=")){n=e.match(/m=.*\r\n.*/g);for(var r=0;r<n.length;r++)n[r].toString().search(/i=.*/)>=0?(t=e.indexOf(n[r].toString())+n[r].toString().length,"c="!==e.substr(t,2)&&(e=e.substr(0,t)+"\r\nc=IN IP4 0.0.0.0"+e.substr(t))):n[r].toString().search(/c=.*/)<0&&(t=e.indexOf(n[r].toString().match(/.*/))+n[r].toString().match(/.*/).toString().length,e=e.substr(0,t)+"\r\nc=IN IP4 0.0.0.0"+e.substr(t))}return e}},Chrome:{needsExplicitlyInactiveSDP:function(e){var n,r;return t.Firefox.isFirefox()&&-1!==(r=e.indexOf("m=video 0"))?(n=(n=e.substr(r)).replace(/\r\nc=IN IP4.*\r\n$/,"\r\nc=IN IP4 0.0.0.0\r\na=inactive\r\n"),e.substr(0,r)+n):e},getsConfusedAboutGUM:function(e){e.mediaHandler&&e.mediaHandler.close()}}};return t}},function(e,t,n){"use strict";e.exports=function(e){var t,n=[],r=[],i=[];function a(t,n,r){for(var i,a=e.Utils.buildStatusLine(t),o=n.getHeaders("via"),s=o.length,c=0;c<s;c++)a+="Via: "+o[c]+"\r\n";i=n.getHeader("To"),n.to_tag||(i+=";tag="+e.Utils.newTag()),a+="To: "+i+"\r\n",a+="From: "+n.getHeader("From")+"\r\n",a+="Call-ID: "+n.call_id+"\r\n",a+="CSeq: "+n.cseq+" "+n.method+"\r\n",a+="\r\n",r.send(a)}n.push(function(e,t,n){if(!e.ruri||"sip"!==e.ruri.scheme)return a(416,e,n),!1}),n.push(function(e,t,n){if(!e.to_tag&&e.call_id.substr(0,5)===t.configuration.sipjsId)return a(482,e,n),!1}),n.push(function(t,n,r){if(e.Utils.str_utf8_length(t.body)<t.getHeader("content-length"))return a(400,t,r),!1}),n.push(function(t,n,r){var i,o,s=t.from_tag,c=t.call_id,u=t.cseq;if(!t.to_tag)if(t.method===e.C.INVITE){if(i=n.transactions.ist[t.via_branch])return;for(o in n.transactions.ist)if((i=n.transactions.ist[o]).request.from_tag===s&&i.request.call_id===c&&i.request.cseq===u)return a(482,t,r),!1}else{if(i=n.transactions.nist[t.via_branch])return;for(o in n.transactions.nist)if((i=n.transactions.nist[o]).request.from_tag===s&&i.request.call_id===c&&i.request.cseq===u)return a(482,t,r),!1}}),r.push(function(e,t){if(e.getHeaders("via").length>1)return t.getLogger("sip.sanitycheck").warn("More than one Via header field present in the response. Dropping the response"),!1}),r.push(function(t,n){if(e.Utils.str_utf8_length(t.body)<t.getHeader("content-length"))return n.getLogger("sip.sanitycheck").warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1}),i.push(function(e,t){for(var n=["from","to","call_id","cseq","via"],r=n.length;r--;)if(!e.hasHeader(n[r]))return t.getLogger("sip.sanitycheck").warn("Missing mandatory header field : "+n[r]+". Dropping the response"),!1}),t=function(t,a,o){var s;for(s=i.length;s--;)if(!1===i[s](t,a,o))return!1;if(t instanceof e.IncomingRequest){for(s=n.length;s--;)if(!1===n[s](t,a,o))return!1}else if(t instanceof e.IncomingResponse)for(s=r.length;s--;)if(!1===r[s](t,a,o))return!1;return!0},e.sanityCheck=t}},function(e,t,n){"use strict";e.exports=function(e){var t;return(t=function(e){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null}).prototype.authenticate=function(t,n){if(this.algorithm=n.algorithm,this.realm=n.realm,this.nonce=n.nonce,this.opaque=n.opaque,this.stale=n.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(n.qop)if(n.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(n.qop.indexOf("auth-int")>-1))return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=t.method,this.uri=t.ruri,this.cnonce=e.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},t.prototype.calculateResponse=function(){var t,n;t=e.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(n=e.calculateMD5(this.method+":"+this.uri),this.response=e.calculateMD5(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+n)):"auth-int"===this.qop?(n=e.calculateMD5(this.method+":"+this.uri+":"+e.calculateMD5(this.body?this.body:"")),this.response=e.calculateMD5(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+n)):null===this.qop&&(n=e.calculateMD5(this.method+":"+this.uri),this.response=e.calculateMD5(t+":"+this.nonce+":"+n))},t.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},t.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},t}},function(e,t,n){"use strict";var r=n(1626);e.exports=function(e){return{parse:function(t,n){var i={startRule:n,SIP:e};try{r.parse(t,i)}catch(a){i.data=-1}return i.data}}}},function(e,t){e.exports=function(){function e(e,t,n,r,i,a){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=a,this.name="SyntaxError"}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:function(t){var n,r=arguments.length>1?arguments[1]:{},i={},a={Contact:118,Name_Addr_Header:155,Record_Route:175,Request_Response:81,SIP_URI:45,Subscription_State:185,Supported:190,Require:181,Via:193,absoluteURI:84,Call_ID:117,Content_Disposition:129,Content_Length:134,Content_Type:135,CSeq:145,displayName:121,Event:148,From:150,host:52,Max_Forwards:153,Min_SE:212,Proxy_Authenticate:156,quoted_string:40,Refer_To:177,Replaces:178,Session_Expires:209,stun_URI:216,To:191,turn_URI:223,uuid:226,WWW_Authenticate:208,challenge:157},o=118,s=["\r\n",{type:"literal",value:"\r\n",description:'"\\r\\n"'},/^[0-9]/,{type:"class",value:"[0-9]",description:"[0-9]"},/^[a-zA-Z]/,{type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},/^[0-9a-fA-F]/,{type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},/^[\0-\xFF]/,{type:"class",value:"[\\0-\\xFF]",description:"[\\0-\\xFF]"},/^["]/,{type:"class",value:'["]',description:'["]'}," ",{type:"literal",value:" ",description:'" "'},"\t",{type:"literal",value:"\t",description:'"\\t"'},/^[a-zA-Z0-9]/,{type:"class",value:"[a-zA-Z0-9]",description:"[a-zA-Z0-9]"},";",{type:"literal",value:";",description:'";"'},"/",{type:"literal",value:"/",description:'"/"'},"?",{type:"literal",value:"?",description:'"?"'},":",{type:"literal",value:":",description:'":"'},"@",{type:"literal",value:"@",description:'"@"'},"&",{type:"literal",value:"&",description:'"&"'},"=",{type:"literal",value:"=",description:'"="'},"+",{type:"literal",value:"+",description:'"+"'},"$",{type:"literal",value:"$",description:'"$"'},",",{type:"literal",value:",",description:'","'},"-",{type:"literal",value:"-",description:'"-"'},"_",{type:"literal",value:"_",description:'"_"'},".",{type:"literal",value:".",description:'"."'},"!",{type:"literal",value:"!",description:'"!"'},"~",{type:"literal",value:"~",description:'"~"'},"*",{type:"literal",value:"*",description:'"*"'},"'",{type:"literal",value:"'",description:'"\'"'},"(",{type:"literal",value:"(",description:'"("'},")",{type:"literal",value:")",description:'")"'},i,"%",{type:"literal",value:"%",description:'"%"'},null,[],function(){return" "},function(){return":"},/^[!-~]/,{type:"class",value:"[!-~]",description:"[!-~]"},/^[\x80-\uFFFF]/,{type:"class",value:"[\\x80-\\uFFFF]",description:"[\\x80-\\uFFFF]"},/^[\x80-\xBF]/,{type:"class",value:"[\\x80-\\xBF]",description:"[\\x80-\\xBF]"},/^[a-f]/,{type:"class",value:"[a-f]",description:"[a-f]"},"`",{type:"literal",value:"`",description:'"`"'},"<",{type:"literal",value:"<",description:'"<"'},">",{type:"literal",value:">",description:'">"'},"\\",{type:"literal",value:"\\",description:'"\\\\"'},"[",{type:"literal",value:"[",description:'"["'},"]",{type:"literal",value:"]",description:'"]"'},"{",{type:"literal",value:"{",description:'"{"'},"}",{type:"literal",value:"}",description:'"}"'},function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,{type:"class",value:"[!-']",description:"[!-']"},/^[*-[]/,{type:"class",value:"[*-[]",description:"[*-[]"},/^[\]-~]/,{type:"class",value:"[\\]-~]",description:"[\\]-~]"},function(e){return e},/^[#-[]/,{type:"class",value:"[#-[]",description:"[#-[]"},/^[\0-\t]/,{type:"class",value:"[\\0-\\t]",description:"[\\0-\\t]"},/^[\x0B-\f]/,{type:"class",value:"[\\x0B-\\f]",description:"[\\x0B-\\f]"},/^[\x0E-\x7f]/,{type:"class",value:"[\\x0E-\x7f]",description:"[\\x0E-\x7f]"},function(){r.data.uri=new r.SIP.URI(r.data.scheme,r.data.user,r.data.host,r.data.port),delete r.data.scheme,delete r.data.user,delete r.data.host,delete r.data.host_type,delete r.data.port},function(){r.data.uri=new r.SIP.URI(r.data.scheme,r.data.user,r.data.host,r.data.port,r.data.uri_params,r.data.uri_headers),delete r.data.scheme,delete r.data.user,delete r.data.host,delete r.data.host_type,delete r.data.port,delete r.data.uri_params,"SIP_URI"===r.startRule&&(r.data=r.data.uri)},"sips",{type:"literal",value:"sips",description:'"sips"'},"sip",{type:"literal",value:"sip",description:'"sip"'},function(e){r.data.scheme=e},function(){r.data.user=decodeURIComponent(m().slice(0,-1))},function(){r.data.password=m()},function(){return r.data.host=m(),r.data.host},function(){return r.data.host_type="domain",m()},/^[a-zA-Z0-9_\-]/,{type:"class",value:"[a-zA-Z0-9_\\-]",description:"[a-zA-Z0-9_\\-]"},/^[a-zA-Z0-9\-]/,{type:"class",value:"[a-zA-Z0-9\\-]",description:"[a-zA-Z0-9\\-]"},function(){return r.data.host_type="IPv6",m()},"::",{type:"literal",value:"::",description:'"::"'},function(){return r.data.host_type="IPv6",m()},function(){return r.data.host_type="IPv4",m()},"25",{type:"literal",value:"25",description:'"25"'},/^[0-5]/,{type:"class",value:"[0-5]",description:"[0-5]"},"2",{type:"literal",value:"2",description:'"2"'},/^[0-4]/,{type:"class",value:"[0-4]",description:"[0-4]"},"1",{type:"literal",value:"1",description:'"1"'},/^[1-9]/,{type:"class",value:"[1-9]",description:"[1-9]"},function(e){return e=parseInt(e.join("")),r.data.port=e,e},"transport=",{type:"literal",value:"transport=",description:'"transport="'},"udp",{type:"literal",value:"udp",description:'"udp"'},"tcp",{type:"literal",value:"tcp",description:'"tcp"'},"sctp",{type:"literal",value:"sctp",description:'"sctp"'},"tls",{type:"literal",value:"tls",description:'"tls"'},function(e){r.data.uri_params||(r.data.uri_params={}),r.data.uri_params.transport=e.toLowerCase()},"user=",{type:"literal",value:"user=",description:'"user="'},"phone",{type:"literal",value:"phone",description:'"phone"'},"ip",{type:"literal",value:"ip",description:'"ip"'},function(e){r.data.uri_params||(r.data.uri_params={}),r.data.uri_params.user=e.toLowerCase()},"method=",{type:"literal",value:"method=",description:'"method="'},function(e){r.data.uri_params||(r.data.uri_params={}),r.data.uri_params.method=e},"ttl=",{type:"literal",value:"ttl=",description:'"ttl="'},function(e){r.data.params||(r.data.params={}),r.data.params.ttl=e},"maddr=",{type:"literal",value:"maddr=",description:'"maddr="'},function(e){r.data.uri_params||(r.data.uri_params={}),r.data.uri_params.maddr=e},"lr",{type:"literal",value:"lr",description:'"lr"'},function(){r.data.uri_params||(r.data.uri_params={}),r.data.uri_params.lr=void 0},function(e,t){r.data.uri_params||(r.data.uri_params={}),t=null===t?void 0:t[1],r.data.uri_params[e.toLowerCase()]=t&&t.toLowerCase()},function(e,t){e=e.join("").toLowerCase(),t=t.join(""),r.data.uri_headers||(r.data.uri_headers={}),r.data.uri_headers[e]?r.data.uri_headers[e].push(t):r.data.uri_headers[e]=[t]},function(){"Refer_To"===r.startRule&&(r.data.uri=new r.SIP.URI(r.data.scheme,r.data.user,r.data.host,r.data.port,r.data.uri_params,r.data.uri_headers),delete r.data.scheme,delete r.data.user,delete r.data.host,delete r.data.host_type,delete r.data.port,delete r.data.uri_params)},"//",{type:"literal",value:"//",description:'"//"'},function(){r.data.scheme=m()},{type:"literal",value:"SIP",description:'"SIP"'},function(){r.data.sip_version=m()},"INVITE",{type:"literal",value:"INVITE",description:'"INVITE"'},"ACK",{type:"literal",value:"ACK",description:'"ACK"'},"VXACH",{type:"literal",value:"VXACH",description:'"VXACH"'},"OPTIONS",{type:"literal",value:"OPTIONS",description:'"OPTIONS"'},"BYE",{type:"literal",value:"BYE",description:'"BYE"'},"CANCEL",{type:"literal",value:"CANCEL",description:'"CANCEL"'},"REGISTER",{type:"literal",value:"REGISTER",description:'"REGISTER"'},"SUBSCRIBE",{type:"literal",value:"SUBSCRIBE",description:'"SUBSCRIBE"'},"NOTIFY",{type:"literal",value:"NOTIFY",description:'"NOTIFY"'},"REFER",{type:"literal",value:"REFER",description:'"REFER"'},function(){return r.data.method=m(),r.data.method},function(e){r.data.status_code=parseInt(e.join(""))},function(){r.data.reason_phrase=m()},function(){r.data=m()},function(){var e,t;for(t=r.data.multi_header.length,e=0;e<t;e++)if(null===r.data.multi_header[e].parsed){r.data=null;break}null!==r.data?r.data=r.data.multi_header:r.data=-1},function(){var e;r.data.multi_header||(r.data.multi_header=[]);try{e=new r.SIP.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params),delete r.data.uri,delete r.data.displayName,delete r.data.params}catch(t){e=null}r.data.multi_header.push({position:u,offset:g(),parsed:e})},function(e){'"'===(e=m().trim())[0]&&(e=e.substring(1,e.length-1)),r.data.displayName=e},"q",{type:"literal",value:"q",description:'"q"'},function(e){r.data.params||(r.data.params={}),r.data.params.q=e},"expires",{type:"literal",value:"expires",description:'"expires"'},function(e){r.data.params||(r.data.params={}),r.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",{type:"literal",value:"0",description:'"0"'},function(){return parseFloat(m())},function(e,t){r.data.params||(r.data.params={}),t=null===t?void 0:t[1],r.data.params[e.toLowerCase()]=t},"render",{type:"literal",value:"render",description:'"render"'},"session",{type:"literal",value:"session",description:'"session"'},"icon",{type:"literal",value:"icon",description:'"icon"'},"alert",{type:"literal",value:"alert",description:'"alert"'},function(){"Content_Disposition"===r.startRule&&(r.data.type=m().toLowerCase())},"handling",{type:"literal",value:"handling",description:'"handling"'},"optional",{type:"literal",value:"optional",description:'"optional"'},"required",{type:"literal",value:"required",description:'"required"'},function(e){r.data=parseInt(e.join(""))},function(){r.data=m()},"text",{type:"literal",value:"text",description:'"text"'},"image",{type:"literal",value:"image",description:'"image"'},"audio",{type:"literal",value:"audio",description:'"audio"'},"video",{type:"literal",value:"video",description:'"video"'},"application",{type:"literal",value:"application",description:'"application"'},"message",{type:"literal",value:"message",description:'"message"'},"multipart",{type:"literal",value:"multipart",description:'"multipart"'},"x-",{type:"literal",value:"x-",description:'"x-"'},function(e){r.data.value=parseInt(e.join(""))},function(e){r.data=e},function(e){r.data.event=e.toLowerCase()},function(){var e=r.data.tag;r.data=new r.SIP.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params),e&&r.data.setParam("tag",e)},"tag",{type:"literal",value:"tag",description:'"tag"'},function(e){r.data.tag=e},function(e){r.data=parseInt(e.join(""))},function(e){r.data=e},function(){r.data=new r.SIP.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params)},"digest",{type:"literal",value:"Digest",description:'"Digest"'},"realm",{type:"literal",value:"realm",description:'"realm"'},function(e){r.data.realm=e},"domain",{type:"literal",value:"domain",description:'"domain"'},"nonce",{type:"literal",value:"nonce",description:'"nonce"'},function(e){r.data.nonce=e},"opaque",{type:"literal",value:"opaque",description:'"opaque"'},function(e){r.data.opaque=e},"stale",{type:"literal",value:"stale",description:'"stale"'},"true",{type:"literal",value:"true",description:'"true"'},function(){r.data.stale=!0},"false",{type:"literal",value:"false",description:'"false"'},function(){r.data.stale=!1},"algorithm",{type:"literal",value:"algorithm",description:'"algorithm"'},"md5",{type:"literal",value:"MD5",description:'"MD5"'},"md5-sess",{type:"literal",value:"MD5-sess",description:'"MD5-sess"'},function(e){r.data.algorithm=e.toUpperCase()},"qop",{type:"literal",value:"qop",description:'"qop"'},"auth-int",{type:"literal",value:"auth-int",description:'"auth-int"'},"auth",{type:"literal",value:"auth",description:'"auth"'},function(e){r.data.qop||(r.data.qop=[]),r.data.qop.push(e.toLowerCase())},function(e){r.data.value=parseInt(e.join(""))},function(){var e,t;for(t=r.data.multi_header.length,e=0;e<t;e++)if(null===r.data.multi_header[e].parsed){r.data=null;break}null!==r.data?r.data=r.data.multi_header:r.data=-1},function(){var e;r.data.multi_header||(r.data.multi_header=[]);try{e=new r.SIP.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params),delete r.data.uri,delete r.data.displayName,delete r.data.params}catch(t){e=null}r.data.multi_header.push({position:u,offset:g(),parsed:e})},function(){r.data=new r.SIP.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params)},function(){r.data.replaces_from_tag&&r.data.replaces_to_tag||(r.data=-1)},function(){r.data={call_id:r.data}},"from-tag",{type:"literal",value:"from-tag",description:'"from-tag"'},function(e){r.data.replaces_from_tag=e},"to-tag",{type:"literal",value:"to-tag",description:'"to-tag"'},function(e){r.data.replaces_to_tag=e},"early-only",{type:"literal",value:"early-only",description:'"early-only"'},function(){r.data.early_only=!0},function(e){return e},function(e,t){return function(e,t){return[e].concat(t)}(e,t)},function(e){"Require"===r.startRule&&(r.data=e||[])},function(e){r.data.value=parseInt(e.join(""))},"active",{type:"literal",value:"active",description:'"active"'},"pending",{type:"literal",value:"pending",description:'"pending"'},"terminated",{type:"literal",value:"terminated",description:'"terminated"'},function(){r.data.state=m()},"reason",{type:"literal",value:"reason",description:'"reason"'},function(e){"undefined"!==typeof e&&(r.data.reason=e)},function(e){"undefined"!==typeof e&&(r.data.expires=e)},"retry_after",{type:"literal",value:"retry_after",description:'"retry_after"'},function(e){"undefined"!==typeof e&&(r.data.retry_after=e)},"deactivated",{type:"literal",value:"deactivated",description:'"deactivated"'},"probation",{type:"literal",value:"probation",description:'"probation"'},"rejected",{type:"literal",value:"rejected",description:'"rejected"'},"timeout",{type:"literal",value:"timeout",description:'"timeout"'},"giveup",{type:"literal",value:"giveup",description:'"giveup"'},"noresource",{type:"literal",value:"noresource",description:'"noresource"'},"invariant",{type:"literal",value:"invariant",description:'"invariant"'},function(e){"Supported"===r.startRule&&(r.data=e||[])},function(){var e=r.data.tag;r.data=new r.SIP.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params),e&&r.data.setParam("tag",e)},"ttl",{type:"literal",value:"ttl",description:'"ttl"'},function(e){r.data.ttl=e},"maddr",{type:"literal",value:"maddr",description:'"maddr"'},function(e){r.data.maddr=e},"received",{type:"literal",value:"received",description:'"received"'},function(e){r.data.received=e},"branch",{type:"literal",value:"branch",description:'"branch"'},function(e){r.data.branch=e},"rport",{type:"literal",value:"rport",description:'"rport"'},function(){"undefined"!==typeof response_port&&(r.data.rport=response_port.join(""))},function(e){r.data.protocol=e},{type:"literal",value:"UDP",description:'"UDP"'},{type:"literal",value:"TCP",description:'"TCP"'},{type:"literal",value:"TLS",description:'"TLS"'},{type:"literal",value:"SCTP",description:'"SCTP"'},function(e){r.data.transport=e},function(){r.data.host=m()},function(e){r.data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===r.startRule&&(r.data.deltaSeconds=e)},"refresher",{type:"literal",value:"refresher",description:'"refresher"'},"uas",{type:"literal",value:"uas",description:'"uas"'},"uac",{type:"literal",value:"uac",description:'"uac"'},function(e){"Session_Expires"===r.startRule&&(r.data.refresher=e)},function(e){"Min_SE"===r.startRule&&(r.data=e)},"stuns",{type:"literal",value:"stuns",description:'"stuns"'},"stun",{type:"literal",value:"stun",description:'"stun"'},function(e){r.data.scheme=e},function(e){r.data.host=e},"?transport=",{type:"literal",value:"?transport=",description:'"?transport="'},"turns",{type:"literal",value:"turns",description:'"turns"'},"turn",{type:"literal",value:"turn",description:'"turn"'},function(){r.data.transport=transport},function(){r.data=m()}],c=[k('. ""2 3!'),k('0"""1!3#'),k('0$""1!3%'),k('0&""1!3\''),k("7'*# \"7("),k('0(""1!3)'),k('0*""1!3+'),k('.,""2,3-'),k('..""2.3/'),k('00""1!31'),k('.2""2233*\x89 ".4""2435*} ".6""2637*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),k('7)*# "7,'),k('.F""2F3G*} ".H""2H3I*q ".J""2J3K*e ".L""2L3M*Y ".N""2N3O*M ".P""2P3Q*A ".R""2R3S*5 ".T""2T3U*) ".V""2V3W'),k('!!.Y""2Y3Z+7$7#+-%7#+#%\'#%$## X$"# X"# X+! (%'),k('!! \\7$,#&7$"+-$7 +#%\'"%$"# X"# X*# " [+@$ \\7$+&$,#&7$""" X+\'%4"6]" %$"# X"# X'),k('7.*# " ['),k('! \\7\'*# "7(,)&7\'*# "7("+A$.8""2839+1%7/+\'%4#6^# %$## X$"# X"# X'),k('!! \\72+&$,#&72""" X+o$ \\! \\7.,#&7."+-$72+#%\'"%$"# X"# X,@&! \\7.,#&7."+-$72+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+! (%'),k('0_""1!3`*# "73'),k('0a""1!3b'),k('0c""1!3d'),k('7!*) "0e""1!3f'),k('! \\7)*\x95 ".F""2F3G*\x89 ".J""2J3K*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O+\x9e$,\x9b&7)*\x95 ".F""2F3G*\x89 ".J""2J3K*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O""" X+! (%'),k('! \\7)*\x89 ".F""2F3G*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O+\x92$,\x8f&7)*\x89 ".F""2F3G*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O""" X+! (%'),k('.T""2T3U*\xe3 ".V""2V3W*\xd7 ".i""2i3j*\xcb ".k""2k3l*\xbf ".:""2:3;*\xb3 ".D""2D3E*\xa7 ".2""2233*\x9b ".8""2839*\x8f ".m""2m3n*\x83 "7&*} ".4""2435*q ".o""2o3p*e ".q""2q3r*Y ".6""2637*M ".>""2>3?*A ".s""2s3t*5 ".u""2u3v*) "7\'*# "7('),k('! \\7)*\u012b ".F""2F3G*\u011f ".J""2J3K*\u0113 ".L""2L3M*\u0107 ".Y""2Y3Z*\xfb ".P""2P3Q*\xef ".H""2H3I*\xe3 ".@""2@3A*\xd7 ".g""2g3h*\xcb ".R""2R3S*\xbf ".N""2N3O*\xb3 ".T""2T3U*\xa7 ".V""2V3W*\x9b ".i""2i3j*\x8f ".k""2k3l*\x83 ".8""2839*w ".m""2m3n*k "7&*e ".4""2435*Y ".o""2o3p*M ".q""2q3r*A ".6""2637*5 ".s""2s3t*) ".u""2u3v+\u0134$,\u0131&7)*\u012b ".F""2F3G*\u011f ".J""2J3K*\u0113 ".L""2L3M*\u0107 ".Y""2Y3Z*\xfb ".P""2P3Q*\xef ".H""2H3I*\xe3 ".@""2@3A*\xd7 ".g""2g3h*\xcb ".R""2R3S*\xbf ".N""2N3O*\xb3 ".T""2T3U*\xa7 ".V""2V3W*\x9b ".i""2i3j*\x8f ".k""2k3l*\x83 ".8""2839*w ".m""2m3n*k "7&*e ".4""2435*Y ".o""2o3p*M ".q""2q3r*A ".6""2637*5 ".s""2s3t*) ".u""2u3v""" X+! (%'),k('!7/+A$.P""2P3Q+1%7/+\'%4#6w# %$## X$"# X"# X'),k('!7/+A$.4""2435+1%7/+\'%4#6x# %$## X$"# X"# X'),k('!7/+A$.>""2>3?+1%7/+\'%4#6y# %$## X$"# X"# X'),k('!7/+A$.T""2T3U+1%7/+\'%4#6z# %$## X$"# X"# X'),k('!7/+A$.V""2V3W+1%7/+\'%4#6{# %$## X$"# X"# X'),k('!.k""2k3l+1$7/+\'%4"6|" %$"# X"# X'),k('!7/+7$.i""2i3j+\'%4"6}" %$"# X"# X'),k('!7/+A$.D""2D3E+1%7/+\'%4#6~# %$## X$"# X"# X'),k('!7/+A$.2""2233+1%7/+\'%4#6\x7f# %$## X$"# X"# X'),k('!7/+A$.8""2839+1%7/+\'%4#6\x80# %$## X$"# X"# X'),k('!7/+1$7&+\'%4"6\x81" %$"# X"# X'),k('!7&+1$7/+\'%4"6\x81" %$"# X"# X'),k('!7=+W$ \\7G*) "7K*# "7F,/&7G*) "7K*# "7F"+-%7>+#%\'#%$## X$"# X"# X'),k('0\x82""1!3\x83*A "0\x84""1!3\x85*5 "0\x86""1!3\x87*) "73*# "7.'),k('!!7/+U$7&+K% \\7J*# "7K,)&7J*# "7K"+-%7&+#%\'$%$$# X$## X$"# X"# X+! (%'),k('!7/+`$7&+V%! \\7J*# "7K,)&7J*# "7K"+! (%+2%7&+(%4$6\x88$!!%$$# X$## X$"# X"# X'),k('7.*G ".L""2L3M*; "0\x89""1!3\x8a*/ "0\x86""1!3\x87*# "73'),k('!.m""2m3n+K$0\x8b""1!3\x8c*5 "0\x8d""1!3\x8e*) "0\x8f""1!3\x90+#%\'"%$"# X"# X'),k('!7N+Q$.8""2839+A%7O*# " [+1%7S+\'%4$6\x91$ %$$# X$## X$"# X"# X'),k('!7N+k$.8""2839+[%7O*# " [+K%7S+A%7_+7%7l*# " [+\'%4&6\x92& %$&# X$%# X$$# X$## X$"# X"# X'),k('!/\x93""1$3\x94*) "/\x95""1#3\x96+\' 4!6\x97!! %'),k('!7P+b$!.8""2839+-$7R+#%\'"%$"# X"# X*# " [+7%.:""2:3;+\'%4#6\x98# %$## X$"# X"# X'),k(' \\7+*) "7-*# "7Q+2$,/&7+*) "7-*# "7Q""" X'),k('.<""2<3=*q ".>""2>3?*e ".@""2@3A*Y ".B""2B3C*M ".D""2D3E*A ".2""2233*5 ".6""2637*) ".4""2435'),k('! \\7+*_ "7-*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E,e&7+*_ "7-*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E"+& 4!6\x99! %'),k('!7T+N$!.8""2839+-$7^+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),k('!7U*) "7\\*# "7X+& 4!6\x9a! %'),k('! \\!7V+3$.J""2J3K+#%\'"%$"# X"# X,>&!7V+3$.J""2J3K+#%\'"%$"# X"# X"+G$7W+=%.J""2J3K*# " [+\'%4#6\x9b# %$## X$"# X"# X'),k(' \\0\x9c""1!3\x9d+,$,)&0\x9c""1!3\x9d""" X'),k('!0$""1!3%+A$ \\0\x9e""1!3\x9f,)&0\x9e""1!3\x9f"+#%\'"%$"# X"# X'),k('!.o""2o3p+A$7Y+7%.q""2q3r+\'%4#6\xa0# %$## X$"# X"# X'),k('!!7Z+\xbf$.8""2839+\xaf%7Z+\xa5%.8""2839+\x95%7Z+\x8b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'-%$-# X$,# X$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0838 "!.\xa1""2\xa13\xa2+\xaf$7Z+\xa5%.8""2839+\x95%7Z+\x8b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\',%$,# X$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0795 "!.\xa1""2\xa13\xa2+\x95$7Z+\x8b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'*%$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u070c "!.\xa1""2\xa13\xa2+{$7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u069d "!.\xa1""2\xa13\xa2+a$7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'&%$&# X$%# X$$# X$## X$"# X"# X*\u0648 "!.\xa1""2\xa13\xa2+G$7Z+=%.8""2839+-%7[+#%\'$%$$# X$## X$"# X"# X*\u060d "!.\xa1""2\xa13\xa2+-$7[+#%\'"%$"# X"# X*\u05ec "!.\xa1""2\xa13\xa2+-$7Z+#%\'"%$"# X"# X*\u05cb "!7Z+\xa5$.\xa1""2\xa13\xa2+\x95%7Z+\x8b%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'+%$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0538 "!7Z+\xb6$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\x8b%.\xa1""2\xa13\xa2+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'*%$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0494 "!7Z+\xc7$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\x9c%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+q%.\xa1""2\xa13\xa2+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\')%$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u03df "!7Z+\xd8$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\xad%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\x82%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+W%.\xa1""2\xa13\xa2+G%7Z+=%.8""2839+-%7[+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0319 "!7Z+\xe9$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\xbe%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\x93%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+h%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+=%.\xa1""2\xa13\xa2+-%7[+#%\'\'%$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0242 "!7Z+\u0114$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\xe9%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\xbe%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\x93%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+h%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+=%.\xa1""2\xa13\xa2+-%7Z+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*\u0140 "!7Z+\u0135$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\u010a%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\xdf%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\xb4%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+\x89%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+^%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+3%.\xa1""2\xa13\xa2+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X+& 4!6\xa3! %'),k('!7#+S$7#*# " [+C%7#*# " [+3%7#*# " [+#%\'$%$$# X$## X$"# X"# X'),k('!7Z+=$.8""2839+-%7Z+#%\'#%$## X$"# X"# X*# "7\\'),k('!7]+u$.J""2J3K+e%7]+[%.J""2J3K+K%7]+A%.J""2J3K+1%7]+\'%4\'6\xa4\' %$\'# X$&# X$%# X$$# X$## X$"# X"# X'),k('!.\xa5""2\xa53\xa6+3$0\xa7""1!3\xa8+#%\'"%$"# X"# X*\xa0 "!.\xa9""2\xa93\xaa+=$0\xab""1!3\xac+-%7!+#%\'#%$## X$"# X"# X*o "!.\xad""2\xad3\xae+7$7!+-%7!+#%\'#%$## X$"# X"# X*D "!0\xaf""1!3\xb0+-$7!+#%\'"%$"# X"# X*# "7!'),k('!!7!*# " [+c$7!*# " [+S%7!*# " [+C%7!*# " [+3%7!*# " [+#%\'%%$%# X$$# X$## X$"# X"# X+\' 4!6\xb1!! %'),k(' \\!.2""2233+-$7`+#%\'"%$"# X"# X,>&!.2""2233+-$7`+#%\'"%$"# X"# X"'),k('7a*A "7b*; "7c*5 "7d*/ "7e*) "7f*# "7g'),k('!/\xb2""1*3\xb3+b$/\xb4""1#3\xb5*G "/\xb6""1#3\xb7*; "/\xb8""1$3\xb9*/ "/\xba""1#3\xbb*# "76+(%4"6\xbc"! %$"# X"# X'),k('!/\xbd""1%3\xbe+J$/\xbf""1%3\xc0*/ "/\xc1""1"3\xc2*# "76+(%4"6\xc3"! %$"# X"# X'),k('!/\xc4""1\'3\xc5+2$7\x8f+(%4"6\xc6"! %$"# X"# X'),k('!/\xc7""1$3\xc8+2$7\xef+(%4"6\xc9"! %$"# X"# X'),k('!/\xca""1&3\xcb+2$7T+(%4"6\xcc"! %$"# X"# X'),k('!/\xcd""1"3\xce+R$!.>""2>3?+-$76+#%\'"%$"# X"# X*# " [+\'%4"6\xcf" %$"# X"# X'),k('!7h+T$!.>""2>3?+-$7i+#%\'"%$"# X"# X*# " [+)%4"6\xd0""! %$"# X"# X'),k('! \\7j+&$,#&7j""" X+! (%'),k('! \\7j+&$,#&7j""" X+! (%'),k('7k*) "7+*# "7-'),k('.o""2o3p*e ".q""2q3r*Y ".4""2435*M ".8""2839*A ".<""2<3=*5 ".@""2@3A*) ".B""2B3C'),k('!.6""2637+u$7m+k% \\!.<""2<3=+-$7m+#%\'"%$"# X"# X,>&!.<""2<3=+-$7m+#%\'"%$"# X"# X"+#%\'#%$## X$"# X"# X'),k('!7n+C$.>""2>3?+3%7o+)%4#6\xd1#"" %$## X$"# X"# X'),k(' \\7p*) "7+*# "7-+2$,/&7p*) "7+*# "7-""" X'),k(' \\7p*) "7+*# "7-,/&7p*) "7+*# "7-"'),k('.o""2o3p*e ".q""2q3r*Y ".4""2435*M ".6""2637*A ".8""2839*5 ".@""2@3A*) ".B""2B3C'),k('7\x90*# "7r'),k("!7\x8f+K$7'+A%7s+7%7'+-%7\x84+#%'%%$%# X$$# X$## X$\"# X\"# X"),k('7M*# "7t'),k('!7\x7f+G$.8""2839+7%7u*# "7x+\'%4#6\xd2# %$## X$"# X"# X'),k('!7v*# "7w+N$!.6""2637+-$7\x83+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),k('!.\xd3""2\xd33\xd4+=$7\x80+3%7w*# " [+#%\'#%$## X$"# X"# X'),k('!.4""2435+-$7{+#%\'"%$"# X"# X'),k('!7z+5$ \\7y,#&7y"+#%\'"%$"# X"# X'),k('7**) "7+*# "7-'),k('7+*\x8f "7-*\x89 ".2""2233*} ".6""2637*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),k('!7|+k$ \\!.4""2435+-$7|+#%\'"%$"# X"# X,>&!.4""2435+-$7|+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),k('! \\7~,#&7~"+k$ \\!.2""2233+-$7}+#%\'"%$"# X"# X,>&!.2""2233+-$7}+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),k(' \\7~,#&7~"'),k('7+*w "7-*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),k('!7"+\x8d$ \\7"*G "7!*A ".@""2@3A*5 ".F""2F3G*) ".J""2J3K,M&7"*G "7!*A ".@""2@3A*5 ".F""2F3G*) ".J""2J3K"+\'%4"6\xd5" %$"# X"# X'),k('7\x81*# "7\x82'),k('!!7O+3$.:""2:3;+#%\'"%$"# X"# X*# " [+-$7S+#%\'"%$"# X"# X*# " ['),k(' \\7+*\x83 "7-*} ".B""2B3C*q ".D""2D3E*e ".2""2233*Y ".8""2839*M ".:""2:3;*A ".<""2<3=*5 ".>""2>3?*) ".@""2@3A+\x8c$,\x89&7+*\x83 "7-*} ".B""2B3C*q ".D""2D3E*e ".2""2233*Y ".8""2839*M ".:""2:3;*A ".<""2<3=*5 ".>""2>3?*) ".@""2@3A""" X'),k(' \\7y,#&7y"'),k('!/\x95""1#3\xd6+y$.4""2435+i% \\7!+&$,#&7!""" X+P%.J""2J3K+@% \\7!+&$,#&7!""" X+\'%4%6\xd7% %$%# X$$# X$## X$"# X"# X'),k('.\xd8""2\xd83\xd9'),k('.\xda""2\xda3\xdb'),k('.\xdc""2\xdc3\xdd'),k('.\xde""2\xde3\xdf'),k('.\xe0""2\xe03\xe1'),k('.\xe2""2\xe23\xe3'),k('.\xe4""2\xe43\xe5'),k('.\xe6""2\xe63\xe7'),k('.\xe8""2\xe83\xe9'),k('.\xea""2\xea3\xeb'),k('!7\x85*S "7\x86*M "7\x88*G "7\x89*A "7\x8a*; "7\x8b*5 "7\x8c*/ "7\x8d*) "7\x8e*# "76+& 4!6\xec! %'),k("!7\x84+K$7'+A%7\x91+7%7'+-%7\x93+#%'%%$%# X$$# X$## X$\"# X\"# X"),k("!7\x92+' 4!6\xed!! %"),k('!7!+7$7!+-%7!+#%\'#%$## X$"# X"# X'),k('! \\7**A "7+*; "7-*5 "73*/ "74*) "7\'*# "7(,G&7**A "7+*; "7-*5 "73*/ "74*) "7\'*# "7("+& 4!6\xee! %'),k('!7\xb5+_$ \\!7A+-$7\xb5+#%\'"%$"# X"# X,8&!7A+-$7\xb5+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),k('!79+R$!.:""2:3;+-$79+#%\'"%$"# X"# X*# " [+\'%4"6\xef" %$"# X"# X'),k('!7:*j "!7\x97+_$ \\!7A+-$7\x97+#%\'"%$"# X"# X,8&!7A+-$7\x97+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+& 4!6\xf0! %'),k('!7L*# "7\x98+c$ \\!7B+-$7\x9a+#%\'"%$"# X"# X,8&!7B+-$7\x9a+#%\'"%$"# X"# X"+\'%4"6\xf1" %$"# X"# X'),k('!7\x99*# " [+A$7@+7%7M+-%7?+#%\'$%$$# X$## X$"# X"# X'),k('!!76+_$ \\!7.+-$76+#%\'"%$"# X"# X,8&!7.+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X*# "7H+\' 4!6\xf2!! %'),k('7\x9b*) "7\x9c*# "7\x9f'),k('!/\xf3""1!3\xf4+<$7<+2%7\x9e+(%4#6\xf5#! %$## X$"# X"# X'),k('!/\xf6""1\'3\xf7+<$7<+2%7\x9d+(%4#6\xf8#! %$## X$"# X"# X'),k('! \\7!+&$,#&7!""" X+\' 4!6\xf9!! %'),k('!.\xfa""2\xfa3\xfb+x$!.J""2J3K+S$7!*# " [+C%7!*# " [+3%7!*# " [+#%\'$%$$# X$## X$"# X"# X*# " [+\'%4"6\xfc" %$"# X"# X'),k('!76+N$!7<+-$7\xa0+#%\'"%$"# X"# X*# " [+)%4"6\xfd""! %$"# X"# X'),k('76*) "7T*# "7H'),k('!7\xa2+_$ \\!7B+-$7\xa3+#%\'"%$"# X"# X,8&!7B+-$7\xa3+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),k('!/\xfe""1&3\xff*G "/\u0100""1\'3\u0101*; "/\u0102""1$3\u0103*/ "/\u0104""1%3\u0105*# "76+& 4!6\u0106! %'),k('7\xa4*# "7\x9f'),k('!/\u0107""1(3\u0108+O$7<+E%/\u0109""1(3\u010a*/ "/\u010b""1(3\u010c*# "76+#%\'#%$## X$"# X"# X'),k('!76+_$ \\!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),k('! \\7!+&$,#&7!""" X+\' 4!6\u010d!! %'),k("!7\xa8+& 4!6\u010e! %"),k('!7\xa9+s$7;+i%7\xae+_% \\!7B+-$7\xaf+#%\'"%$"# X"# X,8&!7B+-$7\xaf+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),k('7\xaa*# "7\xab'),k('/\u010f""1$3\u0110*S "/\u0111""1%3\u0112*G "/\u0113""1%3\u0114*; "/\u0115""1%3\u0116*/ "/\u0117""1+3\u0118*# "7\xac'),k('/\u0119""1\'3\u011a*/ "/\u011b""1)3\u011c*# "7\xac'),k('76*# "7\xad'),k('!/\u011d""1"3\u011e+-$76+#%\'"%$"# X"# X'),k('7\xac*# "76'),k('!76+7$7<+-%7\xb0+#%\'#%$## X$"# X"# X'),k('76*# "7H'),k('!7\xb2+7$7.+-%7\x8f+#%\'#%$## X$"# X"# X'),k('! \\7!+&$,#&7!""" X+\' 4!6\u011f!! %'),k("!7\x9d+' 4!6\u0120!! %"),k('!7\xb5+d$ \\!7B+-$7\x9f+#%\'"%$"# X"# X,8&!7B+-$7\x9f+#%\'"%$"# X"# X"+(%4"6\u0121"!!%$"# X"# X'),k('!!77+k$ \\!.J""2J3K+-$77+#%\'"%$"# X"# X,>&!.J""2J3K+-$77+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+! (%'),k('!7L*# "7\x98+c$ \\!7B+-$7\xb7+#%\'"%$"# X"# X,8&!7B+-$7\xb7+#%\'"%$"# X"# X"+\'%4"6\u0122" %$"# X"# X'),k('7\xb8*# "7\x9f'),k('!/\u0123""1#3\u0124+<$7<+2%76+(%4#6\u0125#! %$## X$"# X"# X'),k('! \\7!+&$,#&7!""" X+\' 4!6\u0126!! %'),k("!7\x9d+' 4!6\u0127!! %"),k('! \\7\x99,#&7\x99"+\x81$7@+w%7M+m%7?+c% \\!7B+-$7\x9f+#%\'"%$"# X"# X,8&!7B+-$7\x9f+#%\'"%$"# X"# X"+\'%4%6\u0128% %$%# X$$# X$## X$"# X"# X'),k("7\xbd"),k('!/\u0129""1&3\u012a+s$7.+i%7\xc0+_% \\!7A+-$7\xc0+#%\'"%$"# X"# X,8&!7A+-$7\xc0+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X*# "7\xbe'),k('!76+s$7.+i%7\xbf+_% \\!7A+-$7\xbf+#%\'"%$"# X"# X,8&!7A+-$7\xbf+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),k('!76+=$7<+3%76*# "7H+#%\'#%$## X$"# X"# X'),k('7\xc1*G "7\xc3*A "7\xc5*; "7\xc7*5 "7\xc8*/ "7\xc9*) "7\xca*# "7\xbf'),k('!/\u012b""1%3\u012c+7$7<+-%7\xc2+#%\'#%$## X$"# X"# X'),k("!7I+' 4!6\u012d!! %"),k('!/\u012e""1&3\u012f+\xa5$7<+\x9b%7D+\x91%7\xc4+\x87% \\! \\7\'+&$,#&7\'""" X+-$7\xc4+#%\'"%$"# X"# X,G&! \\7\'+&$,#&7\'""" X+-$7\xc4+#%\'"%$"# X"# X"+-%7E+#%\'&%$&# X$%# X$$# X$## X$"# X"# X'),k('7t*# "7w'),k('!/\u0130""1%3\u0131+7$7<+-%7\xc6+#%\'#%$## X$"# X"# X'),k("!7I+' 4!6\u0132!! %"),k('!/\u0133""1&3\u0134+<$7<+2%7I+(%4#6\u0135#! %$## X$"# X"# X'),k('!/\u0136""1%3\u0137+_$7<+U%!/\u0138""1$3\u0139+& 4!6\u013a! %*4 "!/\u013b""1%3\u013c+& 4!6\u013d! %+#%\'#%$## X$"# X"# X'),k('!/\u013e""1)3\u013f+T$7<+J%/\u0140""1#3\u0141*/ "/\u0142""1(3\u0143*# "76+(%4#6\u0144#! %$## X$"# X"# X'),k('!/\u0145""1#3\u0146+\x9e$7<+\x94%7D+\x8a%!7\xcb+k$ \\!.D""2D3E+-$7\xcb+#%\'"%$"# X"# X,>&!.D""2D3E+-$7\xcb+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+-%7E+#%\'%%$%# X$$# X$## X$"# X"# X'),k('!/\u0147""1(3\u0148*/ "/\u0149""1$3\u014a*# "76+\' 4!6\u014b!! %'),k('!76+_$ \\!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),k('!7\xce+K$7.+A%7\xce+7%7.+-%7\x8f+#%\'%%$%# X$$# X$## X$"# X"# X'),k('! \\7!+&$,#&7!""" X+\' 4!6\u014c!! %'),k('!7\xd0+c$ \\!7A+-$7\xd0+#%\'"%$"# X"# X,8&!7A+-$7\xd0+#%\'"%$"# X"# X"+\'%4"6\u014d" %$"# X"# X'),k('!7\x98+c$ \\!7B+-$7\x9f+#%\'"%$"# X"# X,8&!7B+-$7\x9f+#%\'"%$"# X"# X"+\'%4"6\u014e" %$"# X"# X'),k('!7L*T "7\x98*N "!7@*# " [+=$7t+3%7?*# " [+#%\'#%$## X$"# X"# X+c$ \\!7B+-$7\x9f+#%\'"%$"# X"# X,8&!7B+-$7\x9f+#%\'"%$"# X"# X"+\'%4"6\u014f" %$"# X"# X'),k('!7\xd3+c$ \\!7B+-$7\xd4+#%\'"%$"# X"# X,8&!7B+-$7\xd4+#%\'"%$"# X"# X"+\'%4"6\u0150" %$"# X"# X'),k("!7\x95+& 4!6\u0151! %"),k('!/\u0152""1(3\u0153+<$7<+2%76+(%4#6\u0154#! %$## X$"# X"# X*j "!/\u0155""1&3\u0156+<$7<+2%76+(%4#6\u0157#! %$## X$"# X"# X*: "!/\u0158""1*3\u0159+& 4!6\u015a! %*# "7\x9f'),k('!!76+o$ \\!7A+2$76+(%4"6\u015b"! %$"# X"# X,=&!7A+2$76+(%4"6\u015b"! %$"# X"# X"+)%4"6\u015c""! %$"# X"# X*# " [+\' 4!6\u015d!! %'),k('!7\xd7+_$ \\!7A+-$7\xd7+#%\'"%$"# X"# X,8&!7A+-$7\xd7+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),k('!7\x98+_$ \\!7B+-$7\x9f+#%\'"%$"# X"# X,8&!7B+-$7\x9f+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),k('! \\7!+&$,#&7!""" X+\' 4!6\u015e!! %'),k('!7\xda+_$ \\!7B+-$7\xdb+#%\'"%$"# X"# X,8&!7B+-$7\xdb+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),k('!/\u015f""1&3\u0160*; "/\u0161""1\'3\u0162*/ "/\u0163""1*3\u0164*# "76+& 4!6\u0165! %'),k('!/\u0166""1&3\u0167+<$7<+2%7\xdc+(%4#6\u0168#! %$## X$"# X"# X*\x83 "!/\xf6""1\'3\xf7+<$7<+2%7\x9d+(%4#6\u0169#! %$## X$"# X"# X*S "!/\u016a""1+3\u016b+<$7<+2%7\x9d+(%4#6\u016c#! %$## X$"# X"# X*# "7\x9f'),k('/\u016d""1+3\u016e*k "/\u016f""1)3\u0170*_ "/\u0171""1(3\u0172*S "/\u0173""1\'3\u0174*G "/\u0175""1&3\u0176*; "/\u0177""1*3\u0178*/ "/\u0179""1)3\u017a*# "76'),k('71*# " ['),k('!!76+o$ \\!7A+2$76+(%4"6\u015b"! %$"# X"# X,=&!7A+2$76+(%4"6\u015b"! %$"# X"# X"+)%4"6\u015c""! %$"# X"# X*# " [+\' 4!6\u017b!! %'),k('!7L*# "7\x98+c$ \\!7B+-$7\xe0+#%\'"%$"# X"# X,8&!7B+-$7\xe0+#%\'"%$"# X"# X"+\'%4"6\u017c" %$"# X"# X'),k('7\xb8*# "7\x9f'),k('!7\xe2+_$ \\!7A+-$7\xe2+#%\'"%$"# X"# X,8&!7A+-$7\xe2+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),k('!7\xe9+s$7.+i%7\xec+_% \\!7B+-$7\xe3+#%\'"%$"# X"# X,8&!7B+-$7\xe3+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),k('7\xe4*; "7\xe5*5 "7\xe6*/ "7\xe7*) "7\xe8*# "7\x9f'),k('!/\u017d""1#3\u017e+<$7<+2%7\xef+(%4#6\u017f#! %$## X$"# X"# X'),k('!/\u0180""1%3\u0181+<$7<+2%7T+(%4#6\u0182#! %$## X$"# X"# X'),k('!/\u0183""1(3\u0184+B$7<+8%7\\*# "7Y+(%4#6\u0185#! %$## X$"# X"# X'),k('!/\u0186""1&3\u0187+<$7<+2%76+(%4#6\u0188#! %$## X$"# X"# X'),k('!/\u0189""1%3\u018a+T$!7<+5$ \\7!,#&7!"+#%\'"%$"# X"# X*# " [+\'%4"6\u018b" %$"# X"# X'),k('!7\xea+K$7;+A%76+7%7;+-%7\xeb+#%\'%%$%# X$$# X$## X$"# X"# X'),k('!/\x95""1#3\xd6*# "76+\' 4!6\u018c!! %'),k('!/\xb4""1#3\u018d*G "/\xb6""1#3\u018e*; "/\xba""1#3\u018f*/ "/\xb8""1$3\u0190*# "76+\' 4!6\u0191!! %'),k('!7\xed+H$!7C+-$7\xee+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),k('!7U*) "7\\*# "7X+& 4!6\u0192! %'),k('!!7!*# " [+c$7!*# " [+S%7!*# " [+C%7!*# " [+3%7!*# " [+#%\'%%$%# X$$# X$## X$"# X"# X+\' 4!6\u0193!! %'),k('!!7!+C$7!*# " [+3%7!*# " [+#%\'#%$## X$"# X"# X+\' 4!6\u0194!! %'),k("7\xbd"),k('!7\x9d+d$ \\!7B+-$7\xf2+#%\'"%$"# X"# X,8&!7B+-$7\xf2+#%\'"%$"# X"# X"+(%4"6\u0195"!!%$"# X"# X'),k('7\xf3*# "7\x9f'),k('!.\u0196""2\u01963\u0197+N$7<+D%.\u0198""2\u01983\u0199*) ".\u019a""2\u019a3\u019b+(%4#6\u019c#! %$## X$"# X"# X'),k('!7\x9d+d$ \\!7B+-$7\x9f+#%\'"%$"# X"# X,8&!7B+-$7\x9f+#%\'"%$"# X"# X"+(%4"6\u019d"!!%$"# X"# X'),k('!76+7$70+-%7\xf6+#%\'#%$## X$"# X"# X'),k(' \\72*) "74*# "7.,/&72*) "74*# "7."'),k(' \\7%,#&7%"'),k('!7\xf9+=$.8""2839+-%7\xfa+#%\'#%$## X$"# X"# X'),k('!/\u019e""1%3\u019f*) "/\u01a0""1$3\u01a1+\' 4!6\u01a2!! %'),k('!7\xfb+N$!.8""2839+-$7^+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),k('!7\\*) "7X*# "7\x82+\' 4!6\u01a3!! %'),k('! \\7\xfd*) "7-*# "7\xfe,/&7\xfd*) "7-*# "7\xfe"+! (%'),k('7"*S "7!*M ".F""2F3G*A ".J""2J3K*5 ".H""2H3I*) ".N""2N3O'),k('.L""2L3M*\x95 ".B""2B3C*\x89 ".<""2<3=*} ".R""2R3S*q ".T""2T3U*e ".V""2V3W*Y ".P""2P3Q*M ".@""2@3A*A ".D""2D3E*5 ".2""2233*) ".>""2>3?'),k('!7\u0100+h$.8""2839+X%7\xfa+N%!.\u01a4""2\u01a43\u01a5+-$7\xeb+#%\'"%$"# X"# X*# " [+#%\'$%$$# X$## X$"# X"# X'),k('!/\u01a6""1%3\u01a7*) "/\u01a8""1$3\u01a9+\' 4!6\u01a2!! %'),k('!7\xeb+Q$/\xb4""1#3\xb5*7 "/\xb6""1#3\xb7*+ " \\7+,#&7+"+\'%4"6\u01aa" %$"# X"# X'),k('!7\u0104+\x8f$.F""2F3G+\x7f%7\u0103+u%.F""2F3G+e%7\u0103+[%.F""2F3G+K%7\u0103+A%.F""2F3G+1%7\u0105+\'%4)6\u01ab) %$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X'),k('!7#+A$7#+7%7#+-%7#+#%\'$%$$# X$## X$"# X"# X'),k('!7\u0103+-$7\u0103+#%\'"%$"# X"# X'),k('!7\u0103+7$7\u0103+-%7\u0103+#%\'#%$## X$"# X"# X')],u=0,l=0,d=0,f={line:1,column:1,seenCR:!1},h=0,p=[],v=0;if("startRule"in r){if(!(r.startRule in a))throw new Error("Can't start parsing from rule \""+r.startRule+'".');o=a[r.startRule]}function m(){return t.substring(l,u)}function g(){return l}function y(e){return d!==e&&(d>e&&(d=0,f={line:1,column:1,seenCR:!1}),function(e,n,r){var i,a;for(i=n;i<r;i++)"\n"===(a=t.charAt(i))?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(f,d,e),d=e),f}function b(e){u<h||(u>h&&(h=u,p=[]),p.push(e))}function _(n,r,i){var a=y(i),o=i<t.length?t.charAt(i):null;return null!==r&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(r),new e(null!==n?n:function(e,t){var n,r=new Array(e.length);for(n=0;n<e.length;n++)r[n]=e[n].description;return"Expected "+(e.length>1?r.slice(0,-1).join(", ")+" or "+r[e.length-1]:r[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input")+" found."}(r,o),r,o,i,a.line,a.column)}function k(e){var t,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=e.charCodeAt(t)-32;return n}if(r.data={},(n=function e(n){for(var r,a,o,d=c[n],f=0,h=[],p=d.length,m=[],g=[];;){for(;f<p;)switch(d[f]){case 0:g.push((o=s[d[f+1]],"[object Array]"===Object.prototype.toString.apply(o)?[]:o)),f+=2;break;case 1:g.push(u),f++;break;case 2:g.pop(),f++;break;case 3:u=g.pop(),f++;break;case 4:g.length-=d[f+1],f+=2;break;case 5:g.splice(-2,1),f++;break;case 6:g[g.length-2].push(g.pop()),f++;break;case 7:g.push(g.splice(g.length-d[f+1],d[f+1])),f+=2;break;case 8:g.pop(),g.push(t.substring(g[g.length-1],u)),f++;break;case 9:m.push(p),h.push(f+3+d[f+1]+d[f+2]),g[g.length-1]?(p=f+3+d[f+1],f+=3):(p=f+3+d[f+1]+d[f+2],f+=3+d[f+1]);break;case 10:m.push(p),h.push(f+3+d[f+1]+d[f+2]),g[g.length-1]===i?(p=f+3+d[f+1],f+=3):(p=f+3+d[f+1]+d[f+2],f+=3+d[f+1]);break;case 11:m.push(p),h.push(f+3+d[f+1]+d[f+2]),g[g.length-1]!==i?(p=f+3+d[f+1],f+=3):(p=f+3+d[f+1]+d[f+2],f+=3+d[f+1]);break;case 12:g[g.length-1]!==i?(m.push(p),h.push(f),p=f+2+d[f+1],f+=2):f+=2+d[f+1];break;case 13:m.push(p),h.push(f+3+d[f+1]+d[f+2]),t.length>u?(p=f+3+d[f+1],f+=3):(p=f+3+d[f+1]+d[f+2],f+=3+d[f+1]);break;case 14:m.push(p),h.push(f+4+d[f+2]+d[f+3]),t.substr(u,s[d[f+1]].length)===s[d[f+1]]?(p=f+4+d[f+2],f+=4):(p=f+4+d[f+2]+d[f+3],f+=4+d[f+2]);break;case 15:m.push(p),h.push(f+4+d[f+2]+d[f+3]),t.substr(u,s[d[f+1]].length).toLowerCase()===s[d[f+1]]?(p=f+4+d[f+2],f+=4):(p=f+4+d[f+2]+d[f+3],f+=4+d[f+2]);break;case 16:m.push(p),h.push(f+4+d[f+2]+d[f+3]),s[d[f+1]].test(t.charAt(u))?(p=f+4+d[f+2],f+=4):(p=f+4+d[f+2]+d[f+3],f+=4+d[f+2]);break;case 17:g.push(t.substr(u,d[f+1])),u+=d[f+1],f+=2;break;case 18:g.push(s[d[f+1]]),u+=s[d[f+1]].length,f+=2;break;case 19:g.push(i),0===v&&b(s[d[f+1]]),f+=2;break;case 20:l=g[g.length-1-d[f+1]],f+=2;break;case 21:l=u,f++;break;case 22:for(r=d.slice(f+4,f+4+d[f+3]),a=0;a<d[f+3];a++)r[a]=g[g.length-1-r[a]];g.splice(g.length-d[f+2],d[f+2],s[d[f+1]].apply(null,r)),f+=4+d[f+3];break;case 23:g.push(e(d[f+1])),f+=2;break;case 24:v++,f++;break;case 25:v--,f++;break;default:throw new Error("Invalid opcode: "+d[f]+".")}if(!(m.length>0))break;p=m.pop(),f=h.pop()}return g[0]}(o))!==i&&u===t.length)return n;throw n!==i&&u<t.length&&b({type:"end",description:"end of input"}),_(null,p,h)}}}()},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0};var a=n(548),o=n(1628),s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Object.assign({LocalTrackPublicationV2:o},n);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(r,{_encodingParameters:{value:e},_removeListeners:{value:new Map},_LocalTrackPublicationV2:{value:n.LocalTrackPublicationV2},_publishedRevision:{writable:!0,value:0},_revision:{writable:!0,value:1},revision:{enumerable:!0,get:function(){return this._revision}}}),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),r(t,[{key:"setParameters",value:function(e){return this._encodingParameters.update(e),this}},{key:"update",value:function(e){return this._publishedRevision>=e.revision?this:(this._publishedRevision=e.revision,e.tracks.forEach(function(e){var t=this.tracks.get(e.id);t&&t.update(e)},this),this)}},{key:"addTrack",value:function(e,n){var r=this,a=new this._LocalTrackPublicationV2(e,n);i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addTrack",this).call(this,a);var o=a.sid,s=function(){o!==a.sid?o=a.sid:r.didUpdate()};return a.on("updated",s),this._removeListener(a),this._removeListeners.set(a,function(){return a.removeListener("updated",s)}),this.didUpdate(),this}},{key:"_removeListener",value:function(e){var t=this._removeListeners.get(e);t&&t()}},{key:"getState",value:function(){return{revision:this.revision,tracks:Array.from(this.tracks.values()).map(function(e){return e.getState()})}}},{key:"didUpdate",value:function(){this._revision++,this.emit("updated")}},{key:"removeTrack",value:function(e){var n=this.tracks.get(e.id);if(!n)return!1;var r=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeTrack",this).call(this,n);return r&&(this._removeListener(n),this.didUpdate()),r}}]),t}();e.exports=s},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(1629),a=n(217).createTwilioError,o=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"getState",value:function(){return{enabled:this.isEnabled,id:this.id,kind:this.kind,name:this.name}}},{key:"update",value:function(e){switch(e.state){case"ready":this.setSid(e.sid);break;case"failed":var t=e.error;this.publishFailed(a(t.code,t.message))}return this}}]),t}();e.exports=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(819),a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r="data"===e.kind||e.track.enabled,i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,e.id,e.kind,r));return i.setTrackTransceiver(e),Object.defineProperties(i,{_error:{value:null,writable:!0},error:{enumerable:!0,get:function(){return this._error}}}),i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"publishFailed",value:function(e){return function(e,t){if(null!==e._sid||e._error)return!1;return e._error=t,!0}(this,e)&&this.emit("updated"),this}},{key:"setSid",value:function(e){return this._error?this:function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setSid",this).call(this,e)}}]),t}();e.exports=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(548),a=n(818),o=n(347),s={closed:["opening"],opening:["closed","open"],open:["closed","closing"],closing:["closed","open"]},c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"closed",s))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),r(t,[{key:"_close",value:function(e){return this.transition("closing",e),this.transition("closed",e),Promise.resolve(this)}},{key:"_connect",value:function(e,t,n,r,i,o){e.connect("PA00000000000000000000000000000000","test");var s=Promise.resolve(new a(e,"RM00000000000000000000000000000000",o));return s.cancel=function(){},s}},{key:"_open",value:function(e){return this.transition("opening",e),this.transition("open",e),Promise.resolve(this)}},{key:"close",value:function(){var e=this;return this.bracket("close",function(t){switch(e.state){case"closed":return e;case"open":return e._close(t);default:throw new Error('Unexpected Signaling state "'+e.state+'"')}})}},{key:"connect",value:function(e,t,n,r,i,a){var o=this;return this.bracket("connect",function s(c){switch(o.state){case"closed":return o._open(c).then(s.bind(null,c));case"open":return o.releaseLockCompletely(c),o._connect(e,t,n,r,i,a);default:throw new Error('Unexpected Signaling state "'+o.state+'"')}})}},{key:"createLocalParticipantSignaling",value:function(){return new i}},{key:"open",value:function(){var e=this;return this.bracket("open",function(t){switch(e.state){case"closed":return e._open(t);case"open":return e;default:throw new Error('Unexpected Signaling state "'+e.state+'"')}})}}]),t}();e.exports=c},function(e,t,n){"use strict";var r=n(179).guessBrowser;e.exports=function(){return!!r()&&(!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)||!!navigator.getUserMedia||!!navigator.webkitGetUserMedia||!!navigator.mozGetUserMedia)&&("undefined"!==typeof RTCPeerConnection||"undefined"!==typeof webkitRTCPeerConnection||"undefined"!==typeof mozRTCPeerConnection)}},,,,,,,,,,function(e,t,n){"use strict";var r=n(1642);e.exports=r},function(e,t,n){"use strict";var r=d(n(193)),i=d(n(319)),a=d(n(236)),o=d(n(161)),s=d(n(156)),c=d(n(157)),u=d(n(152)),l=d(n(189));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t,n,r){return new(n||(n=l.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var h=n(169),p=n(229),v=n(1645),m=n(823);t.User=m.User;var g=n(1650),y=n(1663),b=n(832),_=n(1665),k=n(262),w=n(837),T=n(1698),S=n(1716),C=n(1724),E=n(1731),R=n(1732),O=n(1735),x=n(1736),P=n(1737),I=n(1738);t.PushNotification=I.PushNotification;var A=n(247),j=p.Logger.scope("Client"),M=n(853).version,D="A valid Twilio token should be provided",N=function e(){(0,u.default)(this,e)},U=function(e){function t(e,n){(0,u.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this));r.connectionState="connecting",r.sessionPromise=null,r.channelsPromise=null,r.version=M,r.parsePushNotification=t.parsePushNotification,r.options=n||{},r.options.disableDeepClone||(r.options=A.deepClone(r.options)),r.options.logLevel=r.options.logLevel||"silent",j.setLevel(r.options.logLevel);var i=r.options.productId="ip_messaging";if(r.options.Sync=r.options.Sync||{},"undefined"===typeof r.options.Sync.enableSessionStorage&&(r.options.Sync.enableSessionStorage=!0),r.options.region&&(r.options.Sync.region=r.options.region),!e)throw new Error(D);return r.services=new N,r.config=new v.Configuration(r.options),r.options.twilsockClient=r.options.twilsockClient||new k.Twilsock(e,i,r.options),r.options.transport=r.options.transport||r.options.twilsockClient,r.options.notificationsClient=r.options.notificationsClient||new w.Notifications(e,r.options),r.options.syncClient=r.options.syncClient||new T.SyncClient(e,r.options),r.services.syncClient=r.options.syncClient,r.services.transport=r.options.transport,r.services.twilsockClient=r.options.twilsockClient,r.services.notificationClient=r.options.notificationsClient,r.services.session=new C.Session(r.services,r.config),r.sessionPromise=r.services.session.initialize(),r.services.network=new y.Network(r.config,r.services),r.services.users=new R.Users({session:r.services.session,network:r.services.network,syncClient:r.services.syncClient}),r.services.users.on("userSubscribed",r.emit.bind(r,"userSubscribed")),r.services.users.on("userUpdated",function(e){return r.emit("userUpdated",e)}),r.services.users.on("userUnsubscribed",r.emit.bind(r,"userUnsubscribed")),r.services.twilsockClient.on("tokenAboutToExpire",function(e){return r.emit("tokenAboutToExpire",e)}),r.services.twilsockClient.on("tokenExpired",function(){return r.emit("tokenExpired")}),r.services.consumptionHorizon=new x.ConsumptionHorizon(r.services),r.services.typingIndicator=new O.TypingIndicator(r.config,{transport:r.services.twilsockClient,notificationClient:r.services.notificationClient},r.getChannelBySid.bind(r)),r.services.syncList=new _.SyncList(r.services),r.channels=new E.Channels(r.services),r.channelsPromise=r.sessionPromise.then(function(){return r.channels.on("channelAdded",r.emit.bind(r,"channelAdded")),r.channels.on("channelRemoved",r.emit.bind(r,"channelRemoved")),r.channels.on("channelInvited",r.emit.bind(r,"channelInvited")),r.channels.on("channelJoined",r.emit.bind(r,"channelJoined")),r.channels.on("channelLeft",r.emit.bind(r,"channelLeft")),r.channels.on("channelUpdated",function(e){return r.emit("channelUpdated",e)}),r.channels.on("memberJoined",r.emit.bind(r,"memberJoined")),r.channels.on("memberLeft",r.emit.bind(r,"memberLeft")),r.channels.on("memberUpdated",function(e){return r.emit("memberUpdated",e)}),r.channels.on("messageAdded",r.emit.bind(r,"messageAdded")),r.channels.on("messageUpdated",function(e){return r.emit("messageUpdated",e)}),r.channels.on("messageRemoved",r.emit.bind(r,"messageRemoved")),r.channels.on("typingStarted",r.emit.bind(r,"typingStarted")),r.channels.on("typingEnded",r.emit.bind(r,"typingEnded")),r.channels.fetchChannels()}).then(function(){return r.channels}),r.services.notificationClient.on("connectionStateChanged",function(e){var t=null;switch(e){case"connected":t="connected";break;case"denied":t="denied";break;case"disconnecting":t="disconnecting";break;case"disconnected":t="disconnected";break;default:t="connecting"}t!==r.connectionState&&(r.connectionState=t,r.emit("connectionStateChanged",r.connectionState))}),r.fpaToken=e,r}return(0,c.default)(t,e),(0,o.default)(t,[{key:"subscribeToPushNotifications",value:function(e){var t=this,n=[];return[b.NotificationTypes.NEW_MESSAGE,b.NotificationTypes.ADDED_TO_CHANNEL,b.NotificationTypes.INVITED_TO_CHANNEL,b.NotificationTypes.REMOVED_FROM_CHANNEL,b.NotificationTypes.TYPING_INDICATOR,b.NotificationTypes.CONSUMPTION_UPDATE].forEach(function(r){n.push(t.services.notificationClient.subscribe(r,e))}),l.default.all(n)}},{key:"unsubscribeFromPushNotifications",value:function(e){var t=this,n=[];return[b.NotificationTypes.NEW_MESSAGE,b.NotificationTypes.ADDED_TO_CHANNEL,b.NotificationTypes.INVITED_TO_CHANNEL,b.NotificationTypes.REMOVED_FROM_CHANNEL,b.NotificationTypes.TYPING_INDICATOR,b.NotificationTypes.CONSUMPTION_UPDATE].forEach(function(r){n.push(t.services.notificationClient.unsubscribe(r,e))}),l.default.all(n)}},{key:"initialize",value:function(){return f(this,void 0,void 0,r.default.mark(function e(){var n,a,o=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionPromise;case 2:return t.supportedPushChannels.forEach(function(e){return o.subscribeToPushNotifications(e)}),e.next=5,this.services.session.getSessionLinks();case 5:return n=e.sent,this.services.publicChannels=new g.PublicChannels(this,this.services,n.publicChannelsUrl),this.services.userChannels=new P.UserChannels(this,this.services,n.myChannelsUrl),(a=(0,i.default)(this.options)).transport=null,this.services.mcsClient=new S.McsClient(this.fpaToken,n.mediaServiceUrl,a),e.next=13,this.services.typingIndicator.initialize();case 13:case"end":return e.stop()}},e,this)}))}},{key:"shutdown",value:function(){return f(this,void 0,void 0,r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.twilsockClient.disconnect();case 2:case"end":return e.stop()}},e,this)}))}},{key:"updateToken",value:function(e){return f(this,void 0,void 0,r.default.mark(function t(){var n=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(j.info("updateToken"),e){t.next=3;break}throw new Error(D);case 3:if(this.fpaToken!==e){t.next=5;break}return t.abrupt("return",this);case 5:return t.next=7,this.services.twilsockClient.updateToken(e).then(function(){return n.fpaToken=e}).then(function(){return n.services.mcsClient.updateToken(e)}).then(function(){return n.sessionPromise});case 7:return t.abrupt("return",this);case 8:case"end":return t.stop()}},t,this)}))}},{key:"getChannelBySid",value:function(e){return f(this,void 0,void 0,r.default.mark(function t(){var n=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"===typeof e){t.next=2;break}throw new Error("Client.getChannelBySid requires a <String>channelSid parameter");case 2:return t.abrupt("return",this.channels.syncListRead.promise.then(function(){return n.channels.getChannel(e).then(function(t){return t||n.services.publicChannels.getChannelBySid(e).then(function(e){return n.channels.pushChannel(e)})})}));case 3:case"end":return t.stop()}},t,this)}))}},{key:"getChannelByUniqueName",value:function(e){return f(this,void 0,void 0,r.default.mark(function t(){var n=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"===typeof e){t.next=2;break}throw new Error("Client.getChannelByUniqueName requires a <String>uniqueName parameter");case 2:return t.abrupt("return",this.channels.syncListRead.promise.then(function(){return n.services.publicChannels.getChannelByUniqueName(e).then(function(e){return n.channels.pushChannel(e)})}));case 3:case"end":return t.stop()}},t,this)}))}},{key:"getSubscribedChannels",value:function(e){return this.channelsPromise.then(function(t){return t.getChannels(e)})}},{key:"getLocalChannels",value:function(e){return this.channelsPromise.then(function(n){var r=[];n.channels.forEach(function(e){r.push(e)});var i="ascending";if(e&&e.order)if("descending"===e.order)i="descending";else if("ascending"!==e.order)throw new Error("Sorting order should be `ascending` or `descending`");if(e&&e.criteria)if("lastMessage"===e.criteria)r.sort(function(e,n){return t.compareChannelsByLastMessage(e,n,i)});else if("uniqueName"===e.criteria)r.sort(function(e,n){return t.compareChannelsByStringProperty(e.uniqueName,n.uniqueName,i)});else{if("friendlyName"!==e.criteria)throw new Error("Sorting criteria should be one of `lastMessage`, `uniqueName` or `friendlyName`");r.sort(function(e,n){return t.compareChannelsByStringProperty(e.friendlyName,n.friendlyName,i)})}return r})}},{key:"getPublicChannelDescriptors",value:function(){return this.services.publicChannels.getChannels()}},{key:"getUserChannelDescriptors",value:function(){return this.services.userChannels.getChannels()}},{key:"createChannel",value:function(e){return e=e||{},this.channelsPromise.then(function(t){return t.addChannel(e)})}},{key:"setPushRegistrationId",value:function(e,n){return f(this,void 0,void 0,r.default.mark(function i(){var a=this;return r.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(-1!==t.supportedPushChannels.indexOf(e)){r.next=2;break}throw new Error("Invalid or unsupported channelType: "+e);case 2:return r.next=4,this.subscribeToPushNotifications(e).then(function(){return a.services.notificationClient.setPushRegistrationId(n,e)});case 4:case"end":return r.stop()}},i,this)}))}},{key:"unsetPushRegistrationId",value:function(e){return f(this,void 0,void 0,r.default.mark(function n(){return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(-1!==t.supportedPushChannels.indexOf(e)){n.next=2;break}throw new Error("Invalid or unsupported channelType: "+e);case 2:return n.next=4,this.unsubscribeFromPushNotifications(e);case 4:case"end":return n.stop()}},n,this)}))}},{key:"handlePushNotification",value:function(e){return f(this,void 0,void 0,r.default.mark(function n(){return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:j.debug("handlePushNotification, notificationPayload=",e),this.emit("pushNotification",t.parsePushNotification(e));case 2:case"end":return n.stop()}},n,this)}))}},{key:"getUser",value:function(e){return this.services.users.getUser(e)}},{key:"getUserDescriptor",value:function(e){return f(this,void 0,void 0,r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.services.users.getUserDescriptor(e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"getSubscribedUsers",value:function(){return f(this,void 0,void 0,r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getSubscribedUsers());case 1:case"end":return e.stop()}},e,this)}))}},{key:"user",get:function(){return this.services.users.myself}},{key:"reachabilityEnabled",get:function(){return this.services.session.reachabilityEnabled}},{key:"token",get:function(){return this.fpaToken}}],[{key:"create",value:function(e,n){return f(this,void 0,void 0,r.default.mark(function i(){var a;return r.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=new t(e,n),r.next=3,a.initialize();case 3:return r.abrupt("return",a);case 4:case"end":return r.stop()}},i,this)}))}},{key:"compareChannelsByLastMessage",value:function(e,t,n){if(e.lastMessage&&t.lastMessage){if(e.lastMessage.timestamp&&t.lastMessage.timestamp)return e.lastMessage.timestamp.getTime()<t.lastMessage.timestamp.getTime()?"ascending"===n?-1:1:"ascending"===n?1:-1;if(e.lastMessage.timestamp)return-1;if(t.lastMessage.timestamp)return 1}return e.lastMessage?-1:t.lastMessage?1:0}},{key:"compareChannelsByStringProperty",value:function(e,t,n){return e&&t?"ascending"===n?e.localeCompare(t):-1*e.localeCompare(t):e?-1:t?1:0}},{key:"parsePushNotificationChatData",value:function(e){var n={};for(var r in t.supportedPushDataFields)"undefined"!==typeof e[r]&&null!==e[r]&&("message_index"===r?null!==A.parseToNumber(e[r])&&(n[t.supportedPushDataFields[r]]=Number(e[r])):n[t.supportedPushDataFields[r]]=e[r]);return n}},{key:"parsePushNotification",value:function(e){if(j.debug("parsePushNotification, notificationPayload=",e),"undefined"===typeof e||null===e)throw new Error("Push notification payload should be provided");if("undefined"!==typeof e.aps){if(!e.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var n=t.parsePushNotificationChatData(e),r=e.aps,i=null,a=null;return"string"===typeof r.alert?i=r.alert||null:(i=r.alert.body||null,a=r.alert.title||null),new I.PushNotification({title:a,body:i,sound:r.sound||null,badge:r.badge||null,action:r.category||null,type:e.twi_message_type,data:n})}if("undefined"!==typeof e.data){var o=e.data;if(!o.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var s=t.parsePushNotificationChatData(e.data);return new I.PushNotification({title:o.twi_title||null,body:o.twi_body||null,sound:o.twi_sound||null,badge:null,action:o.twi_action||null,type:o.twi_message_type,data:s})}throw new Error("Provided push notification payload is not Programmable Chat notification")}}]),t}(h.EventEmitter);U.version=M,U.supportedPushChannels=["fcm","apn","gcm"],U.supportedPushDataFields={channel_sid:"channelSid",message_sid:"messageSid",message_index:"messageIndex"},t.Client=U,t.default=U},function(e,t,n){n(1644),e.exports=n(184).Object.getPrototypeOf},function(e,t,n){var r=n(293),i=n(575);n(517)("getPrototypeOf",function(){return function(e){return i(r(e))}})},function(e,t,n){"use strict";var r=a(n(152)),i=a(n(161));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o="/v1/typing",s=function(){function e(t){(0,r.default)(this,e);var n=(t=t||{}).Chat||t.IPMessaging||t||{};this.region=n.region||t.region,this.baseUrl=n.apiUri||n.typingUri||(this.region&&"us1"!==this.region?"https://aim."+this.region+".twilio.com":"https://aim.twilio.com"),this.typingIndicatorUri=this.baseUrl+o,this.typingIndicatorTimeoutOverride=n.typingIndicatorTimeoutOverride,this.httpCacheIntervalOverride=n.httpCacheIntervalOverride,this.consumptionReportIntervalOverride=n.consumptionReportIntervalOverride,this.userInfosToSubscribeOverride=n.userInfosToSubscribeOverride,this.retryWhenThrottledOverride=n.retryWhenThrottledOverride,this.backoffConfigOverride=n.backoffConfigOverride}return(0,i.default)(e,[{key:"typingIndicatorTimeoutDefault",get:function(){return 5e3}},{key:"httpCacheIntervalDefault",get:function(){return"PT5S"}},{key:"consumptionReportIntervalDefault",get:function(){return"PT5S"}},{key:"userInfosToSubscribeDefault",get:function(){return 100}},{key:"retryWhenThrottledDefault",get:function(){return!0}},{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}}]),e}();t.Configuration=s},function(e,t,n){var r=n(184),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(824),i=n(825),a=n(1648),o=n(1649);function s(e,t){var n=i.Pointer.fromJSON(t).evaluate(e);if(void 0!==n)return{op:"test",path:t,value:n.value}}t.applyPatch=function(e,t){return t.map(function(t){var n=a[t.op];return void 0===n?new r.InvalidOperationError(t.op):n(e,t)})},t.createPatch=function(e,t,n){var r=new i.Pointer;return(n?function(e){return function t(n,r,i){var a=e(n,r,i);return Array.isArray(a)?a:o.diffAny(n,r,i,t)}}(n):o.diffAny)(e,t,r)},t.createTests=function(e,t){var n=new Array;return t.filter(o.isDestructive).forEach(function(t){var r=s(e,t.path);if(r&&n.push(r),"from"in t){var i=s(e,t.from);i&&n.push(i)}}),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(825),i=n(826),a=n(824);function o(e,t,n){Array.isArray(e)?"-"==t?e.push(n):e.splice(t,0,n):e[t]=n}function s(e,t){Array.isArray(e)?e.splice(t,1):delete e[t]}t.add=function(e,t){var n=r.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.parent?new a.MissingError(t.path):(o(n.parent,n.key,t.value),null)},t.remove=function(e,t){var n=r.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.value?new a.MissingError(t.path):(s(n.parent,n.key),null)},t.replace=function(e,t){var n=r.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.value?new a.MissingError(t.path):(n.parent[n.key]=t.value,null)},t.move=function(e,t){var n=r.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new a.MissingError(t.from);var i=r.Pointer.fromJSON(t.path).evaluate(e);return void 0===i.parent?new a.MissingError(t.path):(s(n.parent,n.key),o(i.parent,i.key,n.value),null)},t.copy=function(e,t){var n=r.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new a.MissingError(t.from);var i=r.Pointer.fromJSON(t.path).evaluate(e);return void 0===i.parent?new a.MissingError(t.path):(s(n.parent,n.key),o(i.parent,i.key,n.value),null)},t.test=function(e,t){var n=r.Pointer.fromJSON(t.path).evaluate(e);return i.compare(n.value,t.value)?null:new a.TestError(n.value,t.value)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(826);function i(e,t){var n={};for(var r in e)n[r]=1;for(var i in t)delete n[i];return Object.keys(n)}function a(e){var t={};e.forEach(function(e){for(var n in e)t[n]=(t[n]||0)+1});var n=e.length;for(var r in t)t[r]<n&&delete t[r];return Object.keys(t)}function o(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":typeof e}function s(e,t,n,i){void 0===i&&(i=l);var a={"0,0":{operations:[],cost:0}};var o=isNaN(e.length)||e.length<=0?0:e.length,s=isNaN(t.length)||t.length<=0?0:t.length;return function n(i,o){var s=i+","+o,c=a[s];if(void 0===c){if(r.compare(e[i-1],t[o-1]))c=n(i-1,o-1);else{var u=[];if(i>0){var l=n(i-1,o);u.push({operations:l.operations.concat({op:"remove",index:i-1}),cost:l.cost+1})}if(o>0){var d=n(i,o-1);u.push({operations:d.operations.concat({op:"add",index:i-1,value:t[o-1]}),cost:d.cost+1})}if(i>0&&o>0){var f=n(i-1,o-1);u.push({operations:f.operations.concat({op:"replace",index:i-1,original:e[i-1],value:t[o-1]}),cost:f.cost+1})}c=u.sort(function(e,t){return e.cost-t.cost})[0]}a[s]=c}return c}(o,s).operations.reduce(function(e,t){var r=e[0],a=e[1];if(function(e){return"add"===e.op}(t)){var s=t.index+1+a,c=s<o+a?String(s):"-",u={op:t.op,path:n.add(c).toString(),value:t.value};return[r.concat(u),a+1]}if(function(e){return"remove"===e.op}(t)){u={op:t.op,path:n.add(String(t.index+a)).toString()};return[r.concat(u),a-1]}var l=n.add(String(t.index+a)),d=i(t.original,t.value,l);return[r.concat.apply(r,d),a]},[[],0])[0]}function c(e,t,n,r){void 0===r&&(r=l);var o=[];return i(e,t).forEach(function(e){o.push({op:"remove",path:n.add(e).toString()})}),i(t,e).forEach(function(e){o.push({op:"add",path:n.add(e).toString(),value:t[e]})}),a([e,t]).forEach(function(i){o.push.apply(o,r(e[i],t[i],n.add(i)))}),o}function u(e,t,n){return r.compare(e,t)?[]:[{op:"replace",path:n.toString(),value:t}]}function l(e,t,n,r){void 0===r&&(r=l);var i=o(e),a=o(t);return"array"==i&&"array"==a?s(e,t,n,r):"object"==i&&"object"==a?c(e,t,n,r):u(e,t,n)}t.isDestructive=function(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t},t.subtract=i,t.intersection=a,t.objectType=o,t.diffArrays=s,t.diffObjects=c,t.diffValues=u,t.diffAny=l},function(e,t,n){"use strict";var r=s(n(193)),i=s(n(152)),a=s(n(161)),o=s(n(189));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t,n,r){return new(n||(n=o.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var u=n(247),l=n(424),d=n(827),f=function(){function e(t,n,r){(0,i.default)(this,e),this.client=t,this.services=n,this.url=r}return(0,a.default)(e,[{key:"getChannels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c(this,void 0,void 0,r.default.mark(function t(){var n,i,a=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new u.UriBuilder(this.url).arg("PageToken",e.pageToken).build(),t.next=3,this.services.network.get(n);case 3:return i=t.sent,t.abrupt("return",new l.RestPaginator(i.body.channels.map(function(e){return new d.ChannelDescriptor(a.client,e)}),function(e){return a.getChannels({pageToken:e})},i.body.meta.previous_token,i.body.meta.next_token));case 5:case"end":return t.stop()}},t,this)}))}},{key:"getChannelBySid",value:function(e){return c(this,void 0,void 0,r.default.mark(function t(){var n,i;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new u.UriBuilder(this.url).path(e).build(),t.next=3,this.services.network.get(n);case 3:return i=t.sent,t.abrupt("return",new d.ChannelDescriptor(this.client,i.body));case 5:case"end":return t.stop()}},t,this)}))}},{key:"getChannelByUniqueName",value:function(e){return c(this,void 0,void 0,r.default.mark(function t(){var n,i;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new u.UriBuilder(this.url).path(e).build(),t.next=3,this.services.network.get(n);case 3:return i=t.sent,t.abrupt("return",new d.ChannelDescriptor(this.client,i.body));case 5:case"end":return t.stop()}},t,this)}))}}]),e}();t.PublicChannels=f},function(e,t,n){n(361),n(266),n(295),n(1652),n(1653),n(1654),n(1655),e.exports=n(184).Map},function(e,t,n){"use strict";var r=n(768),i=n(521);e.exports=n(770)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(i(this,"Map"),0===e?0:e,t)}},r,!0)},function(e,t,n){var r=n(194);r(r.P+r.R,"Map",{toJSON:n(771)("Map")})},function(e,t,n){n(772)("Map")},function(e,t,n){n(773)("Map")},function(e,t,n){n(1657),e.exports=n(184).Number.isInteger},function(e,t,n){var r=n(194);r(r.S,"Number",{isInteger:n(1658)})},function(e,t,n){var r=n(199),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t,n){"use strict";var r=l(n(193)),i=l(n(236)),a=l(n(152)),o=l(n(161)),s=l(n(156)),c=l(n(157)),u=l(n(189));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e,t,n,r){return new(n||(n=u.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var f=n(169),h=n(830),p=n(229).Logger.scope("Members"),v=function(e){function t(e,n,r){(0,a.default)(this,t);var o=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return o.services=n,o.channel=e,o.members=r,o}return(0,c.default)(t,e),(0,o.default)(t,[{key:"unsubscribe",value:function(){return d(this,void 0,void 0,r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:e.sent.close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}},e,this)}))}},{key:"subscribe",value:function(e){var t=this;return this.rosterEntityPromise=this.rosterEntityPromise||this.services.syncClient.map({id:e,mode:"open_existing"}).then(function(e){e.on("itemAdded",function(e){t.upsertMember(e.item.key,e.item.value).then(function(e){t.emit("memberJoined",e)})}),e.on("itemRemoved",function(e){var n=e.key;if(t.members.has(n)){var r=t.members.get(n);t.members.delete(n),t.emit("memberLeft",r)}}),e.on("itemUpdated",function(e){t.upsertMember(e.item.key,e.item.value)});var n=[];return e.forEach(function(e){n.push(t.upsertMember(e.key,e.value))}).then(function(){return u.default.all(n)}).then(function(){return e})}).catch(function(e){throw t.rosterEntityPromise=null,"disconnected"!=t.services.syncClient.connectionState&&p.error("Failed to get roster object for channel",t.channel.sid,e),p.debug("ERROR: Failed to get roster object for channel",t.channel.sid,e),e})}},{key:"upsertMember",value:function(e,t){return d(this,void 0,void 0,r.default.mark(function n(){var i,a=this;return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(i=this.members.get(e))){n.next=3;break}return n.abrupt("return",i._update(t));case 3:return i=new h.Member(this.services,this.channel,t,e),this.members.set(e,i),i.on("updated",function(e){return a.emit("memberUpdated",e)}),n.abrupt("return",i);case 7:case"end":return n.stop()}},n,this)}))}},{key:"getMembers",value:function(){var e=this;return this.rosterEntityPromise.then(function(){var t=[];return e.members.forEach(function(e){return t.push(e)}),t})}},{key:"add",value:function(e){return this.services.session.addCommand("addMemberV2",{channelSid:this.channel.sid,username:e})}},{key:"invite",value:function(e){return this.services.session.addCommand("inviteMember",{channelSid:this.channel.sid,username:e})}},{key:"remove",value:function(e){return this.services.session.addCommand("removeMember",{channelSid:this.channel.sid,username:e})}}]),t}(f.EventEmitter);t.Members=v},function(e,t,n){"use strict";var r=f(n(311)),i=f(n(193)),a=f(n(261)),o=f(n(236)),s=f(n(152)),c=f(n(161)),u=f(n(156)),l=f(n(157)),d=f(n(189));function f(e){return e&&e.__esModule?e:{default:e}}var h=function(e,t,n,r){return new(n||(n=d.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var p=n(169),v=n(229),m=n(1661),g=n(831),y=v.Logger.scope("Messages"),b=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return r.channel=e,r.services=n,r.messagesByIndex=new a.default,r.messagesListPromise=null,r}return(0,l.default)(t,e),(0,c.default)(t,[{key:"subscribe",value:function(e){var t=this;return this.messagesListPromise=this.messagesListPromise||this.services.syncClient.list({id:e,mode:"open_existing"}).then(function(e){return e.on("itemAdded",function(e){var n=new m.Message(t.channel,t.services,e.item.index,e.item.value);t.messagesByIndex.has(n.index)?y.debug("Message arrived, but already known and ignored",t.channel.sid,n.index):(t.messagesByIndex.set(n.index,n),n.on("updated",function(e){return t.emit("messageUpdated",e)}),t.emit("messageAdded",n))}),e.on("itemRemoved",function(e){var n=e.index;if(t.messagesByIndex.has(n)){var r=t.messagesByIndex.get(n);t.messagesByIndex.delete(r.index),r.removeAllListeners("updated"),t.emit("messageRemoved",r)}}),e.on("itemUpdated",function(e){var n=t.messagesByIndex.get(e.item.index);n&&n._update(e.item.value)}),e}).catch(function(e){throw t.messagesListPromise=null,"disconnected"!=t.services.syncClient.connectionState&&y.error("Failed to get messages object for channel",t.channel.sid,e),y.debug("ERROR: Failed to get messages object for channel",t.channel.sid,e),e})}},{key:"unsubscribe",value:function(){return h(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=6;break}return e.next=3,this.messagesListPromise;case 3:e.sent.close(),this.messagesListPromise=null;case 6:case"end":return e.stop()}},e,this)}))}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,void 0,void 0,i.default.mark(function n(){return i.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(y.debug("Sending text message",e,t),t.constructor===Object){n.next=3;break}throw new Error("Attributes must be a valid JSON object");case 3:return n.abrupt("return",this.services.session.addCommand("sendMessage",{channelSid:this.channel.sid,text:e,attributes:(0,r.default)(t)}));case 4:case"end":return n.stop()}},n,this)}))}},{key:"sendMedia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,void 0,void 0,i.default.mark(function n(){var a,o;return i.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(y.debug("Sending media message",e,t),t.constructor===Object){n.next=3;break}throw new Error("Attributes must be a valid JSON object");case 3:if(a=void 0,!(e instanceof g)){n.next=11;break}return y.debug("Sending media message as FormData",e,t),n.next=8,this.services.mcsClient.postFormData(e);case 8:a=n.sent,n.next=18;break;case 11:if(y.debug("Sending media message as SendMediaOptions",e,t),(o=e).contentType&&o.media){n.next=15;break}throw new Error("Media content <Channel#SendMediaOptions> must contain non-empty contentType and media");case 15:return n.next=17,this.services.mcsClient.post(o.contentType,o.media);case 17:a=n.sent;case 18:return n.abrupt("return",this.services.session.addCommand("sendMediaMessage",{channelSid:this.channel.sid,mediaSid:a.sid,attributes:(0,r.default)(t)}));case 19:case"end":return n.stop()}},n,this)}))}},{key:"getMessages",value:function(e,t,n){return t="undefined"!==typeof t?t:"end",n=n||"backwards",this._getMessages(e,t,n)}},{key:"wrapPaginator",value:function(e,t,n){var r=this,i="desc"===e,a=function(){return t.nextPage().then(function(t){return r.wrapPaginator(e,t,n)})},o=function(){return t.prevPage().then(function(t){return r.wrapPaginator(e,t,n)})};return n(t.items).then(function(e){return{items:e.sort(function(e,t){return e.index-t.index}),hasPrevPage:i?t.hasNextPage:t.hasPrevPage,hasNextPage:i?t.hasPrevPage:t.hasNextPage,prevPage:i?a:o,nextPage:i?o:a}})}},{key:"_upsertMessage",value:function(e,t){var n=this,r=this.messagesByIndex.get(e);if(r)return r;var i=new m.Message(this.channel,this.services,e,t);return this.messagesByIndex.set(i.index,i),i.on("updated",function(e){return n.emit("messageUpdated",e)}),i}},{key:"_getMessages",value:function(e,t,n){var r=this;t="undefined"!==typeof t?t:"end",e=e||30;var i="backwards"===n?"desc":"asc";return this.messagesListPromise.then(function(n){return n.getItems({from:"end"!==t?t:void 0,pageSize:e,order:i})}).then(function(e){return r.wrapPaginator(i,e,function(e){return d.default.all(e.map(function(e){return r._upsertMessage(e.index,e.value)}))})})}}]),t}(p.EventEmitter);t.Messages=b},function(e,t,n){"use strict";var r=d(n(311)),i=d(n(193)),a=d(n(236)),o=d(n(152)),s=d(n(161)),c=d(n(156)),u=d(n(157)),l=d(n(189));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t,n,r){return new(n||(n=l.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var h=n(169),p=n(247),v=n(229),m=n(1662),g=v.Logger.scope("Message");function y(e,t){try{return t?JSON.parse(t):{}}catch(n){return g.warn("Got malformed attributes for the message",e),{}}}var b=function(e){function t(e,n,r,i){(0,o.default)(this,t);var s=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return s.channel=e,s.services=n,s.state={sid:i.sid,index:r,author:i.author,body:i.text,timestamp:i.timestamp?new Date(i.timestamp):null,dateUpdated:i.dateUpdated?new Date(i.dateUpdated):null,lastUpdatedBy:i.lastUpdatedBy?i.lastUpdatedBy:null,attributes:y(i.sid,i.attributes),type:i.type?i.type:"text",media:i.type&&"media"===i.type&&i.media?new m.Media(i.media,s.services):null},s}return(0,u.default)(t,e),(0,s.default)(t,[{key:"_update",value:function(e){var t=[];!e.text&&"string"!==typeof e.text||e.text===this.state.body||(this.state.body=e.text,t.push("body")),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t.push("lastUpdatedBy")),e.author&&e.author!==this.state.author&&(this.state.author=e.author,t.push("author")),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t.push("dateUpdated")),e.timestamp&&new Date(e.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(e.timestamp),t.push("timestamp"));var n=y(this.sid,e.attributes);p.isDeepEqual(this.state.attributes,n)||(this.state.attributes=n,t.push("attributes")),t.length>0&&this.emit("updated",{message:this,updateReasons:t})}},{key:"remove",value:function(){return f(this,void 0,void 0,i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("deleteMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString()});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}},e,this)}))}},{key:"updateBody",value:function(e){return f(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("string"===typeof e){t.next=2;break}throw new Error("Body <String> is a required parameter for updateBody");case 2:return t.next=4,this.services.session.addCommand("editMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString(),text:e});case 4:return t.abrupt("return",this);case 5:case"end":return t.stop()}},t,this)}))}},{key:"updateAttributes",value:function(e){return f(this,void 0,void 0,i.default.mark(function t(){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("undefined"!==typeof e){t.next=4;break}throw new Error("Attributes is a required parameter for updateAttributes");case 4:if(e.constructor===Object){t.next=6;break}throw new Error("Attributes must be a valid JSON object");case 6:return t.next=8,this.services.session.addCommand("editMessageAttributes",{channelSid:this.channel.sid,messageIdx:this.index,attributes:(0,r.default)(e)});case 8:return t.abrupt("return",this);case 9:case"end":return t.stop()}},t,this)}))}},{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"body",get:function(){return"media"===this.type?null:this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"timestamp",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}}]),t}(h.EventEmitter);t.Message=b},function(e,t,n){"use strict";var r=s(n(193)),i=s(n(152)),a=s(n(161)),o=s(n(189));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t,n,r){return new(n||(n=o.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(t,n){(0,i.default)(this,e),this.mcsMedia=null,this.services=n,this.state={sid:t.sid,filename:t.filename,contentType:t.contentType,size:t.size}}return(0,a.default)(e,[{key:"getContentUrl",value:function(){return c(this,void 0,void 0,r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mcsMedia){e.next=8;break}if(!this.services.mcsClient){e.next=7;break}return e.next=4,this.services.mcsClient.get(this.state.sid);case 4:this.mcsMedia=e.sent,e.next=8;break;case 7:throw new Error("Media Content Service is unavailable");case 8:return e.abrupt("return",this.mcsMedia.getContentUrl());case 9:case"end":return e.stop()}},e,this)}))}},{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}}]),e}();t.Media=u},function(e,t,n){"use strict";var r=d(n(193)),i=d(n(192)),a=d(n(756)),o=d(n(319)),s=d(n(261)),c=d(n(152)),u=d(n(161)),l=d(n(189));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t,n,r){return new(n||(n=l.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var h=n(1664),p=function(){function e(t,n){var r=this;(0,c.default)(this,e),this.config=t,this.services=n,this.cache=new s.default,this.cacheLifetime=0,this.services.session.getHttpCacheInterval().then(function(e){r.cacheLifetime=1e3*e,r.cleanupCache()})}return(0,u.default)(e,[{key:"backoffConfig",value:function(){return(0,o.default)(this.config.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){return"undefined"!==typeof this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:"undefined"!==typeof this.config.retryWhenThrottledDefault&&this.config.retryWhenThrottledDefault}},{key:"isExpired",value:function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{key:"cleanupCache",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=(0,i.default)(this.cache);!(e=(r=o.next()).done);e=!0){var s=r.value,c=(0,a.default)(s,2),u=c[0],l=c[1];this.isExpired(l.timestamp)&&this.cache.delete(u)}}catch(d){t=!0,n=d}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}0===this.cache.size&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var e=this;this.timer=this.timer||setInterval(function(){return e.cleanupCache()},2*this.cacheLifetime)}},{key:"executeWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new l.default(function(r,i){var a=[502,503,504];n&&a.push(429);var o=new h.default(t.backoffConfig());o.on("attempt",function(){e().then(function(e){return o.succeeded(e)}).catch(function(e){a.indexOf(e.status)>-1?o.failed(e):"Twilsock disconnected"===e.message?o.failed(e):(o.removeAllListeners(),o.cancel(),i(e))})}),o.on("succeeded",function(e){r(e)}),o.on("cancelled",function(e){return i(e)}),o.on("failed",function(e){return i(e)}),o.start()})}},{key:"get",value:function(e){return f(this,void 0,void 0,r.default.mark(function t(){var n,i,a,o=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.cache.get(e))||this.isExpired(n.timestamp)){t.next=3;break}return t.abrupt("return",n.response);case 3:return i={},t.next=6,this.executeWithRetry(function(){return o.services.transport.get(e,i)},this.retryWhenThrottled());case 6:return a=t.sent,this.cache.set(e,{response:a,timestamp:Date.now()}),this.pokeTimer(),t.abrupt("return",a);case 10:case"end":return t.stop()}},t,this)}))}}]),e}();t.Network=p},function(e,t,n){"use strict";var r=n(159),i=n(165),a=n(172),o=n(170),s=n(173);Object.defineProperty(t,"__esModule",{value:!0});var c=n(169),u=function(e){function t(e){var n;return r(this,t),(n=a(this,o(t).call(this))).minDelay=e.min,n.maxDelay=e.max,n.initialDelay=e.initial||0,n.maxAttemptsCount=e.maxAttemptsCount||0,n.maxAttemptsTime=e.maxAttemptsTime||0,n.randomness=e.randomness||0,n.inProgress=!1,n.attemptNum=0,n.prevDelay=0,n.currDelay=0,n}return s(t,e),i(t,[{key:"attempt",value:function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"===typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;var t=this.currDelay+this.prevDelay;return this.prevDelay=this.currDelay,this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),void this.reject(new Error("Maximum attempt time limit reached"));this.timeout=setTimeout(function(){return t.attempt()},n)}},{key:"cleanup",value:function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise(function(t,n){e.resolve=t,e.reject=n,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)})}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}},{key:"succeeded",value:function(e){this.emit("succeeded",e),this.resolve(e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}},{key:"run",value:function(e){var t=this;return this.on("attempt",function(){e().then(function(e){return t.succeeded(e)}).catch(function(e){return t.failed(e)})}),this.start()}}]),t}(c.EventEmitter);function l(e){return void 0!==e&&null!==e}t.Retrier=u;var d=function(e){function t(e){var n;if(r(this,t),n=a(this,o(t).call(this)),l((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(l(e.maxDelay)&&e.maxDelay<=1)throw new Error("The maximal timeout must be greater than 1.");if(l(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");if(l(e.factor)&&e.factor<=1)throw new Error("Exponential factor should be greater than 1.");if(n.initialDelay=e.initialDelay||100,n.maxDelay=e.maxDelay||1e4,n.maxDelay<=n.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return n.randomisationFactor=e.randomisationFactor||0,n.factor=e.factor||2,n.maxNumberOfRetry=-1,n.reset(),n}return s(t,e),i(t,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new t(e)}}]),t}(c.EventEmitter);t.Backoff=d,t.default=u},function(e,t,n){"use strict";var r=s(n(193)),i=s(n(152)),a=s(n(161)),o=s(n(189));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t,n,r){return new(n||(n=o.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var u=n(247),l=n(424),d=n(1666),f=function(){function e(t){(0,i.default)(this,e),this.services=t}return(0,a.default)(e,[{key:"getPage",value:function(e){return c(this,void 0,void 0,r.default.mark(function t(){var n,i,a,o=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},t.next=3,this.services.session.getSessionLinks();case 3:return n=t.sent,i=new u.UriBuilder(n.syncListUrl).arg("PageToken",e.pageToken).build(),t.next=7,this.services.network.get(i);case 7:return a=t.sent,t.abrupt("return",new l.RestPaginator(a.body.channels.map(function(e){return new d.SyncListDescriptor(e)}),function(e){return o.getPage({pageToken:e})},a.body.meta.previous_token,a.body.meta.next_token));case 9:case"end":return t.stop()}},t,this)}))}}]),e}();t.SyncList=f},function(e,t,n){"use strict";var r,i=n(152),a=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0});t.SyncListDescriptor=function e(t){(0,a.default)(this,e),this.descriptor=t,this.channel_sid=t.channel_sid,this.status=t.status,this.channel=t.channel,this.messages=t.messages,this.roster=t.roster,this.lastConsumedMessageIndex=t.last_consumed_message_index,this.notificationLevel=t.notification_level,this.status=t.status}},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165),s=n(172),c=n(170),u=n(173);Object.defineProperty(t,"__esModule",{value:!0});var l=n(169),d=n(284),f=n(1668),h=n(1669),p=n(1682),v=n(1684),m=n(1686),g=n(1687),y=n(1689),b=n(262),_=n(1690),k=n(1691),w=function(e){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};a(this,t),(r=s(this,c(t).call(this))).offlineStorageDeferred=new y.Deferred,i.continuationToken=i.continuationToken?i.continuationToken:k.TokenStorage.getStoredToken(n);var o=r.config=new f.Configuration(e,n,i);d.log.setLevel(o.logLevel);var u=new v.WebSocketChannel(o.url),l=i.transport?i.transport:new p.PacketInterface(u,o);return r.channel=i.channel?i.channel:new h.TwilsockImpl(u,l,o),r.registrations=i.registrations?i.registrations:new m.Registrations(l),r.upstream=new g.Upstream(l,r.channel,o),r.registrations.on("registered",function(e){return r.emit("registered",e)}),r.channel.on("message",function(e,t){return setTimeout(function(){return r.emit("message",e,t)},0)}),r.channel.on("tokenAboutToExpire",function(){return setTimeout(function(){return r.emit("tokenAboutToExpire")},0)}),r.channel.on("tokenExpired",function(){return setTimeout(function(){return r.emit("tokenExpired")},0)}),r.channel.on("connected",function(){return r.registrations.updateRegistrations()}),r.channel.on("connected",function(){return r.upstream.sendPendingMessages()}),r.channel.on("connected",function(){return setTimeout(function(){return r.emit("connected")},0)}),r.channel.on("disconnected",function(){return setTimeout(function(){return r.emit("disconnected")},0)}),r.channel.on("disconnected",function(){return r.upstream.rejectPendingMessages()}),r.channel.on("stateChanged",function(e){return setTimeout(function(){return r.emit("stateChanged",e)},0)}),r.channel.on("disconnected",function(){return r.offlineStorageDeferred.fail(new b.TwilsockError("Client disconnected"))}),r.channel.on("initialized",function(e){r.handleStorageId(n,e),k.TokenStorage.storeToken(e.continuationToken,n)}),r.offlineStorageDeferred.promise.catch(function(){}),r}return u(t,e),o(t,[{key:"handleStorageId",value:function(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(_.OfflineProductStorage.create(t.offlineStorage[e])),d.log.debug("Offline storage for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage[e]),"."))}catch(n){this.offlineStorageDeferred.fail(new b.TwilsockError("Failed to parse offline storage for ".concat(e," ").concat(JSON.stringify(t.offlineStorage[e]),". ").concat(n,".")))}else this.offlineStorageDeferred.fail(new b.TwilsockError("No offline storage id for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage))));else this.offlineStorageDeferred.fail(new b.TwilsockError("No offline storage id"))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"updateToken",value:function(){var e=i(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d.log.trace("updating token '".concat(t,"'")),this.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return this.config.updateToken(t),e.abrupt("return",this.channel.updateToken(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setNotificationsContext",value:function(e,t){this.registrations.setNotificationsContext(e,t)}},{key:"removeNotificationsContext",value:function(e){this.registrations.removeNotificationsContext(e)}},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:function(){return this.channel.disconnect()}},{key:"get",value:function(e,t){return this.upstream.send("GET",e,t)}},{key:"post",value:function(e,t,n){return this.upstream.send("POST",e,t,n)}},{key:"put",value:function(e,t,n){return this.upstream.send("PUT",e,t,n)}},{key:"delete",value:function(e,t){return this.upstream.send("DELETE",e,t)}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}}]),t}(l.EventEmitter);t.TwilsockClient=w,t.Twilsock=w},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a="0.5.6",o=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e),this.activeGrant=n,this._token=t;var o=i.region||"us1",s="wss://tsock.".concat(o,".twilio.com/v3/wsconnect"),c=i.twilsock||i.Twilsock||{};this.url=c.uri||s,this._continuationToken=i.continuationToken?i.continuationToken:null,this.logLevel=i.logLevel?i.logLevel:"error",this.retryPolicy=i.retryPolicy?i.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=i.clientMetadata?i.clientMetadata:{},this.clientMetadata.ver=a,this.initRegistrations=i.initRegistrations?i.initRegistrations:null}return i(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"updateContinuationToken",value:function(e){this._continuationToken=e}},{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}}]),e}();t.Configuration=o},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(165),o=n(172),s=n(170),c=n(1670),u=n(173),l=n(159);Object.defineProperty(t,"__esModule",{value:!0});var d=n(169),f=n(1672),h=n(284),p=n(550),v=n(835),m=n(836),g=n(1681);t.Response=function e(){l(this,e)};var y=function(e){function t(e,n,r){var i;return l(this,t),(i=o(this,s(t).call(this))).terminalStates=["disconnected","rejected"],i.lastEmittedState=void 0,i.tokenExpiredSasCode=20104,i.websocket=e,i.websocket.on("connected",function(){return i.fsm.socketConnected()}),i.websocket.on("disconnected",function(e){return i.fsm.socketClosed()}),i.websocket.on("message",function(e){return i.onIncomingMessage(e)}),i.transport=n,i.config=r,i.retrier=new g.BackoffRetrier(r.retryPolicy),i.retrier.on("attempt",function(){return i.retry()}),i.retrier.on("failed",function(e){h.log.warn("Retrying failed: ".concat(e.message)),i.disconnect()}),"undefined"!==typeof window&&"undefined"!==typeof window.addEventListener&&(window.addEventListener("online",function(){h.log.debug("Browser reported connectivity state: online"),i.fsm.systemOnline()}),window.addEventListener("offline",function(){h.log.debug("Browser reported connectivity state: online"),i.websocket.close(),i.fsm.socketClosed()})),i.fsm=new f({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){i.setupSocket(),i.emit("connecting")},onEnterInitialising:function(){i.sendInit()},onLeaveInitialising:function(){i.cancelInit()},onEnterUpdating:function(){i.sendUpdate()},onLeaveUpdating:function(){i.cancelUpdate()},onEnterRetrying:function(){i.initRetry(),i.emit("connecting")},onEnterConnected:function(){i.resetBackoff(),i.onConnected()},onUserUpdateToken:function(){i.resetBackoff()},onTokenRejected:function(){i.resetBackoff(),i.closeSocket(!0),i.finalizeSocket()},onUserDisconnect:function(){i.closeSocket(!0)},onEnterDisconnecting:function(){i.startDisconnectTimer()},onLeaveDisconnecting:function(){i.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){i.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){i.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){i.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){i.cancelDisconnectTimer()},onDisconnected:function(){i.resetBackoff(),i.finalizeSocket()},onReceiveClose:function(e,t){i.onCloseReceived(t)},onReceiveOffload:function(e,t){h.log.debug("onreceiveoffload: ",t),i.modifyBackoff(t.body),i.onCloseReceived(t.status)},onUnsupported:function(){i.closeSocket(!0),i.finalizeSocket()},onError:function(e,t){i.closeSocket(t),i.finalizeSocket()},onEnterState:function(e){"none"!==e.from&&i.changeState(e)},onInvalidTransition:function(e,t,n){h.log.warn("FSM: unexpected transition",t,n)}}}),i}return u(t,e),a(t,[{key:"changeState",value:function(e){h.log.debug("FSM: ".concat(e.transition,": ").concat(e.from," --\x3e ").concat(e.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){h.log.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(e){h.log.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"===typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}},{key:"emit",value:function(e){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return h.log.debug("Emitting '".concat(e.toString(),"'").concat(i.length>0?" with "+i.length+" argument/s":"")),(n=c(s(t.prototype),"emit",this)).call.apply(n,[this,e].concat(i))}},{key:"startDisconnectTimer",value:function(){var e=this;h.log.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout(function(){h.log.debug("disconnecting is timed out"),e.closeSocket(!0)},3e3)}},{key:"cancelDisconnectTimer",value:function(){h.log.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"initRetry",value:function(){h.log.debug("initRetry"),this.retrier.inProgress?this.retrier.cancel():this.retrier.start()}},{key:"retry",value:function(){"connecting"!=this.fsm.state?(h.log.trace("retry"),this.websocket.close(),this.fsm.userRetry()):h.log.trace("can\t retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){h.log.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){h.log.trace("setupSocket:",this.config.token),this.websocket.connect()}},{key:"onIncomingMessage",value:function(e){var t=v.Parser.parse(e),n=t.method,r=t.header,i=t.payload;"reply"!==n&&this.confirmReceiving(r),"notification"===n?this.emit("message",r.message_type,i):"reply"===r.method?this.transport.processReply({id:r.id,status:r.status,header:r,body:i}):"client_update"===r.method?"token_about_to_expire"===r.client_update_type&&this.emit("tokenAboutToExpire"):"close"===r.method&&(308===r.status.code?(h.log.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:r.status.status,body:i})):406===r.status.code?(h.log.error("Server closed connection because can't parse protocol: ".concat(JSON.stringify(r.status))),this.fsm.receiveFatalClose()):417===r.status.code?(h.log.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify(r.status))),this.fsm.receiveFatalClose(r.status.status)):410===r.status.code?(h.log.warn("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status),this.emit("tokenExpired")):401===r.status.code?(h.log.error("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status)):(h.log.warn("unexpected message: ",r.status),this.fsm.receiveOffload({status:r.status.status,body:null})))}},{key:"sendInit",value:function(){var e=i(r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h.log.trace("sendInit"),e.prev=1,e.next=4,this.transport.sendInit();case 4:t=e.sent,this.config.updateContinuationToken(t.continuationToken),this.fsm.initSuccess(t),this.emit("initialized",t),this.emit("tokenUpdated"),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),e.t0 instanceof m.TwilsockReplyError?(h.log.warn("Init rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.initError(!0)):500===e.t0.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0)):this.fsm.initError(!0),this.emit("tokenUpdated",e.t0);case 15:case"end":return e.stop()}},e,this,[[1,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"sendUpdate",value:function(){var e=i(r.mark(function e(){var t,n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h.log.trace("sendUpdate"),t=new p.Update(this.config.token),e.prev=2,e.next=5,this.transport.sendWithReply(t);case 5:n=e.sent,this.fsm.updateSuccess(n.body),this.emit("tokenUpdated"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0 instanceof m.TwilsockReplyError?(h.log.warn("Token update rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0),this.emit("tokenUpdated",e.t0);case 14:case"end":return e.stop()}},e,this,[[2,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"cancelInit",value:function(){h.log.trace("cancelInit")}},{key:"cancelUpdate",value:function(){h.log.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(e){h.log.trace("confirmReceiving");try{this.transport.send(new p.Reply(e.id))}catch(t){h.log.debug("failed to confirm packet receiving",t)}}},{key:"closeSocket",value:function(e){var t=this;h.log.trace("closeSocket (graceful: ".concat(e,")")),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout(function(){return t.fsm.socketClosed()},0)}},{key:"connect",value:function(){h.log.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return h.log.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise(function(t){e.disconnectedPromiseResolve=t,e.fsm.userDisconnect()})}},{key:"updateToken",value:function(e){var t=this;return h.log.trace("updateToken:",e),new Promise(function(e,n){t.once("tokenUpdated",function(t){t?n(t):e()}),t.fsm.userUpdateToken()})}},{key:"onCloseReceived",value:function(e){this.websocket.close()}},{key:"isConnected",get:function(){return"connected"===this.state&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"rejected";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{key:"isTerminalState",get:function(){return-1!==this.terminalStates.indexOf(this.fsm.state)}}]),t}(d.EventEmitter);t.TwilsockChannel=y,t.TwilsockImpl=y},function(e,t,n){n(170);var r=n(1671);function i(t,n,a){return"undefined"!==typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,n){var i=r(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n):a.value}},i(t,n,a||t)}e.exports=i},function(e,t,n){var r=n(170);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},function(e,t,n){var r;r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i;for(n=1;n<arguments.length;n++)for(i in r=arguments[n])r.hasOwnProperty(i)&&(e[i]=r[i]);return e}},function(e,t,n){"use strict";var r=n(0);e.exports={build:function(e,t){var n,i,a,o=t.plugins;for(n=0,i=o.length;n<i;n++)(a=o[n]).methods&&r(e,a.methods),a.properties&&Object.defineProperties(e,a.properties)},hook:function(e,t,n){var r,i,a,o,s=e.config.plugins,c=[e.context];for(n&&(c=c.concat(n)),r=0,i=s.length;r<i;r++)o=s[r],(a=s[r][t])&&a.apply(o,c)}}},function(e,t,n){"use strict";function r(e){if(0===e.length)return e;var t,n,r=e.split(/[_-]/);if(1===r.length&&r[0][0].toLowerCase()===r[0][0])return e;for(n=r[0].toLowerCase(),t=1;t<r.length;t++)n=n+r[t].charAt(0).toUpperCase()+r[t].substring(1).toLowerCase();return n}r.prepended=function(e,t){return e+(t=r(t))[0].toUpperCase()+t.substring(1)},e.exports=r},function(e,t,n){"use strict";var r=n(0),i=n(2);function a(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}r(a.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=i.prepended("onEnter",e),this.lifecycle.onLeave[e]=i.prepended("onLeave",e),this.lifecycle.on[e]=i.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=i.prepended("onBefore",e),this.lifecycle.onAfter[e]=i.prepended("onAfter",e),this.lifecycle.on[e]=i.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,r=e.to;return this.addState(n),"function"!==typeof r&&this.addState(r),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"===typeof e?this.mapTransition(r({},this.defaults.init,{to:e,active:!0})):"object"===typeof e?this.mapTransition(r({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"===typeof e?e:"object"===typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var n,r,i;for(n=0,r=(e=e||[]).length;n<r;n++)"function"===typeof(i=e[n])&&(e[n]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,n,r,i,a,o=this.defaults.wildcard;for(n=0;n<e.length;n++)for(r=e[n],i=Array.isArray(r.from)?r.from:[r.from||o],a=r.to||o,t=0;t<i.length;t++)this.mapTransition({name:r.name,from:i[t],to:a})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=a},function(e,t,n){var r=n(0),i=n(6),a=n(1),o=[null,[]];function s(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}r(s.prototype,{init:function(e){if(r(this.context,this.config.data.apply(this.context,e)),a.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,r=this.config.transitionFor(this.state,e),i=r&&r.to;return"function"===typeof i?i.apply(this.context,t):i===n?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,r){var i=this.config.lifecycle,a=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),r.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),a?this.observersForEvent(i.onLeave.state):o,a?this.observersForEvent(i.onLeave[t]):o,this.observersForEvent(i.on.transition),a?["doTransit",[this]]:o,a?this.observersForEvent(i.onEnter.state):o,a?this.observersForEvent(i.onEnter[n]):o,a?this.observersForEvent(i.on[n]):o,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],r)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,r=this.observers.length,i=[];n<r;n++)(t=this.observers[n])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,n,r){if(0===e.length)return this.endTransit(void 0===r||r);var i=e[0][0],o=e[0][1],s=e[0][2];if(t[0].event=i,i&&s&&i!==n&&a.hook(this,"lifecycle",t),0===o.length)return e.shift(),this.observeEvents(e,t,i,r);var c=o.shift(),u=c[i].apply(c,t);return u&&"function"===typeof u.then?u.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===u?this.endTransit(!1):this.observeEvents(e,t,i,u)},onInvalidTransition:function(e,t,n){throw new i("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new i("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=s},function(e,t,n){"use strict";var r=n(0),i=n(2),a=n(1),o=n(3),s=n(4),c={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},u={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function l(e){return d(this||{},e)}function d(e,t){return f(e,new o(t,l)),e._fsm(),e}function f(e,t){if("object"!==typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");a.build(e,t),Object.defineProperties(e,u),r(e,c),r(e,t.methods),t.allTransitions().forEach(function(t){e[i(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}}),e._fsm=function(){this._fsm=new s(this,t),this._fsm.init(arguments)}}l.version="3.0.1",l.factory=function(){var e,t;"function"===typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new o(t,l);return f(e.prototype,n),e.prototype._fsm.config=n,e},l.apply=d,l.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=l},function(e,t,n){"use strict";e.exports=function(e,t,n,r,i){this.message=e,this.transition=t,this.from=n,this.to=r,this.current=i}}])},e.exports=r()},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173);Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(e,n,o){var s,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return r(this,t),(s=i(this,a(t).call(this))).method="init",s.token=e,s.continuation_token=n,s.metadata=o,s.registrations=c,s.capabilities=["client_update","offline_storage"],s}return o(t,e),t}(n(312).AbstractMessage);t.Init=s},function(e,t,n){var r,i,a=n(833),o=n(834),s=0,c=0;e.exports=function(e,t,n){var u=t&&n||0,l=t||[],d=(e=e||{}).node||r,f=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==f){var h=a();null==d&&(d=r=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==f&&(f=i=16383&(h[6]<<8|h[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:c+1,m=p-s+(v-c)/1e4;if(m<0&&void 0===e.clockseq&&(f=f+1&16383),(m<0||p>s)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=p,c=v,i=f;var g=(1e4*(268435455&(p+=122192928e5))+v)%4294967296;l[u++]=g>>>24&255,l[u++]=g>>>16&255,l[u++]=g>>>8&255,l[u++]=255&g;var y=p/4294967296*1e4&268435455;l[u++]=y>>>8&255,l[u++]=255&y,l[u++]=y>>>24&15|16,l[u++]=y>>>16&255,l[u++]=f>>>8|128,l[u++]=255&f;for(var b=0;b<6;++b)l[u+b]=d[b];return t||o(l)}},function(e,t,n){var r=n(833),i=n(834);e.exports=function(e,t,n){var a=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[a+s]=o[s];return t||i(o)}},function(e,t,n){"use strict";var r=n(172),i=n(170),a=n(173),o=n(159);Object.defineProperty(t,"__esModule",{value:!0});var s=n(312);t.ContinuationTokenStatus=function e(){o(this,e)};var c=function(e){function t(e,n,a,s,c){var u;return o(this,t),(u=r(this,i(t).call(this,e))).continuationToken=n,u.continuationTokenStatus=a,u.offlineStorage=s,u.initRegistrations=c,u}return a(t,e),t}(s.AbstractMessage);t.InitReply=c},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173);Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(e){var n;return r(this,t),(n=i(this,a(t).call(this))).method="update",n.token=e,n}return o(t,e),t}(n(312).AbstractMessage);t.Update=s},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173);Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(e,n,o){var s;return r(this,t),(s=i(this,a(t).call(this))).method="message",s.active_grant=e,s.payload_type=n,s.http_request=o,s}return o(t,e),t}(n(312).AbstractMessage);t.Message=s},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173);Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(e){var n;return r(this,t),(n=i(this,a(t).call(this,e))).method="reply",n.payload_type="application/json",n.status={code:200,status:"OK"},n}return o(t,e),t}(n(312).AbstractMessage);t.Reply=s},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173);Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var e;return r(this,t),(e=i(this,a(t).call(this))).method="close",e}return o(t,e),t}(n(312).AbstractMessage);t.Close=s},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(165),s=n(173);Object.defineProperty(t,"__esModule",{value:!0});var c=n(169),u=n(425),l=function(e){function t(e){var n;return r(this,t),(n=i(this,a(t).call(this))).options=e?Object.assign({},e):{},n}return s(t,e),o(t,[{key:"inProgress",get:function(){return!!this.retrier}}]),o(t,[{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(e){this.newBackoff=e}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");this.newBackoff?!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():this.retrier.failed(new Error):this.retrier.failed(new Error)}},{key:"cancel",value:function(){this.retrier&&this.retrier.cancel()}},{key:"cleanRetrier",value:function(){this.retrier&&(this.retrier.removeAllListeners(),this.retrier.cancel(),this.retrier=null)}},{key:"getRetryPolicy",value:function(){var e=Object.assign({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}},{key:"createRetrier",value:function(){var e=this;this.cleanRetrier();var t=this.getRetryPolicy();this.retrier=new u.default(t),this.retrier.once("attempt",function(){e.retrier.on("attempt",function(){return e.emit("attempt")}),e.retrier.failed(new Error("Skipping first attempt"))}),this.retrier.on("failed",function(t){return e.emit("failed",t)}),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start().catch(function(e){})}}]),t}(c.EventEmitter);t.BackoffRetrier=l},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(165),o=n(159);Object.defineProperty(t,"__esModule",{value:!0});var s=n(284),c=n(313),u=n(285),l=n(836),d=n(835),f=n(550),h=n(1683);t.PacketResponse=function e(){o(this,e)};var p=function(){function e(t,n){var r=this;o(this,e),this.config=n,this.activeRequests=new Map,this.channel=t,this.channel.on("reply",function(e){return r.processReply(e)}),this.channel.on("disconnected",function(){r.activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new u.TwilsockError("disconnected"))}),r.activeRequests.clear()})}return a(e,[{key:"processReply",value:function(e){var t,n=this.activeRequests.get(e.id);n&&(clearTimeout(n.timeout),this.activeRequests.delete(e.id),(t=e.status.code)>=200&&t<300?n.resolve(e):(n.reject(new l.TwilsockReplyError("Transport failure: "+e.status.status,e)),s.log.trace("message rejected")))}},{key:"storeRequest",value:function(e,t,n){var r={resolve:t,reject:n,timeout:setTimeout(function(){s.log.trace("request",e,"is timed out"),n(new u.TwilsockError("Twilsock: request timeout: "+e))},3e4)};this.activeRequests.set(e,r)}},{key:"shutdown",value:function(){this.activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new u.TwilsockError("Twilsock: request cancelled by user"))}),this.activeRequests.clear()}},{key:"sendInit",value:function(){var e=i(r.mark(function e(){var t,n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s.log.trace("sendInit"),t=h.Metadata.getMetadata(this.config),n=new f.Init(this.config.token,this.config.continuationToken,t,this.config.initRegistrations),e.next=5,this.sendWithReply(n);case 5:return i=e.sent,e.abrupt("return",new f.InitReply(i.id,i.header.continuation_token,i.header.continuation_token_status,i.header.offline_storage,i.header.init_registrations));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sendClose",value:function(){var e=new f.Close;this.send(e)}},{key:"sendWithReply",value:function(e,t){var n=this;return new Promise(function(r,i){var a=n.send(e,t);n.storeRequest(a,r,i)})}},{key:"send",value:function(e,t){e.id=e.id||"TM".concat(c.v4());var n=d.Parser.createPacket(e,function(e){switch(typeof e){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(r){throw s.log.debug("failed to send ",e,r),s.log.trace(r.stack),r}}},{key:"isConnected",get:function(){return this.channel.isConnected}}]),e}();t.PacketInterface=p},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=n(551),o=function(){function e(){r(this,e)}return i(e,null,[{key:"getMetadata",value:function(e){"undefined"!==typeof navigator&&a.parse(navigator.userAgent);var t=e&&e.clientMetadata?e.clientMetadata:{},n={env:a.name,envv:a.version,os:a.os.family,osv:a.os.version,osa:a.os.architecture,sdk:"js-default"},r={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter(function(e){return e in t||e in n}).forEach(function(e){return r[e]=e in t?t[e]:n[e]}),r}}]),e}();t.Metadata=o},function(e,t,n){"use strict";(function(e){var r=n(159),i=n(165),a=n(172),o=n(170),s=n(173);Object.defineProperty(t,"__esModule",{value:!0});var c=n(169),u=n(284),l=function(t){function c(t){var i;return r(this,c),(i=a(this,o(c).call(this))).url=t,i.WebSocket=e.WebSocket||e.MozWebSocket||n(1685),i}return s(c,t),i(c,[{key:"connect",value:function(){var e=this;u.log.trace("connecting to socket");var t=new this.WebSocket(this.url);t.binaryType="arraybuffer",t.onopen=function(){u.log.debug("socket opened ".concat(e.url)),e.emit("connected")},t.onclose=function(t){u.log.debug("socket closed",t),e.emit("disconnected",t)},t.onerror=function(e){u.log.debug("error:",e)},t.onmessage=function(t){e.emit("message",t.data)},this.socket=t}},{key:"send",value:function(e){this.socket.send(e)}},{key:"close",value:function(){if(u.log.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}},{key:"isConnected",get:function(){return this.socket&&1===this.socket.readyState}}]),c}(c.EventEmitter);t.WebSocketChannel=l}).call(this,n(48))},,function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165),s=n(172),c=n(170),u=n(173);Object.defineProperty(t,"__esModule",{value:!0});var l=n(284),d=n(169),f=n(313),h=n(285),p=function(e){function t(e){var n;return a(this,t),(n=s(this,c(t).call(this))).transport=e,n.registrations=new Map,n.registrationsInProgress=new Map,n}return u(t,e),o(t,[{key:"putNotificationContext",value:function(){var e=i(r.mark(function e(t,n){var i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={method:"put_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(i,n);case 3:e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteNotificationContext",value:function(){var e=i(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"delete_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(n);case 3:e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateRegistration",value:function(){var e=i(r.mark(function e(t,n){var i,a;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.log.debug("update registration for context",t),(i=this.registrationsInProgress.get(t))||(i=new Set,this.registrationsInProgress.set(t,i)),a=f.v4(),i.add(a),e.prev=5,e.next=8,this.putNotificationContext(t,n);case 8:l.log.debug("registration attempt succeeded for context",n),i.delete(a),0===i.size&&(this.registrationsInProgress.delete(t),this.emit("registered",t)),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(5),l.log.warn("registration attempt failed for context",n),l.log.debug(e.t0),i.delete(a),0===i.size&&(this.registrationsInProgress.delete(t),this.emit("registrationFailed",t,e.t0));case 19:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateRegistrations",value:function(){var e=this;l.log.trace("refreshing ".concat(this.registrations.size," registrations")),this.registrations.forEach(function(t,n){e.updateRegistration(n,t)})}},{key:"setNotificationsContext",value:function(e,t){if(!e||!t)throw new h.TwilsockError("Invalid arguments provided");this.registrations.set(e,t),this.transport.isConnected&&this.updateRegistration(e,t)}},{key:"removeNotificationsContext",value:function(){var e=i(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrations.has(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.deleteNotificationContext(t);case 4:this.transport.isConnected&&this.registrations.delete(t);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(d.EventEmitter);t.Registrations=p},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(165),o=n(159);Object.defineProperty(t,"__esModule",{value:!0});var s=n(284),c=n(285),u=n(1688),l=n(550),d=n(262);function f(e,t){var n=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:null};if(n.search.length>0){var r=n.search.substring(1);n.params=r.split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e},{})}return n}throw new c.TwilsockError("Incorrect URI: "+e)}(t),r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}var h=function(){function e(t,n,r){o(this,e),this.config=r,this.transport=t,this.pendingMessages=[],this.twilsock=n}return a(e,[{key:"saveMessage",value:function(e){var t=this;return new Promise(function(n,r){var i={message:e,resolve:n,reject:r,timeout:setTimeout(function(){s.log.debug("request is timed out"),r(new c.TwilsockError("Twilsock: request timeout"))},2e4)};t.pendingMessages.push(i)})}},{key:"sendPendingMessages",value:function(){for(var e=this,t=function(){var t=e.pendingMessages[0];try{var n=t.message;e.actualSend(n).then(function(e){return t.resolve(e)}).catch(function(e){return t.reject(e)}),clearTimeout(t.timeout)}catch(r){return s.log.debug("Failed to send pending message",r),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length;){if("break"===t())break}}},{key:"rejectPendingMessages",value:function(){this.pendingMessages.forEach(function(e){e.reject(new d.TransportUnavailableError("Can't connect to twilsock")),clearTimeout(e.timeout)}),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:function(){var e=i(r.mark(function e(t){var n,i,a,o,s,c;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.to,i=t.headers,a=t.body,o={host:n.host,path:n.path,method:n.method,params:n.params,headers:i},s=new l.Message(this.config.activeGrant,i["Content-Type"]||"application/json",o),e.next=7,this.transport.sendWithReply(s,a);case 7:if(c=e.sent,!((d=c)&&d.header&&d.header.http_status)||(r=c.header.http_status.code)>=200&&r<300){e.next=10;break}throw new u.TwilsockUpstreamError(c.header.http_status.code,c.header.http_status.status,c.body);case 10:return e.abrupt("return",{status:c.header.http_status,headers:c.header.http_headers,body:c.body});case 11:case"end":return e.stop()}var r,d},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new d.TransportUnavailableError("Can't connect to twilsock"));var i=function(e,t,n,r){return{to:f(e,t),headers:n,body:r}}(e,t,n,r);return this.twilsock.isConnected?this.actualSend(i):this.saveMessage(i)}}]),e}();t.Upstream=h},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173);Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(e,n,o){var s;return r(this,t),(s=i(this,a(t).call(this,n))).status=e,s.description=n,s.body=o,s}return o(t,e),t}(n(285).TwilsockError);t.TwilsockUpstreamError=s},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){var t=this;r(this,e),this._promise=new Promise(function(e,n){t._resolve=e,t._reject=n})}return i(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();t.Deferred=a},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=n(262),o=function(){function e(t){r(this,e),this.id=t}return i(e,null,[{key:"create",value:function(t){if(t instanceof Object&&"storage_id"in t)return new e(t.storage_id);throw new a.TwilsockError('Field "storage_id" is missing')}}]),e}();t.OfflineProductStorage=o},function(e,t,n){"use strict";(function(e){var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){r(this,e)}return i(e,null,[{key:"storeToken",value:function(t,n){e.canStore&&e.sessionStorage.setItem(e.getKeyName(n),t)}},{key:"getStoredToken",value:function(t){return e.canStore?e.sessionStorage.getItem(e.getKeyName(t)):null}},{key:"initialize",value:function(){e.canStore&&(e.sessionStorage.getItem(e.initializedFlag)&&this.clear(),e.sessionStorage.setItem(e.initializedFlag,"true"),e.window.addEventListener("unload",function(){e.sessionStorage.removeItem(e.initializedFlag)}))}},{key:"clear",value:function(){if(e.canStore){for(var t=[],n=0;n<e.sessionStorage.length;n++){var r=e.sessionStorage.key(n);r.startsWith(e.tokenStoragePrefix)&&t.push(r)}t.forEach(function(t){return e.sessionStorage.removeItem(t)}),e.sessionStorage.removeItem(e.initializedFlag)}}},{key:"getKeyName",value:function(t){return"".concat(e.tokenStoragePrefix).concat(t)}},{key:"canStore",get:function(){return e.sessionStorage&&e.window}}]),e}();a.initializedFlag="twilio_twilsock_token_storage",a.tokenStoragePrefix="twilio_continuation_token_",a.sessionStorage=e.sessionStorage,a.window=e.window,t.TokenStorage=a,a.initialize()}).call(this,n(48))},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173);Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(e){return r(this,t),i(this,a(t).call(this,e))}return o(t,e),t}(n(285).TwilsockError);t.TransportUnavailableError=s},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165),s=n(172),c=n(170),u=n(173),l=n(228);Object.defineProperty(t,"__esModule",{value:!0});var d=n(169),f=n(262),h=n(1694),p=n(1695),v=n(552),m=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a(this,t),n=s(this,c(t).call(this)),!e||0===e.length)throw new Error("Token is required for Notifications client");r.logLevel=r.logLevel||"error",v.log.setLevel(r.logLevel);r.minTokenRefreshInterval;var i=r.productId||"notifications";return r.twilsockClient=r.twilsockClient||new f.TwilsockClient(e,i,r),r.transport=r.transport||r.twilsockClient,n.services={twilsock:r.twilsockClient,transport:r.transport,config:new h.Configuration(null,r)},n.registrar=new p.Registrar(i,n.services.transport,n.services.twilsock,n.services.config),n.reliableTransportState={overall:!1,transport:!1,registration:!1,lastEmitted:null},n._onTransportStateChange(n.services.twilsock.isConnected),n.registrar.on("transportReady",function(e){n._onRegistrationStateChange(e?"registered":"")}),n.registrar.on("stateChanged",function(e){n._onRegistrationStateChange(e)}),n.registrar.on("needReliableTransport",n._onNeedReliableTransport.bind(l(l(n)))),n.services.twilsock.on("message",function(e,t){return n._routeMessage(e,t)}),n.services.twilsock.on("connected",function(e){n._onTransportStateChange(!0),n.registrar.setNotificationId("twilsock",e)}),n.services.twilsock.on("disconnected",function(){n._onTransportStateChange(!1)}),n.updateToken(e),n}return u(t,e),o(t,[{key:"_routeMessage",value:function(e,t){v.log.trace("Message arrived: ",e,t),this.emit("message",e,t)}},{key:"_onNeedReliableTransport",value:function(e){e?this.services.twilsock.connect():this.services.twilsock.disconnect()}},{key:"_onRegistrationStateChange",value:function(e){this.reliableTransportState.registration="registered"===e,this._updateTransportState()}},{key:"_onTransportStateChange",value:function(e){this.reliableTransportState.transport=e,this._updateTransportState()}},{key:"_updateTransportState",value:function(){var e=this.reliableTransportState.transport&&this.reliableTransportState.registration;this.reliableTransportState.overall!==e&&(this.reliableTransportState.overall=e,v.log.info("Transport ready:",e),this.emit("transportReady",e)),this.reliableTransportState.lastEmitted!==this.connectionState&&(this.reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}},{key:"subscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return v.log.trace("Add subscriptions for message type: ",e,t),this.registrar.subscribe(e,t)}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return v.log.trace("Remove subscriptions for message type: ",e,t),this.registrar.unsubscribe(e,t)}},{key:"handlePushNotification",value:function(e){return{messageType:e.twi_message_type,payload:e.payload}}},{key:"setPushRegistrationId",value:function(e,t){v.log.trace("Set push registration id",e,t),this.registrar.setNotificationId(t,e)}},{key:"updateToken",value:function(){var e=i(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(v.log.info("authTokenUpdated"),this.services.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:this.services.twilsock.updateToken(t),this.services.config.updateToken(t),this.registrar.updateToken(t);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"connectionState",get:function(){return"disconnected"===this.services.twilsock.state?"disconnected":"disconnecting"===this.services.twilsock.state?"disconnecting":"connected"===this.services.twilsock.state&&this.reliableTransportState.registration?"connected":"rejected"===this.services.twilsock.state?"denied":"connecting"}}]),t}(d.EventEmitter);t.Client=m},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e);var i=n.notifications||{},a=i.region||n.region||"us1",o="https://ers.".concat(a,".twilio.com/v1/registrations");this.registrarUrl=i.ersUrl||o,this._token=t}return i(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"token",get:function(){return this._token}}]),e}();t.Configuration=a},function(e,t,n){"use strict";var r=n(159),i=n(165),a=n(172),o=n(170),s=n(173);Object.defineProperty(t,"__esModule",{value:!0});var c=n(169),u=n(1696),l=n(1697),d=function(e){function t(e,n,i,s){var c;r(this,t),(c=a(this,o(t).call(this))).config=s,c.connectors=new Map;var d=c.detectPlatform();return c.connectors.set("gcm",new u.RegistrarConnector("gcm",{protocolVersion:3,productId:e,platform:d},n,s)),c.connectors.set("fcm",new u.RegistrarConnector("fcm",{protocolVersion:3,productId:e,platform:d},n,s)),c.connectors.set("apn",new u.RegistrarConnector("apn",{protocolVersion:4,productId:e,platform:d},n,s)),c.connectors.set("twilsock",new l.TwilsockConnector({productId:e,platform:d},i,s)),c.connectors.get("twilsock").on("transportReady",function(e){return c.emit("transportReady",e)}),c}return s(t,e),i(t,[{key:"setNotificationId",value:function(e,t){this.connector(e).setNotificationId(t)}},{key:"subscribe",value:function(e,t){return this.connector(t).subscribe(e)}},{key:"unsubscribe",value:function(e,t){return this.connector(t).unsubscribe(e)}},{key:"updateToken",value:function(e){this.connectors.forEach(function(t){return t.updateToken(e)})}},{key:"connector",value:function(e){var t=this.connectors.get(e);if(!t)throw new Error("Unknown channel type: ".concat(e));return t}},{key:"detectPlatform",value:function(){var e="";return"undefined"!==typeof navigator?(e="unknown","undefined"!==typeof navigator.product&&(e=navigator.product),"undefined"!==typeof navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),t}(c.EventEmitter);t.Registrar=d},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165),s=n(172),c=n(170),u=n(173);Object.defineProperty(t,"__esModule",{value:!0});var l=n(425),d=n(552),f=n(838);t.Connector=f.Connector;var h={min:2e3,max:12e4,randomness:.2},p=function(e){function t(e,n,r,i){var o;return a(this,t),(o=s(this,c(t).call(this,i))).channelType=e,o.context=n,o.transport=r,o}return u(t,e),o(t,[{key:"updateRegistration",value:function(){var e=i(r.mark(function e(t,n){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.has("notificationId")){e.next=3;break}return e.next=3,this.removeRegistration();case 3:if(t.notificationId&&t.notificationId.length){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,this.register(t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeRegistration",value:function(){var e=i(r.mark(function e(){var t,n,i=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrationId){e.next=2;break}return e.abrupt("return");case 2:return t="".concat(this.config.registrarUrl,"/").concat(this.registrationId,"?productId=").concat(this.context.productId),n={"Content-Type":"application/json","X-Twilio-Token":this.config.token},e.prev=4,d.log.trace("Removing registration for ",this.channelType),e.next=8,new l.Retrier(Object.assign(h,{maxAttemptsCount:3})).run(function(){return i.transport.delete(t,n)});case 8:d.log.debug("Registration removed for",this.channelType),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(4),d.log.error("Failed to remove of registration ",this.channelType,e.t0),e.t0;case 15:case"end":return e.stop()}},e,this,[[4,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"register",value:function(){var e=i(r.mark(function e(t){var n,i,a,o,s=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.log.trace("Registering",this.channelType,t),n={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:Array.from(t.messageTypes),data:{registration_id:t.notificationId},ttl:"PT24H"},i="".concat(this.config.registrarUrl,"?productId=").concat(this.context.productId),a={"Content-Type":"application/json","X-Twilio-Token":t.token},d.log.trace("Creating registration for channel ",this.channelType),e.prev=5,e.next=8,new l.Retrier(h).run(function(){return s.transport.post(i,a,n)});case 8:o=e.sent,this.registrationId=o.body.id,d.log.debug("Registration created: ",o),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(5),d.log.error("Registration failed: ",e.t0),e.t0;case 17:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(f.Connector);t.RegistrarConnector=p},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165),s=n(172),c=n(170),u=n(173);Object.defineProperty(t,"__esModule",{value:!0});var l=n(313),d=function(e){function t(e,n,r){var i;return a(this,t),(i=s(this,c(t).call(this,r))).twilsock=n,i.context=e,e.id=l.v4(),i.twilsock.on("stateChanged",function(e){"connected"!==e&&i.emit("transportReady",!1)}),i.twilsock.on("registered",function(t){e&&t===e.id&&"connected"===n.state&&i.emit("transportReady",!0)}),i}return u(t,e),o(t,[{key:"setNotificationId",value:function(){}},{key:"updateToken",value:function(e){}},{key:"updateContextRequest",value:function(){var e=i(r.mark(function e(t){var n;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,message_types:t},this.emit("transportReady",!1),e.next=4,this.twilsock.setNotificationsContext(this.context.id,n);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateRegistration",value:function(){var e=i(r.mark(function e(t,n){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.has("messageType")){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.updateContextRequest(Array.from(t.messageTypes));case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeRegistration",value:function(){return this.twilsock.removeNotificationsContext(this.context.id)}}]),t}(n(838).Connector);t.TwilsockConnector=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1699);t.SyncClient=r.SyncClient;var i=n(842);t.SyncDocument=i.SyncDocument;var a=n(843);t.SyncList=a.SyncList;var o=n(844);t.SyncListItem=o.ListItem;var s=n(847);t.SyncMap=s.SyncMap;var c=n(848);t.SyncMapItem=c.MapItem,t.default=r.SyncClient,e.exports=r.SyncClient,e.exports.SyncClient=r.SyncClient},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165),s=n(172),c=n(170),u=n(173);Object.defineProperty(t,"__esModule",{value:!0});var l=n(169),d=n(262),f=n(837),h=n(314),p=n(287),v=n(1700),m=n(1701),g=n(1707),y=n(1708),b=n(842),_=n(843),k=n(847),w=n(1711),T=n(1712),S=n(1713),C=n(314),E=n(1714),R="data_sync",O=n(1715).version;function x(e){return e._subscribe(),e}function P(e){if(e){if("string"===typeof e)return{id:e,mode:"open_or_create"};h.validateOptionalTtl(e.ttl);var t=e.mode||(e.id?"open_or_create":"create_new");return Object.assign({},e,{mode:t})}return{mode:"create_new"}}var I=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a(this,t),n=s(this,c(t).call(this)),!e)throw new Error("Sync library needs a valid Twilio token to be passed");r.hasOwnProperty("logLevel")?p.default.setLevel(r.logLevel):p.default.setLevel("silent");var i=r.productId=r.productId||R,o=r.twilsockClient=r.twilsockClient||new d.Twilsock(e,i,r);o.on("tokenAboutToExpire",function(e){return n.emit("tokenAboutToExpire",e)}),o.on("tokenExpired",function(){return n.emit("tokenExpired")});var u=r.notificationsClient=r.notificationsClient||new f.Notifications(e,r),l=new v.Configuration(r),h=new y.Network(new w.ClientInfo(O),l,o),b=new S.SessionStorage(l);n.localStorageId=null,o.connect(),n.services={config:l,twilsock:o,notifications:u,network:h,storage:b,router:null,subscriptions:null};var _=new m.Subscriptions(n.services),k=new g.Router({config:l,subscriptions:_,notifications:u});return n.services.router=k,n.services.subscriptions=_,n.entities=new T.EntitiesCache,u.on("connectionStateChanged",function(){n.emit("connectionStateChanged",n.services.notifications.connectionState)}),n}return u(t,e),o(t,[{key:"ensureReady",value:function(){var e=i(r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.services.config.sessionStorageEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.services.twilsock.storageId();case 5:t=e.sent,this.services.storage.updateStorageId(t.id),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),p.default.warn("Failed to initialize storage",e.t0);case 12:case"end":return e.stop()}},e,this,[[2,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"storeRootInSessionCache",value:function(e,t,n){if(this.services.config.sessionStorageEnabled&&t){var r=C.deepClone(n);e!==_.SyncList.type&&e!==k.SyncMap.type||(r.last_event_id=null,delete r.items),this.services.storage.store(e,t,r)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:function(){var e=i(r.mark(function e(t,n){var i,a,o,s=arguments;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.length>2&&void 0!==s[2]&&s[2],n){e.next=3;break}return e.abrupt("return",null);case 3:return a=new h.UriBuilder(t).pathSegment(n).queryParam("Include",i?"items":void 0).build(),e.next=6,this.services.network.get(a);case 6:return o=e.sent,e.abrupt("return",o.body);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"_createDocument",value:function(e,t,n){var r={unique_name:e,data:t||{}};return"number"===typeof n&&(r.ttl=n),this.services.network.post(this.services.config.documentsUri,r).then(function(e){return e.body.data=r.data,e.body})}},{key:"_getDocument",value:function(){var e=i(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(b.SyncDocument.type,t)||this._get(this.services.config.documentsUri,t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_createList",value:function(e,t,n,r){var i={unique_name:e,purpose:t,context:n};return"number"===typeof r&&(i.ttl=r),this.services.network.post(this.services.config.listsUri,i).then(function(e){return e.body})}},{key:"_getList",value:function(){var e=i(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(_.SyncList.type,t)||this._get(this.services.config.listsUri,t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_createMap",value:function(e,t){var n={unique_name:e};return"number"===typeof t&&(n.ttl=t),this.services.network.post(this.services.config.mapsUri,n).then(function(e){return e.body})}},{key:"_getMap",value:function(){var e=i(r.mark(function e(t){var n,i=arguments;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]&&i[1],e.abrupt("return",this.readRootFromSessionCache(k.SyncMap.type,t)||this._get(this.services.config.mapsUri,t,n));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_getStream",value:function(){var e=i(r.mark(function e(t){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(E.SyncStream.type,t)||this._get(this.services.config.streamsUri,t,!1));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_createStream",value:function(){var e=i(r.mark(function e(t,n){var i,a,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={unique_name:t},"number"===typeof n&&(i.ttl=n),e.next=4,this.services.network.post(this.services.config.streamsUri,i);case 4:return a=e.sent,o=a.body,e.abrupt("return",o);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCached",value:function(e,t){return e&&this.entities.get(e,t)||null}},{key:"removeFromCacheAndSession",value:function(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}},{key:"document",value:function(){var e=i(r.mark(function e(t){var n,i,a,o,s=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=P(t)).mode){e.next=9;break}return e.next=6,this._createDocument(n.id,n.value,n.ttl);case 6:i=e.sent,e.next=39;break;case 9:if(!(a=this.getCached(n.id,b.SyncDocument.type))){e.next=14;break}return e.abrupt("return",a);case 14:return e.prev=14,e.next=17,this._getDocument(n.id);case 17:i=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createDocument(n.id,n.value,n.ttl);case 29:i=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.document(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(b.SyncDocument.type,n.id,i),o=new b.SyncDocument(this.services,i,function(e,t,n){return s.removeFromCacheAndSession(e,t,n)}),o=this.entities.store(o),e.abrupt("return",x(o));case 43:case"end":return e.stop()}},e,this,[[14,20],[26,32]])}));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(){var e=i(r.mark(function e(t){var n,i,a,o,s=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=P(t)).mode){e.next=9;break}return e.next=6,this._createMap(n.id,n.ttl);case 6:i=e.sent,e.next=39;break;case 9:if(!(a=this.getCached(n.id,k.SyncMap.type))){e.next=14;break}return e.abrupt("return",a);case 14:return e.prev=14,e.next=17,this._getMap(n.id,n.includeItems);case 17:i=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createMap(n.id,n.ttl);case 29:i=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.map(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(k.SyncMap.type,n.id,i),o=new k.SyncMap(this.services,i,function(e,t,n){return s.removeFromCacheAndSession(e,t,n)}),o=this.entities.store(o),e.abrupt("return",x(o));case 43:case"end":return e.stop()}},e,this,[[14,20],[26,32]])}));return function(t){return e.apply(this,arguments)}}()},{key:"list",value:function(){var e=i(r.mark(function e(t){var n,i,a,o,s=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=P(t)).mode){e.next=9;break}return e.next=6,this._createList(n.id,n.purpose,n.context,n.ttl);case 6:i=e.sent,e.next=39;break;case 9:if(!(a=this.getCached(n.id,_.SyncList.type))){e.next=14;break}return e.abrupt("return",a);case 14:return e.prev=14,e.next=17,this._getList(n.id);case 17:i=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createList(n.id,n.purpose,n.context,n.ttl);case 29:i=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.list(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(_.SyncList.type,n.id,i),o=new _.SyncList(this.services,i,function(e,t,n){return s.removeFromCacheAndSession(e,t,n)}),o=this.entities.store(o),e.abrupt("return",x(o));case 43:case"end":return e.stop()}},e,this,[[14,20],[26,32]])}));return function(t){return e.apply(this,arguments)}}()},{key:"stream",value:function(){var e=i(r.mark(function e(t){var n,i,a,o,s,c=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=P(t)).mode){e.next=9;break}return e.next=6,this._createStream(n.id,n.ttl);case 6:i=e.sent,e.next=39;break;case 9:if(!(a=this.getCached(n.id,E.SyncStream.type))){e.next=14;break}return e.abrupt("return",a);case 14:return e.prev=14,e.next=17,this._getStream(n.id);case 17:i=e.sent,e.next=39;break;case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createStream(n.id,n.ttl);case 29:i=e.sent,e.next=39;break;case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.stream(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(E.SyncStream.type,n.id,i),o=function(e,t,n){return c.removeFromCacheAndSession(e,t,n)},s=new E.SyncStream(this.services,i,o),s=this.entities.store(s),e.abrupt("return",x(s));case 44:case"end":return e.stop()}},e,this,[[14,20],[26,32]])}));return function(t){return e.apply(this,arguments)}}()},{key:"shutdown",value:function(){var e=i(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateToken",value:function(e){return this.services.twilsock.updateToken(e)}},{key:"connectionState",get:function(){return this.services.notifications.connectionState}}],[{key:"version",get:function(){return O}}]),t}(l.EventEmitter);t.Client=I,t.SyncClient=I,t.default=I},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a="/v4/Subscriptions",o="/v3/Maps",s="/v3/Lists",c="/v3/Documents",u="/v3/Streams";var l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n,i,l,d=t.region||"us1",f="https://cds.".concat(d,".twilio.com"),h=t.cdsUri||f;this.settings={subscriptionsUri:h+a,documentsUri:h+c,listsUri:h+s,mapsUri:h+o,streamsUri:h+u,sessionStorageEnabled:(n=t.Sync,i="enableSessionStorage",l=!0,n&&"undefined"!==typeof n[i]?n[i]:l)}}return i(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}}]),e}();t.Configuration=l},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(405),o=n(159),s=n(165);Object.defineProperty(t,"__esModule",{value:!0});var c=n(1702),u=n(287),l=n(286),d=n(262),f=function(){function e(t){o(this,e),this.localObject=t,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return s(e,[{key:"update",value:function(e,t){this.localObject._update(e,t)}},{key:"updatePending",value:function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.localObject._setSubscriptionState("none")}},{key:"markAsFailed",value:function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new l.SyncError("Failed to subscribe on service events: ".concat(e.error.message),e.error.status,e.error.code))}},{key:"complete",value:function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"isEstablished",get:function(){return this.established}}]),e}(),h=function(){function e(t){var n=this;o(this,e),this.isConnected=!1,this.maxBatchSize=100,this.subscriptionTtlTimer=null,this.pendingPokeReason=null,this.services=t,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;this.backoff=c.exponential(Object.assign({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,r):(n.backoff.reset(),u.default.debug("All subscriptions resolved."))})}return s(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,n,r){var i=[],o=!0,s=!1,c=void 0;try{for(var u,l=e[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var d=a(u.value,2),f=d[0],h=d[1];if(!t.get(f)&&n!==h.pendingAction&&!h.rejectedWithError&&(i.push(h),r&&i.length>=r))break}}catch(p){s=!0,c=p}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}return i}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var n=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}},{key:"persist",value:function(){try{this.backoff.backoff()}catch(e){}}},{key:"applyNewSubscriptionUpdateBatch",value:function(){var e=i(r.mark(function e(t,n){var i,a,o,s,c,l,f,h,p,v,m,g,y,b,_,k,w,T,S,C,E=this;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=4;break}return u.default.debug("Twilsock connection (required for subscription) not ready; waiting\u2026"),this.backoff.reset(),e.abrupt("return");case 4:for(n=this.processLocalActions(t,n),i=(new Date).getTime(),a=!0,o=!1,s=void 0,e.prev=9,c=n[Symbol.iterator]();!(a=(l=c.next()).done);a=!0)f=l.value,this.recordActionAttemptOn(f,t,i);e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),o=!0,s=e.t0;case 17:e.prev=17,e.prev=18,a||null==c.return||c.return();case 20:if(e.prev=20,!o){e.next=23;break}throw s;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return h=this.pendingPokeReason,this.pendingPokeReason=null,e.prev=27,e.next=30,this.request(t,i,h,n);case 30:p=e.sent,v=p.body.max_batch_size,!isNaN(parseInt(v))&&isFinite(v)&&v>0&&(this.maxBatchSize=v),this.subscriptionTtlTimer||(m=p.body.ttl_in_s,g=!isNaN(parseFloat(m))&&isFinite(m),g&&m>0&&(this.subscriptionTtlTimer=setTimeout(function(){return E.onSubscriptionTtlElapsed()},1e3*m))),"establish"===t&&(y=p.body.estimated_delivery_in_ms,b=!isNaN(parseFloat(y))&&isFinite(y),b&&y>0?setTimeout(function(){return E.verifyPokeDelivery(i,y,n)},y):u.default.error("Invalid timeout: ".concat(y)),n.filter(function(e){return e.pendingCorrelationId===i}).forEach(function(e){return e.localObject._setSubscriptionState("response_in_flight")})),this.backoff.reset(),e.next=60;break;case 38:for(e.prev=38,e.t1=e.catch(27),_=!0,k=!1,w=void 0,e.prev=43,T=n[Symbol.iterator]();!(_=(S=T.next()).done);_=!0)C=S.value,this.recordActionFailureOn(C,t);e.next=51;break;case 47:e.prev=47,e.t2=e.catch(43),k=!0,w=e.t2;case 51:e.prev=51,e.prev=52,_||null==T.return||T.return();case 54:if(e.prev=54,!k){e.next=57;break}throw w;case 57:return e.finish(54);case 58:return e.finish(51);case 59:e.t1 instanceof d.TransportUnavailableError?(u.default.debug("Twilsock connection (required for subscription) not ready (c:".concat(i,"); waiting\u2026")),this.backoff.reset()):(u.default.debug("Failed an attempt to ".concat(t," subscriptions (c:").concat(i,"); retrying"),e.t1),this.persist());case 60:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24],[27,38],[43,47,51,59],[52,,54,58]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"verifyPokeDelivery",value:function(e,t,n){var r=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),a=i?(new Date).getTime()-i:t;a>=t?(n.filter(function(t){return t.pendingCorrelationId===e}).forEach(function(e){e.updatePending(null,null),e.retryCount++,r.persisted.delete(e.sid)}),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e)):setTimeout(function(){return r.verifyPokeDelivery(e,t,n)},t-a)}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter(function(e){return!e.rejectedWithError}):t}},{key:"recordActionAttemptOn",value:function(e,t,n){if(e.localObject._setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,n);else{var r=this.persisted.get(e.sid);r&&r.updatePending(t,n)}}},{key:"recordActionFailureOn",value:function(e,t){e.localObject._setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,n,r){var i=r.map(function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0}}),a=r.filter(function(e){return e.retryCount>0}).length;u.default.debug("Attempting '".concat(e,"' request (c:").concat(t,"):"),i);var o={event_protocol_version:3,action:e,correlation_id:t,retried_requests:a,ttl_in_s:-1,requests:i};return"ttl"===n&&(o.reason=n),this.services.network.post(this.services.config.subscriptionsUri,o,null,!0)}},{key:"add",value:function(e,t){u.default.debug("Establishing intent to subscribe to ".concat(e));var n=this.subscriptions.get(e);n&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new f(t)),this.persist())}},{key:"remove",value:function(e){u.default.debug("Establishing intent to unsubscribe from ".concat(e)),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e,t){switch(u.default.trace("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(e.event_type.match(/^(?:map|list|document|stream)_/)||{}).input:this.applyEventToSubscribedEntity(e.event_type.match(/^map_/)?e.event.map_sid:e.event_type.match(/^list_/)?e.event.list_sid:e.event_type.match(/^document_/)?e.event.document_sid:e.event_type.match(/^stream_/)?e.event.stream_sid:void 0,e,t);break;default:u.default.debug("Dropping unknown message type ".concat(e.event_type))}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var n=e.object_sid,r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?"interrupted"===e.replay_status?(u.default.debug("Event Replay for subscription to ".concat(n," (c:").concat(t,") interrupted; continuing eagerly.")),r.updatePending(null,null),this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(u.default.debug("Event Replay for subscription to ".concat(n," (c:").concat(t,") completed. Subscription is ready.")),r.complete(e.last_event_id),this.persisted.set(e.object_sid,r),r.localObject._setSubscriptionState("established"),this.backoff.reset()):u.default.debug("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?(n.updatePending(null,null),n.localObject._setSubscriptionState("none"),this.persisted.delete(e.object_sid)):u.default.debug("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var n=e.object_sid,r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.pendingCorrelationId===t&&(u.default.error("Failed to subscribe on ".concat(i.sid),e.error),i.markAsFailed(e),i.localObject._setSubscriptionState("none")):!r&&i&&(this.persisted.delete(n),i.localObject._setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t,n){var r=this;if(e){n=n||function(){var t=r.persisted.get(e);return t&&t.isEstablished}();var i=this.subscriptions.get(e);i?(t.event.type=t.event_type,i.update(t.event,n)):u.default.debug("Message dropped for SID '".concat(e,"', for which there is no subscription."))}}},{key:"onConnectionStateChanged",value:function(e){this.isConnected=e,e&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(e){u.default.debug("Triggering event replay for all subscriptions, reason=".concat(e)),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t=[],n=!0,r=!1,i=void 0;try{for(var a,o=this.persisted.values()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.reset(),s.rejectedWithError&&t.push(s)}}catch(d){r=!0,i=d}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.persisted.clear();for(var c=0;c<t.length;c++){var l=t[c];this.persisted.set(l.sid,l)}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();t.Subscriptions=h},function(e,t,n){var r=n(839),i=n(1705),a=n(841),o=n(1706);e.exports.Backoff=r,e.exports.FunctionCall=o,e.exports.FibonacciStrategy=a,e.exports.ExponentialStrategy=i,e.exports.fibonacci=function(e){return new r(new a(e))},e.exports.exponential=function(e){return new r(new i(e))},e.exports.call=function(e,t,n){var r=Array.prototype.slice.call(arguments);return e=r[0],t=r.slice(1,r.length-1),n=r[r.length-1],new o(e,t,n)}},function(e,t,n){var r=n(197),i=e.exports=n(1704);function a(e,t,n,i){n=n||"";var a=new e(r.format.apply(this,[n].concat(i)));throw Error.captureStackTrace(a,t),a}function o(e,t,n){a(i.IllegalArgumentError,e,t,n)}function s(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function c(e){return function(t,n){var r=s(t);if(r==e)return t;o(arguments.callee,n||'Expected "'+e+'" but got "'+r+'".',Array.prototype.slice.call(arguments,2))}}e.exports.checkArgument=function(e,t){e||o(arguments.callee,t,Array.prototype.slice.call(arguments,2))},e.exports.checkState=function(e,t){e||function(e,t,n){a(i.IllegalStateError,e,t,n)}(arguments.callee,t,Array.prototype.slice.call(arguments,2))},e.exports.checkIsDef=function(e,t){if(void 0!==e)return e;o(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},e.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;o(arguments.callee,t||'Expected value to be defined and not null but got "'+s(e)+'".',Array.prototype.slice.call(arguments,2))},e.exports.checkIsString=c("string"),e.exports.checkIsArray=c("array"),e.exports.checkIsNumber=c("number"),e.exports.checkIsBoolean=c("boolean"),e.exports.checkIsFunction=c("function"),e.exports.checkIsObject=c("object")},function(e,t,n){var r=n(197);function i(e){Error.call(this,e),this.message=e}function a(e){Error.call(this,e),this.message=e}r.inherits(i,Error),i.prototype.name="IllegalArgumentError",r.inherits(a,Error),a.prototype.name="IllegalStateError",e.exports.IllegalStateError=a,e.exports.IllegalArgumentError=i},function(e,t,n){var r=n(197),i=n(553),a=n(840);function o(e){a.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=o.DEFAULT_FACTOR,e&&void 0!==e.factor&&(i.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}r.inherits(o,a),o.DEFAULT_FACTOR=2,o.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},o.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},e.exports=o},function(e,t,n){var r=n(169),i=n(553),a=n(197),o=n(839),s=n(841);function c(e,t,n){r.EventEmitter.call(this),i.checkIsFunction(e,"Expected fn to be a function."),i.checkIsArray(t,"Expected args to be an array."),i.checkIsFunction(n,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=n,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=c.DEFAULT_RETRY_PREDICATE_,this.state_=c.State_.PENDING}a.inherits(c,r.EventEmitter),c.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},c.DEFAULT_RETRY_PREDICATE_=function(e){return!0},c.prototype.isPending=function(){return this.state_==c.State_.PENDING},c.prototype.isRunning=function(){return this.state_==c.State_.RUNNING},c.prototype.isCompleted=function(){return this.state_==c.State_.COMPLETED},c.prototype.isAborted=function(){return this.state_==c.State_.ABORTED},c.prototype.setStrategy=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},c.prototype.retryIf=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},c.prototype.getLastResult=function(){return this.lastResult_.concat()},c.prototype.getNumRetries=function(){return this.numRetries_},c.prototype.failAfter=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},c.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=c.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},c.prototype.start=function(e){i.checkState(!this.isAborted(),"FunctionCall is aborted."),i.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new s;this.backoff_=e?e(t):new o(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=c.State_.RUNNING,this.doCall_(!1)},c.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);r.EventEmitter.prototype.emit.apply(this,t);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))},c.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},c.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,r.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=c.State_.COMPLETED,this.doCallback_())}},c.prototype.handleBackoff_=function(e,t,n){this.emit("backoff",e,t,n)},e.exports=c},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165);Object.defineProperty(t,"__esModule",{value:!0});var s=n(287),c="com.twilio.rtd.cds.document",u="com.twilio.rtd.cds.list",l="com.twilio.rtd.cds.map",d="twilio.sync.event",f=function(){function e(t){var n=this;a(this,e),this.config=t.config,this.subscriptions=t.subscriptions,this.notifications=t.notifications,this.notifications.subscribe(d),this.notifications.subscribe(c),this.notifications.subscribe(u),this.notifications.subscribe(l),this.notifications.on("message",function(e,t){return n.onMessage(e,t)}),this.notifications.on("transportReady",function(e){return n.onConnectionStateChanged(e)})}return o(e,[{key:"onMessage",value:function(e,t){switch(s.default.trace("Notification type:",e,"content:",t),e){case c:case u:case l:this.subscriptions.acceptMessage(t,!1);break;case d:this.subscriptions.acceptMessage(t,!0)}}},{key:"subscribe",value:function(){var e=i(r.mark(function e(t,n){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subscriptions.add(t,n);case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(){var e=i(r.mark(function e(t,n){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subscriptions.remove(t);case 2:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(e){this.subscriptions.onConnectionStateChanged(e)}}]),e}();t.Router=f,t.default=f},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=n(313),o=n(287),s=n(286),c=n(1709),u=n(425),l=n(262);function d(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function f(e){return e.body?e.body.code:0}function h(e){return 409===e.status?new c.SyncNetworkError(d(e),e.status,f(e),e.body):e.status?new s.SyncError(d(e),e.status,f(e)):e instanceof l.TransportUnavailableError?e:new s.SyncError(e.message,0,0)}var p=function(){function e(t,n,i){r(this,e),this.clientInfo=t,this.config=n,this.transport=i}return i(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+a.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return Object.assign({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(function(r,i){var a=[502,503,504];n&&a.push(429);var o=new u.default(t.backoffConfig());o.on("attempt",function(){e().then(function(e){return o.succeeded(e)}).catch(function(e){if(a.includes(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);o.failed(h(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?o.failed(h(e)):e.message&&-1!==e.message.indexOf("Twilsock: request timeout")?o.failed(h(e)):(o.removeAllListeners(),o.cancel(),i(h(e)))})}),o.on("succeeded",function(e){r(e)}),o.on("cancelled",function(e){return i(h(e))}),o.on("failed",function(e){return i(h(e))}),o.start()})}},{key:"get",value:function(e){var t=this,n=this.createHeaders();return o.default.debug("GET",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.get(e,n)},!0)}},{key:"post",value:function(e,t,n,r){var i=this,a=this.createHeaders();return"undefined"!==typeof n&&null!==n&&(a["If-Match"]=n),o.default.debug("POST",e,"ID:",a["Twilio-Request-Id"]),this.executeWithRetry(function(){return i.transport.post(e,a,t,r)},!1)}},{key:"put",value:function(e,t,n){var r=this,i=this.createHeaders();return"undefined"!==typeof n&&null!==n&&(i["If-Match"]=n),o.default.debug("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry(function(){return r.transport.put(e,i,t)},!1)}},{key:"delete",value:function(e){var t=this,n=this.createHeaders();return o.default.debug("DELETE",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.delete(e,n)},!1)}}]),e}();t.Network=p},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173);Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0;return r(this,t),(n=i(this,a(t).call(this,e,o,s))).body=c,n}return o(t,e),t}(n(286).SyncError);t.SyncNetworkError=s,t.default=s},function(e,t,n){"use strict";var r=n(0),i=n(159),a=n(165);Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t,n){i(this,e),this.balanceFactor=0,this.key=t,this.value=n,this.parent=null,this.left=null,this.right=null}return a(e,[{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}}]),e}(),s=function(){function e(t,n){i(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=n||function(e,t){return e===t},this.root=null,this.count=null}return a(e,[{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var n=this.getNode(e);n?n.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var n=new o(e,t);if(this.count++,this.root){for(var r=this.root;;)if(this.isLessThan(e,r.key)){if(!r.left){r.left=n;break}r=r.left}else{if(!r.right){r.right=n;break}r=r.right}for(n.parent=r,r=n;r.parent;){var i=r.parent,a=i.balanceFactor;if(r.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(a))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}r=i}}else this.root=n}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var n=t.parent,r=t.left,i=t.right;if(!!r!==!!i){var a=r||i;n||a?n&&!a?this.root=a:(n.replace(t,null),this.rebalance(n)):this.root=null}else{for(var o=t.left;o.right;)o=o.right;if(t.left===o)t.isRoot?(this.root=o,o.parent=null):(t.isLeftChild?t.parent.left=o:t.parent.right=o,o.parent=t.parent),o.right=t.right,o.right.parent=o,o.balanceFactor=t.balanceFactor,t={parent:o,isLeftChild:!0};else{var s=o.parent,c=o.left;s.right=c,c&&(c.parent=s),t.isRoot?(this.root=o,o.parent=null):(t.isLeftChild?t.parent.left=o:t.parent.right=o,o.parent=t.parent),o.right=t.right,o.right.parent=o,o.left=t.left,o.left.parent=o,o.balanceFactor=t.balanceFactor,t={parent:s,isLeftChild:!1}}}for(this.count--;t.parent;){var u=t.parent,l=u.balanceFactor;if(t.isLeftChild?u.balanceFactor-=1:u.balanceFactor+=1,Math.abs(u.balanceFactor)>Math.abs(l)){if(!(u.balanceFactor<-1||u.balanceFactor>1))break;if(this.rebalance(u),0!==u.parent.balanceFactor)break;t=u.parent}else t=u}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:Symbol.iterator,value:r.mark(function e(){var t,n,i,a,o,s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,n=!1,i=void 0,e.prev=3,a=this.getIterator()[Symbol.iterator]();case 5:if(t=(o=a.next()).done){e.next=12;break}return s=o.value,e.next=9,s;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),n=!0,i=e.t0;case 18:e.prev=18,e.prev=19,t||null==a.return||a.return();case 21:if(e.prev=21,!n){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])})},{key:"getIterator",value:r.mark(function e(){var t,n,i,a=arguments;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.length>0&&void 0!==a[0]?a[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.left)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)||null===t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:i=!0;case 11:if(!i){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(i=!1,!n.right){e.next=21;break}for(n=n.right;n.left;)n=n.left;i=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}i=n.parent.left===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}i=n.parent.left===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}},e,this)})},{key:"getReverseIterator",value:r.mark(function e(){var t,n,i,a=arguments;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.length>0&&void 0!==a[0]?a[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.right)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)&&null!==t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:i=!0;case 11:if(!i){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(i=!1,!n.left){e.next=21;break}for(n=n.left;n.right;)n=n.right;i=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}i=n.parent.right===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}i=n.parent.right===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}},e,this)})},{key:"size",get:function(){return this.count}}]),e}();t.TreeMap=s},function(e,t,n){"use strict";var r=n(159);Object.defineProperty(t,"__esModule",{value:!0});var i=n(551),a=function e(t){r(this,e),this.sdk="js",this.sdkVer=t,this.os=i.os.family,this.osVer=i.os.version,this.pl=i.name,this.plVer=i.version};t.ClientInfo=a,t.default=a},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){r(this,e),this.names=new Map,this.entities=new Map}return i(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();t.EntitiesCache=a},function(e,t,n){"use strict";var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t,n){r(this,e),this.config=t,this.storageId=null;try{this.storage=n||sessionStorage}catch(i){}}return i(e,[{key:"storageKey",value:function(e,t){return"".concat(this.storageId,"::").concat(e,"::").concat(t)}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(r){}}},{key:"update",value:function(e,t,n,r){if(!this.isReady)return null;this._apply(this.storageKey(e,t),r),n&&this._apply(this.storageKey(e,n),r)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,JSON.stringify(t))}catch(n){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(n){}return null}},{key:"_apply",value:function(e,t){var n=this._read(e);if(!n)return!1;this._store(e,Object.assign(n,t))}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}}]),e}();t.SessionStorage=a},function(e,t,n){"use strict";var r=n(0),i=n(185),a=n(159),o=n(165),s=n(172),c=n(170),u=n(173);Object.defineProperty(t,"__esModule",{value:!0});var l=n(426),d=n(314),f=function(e){function t(e,n,r){var i;return a(this,t),(i=s(this,c(t).call(this,e,r))).descriptor=n,i}return u(t,e),o(t,[{key:"publishMessage",value:function(){var e=i(r.mark(function e(t){var n,i,a,o;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={data:t},e.next=3,this.services.network.post(this.links.messages,n);case 3:return i=e.sent,a=i.body,o=this._handleMessagePublished(a.sid,t,!1),e.abrupt("return",o);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setTtl",value:function(){var e=i(r.mark(function e(t){var n,i;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.validateMandatoryTtl(t),e.prev=1,n={ttl:t},e.next=5,this.services.network.post(this.uri,n);case 5:i=e.sent,this.descriptor.date_expires=i.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"removeStream",value:function(){var e=i(r.mark(function e(){return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_update",value:function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{key:"_handleMessagePublished",value:function(e,t,n){var r={sid:e,value:t};return this.emit("messagePublished",{message:r,isLocal:!n}),r}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}}],[{key:"type",get:function(){return"stream"}}]),t}(l.SyncEntity);t.SyncStream=f,t.default=f},function(e){e.exports={_args:[["twilio-sync@0.8.5","/Users/yraj/lts-code/remotepatientmonitoring/client"]],_from:"twilio-sync@0.8.5",_id:"twilio-sync@0.8.5",_inBundle:!1,_integrity:"sha512-QlxlpedBxDWYZ3lAaZMV6FbD9IvTRC3jjga4QOnDUzToHZ9kHGZL8O8J3Ighc1/vEq60M7CBZsZc0u0UGnrIGQ==",_location:"/twilio-sync",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"twilio-sync@0.8.5",name:"twilio-sync",escapedName:"twilio-sync",rawSpec:"0.8.5",saveSpec:null,fetchSpec:"0.8.5"},_requiredBy:["/twilio-chat"],_resolved:"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.8.5.tgz",_spec:"0.8.5",_where:"/Users/yraj/lts-code/remotepatientmonitoring/client",author:{name:"Twilio"},browserify:{transform:["babelify"]},dependencies:{backoff:"^2.5.0",karibu:"^2.0.0",loglevel:"^1.6.1","operation-retrier":"^2.0.0",platform:"^1.3.5",rfc6902:"^2.2.2","twilio-notifications":"^0.5.2",twilsock:"^0.5.6",update:"^0.7.4",uuid:"^3.2.1"},description:"Twilio Sync client library",devDependencies:{"@types/chai":"^4.1.2","@types/chai-as-promised":"7.1.0","@types/mocha":"^2.2.48","@types/node":"^8.9.1","@types/sinon":"^4.1.3","@types/sinon-chai":"^2.7.29","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-eslint":"^8.2.3","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0",babelify:"^8.0.0",browserify:"^16.0.0",chai:"^4.1.2","chai-as-promised":"^7.1.1",cheerio:"^1.0.0-rc.2",del:"^3.0.0",gulp:"^4.0.0","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-exit":"0.0.2","gulp-insert":"^0.5.0","gulp-istanbul":"^1.1.3","gulp-mocha":"^5.0.0","gulp-rename":"^1.2.2","gulp-replace":"^0.6.1","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.2","gulp-typescript":"^4.0.1","gulp-uglify-es":"^1.0.0","ink-docstrap":"^1.3.2",isparta:"^4.0.0",jsdoc:"^3.5.5",jsonwebtoken:"^8.1.1",karma:"^2.0.0","karma-browserify":"^5.2.0","karma-browserstack-launcher":"^1.3.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5",mocha:"^5.0.0","run-sequence":"^2.2.1",sinon:"^4.2.2","sinon-chai":"^2.14.0","ts-node":"^4.1.0",tslint:"^5.9.1",twilio:"^3.15.0",typescript:"^2.8.1","uglify-es":"^3.3.10","uglify-save-license":"^0.4.1",underscore:"^1.8.3","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0",watchify:"^3.10.0"},engines:{node:">=8"},license:"MIT",main:"lib/index.js",name:"twilio-sync",scripts:{prepare:"gulp build",test:"gulp unit-test"},types:"./lib/index.d.ts",version:"0.8.5"}},function(e,t,n){"use strict";var r=n(1717);e.exports=r},function(e,t,n){"use strict";var r=n(0),i=n(159),a=n(165),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var s=n(849),c=n(850),u=n(1718);t.Media=u.Media,t.McsMedia=u.Media;var l=n(1719),d=n(1722),f=s.Logger.scope(""),h=n(1723).version,p="A valid Twilio token should be provided",v=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i(this,e),this.options=r,this.options.logLevel=this.options.logLevel||"silent",this.config=new c.Configuration(t,n,this.options),!t)throw new Error(p);f.setLevel(this.options.logLevel),this.options.transport=this.options.transport||new l.Transport,this.transport=this.options.transport,this.network=new d.Network(this.config,this.transport)}return a(e,[{key:"updateToken",value:function(e){if(f.info("updateToken"),!e)throw new Error(p);this.config.updateToken(e)}},{key:"get",value:function(e){return o(this,void 0,void 0,r.mark(function t(){var n;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.network.get("".concat(this.config.baseUrl,"/").concat(e));case 2:return n=t.sent,t.abrupt("return",new u.Media(this.config,this.network,n.body));case 4:case"end":return t.stop()}},t,this)}))}},{key:"post",value:function(e,t){return o(this,void 0,void 0,r.mark(function n(){var i;return r.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.network.post(this.config.baseUrl,t,e);case 2:return i=n.sent,n.abrupt("return",new u.Media(this.config,this.network,i.body));case 4:case"end":return n.stop()}},n,this)}))}},{key:"postFormData",value:function(e){return o(this,void 0,void 0,r.mark(function t(){var n;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.network.post(this.config.baseUrl,e);case 2:return n=t.sent,t.abrupt("return",new u.Media(this.config,this.network,n.body));case 4:case"end":return t.stop()}},t,this)}))}}]),e}();v.version=h,t.Client=v,t.McsClient=v,t.default=v},function(e,t,n){"use strict";var r=n(0),i=n(159),a=n(165),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(t,n,r){i(this,e),this.config=t,this.network=n,this._update(r)}return a(e,[{key:"getContentUrl",value:function(){return o(this,void 0,void 0,r.mark(function e(){var t;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.network.get("".concat(this.config.baseUrl,"/").concat(this.sid));case 2:return t=e.sent,this._update(t.body),e.abrupt("return",Promise.resolve(this.state.contentDirectUrl));case 5:case"end":return e.stop()}},e,this)}))}},{key:"_update",value:function(e){this.state={sid:e.sid,serviceSid:e.service_sid,channelSid:e.channel_sid,messageSid:e.message_sid,dateCreated:e.date_created?new Date(e.date_created):null,dateUpdated:e.date_updated?new Date(e.date_updated):null,size:e.size,contentType:e.content_type,url:e.url,contentUrl:e.links.content,contentDirectUrl:e.links.content_direct_temporary,filename:e.filename?e.filename:null}}},{key:"sid",get:function(){return this.state.sid}},{key:"serviceSid",get:function(){return this.state.serviceSid}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"fileName",get:function(){return this.state.filename}}]),e}();t.Media=s},function(e,t,n){"use strict";(function(e){var r=n(159),i=n(165);Object.defineProperty(t,"__esModule",{value:!0});var a=n(1720),o=e.XMLHttpRequest||n(1721).XMLHttpRequest;var s=function(){function e(){r(this,e)}return i(e,[{key:"get",value:function(t,n){return e.request("GET",t,n)}},{key:"post",value:function(t,n,r){return e.request("POST",t,n,r)}},{key:"put",value:function(t,n,r){return e.request("PUT",t,n,r)}},{key:"delete",value:function(t,n){return e.request("PUT",t,n)}}],[{key:"request",value:function(e,t,n,r){return new Promise(function(i,s){var c=new o;for(var u in c.open(e,t,!0),c.onreadystatechange=function(){if(4===c.readyState){var e,t=(e=c.getAllResponseHeaders())?e.split("\r\n").map(function(e){return e.split(": ")}).filter(function(e){return 2===e.length&&e[1].length>0}).reduce(function(e,t){return e[t[0]]=t[1],e},{}):{},n=function(e){var t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(n){return e.responseText}}(c);if(200<=c.status&&c.status<300)i({status:c.status,headers:t,body:n});else{var r,o=c.statusText&&c.statusText.code?c.statusText.code:"NONE";r="string"===typeof n?n&&1===n.split("\n",2).length?n:"":JSON.stringify(n);var u="".concat(c.status,": [").concat(o,"] ").concat(r);s(new a.TransportError(u,c.status,n,o,t))}}},n)c.setRequestHeader(u,n[u]),"Content-Type"===u&&"application/json"===n[u]&&(r=JSON.stringify(r));c.send(r)})}}]),e}();t.Transport=s}).call(this,n(48))},function(e,t,n){"use strict";var r=n(159),i=n(172),a=n(170),o=n(173),s=n(404);Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(e,n,o,s,c){var u;return r(this,t),(u=i(this,a(t).call(this,e))).code=n,u.body=o,u.status=s,u.headers=c,u}return o(t,e),t}(s(Error));t.TransportError=c},,function(e,t,n){"use strict";var r=n(0),i=n(159),a=n(165),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var s=n(425),c=n(849),u=n(850),l=n(831),d=c.Logger.scope("Network"),f=function(){function e(t,n){i(this,e),this.config=t,this.transport=n}return a(e,[{key:"backoffConfig",value:function(){return Object.assign(u.Configuration.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){return"undefined"!==typeof this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:"undefined"!==typeof u.Configuration.retryWhenThrottledDefault&&u.Configuration.retryWhenThrottledDefault}},{key:"executeWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(r,i){var a=[502,503,504];n&&a.push(429);var o=new s.default(t.backoffConfig());o.on("attempt",function(){e().then(function(e){return o.succeeded(e)}).catch(function(e){a.indexOf(e.status)>-1?o.failed(e):"Twilsock disconnected"===e.message?o.failed(e):(o.removeAllListeners(),o.cancel(),i(e))})}),o.on("succeeded",function(e){r(e)}),o.on("cancelled",function(e){return i(e)}),o.on("failed",function(e){return i(e)}),o.start()})}},{key:"get",value:function(e){return o(this,void 0,void 0,r.mark(function t(){var n,i,a=this;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={"X-Twilio-Token":this.config.token},d.trace("sending GET request to ",e," headers ",n),t.next=4,this.executeWithRetry(function(){return a.transport.get(e,n)},this.retryWhenThrottled());case 4:return i=t.sent,d.trace("response",i),t.abrupt("return",i);case 7:case"end":return t.stop()}},t,this)}))}},{key:"post",value:function(e,t,n){return o(this,void 0,void 0,r.mark(function i(){var a,o;return r.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a={"X-Twilio-Token":this.config.token},t instanceof l||!n||Object.assign(a,{"Content-Type":n}),d.trace("sending POST request to ",e," headers ",a),r.prev=3,r.next=6,this.transport.post(e,a,t);case 6:o=r.sent,r.next=17;break;case 9:if(r.prev=9,r.t0=r.catch(3),!(r.t0 instanceof TypeError)){r.next=16;break}throw d.trace("got error in post response",r.t0),new TypeError("Posting FormData supported only with browser engine's FormData");case 16:throw r.t0;case 17:return d.trace("response",o),r.abrupt("return",o);case 19:case"end":return r.stop()}},i,this,[[3,9]])}))}}]),e}();t.Network=f},function(e){e.exports={_args:[["twilio-mcs-client@0.2.2","/Users/yraj/lts-code/remotepatientmonitoring/client"]],_from:"twilio-mcs-client@0.2.2",_id:"twilio-mcs-client@0.2.2",_inBundle:!1,_integrity:"sha512-/NywKHcgLkM5WW//gXFkJXmdV8d/N3vpCiONlMQiumzaZ3OoEcBrpFr1PiHlkoUXI2C2comypFWunfI6DieeNw==",_location:"/twilio-mcs-client",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"twilio-mcs-client@0.2.2",name:"twilio-mcs-client",escapedName:"twilio-mcs-client",rawSpec:"0.2.2",saveSpec:null,fetchSpec:"0.2.2"},_requiredBy:["/twilio-chat"],_resolved:"https://registry.npmjs.org/twilio-mcs-client/-/twilio-mcs-client-0.2.2.tgz",_spec:"0.2.2",_where:"/Users/yraj/lts-code/remotepatientmonitoring/client",author:{name:"Twilio"},browserify:{transform:["babelify"]},dependencies:{"isomorphic-form-data":"^1.0.0",loglevel:"^1.6.1","operation-retrier":"^2.0.0","twilio-transport":"^0.3.3"},description:"Twilio Media Content Service client library",devDependencies:{"@types/chai":"^4.1.2","@types/chai-as-promised":"7.1.0","@types/chai-datetime":"0.0.31","@types/chai-string":"^1.4.0","@types/core-js":"^0.9.46","@types/form-data":"2.2.1","@types/mocha":"^5.0.0","@types/node":"^9.4.2","@types/sinon":"^4.1.3","@types/sinon-chai":"^2.7.29",async:"^2.6.0","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-eslint":"^8.2.1","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-require":"^1.0.1","babel-runtime":"^6.26.0",babelify:"^8.0.0",browserify:"^16.0.0",chai:"^4.1.2","chai-as-promised":"^7.1.1","chai-datetime":"^1.5.0","chai-string":"^1.4.0",cheerio:"^1.0.0-rc.2",del:"^3.0.0",dotenv:"^5.0.0",express:"^4.16.3",gulp:"^4.0.0","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-insert":"^0.5.0","gulp-mocha":"^5.0.0","gulp-rename":"^1.2.2","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.2","gulp-typescript":"^4.0.1","gulp-uglify-es":"^1.0.0","ink-docstrap":"^1.3.2",jsdoc:"^3.5.5","jsdoc-strip-async-await":"^0.1.0",mocha:"^5.0.2",ngrok:"^3.0.1",nyc:"^11.4.1",sinon:"^4.2.2","sinon-chai":"^2.14.0","ts-node":"^4.1.0",tslint:"^5.9.1",twilio:"^3.11.2",typescript:"^2.7.1","uglify-save-license":"^0.4.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},engines:{node:">=6"},license:"MIT",main:"lib/index.js",name:"twilio-mcs-client",scripts:{},types:"./lib/client.d.ts",version:"0.2.2"}},function(e,t,n){"use strict";var r=c(n(193)),i=c(n(261)),a=c(n(161)),o=c(n(152)),s=c(n(189));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e,t,n,r){return new(n||(n=s.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var l=n(313),d=n(551),f=n(1725),h=n(229),p=n(851),v=n(852),m=n(1730),g=n(853).version,y=h.Logger.scope("Session"),b=function e(){(0,o.default)(this,e)};var _=function(){function e(t,n){(0,o.default)(this,e);var r="undefined"!==typeof navigator?d.parse(navigator.userAgent):d;this.services=t,this.config=n,this.sessionInfo=new v.Deferred,this.currentContext={},this.pendingCommands=new i.default,this.sessionStreamPromise=null,this.endpointPlatform=["js",g,r.os,r.name,r.version].join("|")}return(0,a.default)(e,[{key:"handleContextUpdate",value:function(e){var t;(y.info("Session context updated"),y.debug("new session context:",e),this.currentContext=e,t=e,["identity","userInfo","links","myChannels","channels"].some(function(e){return!t.hasOwnProperty(e)}))||(y.info("new session context accepted"),this.sessionInfo.set(e))}},{key:"initialize",value:function(){var e=this,t={type:"IpMsgSession",apiVersion:"3",endpointPlatform:this.endpointPlatform};return this.sessionStreamPromise=this.services.syncClient.list({purpose:"com.twilio.rtd.ipmsg",context:t}).then(function(t){return y.info("Session created",t.sid),t.on("itemAdded",function(t){return e.processCommandResponse(t.item)}),t.on("itemUpdated",function(t){return e.processCommandResponse(t.item)}),t.on("contextUpdated",function(t){return e.handleContextUpdate(t.context)}),t}).catch(function(e){throw y.error("Failed to create session",e),e}),this.sessionStreamPromise}},{key:"addCommand",value:function(e,t){return this.processCommand(e,t)}},{key:"processCommand",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=new b;return i.request=t,i.request.action=e,i.commandId=l.v4(),y.info("Adding command: ",e,i.commandId),y.debug("command arguments:",t,r),new s.default(function(a,o){n.sessionStreamPromise.then(function(e){return n.pendingCommands.set(i.commandId,{resolve:a,reject:o,commandId:i.commandId,request:i.request}),e.push(i)}).then(function(){return y.debug("Command accepted by server",i.commandId)}).catch(function(s){n.pendingCommands.delete(i.commandId),y.error("Failed to add a command to the session",s),s.code!=f.ResponseCodes.ACCESS_FORBIDDEN_FOR_IDENTITY&&s.code!==f.ResponseCodes.LIST_NOT_FOUND||!r?o(new Error("Can't add command: "+s.message)):(y.info("recreating session..."),n.initialize(),a(n.processCommand(e,t,!1)))})})}},{key:"processCommandResponse",value:function(e){if(e.value.hasOwnProperty("response")&&e.value.hasOwnProperty("commandId")&&this.pendingCommands.has(e.value.commandId)){var t=e.value,n=e.value.commandId;if(t.response.status===f.ResponseCodes.HTTP_200_OK){y.debug("Command succeeded: ",t);var r=this.pendingCommands.get(n).resolve;this.pendingCommands.delete(n),r(t.response)}else{y.error("Command failed: ",t);var i=this.pendingCommands.get(n).reject;this.pendingCommands.delete(n),i(new p.SessionError(t.response.statusText,t.response.status))}}}},{key:"getSessionContext",value:function(){return this.sessionStreamPromise.then(function(e){return e.getContext()})}},{key:"getSessionLinks",value:function(){return u(this,void 0,void 0,r.default.mark(function e(){var t;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",{publicChannelsUrl:this.config.baseUrl+t.links.publicChannelsUrl,myChannelsUrl:this.config.baseUrl+t.links.myChannelsUrl,typingUrl:this.config.baseUrl+t.links.typingUrl,syncListUrl:this.config.baseUrl+t.links.syncListUrl,usersUrl:this.config.baseUrl+t.links.usersUrl,mediaServiceUrl:t.links.mediaServiceUrl});case 4:case"end":return e.stop()}},e,this)}))}},{key:"getChannelsId",value:function(){return u(this,void 0,void 0,r.default.mark(function e(){var t;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",t.channels);case 4:case"end":return e.stop()}},e,this)}))}},{key:"getMyChannelsId",value:function(){return u(this,void 0,void 0,r.default.mark(function e(){var t;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",t.myChannels);case 4:case"end":return e.stop()}},e,this)}))}},{key:"getMaxUserInfosToSubscribe",value:function(){return u(this,void 0,void 0,r.default.mark(function e(){var t;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",this.config.userInfosToSubscribeOverride||t.userInfosToSubscribe||this.config.userInfosToSubscribeDefault);case 4:case"end":return e.stop()}},e,this)}))}},{key:"getUsersData",value:function(){return this.sessionInfo.promise.then(function(e){return{user:e.userInfo,identity:e.identity}})}},{key:"getConsumptionReportInterval",value:function(){return u(this,void 0,void 0,r.default.mark(function e(){var t,n;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,n=this.config.consumptionReportIntervalOverride||t.consumptionReportInterval||this.config.consumptionReportIntervalDefault,e.prev=4,e.abrupt("return",m.toSeconds(m.parse(n)));case 8:return e.prev=8,e.t0=e.catch(4),y.error("Failed to parse consumption report interval",n,"using default value",this.config.consumptionReportIntervalDefault),e.abrupt("return",m.toSeconds(m.parse(this.config.consumptionReportIntervalDefault)));case 12:case"end":return e.stop()}},e,this,[[4,8]])}))}},{key:"getHttpCacheInterval",value:function(){return u(this,void 0,void 0,r.default.mark(function e(){var t,n;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,n=this.config.httpCacheIntervalOverride||t.httpCacheInterval||this.config.httpCacheIntervalDefault,e.prev=4,e.abrupt("return",m.toSeconds(m.parse(n)));case 8:return e.prev=8,e.t0=e.catch(4),y.error("Failed to parse cache interval",n,"using default value",this.config.httpCacheIntervalDefault),e.abrupt("return",m.toSeconds(m.parse(this.config.httpCacheIntervalDefault)));case 12:case"end":return e.stop()}},e,this,[[4,8]])}))}},{key:"identity",get:function(){return this.sessionInfo.current.identity}},{key:"reachabilityEnabled",get:function(){return this.currentContext.reachabilityEnabled}}]),e}();t.Session=_},function(e,t,n){"use strict";var r,i=n(152),a=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0});var o=function e(){(0,a.default)(this,e)};o.HTTP_200_OK=200,o.HTTP_400_BAD_REQUEST=400,o.HTTP_404_NOT_FOUND=404,o.ACCESS_FORBIDDEN_FOR_IDENTITY=54007,o.LIST_NOT_FOUND=54150,t.ResponseCodes=o},function(e,t,n){e.exports={default:n(1727),__esModule:!0}},function(e,t,n){n(1728),e.exports=n(184).Reflect.construct},function(e,t,n){var r=n(194),i=n(324),a=n(263),o=n(220),s=n(199),c=n(252),u=n(1729),l=(n(198).Reflect||{}).construct,d=c(function(){function e(){}return!(l(function(){},[],e)instanceof e)}),f=!c(function(){l(function(){})});r(r.S+r.F*(d||f),"Reflect",{construct:function(e,t){a(e),o(t);var n=arguments.length<3?e:a(arguments[2]);if(f&&!d)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(u.apply(e,r))}var c=n.prototype,h=i(s(c)?c:Object.prototype),p=Function.apply.call(e,h,t);return s(p)?p:h}})},function(e,t,n){"use strict";var r=n(263),i=n(199),a=n(777),o=[].slice,s={};e.exports=Function.bind||function(e){var t=r(this),n=o.call(arguments,1),c=function r(){var i=n.concat(o.call(arguments));return this instanceof r?function(e,t,n){if(!(t in s)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";s[t]=Function("F,a","return new F("+r.join(",")+")")}return s[t](e,n)}(t,i.length,i):a(t,i,e)};return i(t.prototype)&&(c.prototype=t.prototype),c}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["weeks","years","months","days","hours","minutes","seconds"],i=t.pattern=new RegExp("P(?:(\\d+(?:[\\.,]\\d{0,3})?W)|(\\d+(?:[\\.,]\\d{0,3})?Y)?(\\d+(?:[\\.,]\\d{0,3})?M)?(\\d+(?:[\\.,]\\d{0,3})?D)?(?:T(\\d+(?:[\\.,]\\d{0,3})?H)?(\\d+(?:[\\.,]\\d{0,3})?M)?(\\d+(?:[\\.,]\\d{0,3})?S)?)?)"),a=t.parse=function(e){return e.match(i).slice(1).reduce(function(e,t,n){return e[r[n]]=parseFloat(t)||0,e},{})},o=t.end=function(e,t){var n=t?t.getTime():Date.now(),r=new Date(n);return r.setFullYear(r.getFullYear()+e.years),r.setMonth(r.getMonth()+e.months),r.setDate(r.getDate()+e.days),r.setHours(r.getHours()+e.hours),r.setMinutes(r.getMinutes()+e.minutes),r.setMilliseconds(r.getMilliseconds()+1e3*e.seconds),r.setDate(r.getDate()+7*e.weeks),r},s=t.toSeconds=function(e,t){var n=t?t.getTime():Date.now(),r=new Date(n);return(o(e,t).getTime()-r.getTime())/1e3};t.default={end:o,toSeconds:s,pattern:i,parse:a}},function(e,t,n){"use strict";var r=h(n(193)),i=h(n(311)),a=h(n(767)),o=h(n(261)),s=h(n(236)),c=h(n(152)),u=h(n(161)),l=h(n(156)),d=h(n(157)),f=h(n(189));function h(e){return e&&e.__esModule?e:{default:e}}var p=function(e,t,n,r){return new(n||(n=f.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var v=n(169),m=n(229),g=n(828);t.Channel=g.Channel;var y=n(852),b=n(247),_=m.Logger.scope("Channels"),k=function(e){function t(e){(0,c.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return n.services=e,n.channels=new o.default,n.thumbstones=new a.default,n.syncListFetched=!1,n.syncListRead=new y.Deferred,n}return(0,d.default)(t,e),(0,u.default)(t,[{key:"getMap",value:function(){var e=this;return this.services.session.getMyChannelsId().then(function(t){return e.services.syncClient.map({id:t,mode:"open_existing"})})}},{key:"addChannel",value:function(e){return p(this,void 0,void 0,r.default.mark(function t(){var n,a,o,s,c;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.session.addCommand("createChannel",{friendlyName:e.friendlyName,uniqueName:e.uniqueName,type:e.isPrivate?"private":"public",attributes:(0,i.default)(e.attributes)});case 2:if(n=t.sent,a="channelSid"in n?n.channelSid:null,o="channel"in n?n.channel:null,!(s=this.channels.get(a))){t.next=10;break}return t.next=9,s._subscribe();case 9:return t.abrupt("return",s);case 10:return c=new g.Channel(this.services,{channel:o,name:null,entityName:null,uniqueName:null,attributes:null,createdBy:null,friendlyName:null,lastConsumedMessageIndex:null,type:e.isPrivate?"private":"public",dateCreated:null,dateUpdated:null},a),this.channels.set(c.sid,c),this.registerForEvents(c),t.next=15,c._subscribe();case 15:return this.emit("channelAdded",c),t.abrupt("return",c);case 17:case"end":return t.stop()}},t,this)}))}},{key:"fetchChannels",value:function(){var e=this;this.getMap().then(function(t){return p(e,void 0,void 0,r.default.mark(function e(){var n,i,a=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.on("itemAdded",function(e){a.upsertChannel("sync",e.item.key,e.item.value)}),t.on("itemRemoved",function(e){var t=e.key;a.syncListFetched||a.thumbstones.add(t);var n=a.channels.get(t);n&&("joined"!==n.status&&"invited"!==n.status||(n._setStatus("known","sync"),a.emit("channelLeft",n)),n.isPrivate&&(a.channels.delete(t),a.emit("channelRemoved",n)))}),t.on("itemUpdated",function(e){a.upsertChannel("sync",e.item.key,e.item.value)}),n=[],e.next=6,this.services.syncList.getPage();case 6:i=e.sent,i.items.forEach(function(e){n.push(a.upsertChannel("synclist",e.channel_sid,e))});case 9:if(!i.hasNextPage){e.next=16;break}return e.next=12,i.nextPage();case 12:(i=e.sent).items.forEach(function(e){n.push(a.upsertChannel("synclist",e.channel_sid,e))}),e.next=9;break;case 16:return this.syncListRead.set(!0),e.abrupt("return",f.default.all(n));case 18:case"end":return e.stop()}},e,this)}))}).then(function(){e.syncListFetched=!0,e.thumbstones.clear(),_.debug("Channels list fetched")}).then(function(){return e}).catch(function(t){throw"disconnected"!=e.services.syncClient.connectionState&&_.error("Failed to get channels list",t),_.debug("ERROR: Failed to get channels list",t),t})}},{key:"_wrapPaginator",value:function(e,t){var n=this;return t(e.items).then(function(r){return{items:r,hasNextPage:e.hasNextPage,hasPrevPage:e.hasPrevPage,nextPage:function(){return e.nextPage().then(function(e){return n._wrapPaginator(e,t)})},prevPage:function(){return e.prevPage().then(function(e){return n._wrapPaginator(e,t)})}}})}},{key:"getChannels",value:function(e){var t=this;return this.getMap().then(function(t){return t.getItems(e)}).then(function(e){return t._wrapPaginator(e,function(e){return f.default.all(e.map(function(e){return t.upsertChannel("sync",e.key,e.value)}))})})}},{key:"getChannel",value:function(e){var t=this;return this.getMap().then(function(t){return t.getItems({key:e})}).then(function(e){return e.items.map(function(e){return t.upsertChannel("sync",e.key,e.value)})}).then(function(e){return e.length>0?e[0]:null})}},{key:"pushChannel",value:function(e){var t=e.sid,n={name:null,entityName:null,lastConsumedMessageIndex:e.lastConsumedMessageIndex,type:e.type,status:e.status,friendlyName:e.friendlyName,dateUpdated:e.dateUpdated,dateCreated:e.dateCreated,uniqueName:e.uniqueName,createdBy:e.createdBy,attributes:e.attributes,channel:e.channel,notificationLevel:e.notificationLevel,sid:t};return this.upsertChannel("chat",t,n)}},{key:"upsertChannel",value:function(e,t,n){var r=this;_.trace("upsertChannel(sid="+t+", data=",n);var i=this.channels.get(t);if(i){if(_.trace("upsertChannel: channel "+t+" is known and it's status is known from source "+i._statusSource()+" and update came from source "+e,i),"undefined"===typeof i._statusSource()||e===i._statusSource()||"synclist"===e&&"sync"!==i._statusSource()||"sync"===e)if("joined"===n.status&&"joined"!==i.status){i._setStatus("joined",e);var a={};"undefined"!==typeof n.notificationLevel&&(a.notificationLevel=n.notificationLevel),"undefined"!==typeof n.lastConsumedMessageIndex&&(a.lastConsumedMessageIndex=n.lastConsumedMessageIndex),b.isDeepEqual(a,{})||i._update(a),i._subscribe().then(function(){r.emit("channelJoined",i)})}else if("invited"===n.status&&"invited"!==i.status){i._setStatus("invited",e);var o={};"undefined"!==typeof n.notificationLevel&&(o.notificationLevel=n.notificationLevel),"undefined"!==typeof n.lastConsumedMessageIndex&&(o.lastConsumedMessageIndex=n.lastConsumedMessageIndex),b.isDeepEqual(o,{})||i._update(o),i._subscribe().then(function(){r.emit("channelInvited",i)})}else"known"!==n.status||"invited"!==i.status&&"joined"!==i.status?"notParticipating"!==n.status&&"known"!==n.status||"private"!==n.type?i._update(n):i._subscribe():(i._setStatus("known",e),i._update(n),i._subscribe().then(function(){r.emit("channelLeft",i)}));else _.trace("upsertChannel: channel is known from sync and came from chat, ignoring",{sid:t,data:n.status,channel:i.status});return i._subscribe().then(function(){return i})}if("chat"!==e&&"synclist"!==e||!this.thumbstones.has(t))return _.trace("upsertChannel: creating local channel object with sid "+t,n),i=new g.Channel(this.services,n,t),this.channels.set(t,i),i._subscribe().then(function(){return r.registerForEvents(i),r.emit("channelAdded",i),"joined"===n.status?(i._setStatus("joined",e),r.emit("channelJoined",i)):"invited"===n.status&&(i._setStatus("invited",e),r.emit("channelInvited",i)),i});_.trace("upsertChannel: channel is deleted and came again from chat, ignoring",t)}},{key:"onChannelRemoved",value:function(e){var t=this.channels.get(e);t&&(this.channels.delete(e),this.emit("channelRemoved",t))}},{key:"registerForEvents",value:function(e){var t=this;e.on("removed",function(){return t.onChannelRemoved(e.sid)}),e.on("updated",function(e){return t.emit("channelUpdated",e)}),e.on("memberJoined",this.emit.bind(this,"memberJoined")),e.on("memberLeft",this.emit.bind(this,"memberLeft")),e.on("memberUpdated",function(e){return t.emit("memberUpdated",e)}),e.on("messageAdded",this.emit.bind(this,"messageAdded")),e.on("messageUpdated",function(e){return t.emit("messageUpdated",e)}),e.on("messageRemoved",this.emit.bind(this,"messageRemoved")),e.on("typingStarted",this.emit.bind(this,"typingStarted")),e.on("typingEnded",this.emit.bind(this,"typingEnded"))}}]),t}(v.EventEmitter);t.Channels=k},function(e,t,n){"use strict";var r=d(n(193)),i=d(n(261)),a=d(n(236)),o=d(n(152)),s=d(n(161)),c=d(n(156)),u=d(n(157)),l=d(n(189));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t,n,r){return new(n||(n=l.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var h=n(169),p=n(823),v=n(1733),m=function(e){function t(e){(0,o.default)(this,t);var n=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n.services=e,n.fifoStack=[],n.fifoStackMaxLength=100,n.myself=new p.User(null,null,n.services),n.myself.on("updated",function(e){return n.emit("userUpdated",e)}),n.myself.on("userSubscribed",function(){return n.emit("userSubscribed",n.myself)}),n.myself.on("userUnsubscribed",function(){n.emit("userUnsubscribed",n.myself),n.myself._ensureFetched()}),n.services=e,n.subscribedUsers=new i.default,n.userDescriptorsPromise=n.services.session.getSessionLinks().then(function(e){return n.userDescriptors=new v.UserDescriptors({users:n,network:n.services.network},e.usersUrl),n.userDescriptors}),n.services.session.getMaxUserInfosToSubscribe().then(function(e){n.fifoStackMaxLength=e}),n.services.session.getUsersData().then(function(e){return n.myself.identity=e.identity,n.myself.entityName=e.user,n.myself._ensureFetched()}),n}return(0,u.default)(t,e),(0,s.default)(t,[{key:"handleUnsubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)&&this.subscribedUsers.delete(e.identity);var t=-1;this.fifoStack.find(function(n,r){return n==e.identity&&(t=r,!0)})&&this.fifoStack.splice(t,1),this.emit("userUnsubscribed",e)}},{key:"handleSubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)||(this.fifoStack.length>=this.fifoStackMaxLength&&this.subscribedUsers.get(this.fifoStack.shift()).unsubscribe(),this.fifoStack.push(e.identity),this.subscribedUsers.set(e.identity,e),this.emit("userSubscribed",e))}},{key:"getUser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return f(this,void 0,void 0,r.default.mark(function n(){var i,a,o=this;return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.services.session.getUsersData();case 2:return n.next=4,this.myself._ensureFetched();case 4:if(e!=this.myself.identity){n.next=6;break}return n.abrupt("return",this.myself);case 6:if(i=this.subscribedUsers.get(e)){n.next=19;break}if(t){n.next=13;break}return n.next=11,this.getUserDescriptor(e);case 11:a=n.sent,t=a._getDescriptor().sync_unique_name;case 13:return(i=new p.User(e,t,this.services)).on("updated",function(e){return o.emit("userUpdated",e)}),i.on("userSubscribed",function(){return o.handleSubscribeUser(i)}),i.on("userUnsubscribed",function(){return o.handleUnsubscribeUser(i)}),n.next=19,i._ensureFetched();case 19:return n.abrupt("return",i);case 20:case"end":return n.stop()}},n,this)}))}},{key:"getUserDescriptor",value:function(e){return f(this,void 0,void 0,r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.userDescriptorsPromise;case 2:return t.abrupt("return",this.userDescriptors.getUserDescriptor(e));case 3:case"end":return t.stop()}},t,this)}))}},{key:"getChannelUserDescriptors",value:function(e){return f(this,void 0,void 0,r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.userDescriptorsPromise;case 2:return t.abrupt("return",this.userDescriptors.getChannelUserDescriptors(e));case 3:case"end":return t.stop()}},t,this)}))}},{key:"getSubscribedUsers",value:function(){return f(this,void 0,void 0,r.default.mark(function e(){var t;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getUsersData();case 2:return e.next=4,this.myself._ensureFetched();case 4:return t=[this.myself],this.subscribedUsers.forEach(function(e){return t.push(e)}),e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}))}}]),t}(h.EventEmitter);t.Users=m},function(e,t,n){"use strict";var r=s(n(193)),i=s(n(152)),a=s(n(161)),o=s(n(189));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t,n,r){return new(n||(n=o.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var u=n(247),l=n(424),d=n(1734),f=function(){function e(t,n){(0,i.default)(this,e),this.services=t,this.url=n}return(0,a.default)(e,[{key:"getUserDescriptor",value:function(e){return c(this,void 0,void 0,r.default.mark(function t(){var n,i;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new u.UriBuilder(this.url).path(e).build(),t.next=3,this.services.network.get(n);case 3:return i=t.sent,t.abrupt("return",new d.UserDescriptor(this.services,i.body));case 5:case"end":return t.stop()}},t,this)}))}},{key:"getChannelUserDescriptors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(this,void 0,void 0,r.default.mark(function n(){var i,a,o=this;return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=new u.UriBuilder(this.url).arg("ChannelSid",e).arg("PageToken",t.pageToken).build(),n.next=3,this.services.network.get(i);case 3:return a=n.sent,n.abrupt("return",new l.RestPaginator(a.body.users.map(function(e){return new d.UserDescriptor(o.services,e)}),function(t){return o.getChannelUserDescriptors(e,{pageToken:t})},a.body.meta.prev_token,a.body.meta.next_token));case 5:case"end":return n.stop()}},n,this)}))}}]),e}();t.UserDescriptors=f},function(e,t,n){"use strict";var r=a(n(152)),i=a(n(161));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(229).Logger.scope("UserDescriptor");var s=function(){function e(t,n){(0,r.default)(this,e),this.services=t,this.descriptor=n,this.identity=n.identity,this.friendlyName=n.friendly_name,this.attributes=function(e){try{return JSON.parse(e)}catch(t){o.warn("Failed to parse user attributes",t)}return{}}(n.attributes),this.online=n.is_online,this.notifiable=n.is_notifiable}return(0,i.default)(e,[{key:"subscribe",value:function(){return this.services.users.getUser(this.identity,this.descriptor.sync_unique_name)}},{key:"_getDescriptor",value:function(){return this.descriptor}}]),e}();t.UserDescriptor=s},function(e,t,n){"use strict";var r=s(n(189)),i=s(n(261)),a=s(n(152)),o=s(n(161));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(229),u=n(832),l=c.Logger.scope("TypingIndicator"),d=function(){function e(t,n,r){(0,a.default)(this,e),this.config=t,this.services=n,this.getChannel=r,this.serviceTypingTimeout=null,this.sentUpdates=new i.default}return(0,o.default)(e,[{key:"initialize",value:function(){var e=this;this.services.notificationClient.subscribe(u.NotificationTypes.TYPING_INDICATOR,"twilsock"),this.services.notificationClient.on("message",function(t,n){t===u.NotificationTypes.TYPING_INDICATOR&&e.handleRemoteTyping(n)})}},{key:"handleRemoteTyping",value:function(e){var t=this;l.trace("Got new typing indicator ",e),this.getChannel(e.channel_sid).then(function(n){n&&n.members.forEach(function(n){n.identity===e.identity&&n._startTyping(t.typingTimeout)})}).catch(function(e){throw l.error(e),e})}},{key:"send",value:function(e){var t=this.sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?r.default.resolve():(this.sentUpdates.set(e,Date.now()),this._send(e))}},{key:"_send",value:function(e){var t=this;l.trace("Sending typing indicator");var n=this.config.typingIndicatorUri,r="ChannelSid="+e;return this.services.transport.post(n,{"Content-Type":"application/x-www-form-urlencoded"},r).then(function(e){e.body.hasOwnProperty("typing_timeout")&&(t.serviceTypingTimeout=1e3*e.body.typing_timeout)}).catch(function(e){throw l.error("Failed to send typing indicator:",e),e})}},{key:"typingTimeout",get:function(){return this.config.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.config.typingIndicatorTimeoutDefault}}]),e}();t.TypingIndicator=d},function(e,t,n){"use strict";var r=s(n(189)),i=s(n(261)),a=s(n(161)),o=s(n(152));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(851),u=function(){function e(t){(0,o.default)(this,e),this.services=t,this.consumptionHorizonRequests=new i.default,this.consumptionHorizonUpdateTimer=null}return(0,a.default)(e,[{key:"getReportInterval",value:function(){return this.services.session.getConsumptionReportInterval().then(function(e){return 1e3*e})}},{key:"delayedSendConsumptionHorizon",value:function(e){var t=this;null===this.consumptionHorizonUpdateTimer&&(this.sendConsumptionReport(!0),this.consumptionHorizonUpdateTimer=setTimeout(function(){t.sendConsumptionReport(!1)},e))}},{key:"sendConsumptionReport",value:function(e){var t=this,n=[],r=new i.default;this.consumptionHorizonRequests.forEach(function(e,t){n.push(e.entry),r.set(t,e.promises)}),n.length>0&&this.services.session.addCommand("consumptionReportV2",{report:n}).then(function(e){return t.processConsumptionReportResponse(e,r)}).catch(function(e){return t.processConsumptionReportError(e,r)}),e||(this.consumptionHorizonUpdateTimer=null),this.consumptionHorizonRequests.clear()}},{key:"processConsumptionReportResponse",value:function(e,t){e&&e.report&&Array.isArray(e.report)&&e.report.length>0&&e.report.forEach(function(e){var n=e;if(t.has(n.channelSid)){var r=null;"undefined"!==typeof n.unreadMessagesCount&&null!=n.unreadMessagesCount&&(r=n.unreadMessagesCount),t.get(n.channelSid).forEach(function(e){return e.resolve(r)}),t.delete(n.channelSid)}}),this.processConsumptionReportError(new c.SessionError("Error while setting LastConsumedMessageIndex",null),t)}},{key:"processConsumptionReportError",value:function(e,t){t.forEach(function(t){return t.forEach(function(t){return t.reject(e)})})}},{key:"updateLastConsumedMessageIndexForChannel",value:function(e,t){var n=this;return new r.default(function(r,i){n.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:t},{resolve:r,reject:i}),n.getReportInterval().then(function(e){return n.delayedSendConsumptionHorizon(e)})})}},{key:"advanceLastConsumedMessageIndexForChannel",value:function(e,t,n){var i=this,a=this.consumptionHorizonRequests.get(e);return new r.default(function(r,o){a&&a.entry?a.entry.messageIdx>=t?i.addPendingConsumptionHorizonRequest(e,a.entry,{resolve:r,reject:o}):i.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:t},{resolve:r,reject:o}):null!==n&&t<n?i.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:n},{resolve:r,reject:o}):i.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:t},{resolve:r,reject:o}),i.getReportInterval().then(function(e){return i.delayedSendConsumptionHorizon(e)})})}},{key:"addPendingConsumptionHorizonRequest",value:function(e,t,n){if(this.consumptionHorizonRequests.has(e)){var r=this.consumptionHorizonRequests.get(e);r.entry=t,r.promises.push(n)}else this.consumptionHorizonRequests.set(e,{entry:t,promises:[n]})}}]),e}();t.ConsumptionHorizon=u},function(e,t,n){"use strict";var r=s(n(193)),i=s(n(152)),a=s(n(161)),o=s(n(189));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(e,t,n,r){return new(n||(n=o.default))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});var u=n(247),l=n(424),d=n(827),f=function(){function e(t,n,r){(0,i.default)(this,e),this.client=t,this.services=n,this.url=r}return(0,a.default)(e,[{key:"getChannels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c(this,void 0,void 0,r.default.mark(function t(){var n,i,a=this;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new u.UriBuilder(this.url).arg("PageToken",e.pageToken).build(),t.next=3,this.services.network.get(n);case 3:return i=t.sent,t.abrupt("return",new l.RestPaginator(i.body.channels.map(function(e){return new d.ChannelDescriptor(a.client,e)}),function(e){return a.getChannels({pageToken:e})},i.body.meta.previous_token,i.body.meta.next_token));case 5:case"end":return t.stop()}},t,this)}))}}]),e}();t.UserChannels=f},function(e,t,n){"use strict";var r,i=n(152),a=(r=i)&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0});t.PushNotification=function e(t){(0,a.default)(this,e),this.title=t.title||null,this.body=t.body||null,this.sound=t.sound||null,this.badge=t.badge||null,this.action=t.action||null,this.type=t.type||null,this.data=t.data||{}}}])]);
//# sourceMappingURL=14.c5d54f9e.chunk.js.map